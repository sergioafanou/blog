---
layout: post
title: How To Set Filesystem Quotas on Debian 10
network: digitalocean
date: August 21, 2019 at 11:37PM
url: https://www.digitalocean.com/community/tutorials/how-to-set-filesystem-quotas-on-debian-10
image: http://ifttt.com/images/no_image_card.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="introduction">Introduction</h3>

<p>Quotas are used to limit the amount of disk space a user or group can use on a filesystem. Without such limits, a user could fill up the machine's disk and cause problems for other users and services.</p>

<p>In this tutorial we will install command line tools to create and inspect disk quotas, then set a quota for an example user.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>This tutorial assumes you are logged into a Debian 10 server, with a non-root, sudo-enabled user, as described in <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-debian-10">Initial Server Setup with Debian 10</a>.</p>

<p>The techniques in this tutorial should generally work on Linux distributions other than Debian, but may require some adaptation.</p>

<h2 id="step-1-–-installing-the-quota-tools">Step 1 – Installing the Quota Tools</h2>

<p>To set and check quotas, we first need to install the quota command line tools using <code>apt</code>. Let’s update our package list, then install the package:</p>
<pre class="code-pre shell"><code langs="">sudo apt update
sudo apt install quota
</code></pre>
<p>You can verify that the tools are installed by running the <code>quota</code> command and asking for its version information:</p>
<pre class="code-pre shell"><code langs="">quota --version
</code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Quota utilities version <span class="highlight">4.04</span>.
. . .
</code></pre>
<p>It's fine if your output shows a slightly different version number.</p>

<p>Next we will update our filesystem's <code>mount</code> options to enable quotas on our <strong>root</strong> filesystem.</p>

<h2 id="step-2-–-updating-filesystem-mount-options">Step 2 – Updating Filesystem Mount Options</h2>

<p>To activate quotas on a particular filesystem, we need to mount it with a few quota-related options specified. We do this by updating the filesystem's entry in the <code>/etc/fstab</code> configuration file. Open that file in your favorite text editor now:</p>
<pre class="code-pre shell"><code langs="">sudo nano /etc/fstab
</code></pre>
<p>The file's contents will be similar to the following:</p>
<div class="code-label " title="/etc/fstab">/etc/fstab</div><pre class="code-pre "><code langs=""># /etc/fstab: static file system information.
UUID=06b2aae3-b525-4a4c-9549-0fc6045bd08e   <span class="highlight">/</span> ext4    errors=remount-ro   0   1
</code></pre>
<p>This <code>fstab</code> file is from a virtual server. A desktop or laptop computer will probably have a slightly different looking <code>fstab</code>, but in most cases you'll have a <code>/</code> or <strong>root</strong> filesystem that represents all of your disk space.</p>

<p>Update the line pointing to the root filesystem by adding options as follows:</p>
<div class="code-label " title="/etc/fstab">/etc/fstab</div><pre class="code-pre "><code langs=""># /etc/fstab: static file system information.
UUID=06b2aae3-b525-4a4c-9549-0fc6045bd08e   /   ext4    errors=remount-ro<span class="highlight">,usrquota,grpquota</span>   0   1
</code></pre>
<p>You will add the new options to the end of any existing options, being sure to separate them all with a comma and no spaces. The above change will allow us to enable both user- (<code>usrquota</code>) and group-based (<code>grpquota</code>) quotas on the filesystem. If you only need one or the other, you may leave out the unused option. </p>

<p>Remount the filesystem to make the new options take effect:</p>
<pre class="code-pre shell"><code langs="">sudo mount -o remount /
</code></pre>
<span class='note'><p>
<strong>Note:</strong> Be certain there are no spaces between the options listed in your <code>/etc/fstab</code> file. If you put a space after the <code>,</code> comma, you will see an error like the following:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>mount: /etc/fstab: parse error at line 2 -- ignored
</code></pre>
<p>If you see this message after running the previous <code>mount</code> command, reopen the <code>fstab</code> file, correct any errors, and repeat the <code>mount</code> command before continuing.<br></p></span>

<p>We can verify that the new options were used to mount the filesystem by looking at the <code>/proc/mounts</code> file. Here, we use <code>grep</code> to show only the root filesystem entry in that file:</p>
<pre class="code-pre shell"><code langs="">cat /proc/mounts | grep ' / '
</code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>/dev/vda1 / ext4 rw,relatime,quota,<span class="highlight">usrquota</span>,<span class="highlight">grpquota</span>,errors=remount-ro,data=ordered 0 0
</code></pre>
<p>Note the two options that we specified. Now that we've installed our tools and updated our filesystem options, we can turn on the quota system.</p>

<h2 id="step-3-–-enabling-quotas">Step 3 – Enabling Quotas</h2>

<p>Before finally turning on the quota system, we need to manually run the <code>quotacheck</code> command once:</p>
<pre class="code-pre shell"><code langs="">sudo quotacheck -ugm /
</code></pre>
<p>This command creates the files <code>/aquota.user</code> and <code>/aquota.group</code>. These files contain information about the limits and usage of the filesystem, and they need to exist before we turn on quota monitoring. The <code>quotacheck</code> parameters we've used are:</p>

<ul>
<li><strong><code>u</code>:</strong> specifies that a user-based quota file should be created</li>
<li><strong><code>g</code>:</strong> indicates that a group-based quota file should be created</li>
<li><strong><code>m</code>:</strong> disables remounting the filesystem as read-only while performing the initial tallying of quotas. Remounting the filesystem as read-only will give more accurate results in case a user is actively saving files during the process, but is not necessary during this initial setup.</li>
</ul>

<p>If you don't need to enable user- or group-based quotas, you can leave off the corresponding <code>quotacheck</code> option.</p>

<p>We can verify that the appropriate files were created by listing the root directory:</p>
<pre class="code-pre shell"><code langs="">ls /
</code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div><span class="highlight">aquota.group</span>  bin   dev  home        initrd.img.old  lib64       media  opt   root  sbin  sys  usr  vmlinuz
<span class="highlight">aquota.user</span>   boot  etc  initrd.img  lib             lost+found  mnt    proc  run   srv   tmp  var  vmlinuz.old
</code></pre>
<p>If you didn't include the <code>u</code> or <code>g</code> options in the <code>quotacheck</code> command, the corresponding file will be missing. Now we're ready to turn on the quota system:</p>
<pre class="code-pre shell"><code langs="">sudo quotaon -v /
</code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>/dev/vda1 [/]: group quotas turned on
/dev/vda1 [/]: user quotas turned on
</code></pre>
<p>Our server is now monitoring and enforcing quotas, but we've not set any yet! Next we'll set a disk quota for a single user.</p>

<h2 id="step-4-–-configuring-quotas-for-a-user">Step 4 – Configuring Quotas for a User</h2>

<p>There are a few ways we can set quotas for users or groups. Here, we'll go over how to set quotas with both the <code>edquota</code> and <code>setquota</code> commands.</p>

<h3 id="using-edquota-to-set-a-user-quota">Using <code>edquota</code> to Set a User Quota</h3>

<p>We use the <code>edquota</code> command to <strong>ed</strong>it <strong>quota</strong>s. Let's edit our example <strong>sammy</strong> user's quota:</p>
<pre class="code-pre shell"><code langs="">sudo edquota -u <span class="highlight">sammy</span>
</code></pre>
<p>The <code>-u</code> option specifies that this is a <code>user</code> quota we'll be editing. If you'd like to edit a group's quota instead, use the <code>-g</code> option in its place.</p>

<p>This will open up a file in the default text editor, similar to how <code>crontab -e</code> opens a temporary file for you to edit. The file will look similar to this:</p>
<pre class="code-pre "><code langs="">Disk quotas for user <span class="highlight">sammy</span> (uid 1001):
  Filesystem                   blocks       soft       hard     inodes     soft     hard
  /dev/vda1                        24          0          0          7        0        0
</code></pre>
<p>This lists the username and <code>uid</code>, the filesystems that have quotas enabled on them, and the <em>block</em>- and <em>inode</em>-based usage and limits. Setting an inode-based quota would limit how many files and directories a user can create, regardless of the amount of disk space they use. Most people will want block-based quotas, which specifically limit disk space usage. This is what we will configure.</p>

<span class='note'><p>
<strong>Note:</strong> The concept of a <em>block</em> is poorly specified and can change depending on many factors, including which command line tool is reporting them. In the context of setting quotas on Debian, it's fairly safe to assume that 1 block equals 1 kilobyte of disk space.</p>

<p>In the above listing, our user <strong>sammy</strong> is using 24 blocks, or 24KB of space on the <code>/dev/vda1</code> drive. The <code>soft</code> and <code>hard</code> limits are both disabled with a <code>0</code> value.<br></p></span>

<p>Each type of quota allows you to set both a <em>soft limit</em> and a <em>hard limit</em>. When a user exceeds the soft limit, they are over quota, but they are not immediately prevented from consuming more space or inodes. Instead, some leeway is given: the user has – by default – seven days to get their disk use back under the soft limit. At the end of the seven day grace period, if the user is still over the soft limit it will be treated as a hard limit. A hard limit is less forgiving: all creation of new blocks or inodes is immediately halted when you hit the specified hard limit. This behaves as if the disk is completely out of space: writes will fail, temporary files will fail to be created, and the user will start to see warnings and errors while performing common tasks.</p>

<p>Let's update our <strong>sammy</strong> user to have a block quota with a 100MB soft limit, and a 110MB hard limit:</p>
<pre class="code-pre "><code langs="">Disk quotas for user <span class="highlight">sammy</span> (uid 1001):
  Filesystem                   blocks       soft       hard     inodes     soft     hard
  /dev/vda1                        24       <span class="highlight">100M</span>       <span class="highlight">110M</span>          7        0        0
</code></pre>
<p>Save and close the file. To check the new quota we can use the <code>quota</code> command:</p>
<pre class="code-pre shell"><code langs="">sudo quota -vs <span class="highlight">sammy</span>
</code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Disk quotas for user <span class="highlight">sammy</span> (uid 1001):
     Filesystem   space   quota   limit   grace   files   quota   limit   grace
      /dev/vda1     24K    <span class="highlight">100M</span>    <span class="highlight">110M</span>               7       0       0
</code></pre>
<p>The command outputs our current quota status, and shows that our quota is <code>100M</code> while our limit is <code>110M</code>. This corresponds to the soft and hard limits respectively.</p>

<span class='note'><p>
<strong>Note:</strong> If you want your users to be able to check their own quotas without having <code>sudo</code> access, you'll need to give them permission to read the quota files we created in Step 4. One way to do this would be to make a <code>users</code> group, make those files readable by the <code>users</code> group, and then make sure all your users are also placed in the group.</p>

<p>To learn more about Linux permissions, including user and group ownership, please read <a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-linux-permissions">An Introduction to Linux Permissions</a><br></p></span>

<h3 id="using-setquota-to-set-a-user-quota">Using <code>setquota</code> to Set a User Quota</h3>

<p>Unlike <code>edquota</code>, <code>setquota</code> will update our user's quota information in a single command, without an interactive editing step. We will specify the username and the soft and hard limits for both block- and inode-based quotas, and finally the filesystem to apply the quota to:</p>
<pre class="code-pre shell"><code langs="">sudo setquota -u <span class="highlight">sammy</span> 200M 220M 0 0 /
</code></pre>
<p>The above command will double <strong>sammy</strong>'s block-based quota limits to 200 megabytes and 220 megabytes. The <code>0 0</code> for inode-based soft and hard limits indicates that they remain unset. This is required even if we're not setting any inode-based quotas.</p>

<p>Once again, use the <code>quota</code> command to check our work:</p>
<pre class="code-pre shell"><code langs="">sudo quota -vs <span class="highlight">sammy</span>
</code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Disk quotas for user <span class="highlight">sammy</span> (uid 1001): 
     Filesystem   space   quota   limit   grace   files   quota   limit   grace
      /dev/vda1     24K    200M    220M               7       0       0
</code></pre>
<p>Now that we have set some quotas, let's find out how to generate a quota report.</p>

<h2 id="step-5-–-generating-quota-reports">Step 5 – Generating Quota Reports</h2>

<p>To generate a report on current quota usage for all users on a particular filesystem, use the <code>repquota</code> command:</p>
<pre class="code-pre shell"><code langs="">sudo repquota -s /
</code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>*** Report for user quotas on device /dev/vda1
Block grace time: 7days; Inode grace time: 7days
                        Space limits                File limits
User            used    soft    hard  grace    used  soft  hard  grace
----------------------------------------------------------------------
root      --    981M      0K      0K          35234     0     0
nobody    --   7664K      0K      0K              3     0     0
ntp       --     12K      0K      0K              3     0     0
_apt      --      8K      0K      0K              2     0     0
debian    --     16K      0K      0K              4     0     0
<span class="highlight">sammy     --     24K    200M    220M              7     0     0</span>
</code></pre>
<p>In this instance we're generating a report for the <code>/</code> <strong>root</strong> filesystem. The <code>-s</code> command tells <code>repquota</code> to use human-readable numbers when possible. There are a few system users listed, which probably have no quotas set by default. Our user <strong>sammy</strong> is listed at the bottom, with the amounts used and soft and hard limits.</p>

<p>Also note the <code>Block grace time: 7days</code> callout, and the <code>grace</code> column. If our user was over the soft limit, the <code>grace</code> column would show how much time they had left to get back under the limit.</p>

<p>In the next step we'll update the grace periods for our quota system.</p>

<h2 id="step-6-–-configuring-a-grace-period-for-overages">Step 6 – Configuring a Grace Period for Overages</h2>

<p>We can configure the period of time where a user is allowed to float above the soft limit. We use the <code>setquota</code> command to do so:</p>
<pre class="code-pre shell"><code langs="">sudo setquota -t 864000 864000 /
</code></pre>
<p>The above command sets both the block and inode grace times to 864000 seconds, or 10 days. This setting applies to all users, and both values must be provided even if you don't use both types of quota (block vs. inode).</p>

<p>Note that the values <em>must</em> be specified in seconds.</p>

<p>Run <code>repquota</code> again to check that the changes took effect:</p>
<pre class="code-pre shell"><code langs="">sudo repquota -s /
</code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Block grace time: <span class="highlight">10days</span>; Inode grace time: <span class="highlight">10days</span>
. . .
</code></pre>
<p>The changes should be reflected immediately in the <code>repquota</code> output.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In this tutorial we installed the <code>quota</code> command line tools, set up a block-based quota for one user, and generated a report on our filesystem's quota usage.</p>

<h3 id="appendix-common-quota-related-error-messages">Appendix: Common Quota-related Error Messages</h3>

<p>The following are some common errors you may see when setting up and manipulating filesystem quotas.</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="quotaon Output">quotaon Output</div>quotaon: cannot find //aquota.group on /dev/vda1 [/]
quotaon: cannot find //aquota.user on /dev/vda1 [/]
</code></pre>
<p>This is an error you might see if you tried to turn on quotas (using <code>quotaon</code>) before running the initial <code>quotacheck</code> command. The <code>quotacheck</code> command creates the <code>aquota</code> or <code>quota</code> files needed to turn on the quota system. See <a href="#step-3-%E2%80%93-enabling-quotas">Step 3</a> for more information.</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="quota Output">quota Output</div>quota: Cannot open quotafile //aquota.user: Permission denied
quota: Cannot open quotafile //aquota.user: Permission denied
quota: Cannot open quotafile //quota.user: No such file or directory
</code></pre>
<p>This is the error you'll see if you run <code>quota</code> and your current user does not have permission to read the quota files for your filesystem. You (or your system administrator) will need to adjust the file permissions appropriately, or use <code>sudo</code> when running commands that require access to the quota file.</p>

<p>To learn more about Linux permissions, including user and group ownership, please read <a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-linux-permissions">An Introduction to Linux Permissions</a></p>
