---
layout: post
title: Настройка WordPress с MySQL в Kubernetes с помощью Helm
network: digitalocean
date: January 24, 2020 at 04:35AM
url: https://www.digitalocean.com/community/tutorials/how-to-set-up-wordpress-with-mysql-on-kubernetes-using-helm-ru
image: http://assets.digitalocean.com/articles/wordpress_kubernetes/admin_login.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="Введение">Введение</h3>

<p>По мере того, как все больше разработчиков используют распределенную среду, такие инструменты, как <a href="https://kubernetes.io/">Kubernetes</a>, становятся центральным местом для хранения компонентов приложений, стандартизованным для динамической сборки и среды для продакшена. По мере усложнения экосистем приложений и роста популярности Kuberbetes, инструменты, помогающие управлять ресурсами внутри кластеров Kubernetes, становятся незаменимыми.</p>

<p><a href="https://helm.sh/">Helm</a> — это диспетчер пакетов с открытым исходным кодом для Kubernetes, упрощающий процесс развертывания и модернизации приложений на кластере Kubernetes, а также предоставляющий способ поиска готовых к установке приложений, упакованных в виде чартов <em>Kubernetes</em>, и обмена ими.</p>

<p>В этом руководстве мы будем использовать Helm для настройки <a href="https://wordpress.com">WordPress</a> в кластере Kubernetes для создания веб-сайта с высокой степенью доступности. Помимо предоставляемых Kubernetes возможностей использования реальной масштабируемости и повышения доступности, подобная настройка будет помогать обеспечивать безопасность WordPress с помощью упрощенного процесса модернизации и отката обновления через Helm.</p>

<p>Мы будем использовать внешний сервер MySQL, чтобы абстрагировать компонент базы данных, поскольку он может находиться в отдельном кластере или управляемой службе для расширенной доступности. После выполнения шагов, описанных в настоящем руководстве, у вас будет полностью функциональная установка WordPress в среде контейнеризированных кластеров, управляемой Kubernetes.</p>

<h2 id="Предварительные-требования">Предварительные требования</h2>

<p>Для выполнения этого руководства вам потребуется следующее:</p>

<ul>
<li>Кластер Kubernetes 1.10+ с включенным <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">контролем доступа на основе ролей</a> (RBAC).</li>
<li>Инструмент командной строки <code>kubectl</code>, установленный на локальном компьютере и настроенный для подключения к вашему кластеру. Ознакомьтесь с <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">официальной документацией Kubernetes</a> для получения информации о выполнении данной настройки.</li>
<li>Диспетчер пакетов <a href="https://helm.sh/">Helm</a>, установленный на локальном компьютере или сервере разработки, и Tiller, установленный на вашем кластере, как указано в руководстве <a href="https://www.digitalocean.com/community/tutorials/how-to-install-software-on-kubernetes-clusters-with-the-helm-package-manager">Установка программного обеспечения на кластеры Kubernetes с диспетчером пакетов Helm</a>.</li>
<li>Внешний сервер MySQL с доступом SSH и <strong>root</strong>-пароль MySQL. Для выполнения этой настройки вы можете воспользоваться одним из наших руководств, например, <a href="https://www.digitalocean.com/community/tutorials/how-to-install-mysql-on-ubuntu-18-04">руководством по установке MySQL в Ubuntu 18.04</a>.</li>
</ul>

<p>Перед тем как продолжить, убедитесь, что вы сможете войти в ваш сервер MySQL, а также что у вас есть возможность подключиться к кластеру Kubernetes. При наличии нескольких кластеров, настроенных в файле конфигурации <code>kubectl</code>, вы должны убедиться, что вы подключаетесь к нужному кластеру, запустив следующую команду на локальном компьютере или сервере разработки:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">kubectl config get-contexts
</li></ul></code></pre>
<p>Это пример вывода:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>
CURRENT   NAME                        CLUSTER                     AUTHINFO                          NAMESPACE
*         do-sfo2-wordpress-cluster   do-sfo2-wordpress-cluster   do-sfo2-wordpress-cluster-admin   
          minikube                    minikube                    minikube                                              
</code></pre>
<p>Знак звездочки (*) указывает, какой кластер в настоящее время используется в качестве <em>контекста по умолчанию</em>. Если вам потребуется изменить текущий контекст, запустите:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">kubectl config use-context <span class="highlight">context-name</span>
</li></ul></code></pre>
<p>Теперь вы должны быть готовы к выполнению остальной части руководства.</p>

<h2 id="Шаг-1-—-Настройка-mysql">Шаг 1 — Настройка MySQL</h2>

<p>Во-первых, мы создадим выделенных пользователя и базу данных MySQL для WordPress, что позволит подключиться к внешним хостам. Это необходимо, поскольку наша установка WordPress будет находиться на отдельном сервере внутри кластера Kubernetes. Если у вас уже есть выделенные пользователь и база данных MySQL для WordPress, вы можете сразу перейти к следующему шагу.</p>

<p>На сервере MySQL выполните вход в MySQL с помощью следующей команды:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">mysql -u root -p
</li></ul></code></pre>
<p>Вам будет предложено указать пароль, который вы задали для учетной записи <strong>root</strong> MySQL при первоначальной установке программного обеспечения. После входа MySQL отобразит командную строку, которую вы сможете использовать для создания базы данных и пользователя, которые нам потребуются для WordPress.</p>

<p><span class='note'><strong>Примечание.</strong> В данном руководстве мы будем создавать базу данных <code><span class="highlight">wordpress</span></code> и пользователя <code><span class="highlight">wordpress_user</span></code> с паролем <code><span class="highlight">password</span></code>. Обратите внимание, что эти значения являются небезопасными и используются в качестве примера, поэтому вы <strong>должны изменить</strong> их соответствующим образом в данном руководстве.<br></span></p>

<p>Для создания базы данных вы можете использовать следующее заявление:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">CREATE DATABASE <span class="highlight">wordpress</span>;
</li></ul></code></pre>
<p>Теперь мы создадим выделенного пользователя MySQL для этой базы данных:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">CREATE USER <span class="highlight">wordpress_user</span> IDENTIFIED BY '<span class="highlight">password</span>';
</li></ul></code></pre>
<p>Пользователь <code><span class="highlight">wordpress_user</span></code> был создан, но у него пока нет каких-либо разрешений. Следующая команда предоставит данному пользователю доступ администратора (все права) для базы данных <strong>wordpress</strong> как в локальной, так и во внешней сети:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">GRANT ALL PRIVILEGES ON <span class="highlight">wordpress</span>.* TO <span class="highlight">wordpress_user</span>@'%';
</li></ul></code></pre>
<p>Для обновления внутренних таблиц MySQL, которые будут управлять разрешениями, используйте следующее заявление:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">FLUSH PRIVILEGES;
</li></ul></code></pre>
<p>Теперь вы можете закрыть клиент MySQL с помощью следующей команды:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">exit;
</li></ul></code></pre>
<p>Для проверки успешного внесения изменений вы снова можете войти в клиент командной строки, на этот раз используя новую учетную запись <code><span class="highlight">wordpress_user</span></code> для аутентификации:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">mysql -u <span class="highlight">wordpress_user</span> -p
</li></ul></code></pre>
<p>Вы должны использовать тот же пароль, который вы указали при создании этого пользователя MySQL с заявлением <code>CREATE_USER</code>. Для подтверждения того, что ваш новый пользователь имеет доступ к базе данных <code><span class="highlight">wordpress</span></code>, воспользуйтесь следующим заявлением:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">show databases;
</li></ul></code></pre>
<p>Вы должны увидеть следующий вывод:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>+--------------------+
| Database           |
+--------------------+
| information_schema |
| <span class="highlight">wordpress</span>          |
+--------------------+
2 rows in set (0.03 sec)
</code></pre>
<p>После подтверждения того, что база данных <code><span class="highlight">wordpress</span></code> включена в результаты, вы можете закрыть клиент командной строки MySQL с помощью следующей команды:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">exit;
</li></ul></code></pre>
<p>Теперь у вас есть выделенная база данных MySQL для WordPress и действительные учетные данные доступа для использования с базой данных. Поскольку наша установка WordPress будет находиться на отдельном сервере, нам нужно изменить конфигурацию MySQL, чтобы разрешить подключения с внешних хостов.</p>

<p>Находясь на сервере MySQL, откройте файл <code>/etc/mysql/mysql.conf.d/mysqld.cnf</code> с помощью любого предпочитаемого вами редактора с командной строкой:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf
</li></ul></code></pre>
<p>Найдите настройку <code>bind-address</code> внутри файла. По умолчанию MySQL прослушивает только <code>127.0.0.1</code> (localhost). Для поддержки подключений с внешних хостов нам нужно изменить это значение на <code>0.0.0.0</code>. Вот как должна выглядеть конфигурация <code>bind-address</code>:</p>
<div class="code-label " title="/etc/mysql/mysql.conf.d/mysqld.cnf">/etc/mysql/mysql.conf.d/mysqld.cnf</div><pre class="code-pre "><code langs="">
# Instead of skip-networking the default is now to listen only on
# localhost which is more compatible and is not less secure.
bind-address            = <span class="highlight">0.0.0.0</span>
</code></pre>
<p>Когда вы закончите внесение изменений, сохраните и закройте файл. Вам нужно будет перезапустить MySQL с помощью следующей команды:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart mysql
</li></ul></code></pre>
<p>Для проверки того, что вы сможете подключиться удаленно, запустите следующую команду на локальном компьютере или сервере разработки:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">mysql -h <span class="highlight">mysql_server_ip</span> -u <span class="highlight">wordpress_user</span> -p
</li></ul></code></pre>
<p>Не забудьте заменить <code><span class="highlight">mysql_server_ip</span></code> на ваш IP-адрес или имя хоста сервера MySQL. Если подключение будет выполнено без ошибок, вы можете перейти к следующему шагу.</p>

<h2 id="Шаг-2-—-Установка-wordpress">Шаг 2 — Установка WordPress</h2>

<p>Теперь, когда у нас есть вся информация для подключения к базе данных MySQL, мы можем перейти к установке WordPress с помощью Helm.</p>

<p>По умолчанию чарт WordPress устанавливает <a href="https://mariadb.org/">MariaDB</a> на отдельном поде внутри кластера и использует ее в качестве базы данных WordPress. Мы хотим отключить это поведение и настроить WordPress для использования внешней базы данных MySQL. Эти и другие параметры конфигурации (например, пользователь и пароль администратора WordPress по умолчанию) можно задать при установке либо с помощью параметров командной строки, либо с помощью отдельного файла конфигурации YAML.</p>

<p>Чтобы обеспечить организацию и возможность расширения, мы будем использовать файл конфигурации.</p>

<p>На локальном компьютере или сервере разработки создайте новую директорию для настроек проекта и перейдите в нее:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">mkdir myblog-settings
</li><li class="line" prefix="$">cd myblog-settings
</li></ul></code></pre>
<p>Далее создайте файл с именем <code>values.yaml</code> с помощью текстового редактора на ваш выбор:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano values.yaml
</li></ul></code></pre>
<p>Внутри файла нам нужно задать несколько параметров, которые будут определять, как WordPress подключается к базе данных, а также добавить базовую информацию для вашего сайта и первоначального пользователя с правами администратора для входа в WordPress, когда установка будет завершена.</p>

<p>При создании нашей конфигурации мы будем опираться на файл <code>values.yaml</code> по умолчанию из <a href="https://github.com/bitnami/charts/blob/master/upstreamed/wordpress/values.yaml">чарта WordPress Helm</a>. Раздел <strong><em>Blog/Site Info</em></strong> (Информация о блоге/сайте) содержит общие параметры блога WordPress, например, название блога и первоначальные учетные данные пользователя. Раздел <strong><em>Database Settings</em></strong> (Настройки базы данных) данного файла содержит параметры для подключения к удаленному серверу MySQL. MariaDB отключается в заключительном разделе.</p>

<p>Скопируйте следующее содержимое в файл <code>values.yaml</code>, заменив выделенные значения на собственные:</p>
<div class="code-label " title="values.yaml">values.yaml</div><pre class="code-pre "><code langs="">
## Blog/Site Info
wordpressUsername: <span class="highlight">sammy</span>
wordpressPassword: <span class="highlight">password</span>
wordpressEmail: <span class="highlight">sammy@example.com</span>
wordpressFirstName: <span class="highlight">Sammy</span>
wordpressLastName: <span class="highlight">the Shark</span>
wordpressBlogName: <span class="highlight">Sammy's Blog!</span>

## Database Settings
externalDatabase:
  host: <span class="highlight">mysql_server_ip</span>
  user: <span class="highlight">wordpress_user</span>
  password: <span class="highlight">password</span>
  database: <span class="highlight">wordpress</span>

## Disabling MariaDB
mariadb:
  enabled: false
</code></pre>
<p>Мы успешно настроили следующие параметры:</p>

<ul>
<li><strong>wordpressUsername</strong>: логин пользователя WordPress.</li>
<li><strong>wordpressPassword</strong>: пароль пользователя WordPress.</li>
<li><strong>wordpressEmail</strong>: электронная почта пользователя WordPress.</li>
<li><strong>wordpressFirstName</strong>: имя пользователя Wordpress.</li>
<li><strong>wordpressLastName</strong>: фамилия пользователя Wordpress.</li>
<li><strong>wordpressBlogName</strong>: название сайта или блога.</li>
<li><strong>host</strong>: IP-адрес или имя хоста сервера MySQL.</li>
<li><strong>user</strong>: пользователь MySQL.</li>
<li><strong>password</strong>: пароль MySQL.</li>
<li><strong>database</strong>: имя базы данных MySQL.</li>
</ul>

<p>Когда вы закончите редактирование, сохраните файл и закройте редактор.</p>

<p>Теперь, когда у нас есть все параметры, настало время запустить <code>helm</code> для установки WordPress. Следующая команда указывает <code>helm</code> установить самую последнюю стабильную версию чарта WordPress с именем <code><span class="highlight">myblog</span></code> с помощью файла конфигурации <code>values.yaml</code>:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">helm install --name <span class="highlight">myblog</span> -f values.yaml stable/wordpress
</li></ul></code></pre>
<p>Вывод должен выглядеть примерно следующим образом:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>
NAME:   myblog
LAST DEPLOYED: Fri Jan 25 20:24:10 2019
NAMESPACE: default
STATUS: DEPLOYED

RESOURCES:
==&gt; v1/Deployment
NAME              READY  UP-TO-DATE  AVAILABLE  AGE
myblog-wordpress  0/1    1           0          1s

==&gt; v1/PersistentVolumeClaim
NAME              STATUS   VOLUME            CAPACITY  ACCESS MODES  STORAGECLASS  AGE
myblog-wordpress  Pending  do-block-storage  1s

==&gt; v1/Pod(related)
NAME                               READY  STATUS   RESTARTS  AGE
myblog-wordpress-5965f49485-8zfl7  0/1    Pending  0         1s

==&gt; v1/Secret
NAME               TYPE    DATA  AGE
myblog-externaldb  Opaque  1     1s
myblog-wordpress   Opaque  1     1s

==&gt; v1/Service
NAME              TYPE          CLUSTER-IP     EXTERNAL-IP  PORT(S)                     AGE
myblog-wordpress  LoadBalancer  10.245.144.79  &lt;pending&gt;    80:31403/TCP,443:30879/TCP  1s

(...)
</code></pre>
<p>После завершения установки служба с именем <strong>myblog-wordpress</strong> создается внутри кластера Kubernetes, но может потребоваться несколько минут, пока контейнер будет готов и информация об <code>External-IP</code> (Внешний IP) станет доступна. Чтобы проверить статус этой службы и получить внешний IP-адрес, запустите:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">kubectl get services
</li></ul></code></pre>
<p>Вывод должен выглядеть примерно следующим образом:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>
NAME               TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)                      AGE
kubernetes         ClusterIP      10.245.0.1      &lt;none&gt;          443/TCP                      20h
<span class="highlight">myblog-wordpress</span>   LoadBalancer   10.245.144.79   <span class="highlight">203.0.113.110</span>   80:31403/TCP,443:30879/TCP   3m40s

</code></pre>
<p>Эта команда предоставляет подробную информацию о службах, запущенных на кластере, включая имя и тип службы, а также IP-адреса, используемые этими службами. Как видно из вывода, установка WordPress обслуживается как <code>myblog-wordpress</code> на внешнем IP-адресе <code>203.0.113.110</code>.</p>

<p><span class='note'><strong>Примечание.</strong> Если вы используете <code>minikube</code> для проверки этой настройки, вам нужно будет запустить команду <code>minikube service myblog-wordpress</code> для получения доступа к веб-серверу контейнера, что позволит получить доступ из браузера.<br></span></p>

<p>Теперь ваша установка WordPress готова к работе. Для доступа к интерфейсу администратора используйте публичный IP-адрес, полученный из вывода команды <code>kubectl get services</code>, за которым следует <code>/wp-admin</code>, в браузере:</p>
<pre class="code-pre "><code langs="">http://<span class="highlight">203.0.113.110</span>/wp-admin
</code></pre>
<p><img src="http://assets.digitalocean.com/articles/wordpress_kubernetes/admin_login.png" alt="Экран входа"></p>

<p>Вы должны использовать учетные данные, определенные в файле <code>values.yaml</code>, для входа и начала настройки сайта WordPress.</p>

<h2 id="Шаг-3-—-Обновление-wordpress">Шаг 3 — Обновление WordPress</h2>

<p>Из-за своей популярности WordPress часто становится целью злоумышленников, поэтому очень важно своевременно обновлять ее. Мы можем обновлять версии Helm с помощью команды <code>helm upgrade</code>.</p>

<p>Чтобы вывести список всех ваших текущих версий, запустите следующую команду на локальном компьютере или сервере разработки:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">helm list
</li></ul></code></pre>
<p>Результат должны выглядеть примерно следующим образом:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>NAME        REVISION    UPDATED                     STATUS      CHART           APP VERSION NAMESPACE
myblog      1           Fri Jan 25 20:24:10 2019    DEPLOYED    wordpress-<span class="highlight">5.1.2</span>   <span class="highlight">5.0.3</span>     default  

</code></pre>
<p>Как видно из вывода, наша версия WordPress — <code>5.0.3</code> (версия приложения), в то время как версия в чарте — <code>5.1.2</code>. Если вы хотите обновить версию на более новую в чарте, обновите репозитории Helm с помощью следующей команды:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">helm repo update
</li></ul></code></pre>
<p>Вы должны получить следующий вывод:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Hang tight while we grab the latest from your chart repositories...
...Skip local chart repository
...Successfully got an update from the "stable" chart repository
Update Complete. ⎈ Happy Helming!⎈
</code></pre>
<p>Теперь вы можете проверить, доступна ли в чарте WordPress более новая версия:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">helm inspect chart stable/wordpress
</li></ul></code></pre>
<p>Результат должен выглядеть примерно следующим образом:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>apiVersion: v1
appVersion: <span class="highlight">5.1.1</span>
description: Web publishing platform for building blogs and websites.
engine: gotpl
home: http://www.wordpress.com/
icon: https://bitnami.com/assets/stacks/wordpress/img/wordpress-stack-220x234.png
keywords:
- wordpress
- cms
- blog
- http
- web
- application
- php
maintainers:
- email: containers@bitnami.com
  name: Bitnami
name: wordpress
sources:
- https://github.com/bitnami/bitnami-docker-wordpress
version: <span class="highlight">5.9.0</span>
</code></pre>
<p>Как видно из вывода, есть новый чарт (версия 5.9.0) с WordPress <strong>5.1.1</strong> (версия приложения). Если вы хотите обновить вашу версию WordPress на самую последнюю версию, доступную в чарте Wordpress, запустите следующую команду:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">helm upgrade -f values.yaml <span class="highlight">myblog</span> stable/wordpress
</li></ul></code></pre>
<p>Эта команда будет генерировать вывод, аналогичный выводу команды <code>helm install</code>. Важно предоставить тот же файл конфигурации, который мы использовали при первой установке чарта WordPress, потому что он содержит пользовательские настройки базы данных, которые мы определили при установке.</p>

<p>Теперь, если вы снова запустите <code>helm list</code>, вы должны будете увидеть обновленную информацию о вашей версии:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>
NAME    REVISION    UPDATED                     STATUS      CHART           APP VERSION     NAMESPACE
myblog  2           Fri May  3 14:51:20 2019    DEPLOYED    wordpress-<span class="highlight">5.9.0</span>   <span class="highlight">5.1.1</span>         default  

</code></pre>
<p>Вы успешно обновили WordPress до последней версии из чарта WordPress.</p>

<h3 id="Откат-версии">Откат версии</h3>

<p>При каждом обновлении версии Helm создает новый <strong><em>выпуск</em></strong> данной версии. Выпуск задает фиксированную <em>точку сохранения</em>, в которую вы можете вернуться, если все будет работать, как ожидалось. Это похоже на <em>commit</em> в Git, потому что в этом случае создается история изменений, которые можно сравнить и откатывать. Если при обновлении что-то пойдет не так, вы всегда можете откатиться к предыдущему выпуску определенной версии Helm с помощью команды <code>helm rollback</code>:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">helm rollback <span class="highlight">release-name revision-number</span>
</li></ul></code></pre>
<p>Например, если мы хотим отменить обновление и откатиться к <strong>первой</strong> версии WordPress, мы должны воспользоваться следующей командой:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">helm rollback myblog <span class="highlight">1</span>
</li></ul></code></pre>
<p>В результате будет выполнен откат к первой версии нашей установки WordPress. Вы должны получить следующий вывод, показывающий, что откат изменений выполнен успешно:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>
Rollback was a success! Happy Helming!
</code></pre>
<p>Выполните команду <code>helm list</code> снова, и вывод должен показывать, что версия WordPress была понижена до 5.0.3, а версия чарта — 5.1.2:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>
NAME        REVISION    UPDATED                     STATUS      CHART           APP VERSION NAMESPACE
myblog      3       Mon Jan 28 22:02:42 2019    DEPLOYED    wordpress-<span class="highlight">5.1.2</span>   <span class="highlight">5.0.3</span>         default  

</code></pre>
<p>Обратите внимание, что при откате к предыдущей версии создается новый выпуск, опирающийся на заданную при откате версию. Наша версия WordPress с именем <code>myblog</code> в настоящий момент имеет номер выпуска <strong>три</strong>, которая опирается на версию номер <strong>один</strong>.</p>

<h2 id="Заключение">Заключение</h2>

<p>В этом руководстве мы установили WordPress с внешним сервером MySQL на кластере Kubernetes с помощью инструмента командной строки Helm. Также мы узнали, как обновить версию WordPress до новой версии чарта, а также как откатить назад версию, если в процессе обновления что-то пойдет не так.</p>

<p>В качестве дополнительных шагов вы можете рассмотреть <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-an-nginx-ingress-with-cert-manager-on-digitalocean-kubernetes">настройку Nginx Ingress с Cert-Manager</a>, чтобы активировать виртуальный хостинг на основе имен и настроить сертификат SSL для вашего сайта WordPress. Также вы должны проверить <a href="https://github.com/helm/charts/tree/master/stable/wordpress#production-and-horizontal-scaling">рекомендуемые настройки для продакшена</a> в случае использования чарта WordPress, который мы задействовали в настоящем руководстве.</p>

<p>Если вы хотите узнать больше о Kubernetes и Helm, ознакомьтесь с разделом <a href="https://www.digitalocean.com/community/tags/kubernetes">Kubernetes</a> на странице нашего сообщества.</p>
