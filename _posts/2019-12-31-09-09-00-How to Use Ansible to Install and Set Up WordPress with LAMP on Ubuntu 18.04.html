---
layout: post
title: How to Use Ansible to Install and Set Up WordPress with LAMP on Ubuntu 18.04
network: digitalocean
date: December 31, 2019 at 09:09AM
url: https://www.digitalocean.com/community/tutorials/how-to-use-ansible-to-install-and-set-up-wordpress-with-lamp-on-ubuntu-18-04
image: https://assets.digitalocean.com/articles/wordpress_lamp_1604/language_selection.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="introduction">Introduction</h3>

<p>Server automation now plays an essential role in systems administration, due to the disposable nature of modern application environments. <a href="https://www.digitalocean.com/community/tutorial_series/getting-started-with-configuration-management">Configuration management</a> tools such as <a href="https://ansible.com">Ansible</a> are typically used to streamline the process of automating server setup by establishing standard procedures for new servers while also reducing human error associated with manual setups.</p>

<p>Ansible offers a simple architecture that doesn&rsquo;t require special software to be installed on nodes. It also provides a robust set of features and built-in modules which facilitate writing automation scripts.</p>

<p>This guide explains how to use Ansible to automate the steps contained in our guide on <a href="https://www.digitalocean.com/community/tutorials/how-to-install-wordpress-with-lamp-on-ubuntu-18-04">How To Install WordPress with LAMP on Ubuntu 18.04</a>. WordPress is the most popular CMS (content management system) on the internet, allowing users to set up flexible blogs and websites on top of a MySQL backend with PHP processing. After setup, almost all administration can be done through the web frontend.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>In order to execute the automated setup provided by the playbook we&rsquo;re discussing in this guide, you&rsquo;ll need:</p>

<ul>
<li><strong>One Ansible control node</strong>: an Ubuntu 18.04 machine with Ansible installed and configured to connect to your Ansible hosts using SSH keys. Make sure the control node has a regular user with sudo permissions and a firewall enabled, as explained in our <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-18-04">Initial Server Setup</a> guide. To set up Ansible, please follow our guide on <a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-ansible-on-ubuntu-18-04">How to Install and Configure Ansible on Ubuntu 18.04</a>.</li>
<li><strong>One or more Ansible Hosts</strong>: one or more remote Ubuntu 18.04 servers previously set up following the guide on <a href="https://www.digitalocean.com/community/tutorials/how-to-use-ansible-to-automate-initial-server-setup-on-ubuntu-18-04">How to Use Ansible to Automate Initial Server Setup on Ubuntu 18.04</a>.</li>
</ul>

<p><span class='note'>Before proceeding, you first need to make sure your Ansible control node is able to connect and execute commands on your Ansible host(s). For a connection test, please check step 3 of <a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-ansible-on-ubuntu-18-04#step-3-%E2%80%94-testing-connection">How to Install and Configure Ansible on Ubuntu 18.04</a>.<br></span></p>

<h2 id="what-does-this-playbook-do">What Does this Playbook Do?</h2>

<p>This Ansible playbook provides an alternative to manually running through the procedure outlined in our guide on <a href="https://www.digitalocean.com/community/tutorials/how-to-install-wordpress-with-lamp-on-ubuntu-18-04">How To Install WordPress with LAMP on Ubuntu 18.04</a>.</p>

<p>Running this playbook will perform the following actions on your Ansible hosts:</p>

<ol>
<li>Install <code>aptitude</code>, which is preferred by Ansible as an alternative to the <code>apt</code> package manager.</li>
<li>Install the required LAMP packages and PHP extensions.</li>
<li>Create and enable a new Apache <code>VirtualHost</code> for the WordPress website.</li>
<li>Enable the Apache rewrite (<code>mod_rewrite</code>) module.</li>
<li>Disable the default Apache website.</li>
<li>Set the password for the MySQL <strong>root</strong> user.</li>
<li>Remove anonymous MySQL accounts and the test database.</li>
<li>Create a new MySQL database and user for the WordPress website.</li>
<li>Set up UFW to allow HTTP traffic on the configured port (<code>80</code> by default).</li>
<li>Download and unpack WordPress.</li>
<li>Set up correct directory ownership and permissions.</li>
<li>Set up the <code>wp-config.php</code> file using the provided template. </li>
</ol>

<p>Once the playbook has finished running, you will have a WordPress installation running on top of a LAMP environment, based on the options you defined within your configuration variables.</p>

<h2 id="how-to-use-this-playbook">How to Use this Playbook</h2>

<p>The first thing we need to do is obtain the WordPress on LAMP playbook and its dependencies from the <a href="https://github.com/do-community/ansible-playbooks">do-community/ansible-playbooks</a> repository. We need to clone this repository to a local folder inside the Ansible Control Node.</p>

<p>In case you have cloned this repository before while following a different guide, access your existing <code>ansible-playbooks</code> copy and run a <code>git pull</code> command to make sure you have updated contents:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd ~/ansible-playbooks
</li><li class="line" prefix="$">git pull
</li></ul></code></pre>
<p>If this is your first time using the <code>do-community/ansible-playbooks</code> repository, you should start by cloning the repository to your home folder with:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd ~
</li><li class="line" prefix="$">git clone https://github.com/do-community/ansible-playbooks.git
</li><li class="line" prefix="$">cd ansible-playbooks
</li></ul></code></pre>
<p>The files we&rsquo;re interested in are located inside the <code>wordpress-lamp_ubuntu1804</code> folder, which has the following structure:</p>
<pre class="code-pre "><code langs="">wordpress-lamp_ubuntu1804
├── files
│   ├── apache.conf.j2
│   └── wp-config.php.j2
├── vars
│   └── default.yml
├── playbook.yml
└── readme.md
</code></pre>
<p>Here is what each of these files are:</p>

<ul>
<li><code>files/apache.conf.j2</code>: Template file for setting up the Apache VirtualHost.</li>
<li><code>files/wp-config.php.j2</code>: Template file for setting up WordPress&rsquo;s configuration file.</li>
<li><code>vars/default.yml</code>: Variable file for customizing playbook settings.</li>
<li><code>playbook.yml</code>: The playbook file, containing the tasks to be executed on the remote server(s).</li>
<li><code>readme.md</code>: A text file containing information about this playbook.</li>
</ul>

<p>We&rsquo;ll edit the playbook&rsquo;s variable file to customize its options. Access the <code>wordpress-lamp_ubuntu1804</code> directory and open the <code>vars/default.yml</code> file using your command line editor of choice:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd wordpress-lamp_ubuntu1804
</li><li class="line" prefix="$">nano vars/default.yml
</li></ul></code></pre>
<p>This file contains a few variables that require your attention:</p>
<div class="code-label " title="vars/default.yml">vars/default.yml</div><pre class="code-pre yaml local-environment"><code langs="">---
#System Settings
php_modules: [ 'php-curl', 'php-gd', 'php-mbstring', 'php-xml', 'php-xmlrpc', 'php-soap', 'php-intl', 'php-zip' ]

#MySQL Settings
mysql_root_password: "<span class="highlight">mysql_root_password</span>"
mysql_db: "<span class="highlight">wordpress</span>"
mysql_user: "<span class="highlight">sammy</span>"
mysql_password: "<span class="highlight">password</span>"

#HTTP Settings
http_host: "<span class="highlight">your_domain</span>"
http_conf: "<span class="highlight">your_domain.conf</span>"
http_port: "<span class="highlight">80</span>"
</code></pre>
<p>The following list contains a brief explanation of each of these variables and how you might want to change them:</p>

<ul>
<li> <code>php_modules</code>:  An array containing PHP extensions that should be installed to support your WordPress setup. You don&rsquo;t need to change this variable, but you might want to include new extensions to the list if your specific setup requires it.</li>
<li><code>mysql_root_password</code>: The desired password for the <strong>root</strong> MySQL account.</li>
<li><code>mysql_db</code>: The name of the MySQL database that should be created for WordPress.</li>
<li><code>mysql_user</code>: The name of the MySQL user that should be created for WordPress.</li>
<li><code>mysql_password</code>: The password for the new MySQL user.</li>
<li><code>http_host</code>: Your domain name.</li>
<li><code>http_conf</code>: The name of the configuration file that will be created within Apache.</li>
<li><code>http_port</code>: HTTP port for this virtual host, where <code>80</code> is the default. </li>
</ul>

<p>Once you&rsquo;re done updating the variables inside <code>vars/default.yml</code>, save and close this file. If you used <code>nano</code>, do so by pressing <code>CTRL + X</code>, <code>Y</code>, then <code>ENTER</code>.</p>

<p>You&rsquo;re now ready to run this playbook on one or more servers. Most playbooks are configured to be executed on every server in your inventory, by default. We can use the <code>-l</code> flag to make sure that only a subset of servers, or a single server, is affected by the playbook. We can also use the <code>-u</code> flag to specify which user on the remote server we&rsquo;re using to connect and execute the playbook commands on the remote hosts.</p>

<p>To execute the playbook only on <code><span class="highlight">server1</span></code>, connecting as <code><span class="highlight">sammy</span></code>, you can use the following command:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ansible-playbook playbook.yml -l <span class="highlight">server1</span> -u <span class="highlight">sammy</span>
</li></ul></code></pre>
<p>You will get output similar to this:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>PLAY [all] *****************************************************************************************************************************

TASK [Gathering Facts] *****************************************************************************************************************
ok: [server1]

TASK [Install prerequisites] ***********************************************************************************************************
ok: [server1]

&hellip;

TASK [Download and unpack latest WordPress] ********************************************************************************************
changed: [server1]

TASK [Set ownership] *******************************************************************************************************************
changed: [server1]

TASK [Set permissions for directories] *************************************************************************************************
changed: [server1]

TASK [Set permissions for files] *******************************************************************************************************
changed: [server1]

TASK [Set up wp-config] ****************************************************************************************************************
changed: [server1]

RUNNING HANDLER [Reload Apache] ********************************************************************************************************
changed: [server1]

RUNNING HANDLER [Restart Apache] *******************************************************************************************************
changed: [server1]

PLAY RECAP *****************************************************************************************************************************
server1          : ok=22   changed=18   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

</code></pre>
<p><span class='note'><strong>Note</strong>: For more information on how to run Ansible playbooks, check our <a href="https://www.digitalocean.com/community/tutorials/how-to-use-ansible-cheat-sheet-guide">Ansible Cheat Sheet Guide</a>.<br></span></p>

<p>When the playbook is finished running, you can go to your web browser to finish WordPress&rsquo;s installation from there.</p>

<p>Navigate to your server’s domain name or public IP address:</p>
<pre class="code-pre "><code langs="">http://<span class="highlight">server_host_or_IP</span>
</code></pre>
<p>You will see a page like this:</p>

<p><img src="https://assets.digitalocean.com/articles/wordpress_lamp_1604/language_selection.png" alt="WordPress language selection page"></p>

<p>After selecting the language you&rsquo;d like to use for your WordPress installation, you&rsquo;ll be presented with a final step to set up your WordPress user and password so you can log into your control panel: </p>

<p><img src="https://assets.digitalocean.com/articles/wordpress_lamp_1604/setup_installation.png" alt="WordPress Setup"></p>

<p>When you click ahead, you will be taken to a page that prompts you to log in:</p>

<p><img src="https://assets.digitalocean.com/articles/wordpress_lamp_1604/login_prompt.png" alt="WP login prompt"></p>

<p>Once you log in, you will be taken to the WordPress administration dashboard:</p>

<p><img src="https://assets.digitalocean.com/articles/automated_ansible/wordpress_panel.png" alt="WP Admin Panel"></p>

<p>Some common next steps for customizing your WordPress installation include choosing the permalinks setting for your posts (can be found in <code>Settings &gt; Permalinks</code>) and selecting a new theme (in <code>Appearance &gt; Themes</code>).</p>

<h2 id="the-playbook-contents">The Playbook Contents</h2>

<p>You can find the WordPress on LAMP server setup featured in this tutorial in the <a href="https://github.com/do-community/ansible-playbooks/tree/master/wordpress-lamp_ubuntu1804"><code>wordpress-lamp_ubuntu1804</code></a> folder inside the <a href="https://github.com/do-community/ansible-playbooks">DigitalOcean Community Playbooks</a> repository. To copy or download the script contents directly, click the <strong>Raw</strong> button towards the top of each script.</p>

<p>The full contents of the playbook as well as its associated files are also included here for your convenience.</p>

<h3 id="vars-default-yml">vars/default.yml</h3>

<p>The <code>default.yml</code> variable file contains values that will be used within the playbook tasks, such as the database settings and the domain name to configure within Apache.</p>
<div class="code-label " title="vars/default.yml">vars/default.yml</div><pre class="code-pre yaml local-environment"><code langs="">#System Settings
php_modules: [ 'php-curl', 'php-gd', 'php-mbstring', 'php-xml', 'php-xmlrpc', 'php-soap', 'php-intl', 'php-zip' ]

#MySQL Settings
mysql_root_password: "<span class="highlight">mysql_root_password</span>"
mysql_db: "<span class="highlight">wordpress</span>"
mysql_user: "<span class="highlight">sammy</span>"
mysql_password: "<span class="highlight">password</span>"

#HTTP Settings
http_host: "<span class="highlight">your_domain</span>"
http_conf: "<span class="highlight">your_domain.conf</span>"
http_port: "<span class="highlight">80</span>"
</code></pre>
<h3 id="files-apache-conf-j2">files/apache.conf.j2</h3>

<p>The <code>apache.conf.j2</code> file is a <a href="https://jinja.palletsprojects.com/en/2.10.x/">Jinja 2</a> template file that configures a new Apache VirtualHost. The variables used within this template are defined in the <code>vars/default.yml</code> variable file.</p>
<div class="code-label " title="files/apache.conf.j2">files/apache.conf.j2</div><pre class="code-pre  local-environment"><code langs="">&lt;VirtualHost *:{{ http_port }}&gt;
   ServerAdmin webmaster@localhost
   ServerName {{ http_host }}
   ServerAlias www.{{ http_host }}
   DocumentRoot /var/www/{{ http_host }}
   ErrorLog ${APACHE_LOG_DIR}/error.log
   CustomLog ${APACHE_LOG_DIR}/access.log combined

   &lt;Directory /var/www/{{ http_host }}&gt;
         Options -Indexes
   &lt;/Directory&gt;

   &lt;IfModule mod_dir.c&gt;
       DirectoryIndex index.php index.html index.cgi index.pl  index.xhtml index.htm
   &lt;/IfModule&gt;

&lt;/VirtualHost&gt;
</code></pre>
<h3 id="files-wp-config-php-j2">files/wp-config.php.j2</h3>

<p>The <code>wp-config.php.j2</code> file is another Jinja template, used to set up the main configuration file used by WordPress. The variables used within this template are defined in the <code>vars/default.yml</code> variable file. Unique authentication keys and salts are generated using a hash function.</p>
<div class="code-label " title="files/info.php.j2">files/info.php.j2</div><pre class="code-pre  local-environment"><code langs="">&lt;?php
/**
 * The base configuration for WordPress
 *
 * The wp-config.php creation script uses this file during the
 * installation. You don't have to use the web site, you can
 * copy this file to "wp-config.php" and fill in the values.
 *
 * This file contains the following configurations:
 *
 * * MySQL settings
 * * Secret keys
 * * Database table prefix
 * * ABSPATH
 *
 * @link https://codex.wordpress.org/Editing_wp-config.php
 *
 * @package WordPress
 */

// ** MySQL settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
define( 'DB_NAME', '{{ mysql_db }}' );

/** MySQL database username */
define( 'DB_USER', '{{ mysql_user }}' );

/** MySQL database password */
define( 'DB_PASSWORD', '{{ mysql_password }}' );

/** MySQL hostname */
define( 'DB_HOST', 'localhost' );

/** Database Charset to use in creating database tables. */
define( 'DB_CHARSET', 'utf8' );

/** The Database Collate type. Don't change this if in doubt. */
define( 'DB_COLLATE', '' );

/** Filesystem access **/
define('FS_METHOD', 'direct');

/**#@+
 * Authentication Unique Keys and Salts.
 *
 * Change these to different unique phrases!
 * You can generate these using the {@link https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service}
 * You can change these at any point in time to invalidate all existing cookies. This will force all users to have to log in again.
 *
 * @since 2.6.0
 */
define( 'AUTH_KEY',         '{{ ansible_date_time.iso8601_micro | hash('sha256') }}' );
define( 'SECURE_AUTH_KEY',  '{{ ansible_date_time.iso8601_micro | hash('sha256') }}' );
define( 'LOGGED_IN_KEY',    '{{ ansible_date_time.iso8601_micro | hash('sha256') }}' );
define( 'NONCE_KEY',        '{{ ansible_date_time.iso8601_micro | hash('sha256') }}' );
define( 'AUTH_SALT',        '{{ ansible_date_time.iso8601_micro | hash('sha256') }}' );
define( 'SECURE_AUTH_SALT', '{{ ansible_date_time.iso8601_micro | hash('sha256') }}' );
define( 'LOGGED_IN_SALT',   '{{ ansible_date_time.iso8601_micro | hash('sha256') }}' );
define( 'NONCE_SALT',       '{{ ansible_date_time.iso8601_micro | hash('sha256') }}' );

/**#@-*/

/**
 * WordPress Database Table prefix.
 *
 * You can have multiple installations in one database if you give each
 * a unique prefix. Only numbers, letters, and underscores please!
 */
$table_prefix = 'wp_';

/**
 * For developers: WordPress debugging mode.
 *
 * Change this to true to enable the display of notices during development.
 * It is strongly recommended that plugin and theme developers use WP_DEBUG
 * in their development environments.
 *
 * For information on other constants that can be used for debugging,
 * visit the Codex.
 *
 * @link https://codex.wordpress.org/Debugging_in_WordPress
 */
define( 'WP_DEBUG', false );

/* That's all, stop editing! Happy publishing. */

/** Absolute path to the WordPress directory. */
if ( ! defined( 'ABSPATH' ) ) {
    define( 'ABSPATH', dirname( __FILE__ ) . '/' );
}

/** Sets up WordPress vars and included files. */
require_once( ABSPATH . 'wp-settings.php' );

</code></pre>
<h3 id="playbook-yml">playbook.yml</h3>

<p>The <code>playbook.yml</code> file is where all tasks from this setup are defined. It starts by defining the group of servers that should be the target of this setup (<code>all</code>), after which it uses <code>become: true</code> to define that tasks should be executed with privilege escalation (<code>sudo</code>) by default. Then, it includes the <code>vars/default.yml</code> variable file to load configuration options.</p>
<div class="code-label " title="playbook.yml">playbook.yml</div><pre class="code-pre yaml local-environment"><code langs="">---
- hosts: all
  become: true
  vars_files:
    - vars/default.yml

  tasks:
    - name: Install prerequisites
      apt: name=aptitude update_cache=yes state=latest force_apt_get=yes
      tags: [ system ]

    - name: Install LAMP Packages
      apt: name={{ item }} update_cache=yes state=latest
      loop: [ 'apache2', 'mysql-server', 'python3-pymysql', 'php', 'php-mysql', 'libapache2-mod-php' ]
      tags: [ system ]

    - name: Install PHP Extensions
      apt: name={{ item }} update_cache=yes state=latest
      loop: "{{ php_modules }}"
      tags: [ system ]

  # Apache Configuration
    - name: Create document root
      file:
        path: "/var/www/{{ http_host }}"
        state: directory
        owner: "www-data"
        group: "www-data"
        mode: '0755'
      tags: [ apache ]

    - name: Set up Apache VirtualHost
      template:
        src: "files/apache.conf.j2"
        dest: "/etc/apache2/sites-available/{{ http_conf }}"
      notify: Reload Apache
      tags: [ apache ]

    - name: Enable rewrite module
      shell: /usr/sbin/a2enmod rewrite
      notify: Reload Apache
      tags: [ apache ]

    - name: Enable new site
      shell: /usr/sbin/a2ensite {{ http_conf }}
      notify: Reload Apache
      tags: [ apache ]

    - name: Disable default Apache site
      shell: /usr/sbin/a2dissite 000-default.conf
      notify: Restart Apache
      tags: [ apache ]

  # MySQL Configuration
    - name: Set the root password
      mysql_user:
        name: root
        password: "{{ mysql_root_password }}"
        login_unix_socket: /var/run/mysqld/mysqld.sock
      tags: [ mysql, mysql-root ]

    - name: Remove all anonymous user accounts
      mysql_user:
        name: ''
        host_all: yes
        state: absent
        login_user: root
        login_password: "{{ mysql_root_password }}"
      tags: [ mysql ]

    - name: Remove the MySQL test database
      mysql_db:
        name: test
        state: absent
        login_user: root
        login_password: "{{ mysql_root_password }}"
      tags: [ mysql ]

    - name: Creates database for WordPress
      mysql_db:
        name: "{{ mysql_db }}"
        state: present
        login_user: root
        login_password: "{{ mysql_root_password }}"
      tags: [ mysql ]

    - name: Create MySQL user for WordPress
      mysql_user:
        name: "{{ mysql_user }}"
        password: "{{ mysql_password }}"
        priv: "{{ mysql_db }}.*:ALL"
        state: present
        login_user: root
        login_password: "{{ mysql_root_password }}"
      tags: [ mysql ]

  # UFW Configuration
    - name: "UFW - Allow HTTP on port {{ http_port }}"
      ufw:
        rule: allow
        port: "{{ http_port }}"
        proto: tcp
      tags: [ system ]

  # WordPress Configuration
    - name: Download and unpack latest WordPress
      unarchive:
        src: https://wordpress.org/latest.tar.gz
        dest: "/var/www/{{ http_host }}"
        remote_src: yes
        creates: "/var/www/{{ http_host }}/wordpress"
      tags: [ wordpress ]

    - name: Set ownership
      file:
        path: "/var/www/{{ http_host }}"
        state: directory
        recurse: yes
        owner: www-data
        group: www-data
      tags: [ wordpress ]

    - name: Set permissions for directories
      shell: "/usr/bin/find /var/www/{{ http_host }}/wordpress/ -type d -exec chmod 750 {} \\;"
      tags: [ wordpress ]

    - name: Set permissions for files
      shell: "/usr/bin/find /var/www/{{ http_host }}/wordpress/ -type f -exec chmod 640 {} \\;"
      tags: [ wordpress ]

    - name: Set up wp-config
      template:
        src: "files/wp-config.php.j2"
        dest: "/var/www/{{ http_host }}/wordpress/wp-config.php"
      tags: [ wordpress ]

  handlers:
    - name: Reload Apache
      service:
        name: apache2
        state: reloaded

    - name: Restart Apache
      service:
        name: apache2
        state: restarted
</code></pre>
<p>Feel free to modify these files to best suit your individual needs within your own workflow. </p>

<h2 id="conclusion">Conclusion</h2>

<p>In this guide, we used Ansible to automate the process of installing and setting up a WordPress website with LAMP on an Ubuntu 18.04 server. </p>

<p>If you&rsquo;d like to include other tasks in this playbook to further customize your server setup, please refer to our introductory Ansible guide <a href="https://www.digitalocean.com/community/tutorials/configuration-management-101-writing-ansible-playbooks">Configuration Management 101: Writing Ansible Playbooks</a>. </p>
