---
layout: post
title: Como instalar a pilha Linux, Apache, MySQL, PHP (LAMP) no Debian 9
network: digitalocean
date: January 21, 2020 at 10:07PM
url: https://www.digitalocean.com/community/tutorials/how-to-install-linux-apache-mariadb-php-lamp-stack-debian9-pt
image: http://assets.digitalocean.com/how-to-install-lamp-debian-9/small_apache_default_debian9.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="introdução">Introdução</h3>

<p>Uma pilha de software &ldquo;LAMP&rdquo; é um grupo de softwares de código aberto que são normalmente instalados juntos para permitir que um servidor hospede sites dinâmicos e aplicativos Web. Este termo é, na verdade, uma sigla que representa o sistema operacional <strong>L</strong>inux, com o servidor Web do <strong>A</strong>pache. Os dados do site são armazenados em uma base de dados <strong>M</strong>ariaDB e o conteúdo dinâmico é processado pelo <strong>P</strong>HP.</p>

<p>Neste guia, instalaremos uma pilha LAMP em um servidor Debian 9.</p>

<h2 id="pré-requisitos">Pré-requisitos</h2>

<p>Para completar este tutorial, será necessário ter um servidor Debian 9 com uma conta de usuário não raiz com o <code>sudo</code> habilitado e um firewall básico. Isso pode ser configurado usando nosso <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-debian-9">guia de configuração inicial de servidor para o Debian 9</a>.</p>

<h2 id="passo-1-—-instalando-o-apache-e-atualizando-o-firewall">Passo 1 — Instalando o Apache e atualizando o firewall</h2>

<p>O servidor Web Apache está entre os servidores Web mais populares no mundo. Ele é bem documentado e tem sido amplamente usado em grande parte da história da Web, o que torna ele uma ótima escolha padrão para hospedar um site.</p>

<p>Instale o Apache usando o gerenciador de pacotes do Debian, <code>apt</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt update
</li><li class="line" prefix="$">sudo apt install apache2
</li></ul></code></pre>
<p>Como este é um comando <code>sudo</code>, essas operações são executadas com privilégios raiz. Ele irá pedir a senha do seu usuário para verificar suas intenções.</p>

<p>Assim que digitar sua senha, o <code>apt</code> irá dizer a você quais pacotes ele planeja instalar e quanto espaço de disco extra irão ocupar. Pressione <code>Y</code> e clique em <code>ENTER</code> para continuar, e a instalação prosseguirá.</p>

<p>Em seguida, supondo que tenha seguido as instruções de configuração inicial do servidor, instalando e habilitando o firewall UFW, certifique-se de que seu firewall permite o tráfego HTTP e HTTPS.</p>

<p>Quando instalado no Debian 9, o UFW vem carregado com perfis de app que podem ser utilizados para ajustar suas configurações de firewall. Veja a lista completa dos perfis de aplicativo executando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw app list
</li></ul></code></pre>
<p>Os perfis <code>WWW</code> são usados para gerenciar portas usadas por servidores Web:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Available applications:
. . .
  WWW
  WWW Cache
  WWW Full
  WWW Secure
. . .
</code></pre>
<p>Se inspecionar o perfil <code>WWW Full</code>, ele exibirá que habilita o tráfego para as portas <code>80</code> e <code>443</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw app info "WWW Full"
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Profile: WWW Full
Title: Web Server (HTTP,HTTPS)
Description: Web Server (HTTP,HTTPS)

Ports:
  <span class="highlight">80</span>,<span class="highlight">443/tcp</span>
</code></pre>
<p>Permita o tráfego HTTP e HTTPS de entrada para este perfil:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow in "WWW Full"
</li></ul></code></pre>
<p>Você pode fazer uma checagem imediatamente para verificar se tudo ocorreu como planejado visitando o endereço IP público do seu servidor no seu navegador Web:</p>
<pre class="code-pre "><code langs="">http://<span class="highlight">your_server_ip</span>
</code></pre>
<p>Você verá a página Web padrão do Apache para o Debian 9, que está disponível para fins informativos e de teste. Ela deve se parecer com isto:</p>

<p><img src="http://assets.digitalocean.com/how-to-install-lamp-debian-9/small_apache_default_debian9.png" alt="Debian 9 Apache default"></p>

<p>Se ver essa página, seu servidor Web agora está instalado corretamente e é acessível através do seu firewall.</p>

<p>Se não sabe qual é o endereço IP público do seu servidor, há uma série de maneiras para encontrá-lo. Normalmente, este é o endereço que você usa para se conectar ao seu servidor através do SSH.</p>

<p>Existem algumas maneiras de fazer isso a partir da linha de comando. Primeiro, poderia usar as ferramentas <code>iproute2</code> para obter seu endereço IP digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ip addr show eth0 | grep inet | awk '{ print $2; }' | sed 's/\/.*$//'
</li></ul></code></pre>
<p>Isso retornará a você duas ou três linhas. Todos os endereços são corretos, mas seu computador consegue usar apenas um deles, então sinta-se à vontade para testar cada um.</p>

<p>Um método alternativo é usar o utilitário <code>curl</code> para contatar uma entidade exterior para dizer a você como <em>ela</em> vê seu servidor. Isso é feito perguntando a um servidor específico qual é seu endereço IP:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt install curl
</li><li class="line" prefix="$">curl http://icanhazip.com
</li></ul></code></pre>
<p>Independentemente do método que você usa para obter seu endereço IP, digite-o na barra de endereço do seu navegador Web para ver a página padrão do Apache.</p>

<h2 id="passo-2-—-instalando-o-mariadb">Passo 2 — Instalando o MariaDB</h2>

<p>Agora que você tem seu servidor Web em funcionamento, é hora de instalar o MariaDB. O MariaDB é um sistema de gerenciamento de banco de dados. Basicamente, ele irá organizar e fornecer acesso aos bancos de dados onde seu site pode armazenar informações.</p>

<p>O MariaDB é uma bifurcação feita pela comunidade do MySQL. No Debian 9, o servidor padrão MySQL é o MariaDB 10.1, e o pacote <code>mysql-server</code>, que é normalmente usado para instalar o MySQL, é um pacote transitório que irá instalar o MariaDB. No entanto, é recomendável que instale o MariaDB usando o pacote real do programa, o <code>mariadb-server</code>.</p>

<p>Novamente, utilize o <code>apt</code> para adquirir e instalar este software:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt install mariadb-server
</li></ul></code></pre>
<p><span class='note'><strong>Nota</strong>: neste caso, não será necessário executar o <code>sudo apt update</code> antes do comando. Isso se dá pois você o executou recentemente nos comandos acima para instalar o Apache, e o índice de pacotes no seu computador já deve estar atualizado.<br></span></p>

<p>Este comando também irá mostrar a você uma lista dos pacotes que serão instalados, junto com a quantidade de espaço em disco que irão ocupar. Digite <code>Y</code> para continuar.</p>

<p>Quando a instalação for concluída, execute um script de segurança simples que vem pré-instalado com o MariaDB, que removerá algumas configurações padrão inseguras e irá bloquear o acesso ao seu sistema de banco de dados. Inicie o script interativo executando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo mysql_secure_installation
</li></ul></code></pre>
<p>Isso levará você através de uma série de prompts onde é possível fazer algumas alterações nas opções de segurança de sua instalação do MariaDB. O primeiro prompt pedirá que digite a senha <strong>root</strong> do banco de dados atual. Esta é uma conta administrativa no MariaDB que tem mais privilégios. Pense nela como sendo similar à conta <strong>root</strong> para o servidor em si (embora essa conta que você está configurando agora é uma conta específica do MariaDB). Como você instalou o MariaDB e ainda não fez nenhuma alteração de configuração, essa senha estará em branco. Dessa forma, pressione apenas <code>ENTER</code> no prompt.</p>

<p>O próximo prompt pergunta a você se deseja configurar uma senha <strong>root</strong> do banco de dados. Digite <code>N</code> e então pressione <code>ENTER</code>. No Debian, a conta <strong>root</strong> para o MariaDB está intimamente ligada à manutenção automatizada do sistema, então não deve-se alterar os métodos de autenticação configurados para essa conta. Se isso fosse feito, seria possível a atualização de pacotes para a quebra do sistema de banco de dados pela remoção do acesso à conta administrativa. Mais tarde, vamos tratar de como configurar, de forma opcional, uma conta administrativa adicional para o acesso por senha caso a autenticação por soquete não seja apropriada para o seu caso de uso.</p>

<p>A partir daí, pressione <code>Y</code> e então <code>ENTER</code> para aceitar as configurações padrão para todas as perguntas subsequentes. Isso irá remover alguns usuários anônimos e o banco de dados teste, desativará os logins remotos ao <strong>root,</strong> e carregará essas novas regras para que o MariaDB respeite imediatamente as alterações que você fez.</p>

<p>Em novas instalações nos sistemas Debian, o usuário <strong>root</strong> MariaDB é configurado para autenticar usando o plug-in <code>unix_socket</code> por padrão ao invés de fazê-lo com uma senha. Isso permite maior segurança e usabilidade na maioria dos casos, mas também pode complicar as coisas quando for necessário permitir direitos administrativos a um programa externo (por exemplo, o phpMyAdmin).</p>

<p>Como o servidor usa a conta <strong>root</strong> para tarefas como a rotação de registro e a inicialização e parada do servidor, é melhor não alterar os detalhes de autenticação da conta <strong>root</strong>. A alteração das credenciais da conta no <code>/etc/mysql/debian.cnf</code> pode funcionar inicialmente, mas as atualizações de pacotes podem substituir essas alterações. Ao invés de modificar a conta <strong>root,</strong> os mantenedores de pacotes recomendam a criação de uma conta administrativa separada caso seja necessário configurar o acesso baseado em senha.</p>

<p>Para fazer isso, criaremos uma nova conta chamada <code>admin</code> com as mesmas capacidades que a conta <strong>root</strong>, mas configurada para a autenticação por senha. Para fazer isso, abra o prompt do MariaDB do seu terminal:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo mariadb
</li></ul></code></pre>
<p>Agora, podemos criar um novo usuário com privilégios <strong>root</strong> e acesso baseado em senha. Altere o nome de usuário e senha para que correspondam às suas preferências:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="MariaDB [(none)]&gt;">GRANT ALL ON *.* TO '<span class="highlight">admin</span>'@'localhost' IDENTIFIED BY '<span class="highlight">password</span>' WITH GRANT OPTION;
</li></ul></code></pre>
<p>Descarregue os privilégios para garantir que eles estão salvos e disponíveis na sessão atual:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="MariaDB [(none)]&gt;">FLUSH PRIVILEGES;
</li></ul></code></pre>
<p>Em seguida, saia do shell do MariaDB:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="MariaDB [(none)]&gt;">exit
</li></ul></code></pre>
<p>Agora, quando quiser acessar seu banco de dados como seu novo usuário administrativo, será necessário autenticar-se como aquele usuário com a senha que você acabou de definir usando o seguinte comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">mariadb -u <span class="highlight">admin</span> -p
</li></ul></code></pre>
<p>Neste ponto, seu sistema de banco de dados está configurado e você pode seguir em frente para a instalação do PHP, o componente final da pilha LAMP.</p>

<h2 id="passo-3-—-instalando-o-php">Passo 3 — Instalando o PHP</h2>

<p>O PHP é o componente da sua configuração que irá processar o código para mostrar conteúdo dinâmico. Ele pode executar os scripts, conectar-se aos seus bancos de dados do MariaDB para obter informações e entregar o conteúdo processado ao seu servidor Web para exibição.</p>

<p>Novamente, utilize o sistema <code>apt</code> para instalar o PHP. Além disso, inclua alguns pacotes auxiliares para que desta vez o código PHP possa ser executado no servidor do Apache e se comunique com seu banco de dados do MariaDB:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt install php libapache2-mod-php php-mysql
</li></ul></code></pre>
<p>Isso deve instalar o PHP sem problemas. Vamos testar isso em instantes.</p>

<p>Na maioria dos casos, será vantajoso modificar a maneira que o Apache atende aos arquivos quando um diretório for solicitado. Atualmente, caso um usuário solicite um diretório do servidor, o Apache irá procurar primeiro um arquivo chamado <code>index.html</code>. Queremos dizer ao servidor Web para preferir arquivos PHP em relação a outros, então faça com que o Apache procure pelo arquivo <code>index.php</code> primeiro.</p>

<p>Para fazer isso, digite este comando para abrir o arquivo <code>dir.conf</code> em um editor de texto com privilégios raiz:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/apache2/mods-enabled/dir.conf
</li></ul></code></pre>
<p>Ele se parecerá com isso:</p>
<div class="code-label " title="/etc/apache2/mods-enabled/dir.conf">/etc/apache2/mods-enabled/dir.conf</div><pre class="code-pre "><code langs="">&lt;IfModule mod_dir.c&gt;
    DirectoryIndex index.html index.cgi index.pl <span class="highlight">index.php</span> index.xhtml index.htm
&lt;/IfModule&gt;
</code></pre>
<p>Mova o arquivo de índice do PHP (destacado acima) para a primeira posição após a especificação <code>DirectoryIndex</code>, desta forma:</p>
<div class="code-label " title="/etc/apache2/mods-enabled/dir.conf">/etc/apache2/mods-enabled/dir.conf</div><pre class="code-pre "><code langs="">&lt;IfModule mod_dir.c&gt;
    DirectoryIndex <span class="highlight">index.php</span> index.html index.cgi index.pl index.xhtml index.htm
&lt;/IfModule&gt;
</code></pre>
<p>Quando terminar, salve e feche o arquivo pressionando <code>CTRL+X</code>. Confirme o salvamento digitando <code>Y</code> e então clique em <code>ENTER</code> para verificar a localização do arquivo de salvamento.</p>

<p>Após isso, reinicie o servidor Web Apache para que suas alterações sejam reconhecidas. Faça isso digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart apache2
</li></ul></code></pre>
<p>Você também pode verificar o status do serviço <code>apache2</code> usando o <code>systemctl</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl status apache2
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Sample Output">Sample Output</div>● apache2.service - The Apache HTTP Server
   Loaded: loaded (/lib/systemd/system/apache2.service; enabled; vendor preset: enabled)
   Active: active (running) since Tue 2018-09-04 18:23:03 UTC; 9s ago
  Process: 22209 ExecStop=/usr/sbin/apachectl stop (code=exited, status=0/SUCCESS)
  Process: 22216 ExecStart=/usr/sbin/apachectl start (code=exited, status=0/SUCCESS)
 Main PID: 22221 (apache2)
    Tasks: 6 (limit: 4915)
   CGroup: /system.slice/apache2.service
           ├─22221 /usr/sbin/apache2 -k start
           ├─22222 /usr/sbin/apache2 -k start
           ├─22223 /usr/sbin/apache2 -k start
           ├─22224 /usr/sbin/apache2 -k start
           ├─22225 /usr/sbin/apache2 -k start
           └─22226 /usr/sbin/apache2 -k start
</code></pre>
<p>Para melhorar a funcionalidade do PHP, você tem a opção de instalar alguns módulos adicionais. Para ver as opções disponíveis para módulos e bibliotecas do PHP, canalize os resultados de <code>apt search</code> em <code>less</code>, um pager que permite que você percorra os resultados de outros comandos:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">apt search php- | less
</li></ul></code></pre>
<p>Use as teclas de seta para se deslocar para cima e para baixo, e pressione <code>Q</code> para sair.</p>

<p>Os resultados são todos componentes opcionais que você pode instalar. Será dado a você uma breve descrição para cada um:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Sorting...
Full Text Search...
bandwidthd-pgsql/stable 2.0.1+cvs20090917-10 amd64
  Tracks usage of TCP/IP and builds html files with graphs

bluefish/stable 2.2.9-1+b1 amd64
  advanced Gtk+ text editor for web and software development

cacti/stable 0.8.8h+ds1-10 all
  web interface for graphing of monitoring systems

cakephp-scripts/stable 2.8.5-1 all
  rapid application development framework for PHP (scripts)

ganglia-webfrontend/stable 3.6.1-3 all
  cluster monitoring toolkit - web front-end

haserl/stable 0.9.35-2+b1 amd64
  CGI scripting program for embedded environments

kdevelop-php-docs/stable 5.0.3-1 all
  transitional package for kdevelop-php

kdevelop-php-docs-l10n/stable 5.0.3-1 all
  transitional package for kdevelop-php-l10n
&hellip;
:
</code></pre>
<p>Para aprender mais sobre o que cada módulo faz, procure na Internet mais informações a respeito deles. De forma alternativa, consulte a descrição do pacote digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">apt show <span class="highlight">package_name</span>
</li></ul></code></pre>
<p>Haverá um resultado extenso, com um campo chamado <code>Description</code> que terá uma explicação mais longa da funcionalidade que o módulo fornece.</p>

<p>Por exemplo, para descobrir o que o módulo <code>php-cli</code> faz, digite isso:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">apt show php-cli
</li></ul></code></pre>
<p>Junto com uma grande quantidade de outras informações, você encontrará algo que se parece com isso:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>&hellip;
Description: command-line interpreter for the PHP scripting language (default)
 This package provides the /usr/bin/php command interpreter, useful for
 testing PHP scripts from a shell or performing general shell scripting tasks.
 .
 PHP (recursive acronym for PHP: Hypertext Preprocessor) is a widely-used
 open source general-purpose scripting language that is especially suited
 for web development and can be embedded into HTML.
 .
 This package is a dependency package, which depends on Debian's default
 PHP version (currently 7.0).
&hellip;
</code></pre>
<p>Se, após a pesquisa, você decidir que quer instalar um pacote, faça isso usando o comando <code>apt install</code> como tem feito para os outros softwares.</p>

<p>Se decidiu que o <code>php-cli</code> é algo que precisa, digite:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt install php-cli
</li></ul></code></pre>
<p>Se quiser instalar mais de um módulo, faça isso pela listagem de cada um, separados por um espaço, seguindo o comando <code>apt install</code>, desta forma:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt install <span class="highlight">package1</span> <span class="highlight">package2</span> <span class="highlight">...</span>
</li></ul></code></pre>
<p>Neste ponto, sua pilha LAMP está instalada e configurada. No entanto, antes de fazer mais alterações ou implantar um aplicativo, seria útil testar proativamente sua configuração do PHP, para o caso de haver problemas que devam ser resolvidos.</p>

<h2 id="passo-4-—-testando-o-processamento-do-php-no-seu-servidor-web">Passo 4 — Testando o processamento do PHP no seu servidor Web</h2>

<p>Para testar se seu sistema está configurado corretamente para o PHP, crie um script bem básico do PHP chamado <code>info.php</code>. Para que o Apache encontre este arquivo e o atenda corretamente, ele deve ser salvo em um diretório muito específico chamado <em>web root</em>.</p>

<p>No Debian 9, este diretório está localizado em <code>/var/www/html/</code>. Crie o arquivo naquele local executando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /var/www/html/info.php
</li></ul></code></pre>
<p>Isso abrirá um arquivo em branco. Adicione o seguinte texto, que é um código válido do PHP, dentro do arquivo:</p>
<div class="code-label " title="/var/www/html/info.php">/var/www/html/info.php</div><pre class="code-pre "><code langs="">&lt;?php
phpinfo();
?&gt;
</code></pre>
<p>Quando você terminar, salve e feche o arquivo.</p>

<p>Agora, você pode testar se seu servidor Web consegue exibir corretamente o conteúdo gerado por este script do PHP. Para testar isso, visite esta página no seu navegador Web. O seu endereço IP público do seu servidor será necessário novamente.</p>

<p>O endereço a ser visitado é:</p>
<pre class="code-pre "><code langs="">http://<span class="highlight">your_server_ip</span>/info.php
</code></pre>
<p>A página que você acessar deve se parecer com esta:</p>

<p><img src="https://assets.digitalocean.com/how-to-install-lamp-debian-9/small_php_info_debian9.png" alt="Debian 9 default PHP info"></p>

<p>Esta página fornece algumas informações básicas sobre seu servidor na perspectiva do PHP. Ela é útil para a depuração e para garantir que suas configurações estejam sendo aplicadas corretamente.</p>

<p>Se você puder ver essa página no seu navegador, então seu PHP está funcionando como esperado.</p>

<p>Provavelmente, você quer remover este arquivo após este teste porque ele poderia fornecer informações sobre seu servidor para usuários não autorizados. Para fazer isso, execute o seguinte comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo rm /var/www/html/info.php
</li></ul></code></pre>
<p>Você sempre pode recriar essa página se precisar acessar as informações novamente mais tarde.</p>

<h2 id="conclusão">Conclusão</h2>

<p>Agora que tem uma pilha LAMP instalada, você tem muitas opções para o que fazer a seguir. Basicamente, você instalou uma plataforma que permitirá que instale a maioria dos tipos de sites e softwares Web no seu servidor.</p>
