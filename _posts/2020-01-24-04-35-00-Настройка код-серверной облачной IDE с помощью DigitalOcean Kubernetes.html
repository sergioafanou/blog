---
layout: post
title: Настройка код-серверной облачной IDE с помощью DigitalOcean Kubernetes
network: digitalocean
date: January 24, 2020 at 04:35AM
url: https://www.digitalocean.com/community/tutorials/how-to-set-up-the-code-server-cloud-ide-platform-on-digitalocean-kubernetes-ru
image: https://assets.digitalocean.com/articles/codeserver/step1a.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<p><em>Автор выбрал <a href="https://www.brightfunds.org/funds/foss-nonprofits">фонд Free and Open Source Fund</a> для получения пожертвования в рамках программы <a href="https://do.co/w4do-cta">Write for DOnations</a>.</em></p>

<h3 id="Введение">Введение</h3>

<p>По мере перемещения инструментов для разработчиков в облако, появляется все большее количество облачных IDE (Интегрированная среда разработки), и все большее количество разработчиков начинает их использовать. Облачные IDE позволяет реализовать взаимодействие между группами разработчиков в режиме реального времени, работающих в единой среде разработки, которая минимизирует количество несовместимостей и повышает продуктивность. Облачные IDE, доступ к которым осуществляется с помощью веб-браузеров, можно использовать на любых типах современных устройств. Еще одним преимуществом облачной IDE является возможность использовать возможности, появляющиеся при создании кластера, что позволяет значительно увеличивать вычислительные возможности отдельного компьютера, используемого для разработки.</p>

<p><a href="https://github.com/cdr/code-server">Код-сервер</a>ная IDE — это код <a href="https://code.visualstudio.com/">Microsoft Visual Studio Code</a>, запущенная на удаленном сервере и доступная напрямую из браузера. Visual Studio Code — это современный редактор кода с интегрированной поддержкой Git, дебаггером кода, умным автозаполнением и настраиваемыми и расширяемыми функциями. Это означает, что вы можете использовать различные устройства, работающие под управлением различных оперативных систем, и всегда иметь под рукой постоянную среду разработки.</p>

<p>В этом обучающем руководстве вы настроите код-серверную облачную платформу IDE на вашем кластере DigitalOcean Kubernetes и публиковать его на вашем домене, защищенном сертификатами Let&rsquo;s Encrypt. В конце руководства у вас будет Microsoft Visual Studio Code на вашем кластере Kubernetes, доступный через HTTPS и защищенный паролем.</p>

<h2 id="Предварительные-требования">Предварительные требования</h2>

<ul>
<li><p>Кластер DigitalOcean Kubernetes с вашим подключением, настроенным с помощью <code>kubectl</code> по умолчанию. Инструкции по настройке <code>kubectl</code> описаны в шаге <strong>Подключение кластера</strong>, где вы создадите ваш кластер. Процесс создания кластера Kubernetes в DigitalOcean, см. <a href="https://www.digitalocean.com/docs/kubernetes/quickstart/">Быстрое начало работы с Kubernetes</a>.</p></li>
<li><p>Менеджер пакетов Helm, установленный на локальном компьютере, и Tiller, установленный на кластере. Для этого нужно выполнить шаги 1 и 2 руководства <a href="https://www.digitalocean.com/community/tutorials/how-to-install-software-on-kubernetes-clusters-with-the-helm-package-manager">Установка программного обеспечения на Kubernetes с помощью менеджера пакетов Helm</a>.</p></li>
<li><p>Nginx Ingress-контроллер и Cert-Manager, установленные на вашем кластере с помощью Helm, для предоставления код-серверной IDE с помощью ресурсов Ingress. См. руководство <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-an-nginx-ingress-on-digitalocean-kubernetes-using-helm">Настройка Nginx Ingress на DigitalOcean Kubernetes с помощью Helm</a> для выполнения необходимых действий.</p></li>
<li><p>Полное зарегистрированное доменное имя для хранения код-сервер, указывающее на средство балансировки нагрузки, используемое в Nginx Ingress. В этом обучающем модуле мы будем использовать имя <code><span class="highlight">code-server.your_domain</span></code>. Вы можете купить доменное имя на <a href="https://www.namecheap.com/">Namecheap</a>, получить его бесплатно на <a href="https://www.freenom.com/en/index.html?lang=en">Freenom</a> или воспользоваться услугами любого предпочитаемого регистратора доменных имен. Это доменное имя должно отличаться от имени, используемом в руководстве по настройке Nginx Ingress на DigitalOcean Kubernetes.</p></li>
</ul>

<h2 id="Шаг-1-—-Установка-и-передача-код-серверной-ide">Шаг 1 — Установка и передача код-серверной IDE</h2>

<p>В этом разделе вы установите код-серверную IDE на ваш кластер DigitalOcean Kubernetes и передадите его на ваш домен с помощью контроллера Nginx Ingress. Также вы выполните настройку пароля для входа.</p>

<p>Вы должны будете сохранить конфигурацию развертывания на локальном компьютере в файле с именем <code>code-server.yaml</code>. Создайте файл с помощью следующей команды:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano code-server.yaml
</li></ul></code></pre>
<p>Добавьте в файл следующие строки:</p>
<div class="code-label " title="code-server.yaml">code-server.yaml</div><pre class="code-pre "><code langs="">apiVersion: v1
kind: Namespace
metadata:
  name: code-server
---
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: code-server
  namespace: code-server
  annotations:
    kubernetes.io/ingress.class: nginx
spec:
  rules:
  - host: <span class="highlight">code-server.your_domain</span>
    http:
      paths:
      - backend:
          serviceName: code-server
          servicePort: 80
---
apiVersion: v1
kind: Service
metadata:
 name: code-server
 namespace: code-server
spec:
 ports:
 - port: 80
   targetPort: 8443
 selector:
   app: code-server
---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  labels:
    app: code-server
  name: code-server
  namespace: code-server
spec:
  selector:
    matchLabels:
      app: code-server
  replicas: 1
  template:
    metadata:
      labels:
        app: code-server
    spec:
      containers:
      - image: codercom/code-server
        imagePullPolicy: Always
        name: code-server
        args: ["--allow-http"]
        ports:
        - containerPort: 8443
        env:
        - name: PASSWORD
          value: "<span class="highlight">your_password</span>"
</code></pre>
<p>Эта конфигурация определяет пространство имен, развертывание и службы, а также Ingress. Пространство имен называется <code>code-server</code> и отделяет установку код-серверной IDE от остальной части кластера. Развертывание включает одну копию образа Docker <code>codercom/code-server</code>, а также переменную среды с именем <code>PASSWORD</code>, которая указывает пароль для доступа.</p>

<p>Служба <code>code-server</code> на внутреннем уровне передает под (создаваемый как часть развертывания) на порт <code>80</code>. Ingress, определенный в строке, указывает, что в качестве Ingress-контролера выступает <code>nginx</code>, а домен <code><span class="highlight">code-server.your_domain</span></code> будет обслуживаться службой.</p>

<p>Обязательно замените <code><span class="highlight">your_password</span></code> на собственный пароль, а <code><span class="highlight">code-server.your_domain</span></code> — на ваш домен, указывающий на средство балансировки нагрузки контроллера Nginx Ingress.</p>

<p>Затем создайте конфигурацию в Kubernetes с помощью следующей команды:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">kubectl create -f code-server.yaml
</li></ul></code></pre>
<p>Вывод должен выглядеть так:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>namespace/code-server created
ingress.extensions/code-server created
service/code-server created
deployment.extensions/code-server created
</code></pre>
<p>Вы можете проверить, стал ли под код-серверной IDE доступным, с помощью команды:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">kubectl get pods -w -n code-server
</li></ul></code></pre>
<p>Вывод будет выглядеть следующим образом:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>NAME                          READY   STATUS              RESTARTS   AGE
code-server-f85d9bfc9-j7hq6   0/1     ContainerCreating   0          1m
</code></pre>
<p>Как только в качестве статуса будет отображаться <code>Running</code> (Запущен), это значит, что код-серверная IDE завершила установку на ваш кластер.</p>

<p>Перейдите на ваш домен в браузере. Вы увидите запрос данных для входа в код-серверную IDE.</p>

<p><img src="https://assets.digitalocean.com/articles/codeserver/step1a.png" alt="запрос данных для входа в код-серверную"></p>

<p>Введите пароль, который вы задали в <strong>code-server.yaml</strong> и нажмите Enter <code>IDE</code>. Вы выполните вход в код-серверную IDE и немедленно увидите графический интерфейс редактора.</p>

<p><img src="https://assets.digitalocean.com/articles/codeserver/step2a.png" alt="графический интерфейс код-серверной IDE"></p>

<p>Вы установили код-серверную IDE на ваш кластер Kubernetes и сделали ее доступной на вашем домене. Также вы убедились, что для входа требуется указать пароль. Теперь вы можете перейти к обеспечению безопасности с помощью бесплатных сертификатов Let&rsquo;s Encrypt, используя Cert-Manager.</p>

<h2 id="Шаг-2-—-Защита-развертывания-код-серверной-ide">Шаг 2 — Защита развертывания код-серверной IDE</h2>

<p>В этом разделе вы должны будете обеспечить безопасность вашей установки код-серверной IDE, применив сертификаты Let&rsquo;s Encrypt для вашего Ingress, которые будет автоматически создавать Cert-Manager. После выполнения этого шага ваша установка код-серверной IDE будет доступна через HTTPS.</p>

<p>Откройте <code>code-server.yaml</code> для редактирования:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano code-server.yaml
</li></ul></code></pre>
<p>Добавьте выделенные строки в файл и обязательно замените используемый в качестве примера домен на собственный:</p>
<div class="code-label " title="code-server.yaml">code-server.yaml</div><pre class="code-pre "><code langs="">apiVersion: v1
kind: Namespace
metadata:
  name: code-server
---
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: code-server
  namespace: code-server
  annotations:
    kubernetes.io/ingress.class: nginx
<span class="highlight">    certmanager.k8s.io/cluster-issuer: letsencrypt-prod</span>
spec:
<span class="highlight">  tls:</span>
<span class="highlight">  - hosts:</span>
<span class="highlight">    - code-server.your_domain</span>
<span class="highlight">    secretName: codeserver-prod</span>
  rules:
  - host: code-server.your_domain
    http:
      paths:
      - backend:
          serviceName: code-server
          servicePort: 80
...
</code></pre>
<p>Во-первых, необходимо указать, что создателем кластера, который Ingress будет использовать для выпуска сертификатов, будет выступать <code>letsencrypt-prod</code>, созданный на этапе выполнения подготовительных требований. Затем вы должны указать домены, которые будут защищаться в рамках раздела <code>tls</code>, а также ваше имя для <code>Secret</code>, который их хранит.</p>

<p>Примените изменения, внесенные в ваш кластер Kubernetes, с помощью следующей команды:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">kubectl apply -f code-server.yaml
</li></ul></code></pre>
<p>Вам нужно будет подождать несколько минут, чтобы Let&rsquo;s Encrypt смог предоставить ваш сертификат. В настоящее время вы можете отслеживать прогресс, ознакомившись с результатами выполнения следующей команды:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">kubectl describe certificate codeserver-prod -n code-server
</li></ul></code></pre>
<p>После завершения ее выполнения, конечная часть вывода будет выглядеть примерно так:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Events:
  Type    Reason              Age    From          Message
  ----    ------              ----   ----          -------
  Normal  Generated           2m49s  cert-manager  Generated new private key
  Normal  GenerateSelfSigned  2m49s  cert-manager  Generated temporary self signed certificate
  Normal  OrderCreated        2m49s  cert-manager  Created Order resource "codeserver-prod-4279678953"
  Normal  OrderComplete       2m14s  cert-manager  Order "codeserver-prod-4279678953" completed successfully
  Normal  CertIssued          2m14s  cert-manager  Certificate issued successfully
</code></pre>
<p>Теперь вы можете обновить ваш домен в браузере. Вы увидите замок слева адресной строки в браузере, что означает, что соединение защищено.</p>

<p>На этом шаге вы настроили Ingress для обеспечения безопасности развертывания код-серверной IDE. Теперь вы можете перейти к изучению пользовательского интерфейса код-серверной IDE.</p>

<h2 id="Шаг-3-—-Изучение-интерфейса-код-сервер">Шаг 3 — Изучение интерфейса код-сервер</h2>

<p>В этом разделе вы изучите некоторые функции интерфейса код-серверной IDE. Поскольку наша код-серверная IDE — это Visual Studio Code, запущенный в облаке, она имеет тот же интерфейс, что и отдельная настольная версия.</p>

<p>С левой стороны IDE имеется вертикальный ряд из 6 кнопок с самыми популярными функциями на боковой панели, которая называется панелью активности.</p>

<p><img src="https://assets.digitalocean.com/articles/codeserver/step3a.png" alt="Графический интерфейс код-серверной IDE - Боковая панель"></p>

<p>Эта панель настраивается, поэтому вы можете перемещать эти представления в различном порядке или удалять их из панели. По умолчанию, первое представление открывает панель обозревателя, которая обеспечивает возможность навигации по структуре проекта, имеющей форму дерева. Здесь вы можете управлять папками и файлами — создавать, удалять, перемещать их при необходимости. Следующее представление предоставляет доступ к поиску и замене.</p>

<p>Далее при использовании порядка по умолчанию идет представление систем управления версиями, например, <a href="https://git-scm.com/download">Git</a>. Visual Studio Code также поддерживает другие системы контроля версий, вы можете найти дополнительные данные о системах управления версиями в <a href="https://code.visualstudio.com/docs/editor/versioncontrol">этой документации</a>.</p>

<p><img src="https://assets.digitalocean.com/articles/codeserver/git.png" alt="Выпадающее меню Git с функциями контроля версий"></p>

<p>Функция дебаггера в панели действий предоставляет все стандартные возможности для отладки на панели. Visual Studio Code оснащается встроенной поддержкой встроенного отладчика во время выполнения для <a href="https://nodejs.org/">Node.js​​​</a> и любого языка, который компилируется в <a href="https://www.javascript.com/">Javascript</a>. Для других языков вы можете установить <a href="https://code.visualstudio.com/docs/editor/debugging#_debugger-extensions">расширения</a> для требуемого отладчика. Вы можете сохранить конфигрурации отладчика в файле <code>launch.json</code>.</p>

<p><img src="https://assets.digitalocean.com/articles/codeserver/debugger.png" alt="Представление отладчика с открытым файлом launch.json"></p>

<p>Последнее представление панели деятельности предоставляет меню для доступа к доступным расширениям в <a href="https://marketplace.visualstudio.com/VSCode">Marketplace</a>.</p>

<p><img src="https://assets.digitalocean.com/articles/codeserver/step3b.png" alt="Графический интерфейс код-серверной IDE — Вкладки"></p>

<p>Центральную часть графического интерфейса занимает редактор, который вы можете разделить вкладками для редактирования кода. Вы можете изменить представление редактирования на сетку или расположенные параллельной файлы.</p>

<p><img src="https://assets.digitalocean.com/articles/codeserver/gridview.png" alt="Вид редактора в сетку"></p>

<p>После создания нового файла через с помощью меню <strong>File</strong> (Файл), в новой вкладке открывается пустой файл, а после сохранения имя файла будет отображаться в боковой панели обозревателя. Папки можно создать с помощью щелчка правой кнопкой мыши на боковой панели обозревателя и нажать New <strong>Folder</strong> (Новая папка). Вы можете развернуть папку, нажав на ее имя, а также перетаскивать файлы и папки в верхнюю часть иерархии, чтобы переместить их в новое место.</p>

<p><img src="https://assets.digitalocean.com/articles/codeserver/step3c.png" alt="Графический интерфейс код-серверной IDE — Новая папка"></p>

<p>Вы можете получить доступ к командной строке, нажав <code>CTRL+SHIFT+\</code> или выбрав пункт <strong>Terminal</strong> (Командная строка) в верхнем меню, а затем выбрав <strong>New Terminal</strong> (Новая командная строка). Командная строка откроется в нижней панели, а в качестве ее рабочей директории будет указано рабочее пространство проекта, которое содержит файлы и папки папки, отображаемые в боковой панели обозревателя.</p>

<p>Вы изучили базовые элементы интерфейса код-серверной IDE и познакомились с некоторыми самыми популярными функциями.</p>

<h2 id="Заключение">Заключение</h2>

<p>Теперь у вас есть код-серверная IDE, гибкий облачный инструмент, установленный на вашем кластере DigitalOcean Kubernetes. Вы можете работать с исходным кодом и документами индивидуально или вместе с вашей командой. Запуск облачной IDE на кластере предоставляет большее удобство для тестирования, загрузки и многого другого, а также при серьезных вычислениях. Дополнительную информацию о дополнительных функциях и подробные инструкции по работе с прочими компонентами код-серверной <a href="https://code.visualstudio.com/docs">IDE см. в документации для Visual Studio Code</a>.</p>
