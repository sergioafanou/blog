---
layout: post
title: How To Set Up a Firewall with UFW on Debian 9
network: digitalocean
date: December 12, 2019 at 08:01PM
url: https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-debian-9-pt
image: http://ifttt.com/images/no_image_card.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="introdução">Introdução</h3>

<p>O UFW, ou Uncomplicated Firewall (Firewall Descomplicado), é uma interface para <code>iptables</code> desenvolvida para simplificar o processo de configuração de um firewall. Apesar da <code>iptables</code> ser uma ferramenta sólida e flexível, pode ser difícil para os iniciantes aprender como usá-la para configurar corretamente um firewall. Se você deseja começar a proteger sua rede, mas não tem certeza sobre qual ferramenta usar, o UFW pode ser a escolha certa para você.</p>

<p>Este tutorial mostrará como configurar um firewall com o UFW no Debian 9.</p>

<h2 id="pré-requisitos">Pré-requisitos</h2>

<p>Para seguir este tutorial, você precisará de um servidor Debian 9 com um usuário sudo não raiz, que pode ser configurado seguindo os Passos 1–3 na <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-debian-9">Configuração Inicial do Servidor com o Debian 9</a>.</p>

<h2 id="passo-1-instalando-o-ufw">Passo 1 - Instalando o UFW</h2>

<p>O Debian não instala o UFW por padrão. Se você seguiu todo o <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-debian-9">tutorial de Configuração Inicial do Servidor</a>, você já terá instalado e habilitado o UFW. Caso contrário, instale-o agora usando o <code>apt</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt install ufw
</li></ul></code></pre>
<p>Vamos configurar o UFW e habilitá-lo nos passos a seguir.</p>

<h2 id="passo-2-—-usando-o-ipv6-com-o-ufw-opcional">Passo 2 — Usando o IPv6 com o UFW (Opcional)</h2>

<p>Este tutorial foi escrito tendo o IPv4 em mente, mas funcionará também com o IPv6, contanto que você o habilite. Se seu servidor Debian tiver o IPv6 habilitado, certifique-se de que o UFW esteja configurado para dar suporte ao IPv6, para que ele gerencie as regras de firewall do IPv6, além das regras do IPv4. Para fazer isso, abra a configuração do UFW com o <code>nano</code> ou seu editor favorito.</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/default/ufw
</li></ul></code></pre>
<p>Então, certifique-se de que o valor <code>IPV6</code> seja <code>yes</code>. Deve se parecer com isto:</p>
<div class="code-label " title="/etc/default/ufw excerpt">/etc/default/ufw excerpt</div><pre class="code-pre "><code langs="">IPV6=<span class="highlight">yes</span>
</code></pre>
<p>Salve e feche o arquivo. Agora, quando o UFW estiver habilitado, ele será configurado para escrever regras de firewall para ambos IPv4 e IPv6. No entanto, antes de habilitar o UFW, nós vamos querer garantir que seu firewall esteja configurado para permitir que você se conecte via SSH. Vamos começar configurando as políticas padrão.</p>

<h2 id="passo-3-—-configurando-as-políticas-padrão">Passo 3 — Configurando as políticas padrão</h2>

<p>Se você estiver apenas começando com seu firewall, as primeiras regras a definir são suas políticas padrão. Essas regras controlam a maneira de lidar com tráfego que não seja claramente compatível com quaisquer outras regras. Por padrão, o UFW é configurado para negar todas as conexões de entrada e permitir todas as conexões de saída. Isso significa que qualquer um que tentasse acessar o seu servidor não conseguiria conectar-se, ao passo que os aplicativos dentro do servidor conseguiriam alcançar o mundo exterior.</p>

<p>Vamos retornar as regras do seu UFW para as configurações padrão, para que possamos ter certeza de que você conseguirá acompanhar este tutorial. Para definir os padrões usados pelo UFW, utilize estes comandos:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw default deny incoming
</li><li class="line" prefix="$">sudo ufw default allow outgoing
</li></ul></code></pre>
<p>Esses comandos configuram os padrões para negar as conexões de entrada e permitir as conexões de saída. Esses padrões do firewall poderiam suprir as necessidades de um computador pessoal Porém, os servidores normalmente precisam responder às solicitações que chegam de usuários externos. Vamos verificar isso a seguir.</p>

<h2 id="passo-4-—-permitindo-as-conexões-via-protocolo-ssh">Passo 4 — Permitindo as conexões via protocolo SSH</h2>

<p>Se nós habilitássemos nosso firewall UFW agora, ele negaria todas as conexões de entrada. Isso significa que precisaremos criar regras que permitam de maneira explícita as conexões de entrada legítimas — conexões SSH ou HTTP, por exemplo — se quisermos que nosso servidor responda a esses tipos de pedidos. Se você estiver usando um servidor na nuvem, você provavelmente irá querer permitir conexões de entrada via protocolo SSH para que você consiga se conectar e gerenciar o seu servidor.</p>

<p>Para configurar seu servidor para permitir as conexões de entrada via SSH, você pode utilizar este comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow ssh
</li></ul></code></pre>
<p>Esse procedimento criará regras do firewall que permitirão todas as conexões na porta <code>22</code>, que é a porta na qual o SSH daemon escuta por padrão. O UFW sabe o que a porta <code>allow ssh</code> significa porque ela está listada como um serviço no arquivo <code>/etc/services</code>.</p>

<p>No entanto, podemos realmente escrever a regra equivalente, especificando a porta em vez do nome do serviço. Por exemplo, este comando funciona de forma semelhante ao anterior:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow 22
</li></ul></code></pre>
<p>Se você configurou seu SSH daemon para usar uma porta diferente, você terá que especificar a porta apropriada. Por exemplo, se seu servidor SSH estiver escutando na porta <code>2222</code>, você pode usar este comando para permitir as conexões naquela porta:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow <span class="highlight">2222</span>
</li></ul></code></pre>
<p>Agora que seu firewall está configurado para permitir as conexões de entrada via SSH, podemos habilitá-lo.</p>

<h2 id="passo-5-—-habilitando-o-ufw">Passo 5 — Habilitando o UFW</h2>

<p>Para habilitar o UFW, utilize este comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw enable
</li></ul></code></pre>
<p>Você receberá um aviso que diz que o comando pode interromper conexões via SSH existentes. Nós já configuramos uma regra de firewall que permite conexões via SSH, então tudo bem continuar. Responda ao prompt com <code>y</code> e tecle <code>ENTER</code>.</p>

<p>O firewall agora está ativo. Execute o comando <code>sudo ufw status verbose</code> para ver as regras que foram definidas. O resto deste tutorial tratará de como usar o UFW em mais detalhes, como, por exemplo, permitir ou negar diferentes tipos de conexões.</p>

<h2 id="passo-6-—-permitindo-outras-conexões">Passo 6 — Permitindo outras conexões</h2>

<p>Neste ponto, você deve permitir todas as outras conexões às quais seu servidor precisa responder. As conexões que você deve permitir dependem das suas necessidades específicas. Felizmente, você já sabe escrever regras que permitem conexões baseadas em um nome de serviço ou porta; já fizemos isso para o SSH na porta <code>22</code>. Você também pode fazer isso para:</p>

<ul>
<li>O HTTP na porta 80, que é a porta que os servidores Web não criptografados utilizam, usando <code>sudo ufw allow http</code> ou <code>sudo ufw allow 80</code></li>
<li>O HTTPS na porta 443, que é a porta que os servidores Web criptografados utilizam, usando <code>sudo ufw allow https</code> ou <code>sudo ufw allow 443</code></li>
</ul>

<p>Há várias outras maneiras de permitir outras conexões, além de especificar uma porta ou serviço conhecido.</p>

<h3 id="faixas-de-portas-específicas">Faixas de portas específicas</h3>

<p>Você pode especificar faixas de portas com o UFW. Alguns aplicativos usam várias portas, em vez de uma única porta.</p>

<p>Por exemplo, para permitir conexões via protocolo X11, que usam as portas <code>6000</code>-<code>6007</code>, utilize esses comandos:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow <span class="highlight">6000</span>:<span class="highlight">6007</span>/tcp
</li><li class="line" prefix="$">sudo ufw allow <span class="highlight">6000</span>:<span class="highlight">6007</span>/udp
</li></ul></code></pre>
<p>Ao especificar as faixas de porta com o UFW, você deve especificar o protocolo (<code>tcp</code> ou <code>udp</code>) para o qual as regras devem aplicar-se. Nós não mencionamos isso antes porque não especificar o protocolo automaticamente permite ambos os protocolos, o que é OK na maioria dos casos.</p>

<h3 id="endereços-ip-específicos">Endereços IP específicos</h3>

<p>Ao trabalhar com o UFW, você também pode especificar endereços IP. Por exemplo, se quiser permitir conexões de um endereço IP específico, como um endereço IP de trabalho ou domicílio de <code>203.0.113.4</code>, você precisa especificar <code>from</code>, então o endereço IP:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow from <span class="highlight">203.0.113.4</span>
</li></ul></code></pre>
<p>Você também pode especificar uma porta específica na qual o endereço IP tem permissão para se conectar, adicionando <code>to any port</code> seguido do número da porta. Por exemplo, se quiser permitir que o endereço <code>203.0.113.4</code> se conecte à porta <code>22</code> (SSH), utilize este comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow from <span class="highlight">203.0.113.4</span> to any port <span class="highlight">22</span>
</li></ul></code></pre>
<h3 id="sub-redes">Sub-redes</h3>

<p>Se você quiser permitir uma sub-rede de endereços IP, você pode fazer isso usando uma notação CIDR para especificar uma máscara de rede. Por exemplo, se você quiser permitir todos os endereços IP na faixa de <code>203.0.113.1</code> a <code>203.0.113.254</code>, você pode usar este comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow from <span class="highlight">203.0.113.0</span>/<span class="highlight">24</span>
</li></ul></code></pre>
<p>De maneira similar, você também pode especificar a porta de destino na qual a sub-rede <code>203.0.113.0/24</code> tem permissão para se conectar. Novamente, nós vamos usar a porta <code>22</code> (SSH) como um exemplo:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow from <span class="highlight">203.0.113.0</span>/<span class="highlight">24</span> to any port 22
</li></ul></code></pre>
<h3 id="conexões-a-uma-interface-de-rede-específica">Conexões a uma Interface de Rede Específica</h3>

<p>Se você quiser criar uma regra de firewall que se aplique apenas a uma interface de rede específica, você pode fazer isso especificando &ldquo;allow in on&rdquo; seguido do nome da interface de rede.</p>

<p>Você pode querer verificar suas interfaces de rede antes de continuar. Para fazer isso, utilize este comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ip addr
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output Excerpt">Output Excerpt</div>2: <span class="highlight">eth0</span>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state
. . .
3: <span class="highlight">eth1</span>: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default
. . .
</code></pre>
<p>O resultado destacado indica os nomes de interfaces de rede. Normalmente, elas recebem nomes como <code>eth0</code> ou <code>enp3s2</code>.</p>

<p>Então, se o seu servidor tiver uma interface de rede pública chamada <code>eth0</code>, você pode permitir o tráfego HTTP (porta <code>80</code>) nela, usando este comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow in on <span class="highlight">eth0</span> to any port <span class="highlight">80</span>
</li></ul></code></pre>
<p>Fazer isso permitiria que seu servidor recebesse pedidos HTTP da internet pública.</p>

<p>Ou, se você quiser que seu servidor de banco de dados MySQL (porta <code>3306</code>) escute conexões na interface de rede privada <code>eth1</code>, por exemplo, você pode usar este comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow in on <span class="highlight">eth1</span> to any port <span class="highlight">3306</span>
</li></ul></code></pre>
<p>Isso permitiria que outros servidores na sua rede privada se conectassem ao seu banco de dados MySQL.</p>

<h2 id="passo-7-—-negando-conexões">Passo 7 — Negando conexões</h2>

<p>Se você não tiver mudado a política padrão das conexões de entrada, o UFW está configurado para negar todas as conexões de entrada. Geralmente, isso simplifica o processo de criação de uma política de firewall segura ao exigir que você crie regras que permitam explicitamente portas e endereços IP específicos.</p>

<p>No entanto, algumas vezes você irá querer negar conexões específicas baseadas no endereço IP ou na sub-rede da origem, talvez porque você saiba que seu servidor está sendo atacado a partir daí. Além disso, se você quisesse alterar sua política de entrada padrão para permitir (<strong>allow</strong>) (o que não é recomendado), você precisaria criar regras para negar (<strong>deny</strong>) quaisquer serviços ou endereços IP para os quais você não quisesse permitir conexões.</p>

<p>Para escrever regras de <strong>deny</strong>, você pode usar os comandos descritos acima, substituindo <strong>allow</strong> por <strong>deny</strong>.</p>

<p>Por exemplo, para negar conexões HTTP, você pode usar este comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw deny http
</li></ul></code></pre>
<p>Ou se você quiser negar todas as conexões do endereço <code>203.0.113.4</code> você pode usar este comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw deny from <span class="highlight">203.0.113.4</span>
</li></ul></code></pre>
<p>Agora, vamos ver como excluir regras.</p>

<h2 id="passo-8-—-excluindo-regras">Passo 8 — Excluindo regras</h2>

<p>Saber como excluir regras do firewall é tão importante quanto saber como criá-las. Há duas maneiras diferentes para especificar quais regras excluir: pelo número da regra ou pela regra em si (semelhante ao modo como as regras foram especificadas quando foram criadas). Vamos começar com o método *<em>excluir pelo número *</em>da regra porque é mais fácil.</p>

<h3 id="pelo-número-da-regra">Pelo número da regra</h3>

<p>Se você estiver usando o número da regra para excluir regras do firewall, a primeira coisa que você vai querer fazer é obter uma lista das regras do seu firewall. O comando status do UFW tem uma opção para mostrar números ao lado de cada regra, como demonstrado aqui:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw status numbered
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Numbered Output:">Numbered Output:</div>Status: active

     To                         Action      From
     --                         ------      ----
[ 1] 22                         ALLOW IN    15.15.15.0/24
[ 2] 80                         ALLOW IN    Anywhere
</code></pre>
<p>Se decidirmos que queremos excluir a regra 2, aquela que permite conexões na porta 80 (HTTP), podemos especificar isso em um comando delete do UFW desta forma:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw delete <span class="highlight">2</span>
</li></ul></code></pre>
<p>Isso mostraria um prompt de confirmação e então excluiria a regra 2, que permite conexões HTTP. Note que se você tivesse o IPv6 habilitado, você iria querer excluir a regra correspondente ao IPv6 também.</p>

<h3 id="pela-regra">Pela regra</h3>

<p>A alternativa para os números das regras é especificar a regra propriamente dita a ser excluída. Por exemplo, se quiser remover a regra <code>allow http</code>, você pode escrever desta forma:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw delete <span class="highlight">allow http</span>
</li></ul></code></pre>
<p>Você também poderia especificar a regra por <code>allow 80</code>, em vez de pelo nome do serviço:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw delete <span class="highlight">allow 80</span>
</li></ul></code></pre>
<p>Esse método irá excluir as regras do IPv4 e do IPv6, se houver.</p>

<h2 id="passo-9-—-verificando-o-status-e-as-regras-do-ufw">Passo 9 — Verificando o status e as regras do UFW</h2>

<p>A qualquer momento, você pode verificar o status do UFW com este comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw status verbose
</li></ul></code></pre>
<p>Se o UFW estiver desabilitado - o que acontece por padrão, você verá algo como isso:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Status: inactive
</code></pre>
<p>Se o UFW estiver ativo - o que deve ser o caso se você tiver seguido o Passo 3 - o resultado dirá que ele está ativo e listará quaisquer regras que estejam definidas. Por exemplo, se o firewall estiver configurado para permitir conexões via SSH (porta <code>22</code>) de qualquer lugar, o resultado poderia parecer com este:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Status: active
Logging: on (low)
Default: deny (incoming), allow (outgoing), disabled (routed)
New profiles: skip

To                         Action      From
--                         ------      ----
22/tcp                     ALLOW IN    Anywhere
</code></pre>
<p>Use o comando <code>status</code>, se quiser verificar como o UFW configurou o firewall.</p>

<h2 id="passo-10-—-desabilitando-ou-redefinindo-o-ufw-opcional">Passo 10 — Desabilitando ou redefinindo o UFW (opcional)</h2>

<p>Se você decidir que não quer usar o UFW, você pode desabilitá-lo com este comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw disable
</li></ul></code></pre>
<p>Quaisquer regras que você tenha criado com o UFW já não estarão mais ativas. Você sempre poderá executar <code>sudo ufw enable</code> se precisar ativá-lo mais tarde.</p>

<p>Se você já tiver regras do UFW configuradas, mas decidir que quer começar novamente, você pode usar o comando de redefinição:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw reset
</li></ul></code></pre>
<p>Isso irá desabilitar o UFW e excluir quaisquer regras que tiverem sido definidas anteriormente. Lembre-se de que as políticas padrão não irão voltar para suas configurações originais se, em algum momento, você as tiver alterado. Isso deve dar a você um novo começo com o UFW.</p>

<h2 id="conclusão">Conclusão</h2>

<p>Seu firewall agora está configurado para permitir (pelo menos) conexões via SSH. Certifique-se de permitir outras conexões de entrada que seu servidor, ao mesmo tempo em que limita quaisquer conexões desnecessárias, para que seu servidor seja funcional e seguro.</p>

<p>Para aprender sobre mais configurações comuns do UFW, verifique o tutorial <a href="https://www.digitalocean.com/community/tutorials/ufw-essentials-common-firewall-rules-and-commands">Fundamentos do UFW: regras comuns de firewall e comandos</a>.</p>
