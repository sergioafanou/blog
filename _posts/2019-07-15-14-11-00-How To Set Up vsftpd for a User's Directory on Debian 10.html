---
layout: post
title: How To Set Up vsftpd for a User's Directory on Debian 10
network: digitalocean
date: July 15, 2019 at 02:11PM
url: https://www.digitalocean.com/community/tutorials/how-to-set-up-vsftpd-for-a-user-s-directory-on-debian-10
image: https://assets.digitalocean.com/articles/vsftpd_18_04/vsftpd_images/filezilla_site_manager_vsftpd_18_04.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="introduction">Introduction</h3>

<p>FTP, short for File Transfer Protocol, is a network protocol that was once widely used for moving files between a client and server. It has since been replaced by faster, more secure, and more convenient ways of delivering files. Many casual internet users expect to download directly from their web browser with <code>https</code>, and command-line users are more likely to use secure protocols such as the <code>scp</code> or <a href="https://www.digitalocean.com/community/tutorials/how-to-use-sftp-to-securely-transfer-files-with-a-remote-server">SFTP</a>.</p>

<p>FTP is still used to support legacy applications and workflows with very specific needs. If you have a choice of what protocol to use, consider exploring the more modern options. When you do need FTP, however, vsftpd is an excellent choice.  Optimized for security, performance, and stability, vsftpd offers strong protection against many security problems found in other FTP servers and is the default for many Linux distributions.</p>

<p>In this tutorial, you'll configure vsftpd to allow a user to upload files to their home directory using FTP, with login credentials secured by SSL/TLS.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>To follow along with this tutorial you will need:</p>

<ul>
<li>A Debian 10 server, and a non-root user with <code>sudo</code> privileges.  You can learn more about how to create a user with these privileges in our <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-debian-10">Initial Server Setup with Debian 10</a> guide.</li>
</ul>

<h2 id="step-1-—-installing-vsftpd">Step 1 — Installing vsftpd</h2>

<p>Let's start by updating our package list and installing the <code>vsftpd</code> daemon:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt update
</li><li class="line" prefix="$">sudo apt install vsftpd
</li></ul></code></pre>
<p>When the installation is complete, copy the configuration file so you can start with a blank configuration, and save the original as a backup:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo cp /etc/vsftpd.conf /etc/vsftpd.conf.orig
</li></ul></code></pre>
<p>With a backup of the configuration in place, we're ready to configure the firewall.</p>

<h2 id="step-2-—-opening-the-firewall">Step 2 — Opening the Firewall</h2>

<p>Let's check the firewall status to see if it’s enabled. If it is, we’ll ensure that FTP traffic is permitted so firewall rules don't block our tests. This guide assumes that you have UFW installed, following Step 4 in the <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-debian-10#step-4-%E2%80%94-setting-up-a-basic-firewall">initial server setup guide</a>.</p>

<p>Check the firewall status:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw status
</li></ul></code></pre>
<p>In this case, only SSH is allowed through:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Status: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere
OpenSSH (v6)               ALLOW       Anywhere (v6)
</code></pre>
<p>You may have other rules in place or no firewall rules at all. Since only SSH traffic is permitted in this case,  we’ll need to add rules for FTP traffic.</p>

<p>Let's open ports <code>20</code> and <code>21</code> for FTP, port <code>990</code> for when we enable TLS, and ports <code>40000-50000</code> for the range of passive ports we plan to set in the configuration file:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow 20/tcp
</li><li class="line" prefix="$">sudo ufw allow 21/tcp
</li><li class="line" prefix="$">sudo ufw allow 990/tcp
</li><li class="line" prefix="$">sudo ufw allow 40000:50000/tcp
</li></ul></code></pre>
<p>Check the firewall status:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw status
</li></ul></code></pre>
<p>Your firewall rules should now look like this:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Status: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere
990/tcp                    ALLOW       Anywhere
20/tcp                     ALLOW       Anywhere
21/tcp                     ALLOW       Anywhere
40000:50000/tcp            ALLOW       Anywhere
OpenSSH (v6)               ALLOW       Anywhere (v6)
20/tcp (v6)                ALLOW       Anywhere (v6)
21/tcp (v6)                ALLOW       Anywhere (v6)
990/tcp (v6)               ALLOW       Anywhere (v6)
40000:50000/tcp (v6)       ALLOW       Anywhere (v6)
</code></pre>
<p>With <code>vsftpd</code> installed and the necessary ports open, let's move on to creating a dedicated FTP user.</p>

<h2 id="step-3-—-preparing-the-user-directory">Step 3 — Preparing the User Directory</h2>

<p>We will create a dedicated FTP user, but you may already have a user in need of FTP access. We'll take care to preserve an existing user’s access to their data in the instructions that follow. Even so, we recommend that you start with a new user until you've configured and tested your setup.</p>

<p>First, add a test user called <code><span class="highlight">sammy</span></code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo adduser <span class="highlight">sammy</span>
</li></ul></code></pre>
<p>Assign a password when prompted. Feel free to press <code>ENTER</code> through the other prompts.</p>

<p>FTP is generally more secure when users are restricted to a specific directory. <code>vsftpd</code> accomplishes this with <a href="https://www.digitalocean.com/community/tutorials/how-to-configure-chroot-environments-for-testing-on-an-ubuntu-12-04-vps#what-is-a-chroot-environment"><code>chroot</code></a> jails. When <code>chroot</code> is enabled for local users, they are restricted to their home directory by default. However, because of the way <code>vsftpd</code> secures the directory, it must not be writable by the user. This is fine for a new user who should only connect via FTP, but an existing user may need to write to their home folder if they also have shell access.</p>

<p>In this example, rather than removing write privileges from the home directory, let's create an <code>ftp</code> directory to serve as the <code>chroot</code> and a writable <code>files</code> directory to hold the actual files.</p>

<p>Create the <code>ftp</code> folder:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo mkdir /home/<span class="highlight">sammy</span>/ftp
</li></ul></code></pre>
<p>Set its ownership:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo chown nobody:nogroup /home/<span class="highlight">sammy</span>/ftp
</li></ul></code></pre>
<p>Remove write permissions:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo chmod a-w /home/<span class="highlight">sammy</span>/ftp
</li></ul></code></pre>
<p>Verify the permissions:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ls -la /home/<span class="highlight">sammy</span>/ftp
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>total 8
4 dr-xr-xr-x  2 nobody nogroup 4096 Aug 24 21:29 .
4 drwxr-xr-x  3 sammy  sammy   4096 Aug 24 21:29 ..
</code></pre>
<p>Next, let's create the directory for file uploads and assign ownership to the user:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo mkdir /home/<span class="highlight">sammy</span>/ftp/files
</li><li class="line" prefix="$">sudo chown <span class="highlight">sammy</span>:<span class="highlight">sammy</span> /home/<span class="highlight">sammy</span>/ftp/files
</li></ul></code></pre>
<p>A permissions check on the <code>ftp</code> directory should return the following:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ls -la /home/sammy/ftp
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>total 12
dr-xr-xr-x 3 nobody nogroup 4096 Aug 26 14:01 .
drwxr-xr-x 3 sammy  sammy   4096 Aug 26 13:59 ..
drwxr-xr-x 2 sammy  sammy   4096 Aug 26 14:01 files
</code></pre>
<p>Finally, let's add a <code>test.txt</code> file to use when we test:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">echo "vsftpd test file" | sudo tee /home/<span class="highlight">sammy</span>/ftp/files/test.txt
</li></ul></code></pre>
<p>Now that we've secured the <code>ftp</code> directory and allowed the user access to the <code>files</code> directory, let's modify our configuration.</p>

<h2 id="step-4-—-configuring-ftp-access">Step 4 — Configuring FTP Access</h2>

<p>We're planning to allow a single user with a local shell account to connect with FTP. The two key settings for this are already set in <code>vsftpd.conf</code>. Start by opening the config file to verify that the settings in your configuration match those below:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/vsftpd.conf
</li></ul></code></pre><div class="code-label " title="/etc/vsftpd.conf">/etc/vsftpd.conf</div><pre class="code-pre "><code langs="">. . .
# Allow anonymous FTP? (Disabled by default).
anonymous_enable=NO
#
# Uncomment this to allow local users to log in.
local_enable=YES
. . .
</code></pre>
<p>Next, let's enable the user to upload files by ensuring that the <code>write_enable</code> setting is uncommented and set to <code><span class="highlight">YES</span></code>:</p>
<div class="code-label " title="/etc/vsftpd.conf">/etc/vsftpd.conf</div><pre class="code-pre "><code langs="">. . .
write_enable=<span class="highlight">YES</span>
. . .
</code></pre>
<p>We’ll also uncomment the <code>chroot</code> to prevent the FTP-connected user from accessing any files or commands outside the directory tree:</p>
<div class="code-label " title="/etc/vsftpd.conf">/etc/vsftpd.conf</div><pre class="code-pre "><code langs="">. . .
chroot_local_user=<span class="highlight">YES</span>
. . .
</code></pre>
<p>Let's also add a <code>user_sub_token</code> to insert the username in our <code>local_root directory</code> path so our configuration will work for this user and any additional future users. Add these settings anywhere in the file:</p>
<div class="code-label " title="/etc/vsftpd.conf">/etc/vsftpd.conf</div><pre class="code-pre "><code langs="">. . .
<span class="highlight">user_sub_token=$USER</span>
<span class="highlight">local_root=/home/$USER/ftp</span>
</code></pre>
<p>Let's also limit the range of ports that can be used for passive FTP to make sure enough connections are available:</p>
<div class="code-label " title="/etc/vsftpd.conf">/etc/vsftpd.conf</div><pre class="code-pre "><code langs="">. . .
<span class="highlight">pasv_min_port=40000</span>
<span class="highlight">pasv_max_port=50000</span>
</code></pre>
<p><span class='note'><strong>Note:</strong> In Step 2, we opened the ports that we set here for the passive port range. If you change the values, be sure to update your firewall settings.<br></span></p>

<p>To allow FTP access on a case-by-case basis, let's set the configuration so that users only have access when they are explicitly added to a list, rather than by default:</p>
<div class="code-label " title="/etc/vsftpd.conf">/etc/vsftpd.conf</div><pre class="code-pre "><code langs="">. . .
<span class="highlight">userlist_enable=YES</span>
<span class="highlight">userlist_file=/etc/vsftpd.userlist</span>
<span class="highlight">userlist_deny=NO</span>
</code></pre>
<p><code>userlist_deny</code> toggles the logic: When it is set to <code>YES</code>, users on the list are denied FTP access. When it is set to <code>NO</code>, only users on the list are allowed access. </p>

<p>When you're done making the changes, save the file and exit the editor.</p>

<p>Finally, let's add our user to <code>/etc/vsftpd.userlist</code>. Use the <code>-a</code> flag to append to the file:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">echo "<span class="highlight">sammy</span>" | sudo tee -a /etc/vsftpd.userlist
</li></ul></code></pre>
<p>Check that it was added as you expected:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cat /etc/vsftpd.userlist
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>sammy
</code></pre>
<p>Restart the daemon to load the configuration changes:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart vsftpd
</li></ul></code></pre>
<p>With the configuration in place, we can move on to testing FTP access.</p>

<h2 id="step-5-—-testing-ftp-access">Step 5 — Testing FTP Access</h2>

<p>We've configured the server to allow only the user <strong>sammy</strong> to connect via FTP. Let's make sure that this works as expected.</p>

<p><strong>Anonymous users should fail to connect</strong>:  We've disabled anonymous access. Let's test that by trying to connect anonymously. If our configuration is set up properly, anonymous users should be denied permission. Open another terminal and run the following command. Be sure to replace <code><span class="highlight">203.0.113.0</span></code> with <strong>your server's public IP address</strong>, and use <code><span class="highlight">anonymous</span></code> as your username:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ftp -p <span class="highlight">203.0.113.0</span>
</li></ul></code></pre><pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>Connected to 203.0.113.0.
220 (vsFTPd 3.0.3)
Name (203.0.113.0:default): <span class="highlight">anonymous</span>
530 Permission denied.
ftp: Login failed.
ftp&gt;
</code></pre>
<p>Close the connection:</p>
<pre class="code-pre custom_prefix local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ftp&gt;">bye
</li></ul></code></pre>
<p><strong>Users other than sammy should fail to connect</strong>: Next, let's try connecting as our <code>sudo</code> user. They should also be denied access, and it should happen before they're allowed to enter their password:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ftp -p <span class="highlight">203.0.113.0</span>
</li></ul></code></pre><pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>Connected to 203.0.113.0.
220 (vsFTPd 3.0.3)
Name (203.0.113.0:default): <span class="highlight">your_sudo_user</span>
530 Permission denied.
ftp: Login failed.
ftp&gt;
</code></pre>
<p>Close the connection:</p>
<pre class="code-pre custom_prefix local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ftp&gt;">bye
</li></ul></code></pre>
<p><strong>The user sammy should be able to connect, read, and write files</strong>: Let's make sure that our designated user can connect:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ftp -p <span class="highlight">203.0.113.0</span>
</li></ul></code></pre><pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>Connected to 203.0.113.0.
220 (vsFTPd 3.0.3)
Name (203.0.113.0:default): <span class="highlight">sammy</span>
331 Please specify the password.
Password: <span class="highlight">your_user's_password</span>
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt;
</code></pre>
<p>Let's change into the <code>files</code> directory and use the <code>get</code> command to transfer the test file we created earlier to our local machine:</p>
<pre class="code-pre custom_prefix local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ftp&gt;">cd files
</li><li class="line" prefix="ftp&gt;">get test.txt
</li></ul></code></pre><pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>229 Entering Extended Passive Mode (
47398|)
150 Opening BINARY mode data connection for test.txt (17 bytes).
100% |**********************************|    17      146.91 KiB/s    00:00 ETA
226 Transfer complete.
17 bytes received in 00:00 (0.17 KiB/s)
ftp&gt;
</code></pre>
<p>Next, let's upload the file with a new name to test write permissions:</p>
<pre class="code-pre custom_prefix local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ftp&gt;">put test.txt upload.txt
</li></ul></code></pre><pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>229 Entering Extended Passive Mode (
46598|)
150 Ok to send data.
100% |**********************************|    17        8.93 KiB/s    00:00 ETA
226 Transfer complete.
17 bytes sent in 00:00 (0.08 KiB/s)
</code></pre>
<p>Close the connection:</p>
<pre class="code-pre custom_prefix local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ftp&gt;">bye
</li></ul></code></pre>
<p>Now that we've tested our configuration, let's take steps to further secure our server.</p>

<h2 id="step-6-—-securing-transactions">Step 6 — Securing Transactions</h2>

<p>Since FTP does <em>not</em> encrypt any data in transit, including user credentials, we'll enable TLS/SSL to provide that encryption.  The first step is to create the SSL certificates for use with <code>vsftpd</code>. </p>

<p>Let's use <code>openssl</code> to create a new certificate and use the <code>-days</code> flag to make it valid for one year. In the same command, we'll add a private 2048-bit RSA key.  By setting both the <code>-keyout</code> and <code>-out</code> flags to the same value, the private key and the certificate will be located in the same file:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/vsftpd.pem -out /etc/ssl/private/vsftpd.pem
</li></ul></code></pre>
<p>You'll be prompted to provide address information for your certificate. Substitute your own information for the highlighted values below. For the <code>Common Name</code> field, be sure to add <code><span class="highlight">your_server_ip</span></code>:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Generating a 2048 bit RSA private key
............................................................................+++
...........+++
writing new private key to '/etc/ssl/private/vsftpd.pem'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:<span class="highlight">US</span>
State or Province Name (full name) [Some-State]:<span class="highlight">NY</span>
Locality Name (eg, city) []:<span class="highlight">New York City</span>
Organization Name (eg, company) [Internet Widgits Pty Ltd]:<span class="highlight">DigitalOcean</span>
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []: <span class="highlight">your_server_ip</span>
Email Address []:
</code></pre>
<p>For more detailed information about the certificate flags, see <a href="https://www.digitalocean.com/community/tutorials/openssl-essentials-working-with-ssl-certificates-private-keys-and-csrs">OpenSSL Essentials: Working with SSL Certificates, Private Keys and CSRs</a></p>

<p>Once you've created the certificates, open the <code>vsftpd</code> configuration file again:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/vsftpd.conf
</li></ul></code></pre>
<p>Toward the bottom of the file, you will see two lines that begin with <code>rsa_</code>. Comment them out so they look like this:</p>
<div class="code-label " title="/etc/vsftpd.conf">/etc/vsftpd.conf</div><pre class="code-pre "><code langs="">. . .
<span class="highlight">#</span> rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem
<span class="highlight">#</span> rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key
. . .
</code></pre>
<p>Below them, add the following lines that point to the certificate and private key we just created:</p>
<div class="code-label " title="/etc/vsftpd.conf">/etc/vsftpd.conf</div><pre class="code-pre "><code langs="">. . .
<span class="highlight">rsa_cert_file=/etc/ssl/private/vsftpd.pem</span>
<span class="highlight">rsa_private_key_file=/etc/ssl/private/vsftpd.pem</span>
. . .
</code></pre>
<p>After that, we will force the use of SSL, which will prevent clients that can't deal with TLS from connecting. This is necessary to ensure that all traffic is encrypted, but it may force your FTP user to change clients. Change <code>ssl_enable</code> to <code>YES</code>:</p>
<div class="code-label " title="/etc/vsftpd.conf">/etc/vsftpd.conf</div><pre class="code-pre "><code langs="">. . .
ssl_enable=<span class="highlight">YES</span>
. . .
</code></pre>
<p>After that, add the following lines to explicitly deny anonymous connections over SSL and to require SSL for both data transfer and logins:</p>
<div class="code-label " title="/etc/vsftpd.conf">/etc/vsftpd.conf</div><pre class="code-pre "><code langs="">. . .
<span class="highlight">allow_anon_ssl=NO</span>
<span class="highlight">force_local_data_ssl=YES</span>
<span class="highlight">force_local_logins_ssl=YES</span>
. . .
</code></pre>
<p>After this, configure the server to use TLS, the preferred successor to SSL, by adding the following lines:</p>
<div class="code-label " title="/etc/vsftpd.conf">/etc/vsftpd.conf</div><pre class="code-pre "><code langs="">. . .
<span class="highlight">ssl_tlsv1=YES</span>
<span class="highlight">ssl_sslv2=NO</span>
<span class="highlight">ssl_sslv3=NO</span>
. . .
</code></pre>
<p>Finally, we will add two more options. First, we will not require SSL reuse because it can break many FTP clients. We will require "high" encryption cipher suites, which currently means key lengths equal to or greater than 128 bits:</p>
<div class="code-label " title="/etc/vsftpd.conf">/etc/vsftpd.conf</div><pre class="code-pre "><code langs="">. . .
<span class="highlight">require_ssl_reuse=NO</span>
<span class="highlight">ssl_ciphers=HIGH</span>
. . .
</code></pre>
<p>The finished file section should look like this:</p>
<div class="code-label " title="/etc/vsftpd.conf">/etc/vsftpd.conf</div><pre class="code-pre "><code langs=""># This option specifies the location of the RSA certificate to use for SSL
# encrypted connections.
#rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem
#rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key
rsa_cert_file=/etc/ssl/private/vsftpd.pem
rsa_private_key_file=/etc/ssl/private/vsftpd.pem
ssl_enable=YES
allow_anon_ssl=NO
force_local_data_ssl=YES
force_local_logins_ssl=YES
ssl_tlsv1=YES
ssl_sslv2=NO
ssl_sslv3=NO
require_ssl_reuse=NO
ssl_ciphers=HIGH
</code></pre>
<p>When you're done, save and close the file.</p>

<p>Restart the server for the changes to take effect:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart vsftpd
</li></ul></code></pre>
<p>At this point, we will no longer be able to connect with an insecure command-line client. If we tried, we'd see something like:</p>
<pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>ftp -p <span class="highlight">203.0.113.0</span>
Connected to 203.0.113.0.
220 (vsFTPd 3.0.3)
Name (203.0.113.0:default): <span class="highlight">sammy</span>
530 Non-anonymous sessions must use encryption.
ftp: Login failed.
ftp&gt;
</code></pre>
<p>Next, let's verify that we can connect using a client that supports TLS.</p>

<h2 id="step-7-—-testing-tls-with-filezilla">Step 7 — Testing TLS with FileZilla</h2>

<p>Most modern FTP clients can be configured to use TLS encryption.  We will demonstrate how to connect with <a href="https://filezilla-project.org/">FileZilla</a> because of its cross-platform support. Consult the documentation for other clients.</p>

<p>When you first open FileZilla, find the Site Manager icon just above the word <strong>Host</strong>, the left-most icon on the top row.  Click it:</p>

<p><img src="https://assets.digitalocean.com/articles/vsftpd_18_04/vsftpd_images/filezilla_site_manager_vsftpd_18_04.png" alt="Site Manager Screent Shot"></p>

<p>A new window will open. Click the <strong>New Site</strong> button in the bottom right corner:</p>

<p><img src="https://assets.digitalocean.com/articles/vsftp-user/new-site.png" alt="New Site Button"><br>
Under <strong>My Sites</strong> a new icon with the words <strong>New Site</strong> will appear. You can name it now or return later and use the <strong>Rename</strong> button.</p>

<p>Fill out the <strong>Host</strong> field with your domain name or IP address.  Under the <strong>Encryption</strong> drop down menu, select <strong>Require explicit FTP over TLS</strong>. </p>

<p>For <strong>Logon Type</strong>, select <strong>Ask for password</strong>.  Fill in your FTP user in the <strong>User</strong> field:</p>

<p><img src="https://assets.digitalocean.com/articles/vsftpd_debian_10/vsftpd_settings.png" alt="General Settings Tab"></p>

<p>Click <strong>Connect</strong> at the bottom of the interface.  You will be asked for the user's password:</p>

<p><img src="https://assets.digitalocean.com/articles/vsftp-user/user-pass.png" alt="Password Dialogue"></p>

<p>Click <strong>OK</strong> to connect. You should now be connected with your server with TLS/SSL encryption.</p>

<p>Upon success, you will be presented with a server certificate that looks like this:</p>

<p><img src="https://assets.digitalocean.com/articles/vsftpd_18_04/vsftpd_images/filezilla_certificate_vsftpd.png" alt="Site Certificate Dialogue"></p>

<p>When you’ve accepted the certificate, double-click the <code>files</code> folder and drag <code>upload.txt</code> to the left to confirm that you’re able to download files:</p>

<p><img src="https://assets.digitalocean.com/articles/vsftpd_18_04/vsftpd_images/filezilla_file_test_vsftpd_18_04.png" alt="Download test.txt"></p>

<p>When you’ve done that, right-click on the local copy, rename it to <code>upload-tls.txt</code> and drag it back to the server to confirm that you can upload files:</p>

<p><img src="https://assets.digitalocean.com/articles/vsftpd_18_04/vsftpd_images/filezilla_file_upload_vsftpd_18_04.png" alt="Rename and Upload"></p>

<p>You’ve now confirmed that you can securely and successfully transfer files with SSL/TLS enabled.</p>

<h2 id="step-8-—-disabling-shell-access-optional">Step 8 — Disabling Shell Access (Optional)</h2>

<p>If you're unable to use TLS because of client requirements, you can gain some security by disabling the FTP user's ability to log in any other way. One relatively straightforward way to prevent it is by creating a custom shell. This will not provide any encryption, but it will limit the access of a compromised account to files accessible by FTP.</p>

<p>First, open a file called <code>ftponly</code> in the <code>bin</code> directory:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /bin/ftponly
</li></ul></code></pre>
<p>Add a message telling the user why they are unable to log in:</p>
<div class="code-label " title="/bin/ftponly">/bin/ftponly</div><pre class="code-pre "><code langs="">#!/bin/sh
echo "This account is limited to FTP access only."
</code></pre>
<p>Save the file and exit your editor.</p>

<p>Change the permissions to make the file executable:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo chmod a+x /bin/ftponly
</li></ul></code></pre>
<p>Open the list of valid shells:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/shells
</li></ul></code></pre>
<p>At the bottom add:</p>
<div class="code-label " title="/etc/shells">/etc/shells</div><pre class="code-pre "><code langs="">. . .
/bin/ftponly
</code></pre>
<p>Update the user's shell with the following command:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo usermod <span class="highlight">sammy</span> -s /bin/ftponly
</li></ul></code></pre>
<p>Now try logging into your server as <strong>sammy</strong>:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ssh sammy@<span class="highlight">your_server_ip</span>
</li></ul></code></pre>
<p>You should see something like:</p>
<pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>This account is limited to FTP access only.
Connection to 203.0.113.0 closed.
</code></pre>
<p>This confirms that the user can no longer <code>ssh</code> to the server and is limited to FTP access only.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In this tutorial we covered setting up FTP for users with a local account. If you need to use an external authentication source, you might want to look into <code>vsftpd</code>'s support of virtual users. This offers a rich set of options through the use of PAM, the Pluggable Authentication Modules, and is a good choice if you manage users in another system such as LDAP or Kerberos.</p>
