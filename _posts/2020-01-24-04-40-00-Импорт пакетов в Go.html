---
layout: post
title: Импорт пакетов в Go
network: digitalocean
date: January 24, 2020 at 04:40AM
url: https://www.digitalocean.com/community/tutorials/importing-packages-in-go-ru
image: http://ifttt.com/images/no_image_card.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="Введение">Введение</h3>

<p>Иногда для вашего кода могут потребоваться дополнительные функции вне текущей программы. В подобных случаях вы можете использовать пакеты, чтобы сделать программу более функциональной. Пакет представляет собой все файлы в одном каталоге на диске. Пакеты могут определять функции, типы и интерфейсы, на которые вы можете ссылаться в других файлах или пакетах Go.</p>

<p>В этом обучающем руководстве вы научитесь выполнять установку, импорт и присвоение имен пакетов.</p>

<h2 id="Пакеты-стандартной-библиотеки">Пакеты стандартной библиотеки</h2>

<p>Стандартная библиотека, входящая в комплект Go, представляет собой набор пакетов. Эти пакеты содержат множество фундаментальных компонентов для современного программного обеспечения. Например, пакет <a href="https://golang.org/pkg/fmt"><code>fmt</code></a> содержит базовые функции для форматирования и вывода строк. Пакет <a href="https://golang.org/pkg/net/http/"><code>net/http</code></a> содержит функции, позволяющие разработчику создавать веб-службы, отправлять и получать данные по протоколу <code>http</code> и т. д.</p>

<p>Чтобы использовать функции пакета, необходимо получить доступ к нему с помощью выражения <code>import</code>. Выражение <code>import</code> состоит из ключевого слова <code>import</code> и имени пакета.</p>

<p>Например, в файле программы Go с именем <code>random.go</code> вы можете импортировать пакет <code>math/rand</code> для генерирования случайных чисел с помощью следующей команды:</p>
<div class="code-label " title="random.go">random.go</div><pre class="code-pre "><code class="code-highlight language-go">import "math/rand"
</code></pre>
<p>При импорте пакета мы делаем его доступной в текущей программе в качестве отдельного пространства имен. Это означает, что мы будем ссылаться на функцию в <em>точечной нотации</em>, например <code><span class="highlight">package</span>.<span class="highlight">function</span></code>.</p>

<p>На практике функция из пакета <code>math/rand</code> может выглядеть, как показано в этих примерах:</p>

<ul>
<li><code>rand.Int()</code> вызывает функцию, возвращающую случайное целое число.</li>
<li><code>rand.Intn()</code> вызывает функцию, возвращающую случайный элемент от <code>0</code> до заданного числа.</li>
</ul>

<p>Создадим цикл <code>for</code>, показывающий, как мы вызываем функцию пакета <code>math/rand</code> в нашей программе <code>random.go</code>:</p>
<div class="code-label " title="random.go">random.go</div><pre class="code-pre "><code class="code-highlight language-go">package main

import "math/rand"

func main() {
  for i := 0; i &lt; 10; i++ {
    println(rand.Intn(25))
  }
}
</code></pre>
<p>Вначале программа импортирует пакет <code>math/rand</code> в третьей строке, а затем переходит к циклу <code>for</code>, который выполняется 10 раз. В этом цикле программа выводит случайное целое число в диапазоне от <code>0</code> до <code>25</code>. Целое число <code>25</code> передается функции <code>rand.Intn()</code> как параметр.</p>

<p>При запуске программы с помощью команды <code>go run random.go</code> мы получаем 10 случайных чисел. Поскольку это случайные числа, они скорее всего будут разными при каждом запуске программы. Результат будет выглядеть примерно так:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>6
12
22
9
6
18
0
15
6
0
</code></pre>
<p>Выводимые целые числа никогда не будут меньше 0 или больше 24.</p>

<p>При импорте нескольких пакетов вы можете использовать <code>()</code> для создания блока. Используя блоки, вы можете не повторять ключевое слово <code>import</code> на каждой строчке. Так ваш код будет выглядеть лучше:</p>
<div class="code-label " title="random.go">random.go</div><pre class="code-pre "><code class="code-highlight language-go">
import (
  "fmt"
  "math/rand"
)
</code></pre>
<p>Чтобы использовать дополнительный пакет, мы можем отформатировать результаты и вывести итерацию генерирования каждого случайного числа во время цикла:</p>
<div class="code-label " title="random.go">random.go</div><pre class="code-pre "><code class="code-highlight language-go">package main

import (
  "fmt"
  "math/rand"
)

func main() {
  for i := 0; i &lt; 10; i++ {
    fmt.Printf("%d) %d\n", i, rand.Intn(25))
  }
}
</code></pre>
<p>Теперь при запуске программы мы получим результат, который будет выглядеть примерно так:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>0) 6
1) 12
2) 22
3) 9
4) 6
5) 18
6) 0
7) 15
8) 6
9) 0
</code></pre>
<p>В этом разделе мы научились импортировать пакеты и использовать их для написания более функциональных программ. До сих пор мы использовали только пакеты из стандартной библиотеки. Теперь мы посмотрим, как устанавливать и использовать пакеты, написанные другими разработчиками.</p>

<h2 id="Установка-пакетов">Установка пакетов</h2>

<p>Хотя в стандартной библиотеке содержится много хороших и полезных пакетов, они целенаправленно разработаны как пакеты <em>общего назначения</em> и не имеют конкретного характера. Это позволяет разработчикам создавать собственные пакеты на основе стандартной библиотеки для выполнения конкретных задач.</p>

<p>Цепочка инструментов Go содержит команду <code>go get</code>. Эта команда позволяет устанавливать сторонние пакеты в локальную среду разработки и использовать их в вашей программе.</p>

<p>При использовании <code>go get</code> для установки сторонних пакетов часто используется канонический путь пакета. Это может быть путь к публичному проекту, размещенному в таком хранилище кода, как GitHub. Если вы захотите импортировать пакет <a href="https://github.com/gobuffalo/flect"><code>flect</code></a>, вы используете полный канонический путь:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">go get github.com/gobuffalo/flect
</li></ul></code></pre>
<p>Инструмент <code>go get</code> найдет пакет на GitHub и установит его в каталог <a href="https://www.digitalocean.com/community/tutorials/understanding-the-gopath"><code>$GOPATH</code></a>.</p>

<p>В этом примере код будет устанавливаться в следующий каталог:</p>
<pre class="code-pre "><code class="code-highlight language-sh">$GOPATH/src/github.com/gobuffalo/flect
</code></pre>
<p>Авторы часто обновляют пакеты, устраняя ошибки и добавляя новые возможности. В этом случае вам нужно использовать последнюю версию пакета для применения новых функций или устранения ошибок. Для обновления пакета вы можете использовать флаг <code>-u</code> с командой <code>go get</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">go get -u github.com/gobuffalo/flect
</li></ul></code></pre>
<p>Эта команда также установит пакет в Go, если он отсутствует в локальной среде. Если пакет уже установлен, Go попытается обновить его до последней версии.</p>

<p>Команда <code>go get</code> всегда получает последнюю доступную версию пакета. Однако возможны обновления предыдущих версий пакета, которые все равно новее используемых, и поэтому программу будет полезно обновить. Чтобы получить определенную версию пакета, вам потребуется инструмент для <strong>управления пакетами</strong>, например <a href="https://github.com/golang/go/wiki/Modules">Go Modules</a>.</p>

<p>В версии Go 1.11 модули Go используются для определения версии пакета, которую вы хотите импортировать. В настоящей статье мы не рассматриваем тему управления пакетами, но вы можете прочитать об этом <a href="https://github.com/golang/go/wiki/Modules">на странице Go Modules на GitHub</a>.</p>

<h2 id="Присвоение-имен-импортируемым-пакетам">Присвоение имен импортируемым пакетам</h2>

<p>Вы можете изменить имя пакета, если у вас уже есть локальный пакет с тем же именем, что и у используемого стороннего пакета. В этом случае лучше всего присвоить псевдоним импортируемому пакету. Вы можете изменять имена пакетов и их функций Go посредством указания <code>псевдонима</code> перед именем импортируемого пакета.</p>

<p>Данное выражение выглядит следующим образом:</p>
<pre class="code-pre "><code langs="">import <span class="highlight">another_name</span> "<span class="highlight">package</span>"
</code></pre>
<p>В этом примере мы изменяем имя пакета <code>fmt</code> в файле программы <code>random.go</code>. Мы изменим имя пакета <code>fmt</code> на <code>f</code> для сокращения. Измененная программа будет выглядеть следующим образом:</p>
<div class="code-label " title="random.go">random.go</div><pre class="code-pre txt"><code langs="">package main

import (
<span class="highlight"> f "fmt"</span>
  "math/rand"
)

func main() {
  for i := 0; i &lt; 10; i++ {
    <span class="highlight">f.Printf</span>("%d) %d\n", i, rand.Intn(25))
  }
}
</code></pre>
<p>Теперь внутри программы мы ссылаемся на функцию <code>Printf</code> как на <code>f.Printf</code>, а не на <code>fmt.Printf</code>.</p>

<p>В других языках изменение имен пакетов поощряется для упрощения их использования в программе, в Go дела обстоят иначе. Например, изменение имени пакета <code>fmt</code> на <code>f</code> не будет соответствовать <a href="https://github.com/golang/go/wiki/CodeReviewComments#import-dot">указаниям руководства по стилю</a>.</p>

<p>При переименовании импортируемых файлов во избежание конфликта имен следует переименовывать наиболее локальные или относящиеся к конкретным проектам импортируемые пакеты. Например, если у вас имеется <em>локальный</em> пакет с именем <code>strings</code>, и вы хотите импортировать <em>системный</em> пакет с именем <code>strings</code>, лучше переименовать локальный пакет, а не системный. По возможности конфликта имен следует избегать.</p>

<p>В этом разделе мы узнали, как изменить имя импортируемого пакета во избежание конфликта с именем другого импортированного пакета в нашей программе. Важно помнить, что ясность и удобство чтения вашей программы очень важны, и изменять имена следует только для удобства чтения кода или предотвращения конфликта имен.</p>

<h2 id="Форматирование-при-импорте">Форматирование при импорте</h2>

<p>При форматировании импортируемых пакетов они сортируются в определенном порядке, что делает код более согласованным. Кроме того, это предотвращает случайные записи изменений в случаях, когда меняется только порядок сортировки импортируемых пакетов. Поскольку форматирование импортируемых пакетов предотвращает случайную запись, также предотвращается засорение или сложности при проверке кода.</p>

<p>В большинстве редакторов импортируемые файлы форматируются автоматически. Также вы можете настроить редактор для использования <a href="https://godoc.org/golang.org/x/tools/cmd/goimports"><code>goimports</code></a>. Использование <code>goimports</code> в редакторе считается стандартной практикой, поскольку поддерживать порядок сортировки импортируемых пакетов вручную сложно, и при этом возможны ошибки. Кроме того, в случае изменения стиля <code>goimports</code> также обновляется с учетом этих изменений. Благодаря этому все, кто работает над кодом, будут применять единый стиль импортируемых блоков.</p>

<p>Здесь показано, как может выглядеть блок импорта до форматирования:</p>
<pre class="code-pre "><code class="code-highlight language-go">import (
  "fmt"
  "os"
  "github.com/digital/ocean/godo"
  "github.com/sammy/foo"
  "math/rand"
  "github.com/sammy/bar"
)
</code></pre>
<p>Запуск инструмента <code>goimport</code> (который также запускается при сохранении файлов в большинстве редакторов, где есть этот инструмент) изменит формат следующим образом:</p>
<pre class="code-pre "><code class="code-highlight language-go">import (
  "fmt"
  "math/rand"
  "os"

  "github.com/sammy/foo"
  "github.com/sammy/bar"

  "github.com/digital/ocean/godo"
)
</code></pre>
<p>Обратите внимание, что вначале группируются все пакеты стандартной библиотеки, а затем все сторонние пакеты группируются с пустыми строками. Это упрощает чтение и понимание состава используемых пакетов.</p>

<p>В этом разделе мы узнали, что использование <code>goimports</code> обеспечит правильное форматирование всех импортируемых блоков и поможет предотвратить несогласованность кода в случае работы нескольких разработчиков с одними и теми же файлами.</p>

<h2 id="Заключение">Заключение</h2>

<p>Импорт пакетов позволяет нам вызывать функции, которые не встроены в Go. Некоторые пакеты являются частью стандартной библиотеки, входящей в комплектацию Go, а некоторые нужно устанавливать с помощью инструмента <code>go get</code>.</p>

<p>Использование пакетов делает программу более функциональной и надежной, поскольку мы используем существующий код. Также мы можем <a href="https://www.digitalocean.com/community/tutorials/how-to-write-packages-in-go">создавать собственные пакеты</a> для себя и других программистов и использовать их в будущих программах.</p>
