---
layout: post
title: Установка веб-сервера Apache в Debian 9
network: digitalocean
date: January 07, 2020 at 07:48PM
url: https://www.digitalocean.com/community/tutorials/how-to-install-the-apache-web-server-on-debian-9-ru
image: http://assets.digitalocean.com/how-to-install-lamp-debian-9/small_apache_default_debian9.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="Введение">Введение</h3>

<p>HTTP-сервер Apache — самый широко используемый веб-сервер в мире. Он имеет множество мощных функций, включая динамически загружаемые модули, надежную поддержку различных медиа-форматов и интеграцию с другим популярным программным обеспечением.</p>

<p>В этом обучающем модуле мы расскажем, как установить веб-сервер Apache на сервере Debian 9.</p>

<h2 id="Предварительные-требования">Предварительные требования</h2>

<p>Прежде чем начать прохождение настоящего обучающего модуля, необходимо настроить на сервере обычного пользователя без привилегий root и с привилегиями sudo. Также вам потребуется включить базовый брандмауэр, чтобы заблокировать все порты, кроме необходимых. Вы научитесь настраивать учетную запись обычного пользователя и брандмауэр для вашего сервера, следуя указаниям руководства <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-debian-9">Начальная настройка сервера Debian 9</a>.</p>

<p>Создав учетную запись, войдите в систему как пользователь без привилегий root.</p>

<h2 id="Шаг-1-—-Установка-apache">Шаг 1 — Установка Apache</h2>

<p>Apache поставляется с используемыми по умолчанию хранилищами программного обеспечения Debian, что позволяет использовать для его установки инструменты управления из стандартных пакетов.</p>

<p>Для начала выгрузим указатель локальных пакетов, чтобы отразить последние изменения на предыдущих уровнях:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt update
</li></ul></code></pre>
<p>Затем установим пакет <code>apache2</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt install apache2
</li></ul></code></pre>
<p>После подтверждения установки <code>apt</code> выполнит установку Apache и всех требуемых зависимостей.</p>

<h2 id="Шаг-2-—-Настройка-брандмауэра">Шаг 2 — Настройка брандмауэра</h2>

<p>Прежде чем тестировать Apache, необходимо изменить настройки брандмауэра, чтобы разрешить доступ к веб-портам по умолчанию. Если вы выполнили предварительные указания , у вас должен быть установлен брандмауэр UFW, настроенный для ограничения доступа к вашему серверу.</p>

<p>Во время установки Apache регистрируется в UFW, предоставляя несколько профилей приложений, которые можно использовать для включения или отключения доступа к Apache через брандмауэр.</p>

<p>Выведите список профилей приложений <code>ufw</code>, введя следующую команду:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw app list
</li></ul></code></pre>
<p>Вы увидите список профилей приложений:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Available applications:
  AIM
  Bonjour
  CIFS
. . .
 WWW
 WWW Cache
 WWW Full
 WWW Secure
. . .
</code></pre>
<p>Профили Apache начинаются с WWW:</p>

<ul>
<li><strong>WWW:</strong> этот профиль открывает только порт 80 (обычный веб-трафик без шифрования)</li>
<li><strong>WWW Cache:</strong> этот профиль открывает только порт 8080 (иногда используется для кэширования и веб-прокси)</li>
<li><strong>WWW Full:</strong> этот профиль открывает порт 80 (обычный веб-трафик без шифрования) и порт 443 (трафик TLS/SSL с шифрованием)</li>
<li><strong>WWW Secure:</strong> этот профиль открывает только порт 443 (трафик с шифрованием TLS/SSL)</li>
</ul>

<p>Рекомендуется применять самый ограничивающий профиль, который будет разрешать заданный трафик. Поскольку в этом модуле мы еще не настроили SSL для нашего сервера, нам нужно будет только разрешить трафик на порту 80.</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow 'WWW'
</li></ul></code></pre>
<p>Для проверки изменений введите:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw status
</li></ul></code></pre>
<p>В результатах вы должны увидеть, что трафик HTTP разрешен:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Status: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere
WWW                        ALLOW       Anywhere
OpenSSH (v6)               ALLOW       Anywhere (v6)
WWW (v6)                   ALLOW       Anywhere (v6)
</code></pre>
<p>Как видите, профиль был активирован для разрешения доступа к веб-серверу.</p>

<h2 id="Шаг-3-—-Проверка-веб-сервера">Шаг 3 — Проверка веб-сервера</h2>

<p>В конце процесса установки Debian 9 запускает Apache. Веб-сервер уже должен быть запущен и работать.</p>

<p>Используйте команду <code>systemd</code> init system, чтобы проверить работу службы:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl status apache2
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>● apache2.service - The Apache HTTP Server
   Loaded: loaded (/lib/systemd/system/apache2.service; enabled; vendor preset: enabled)
   Active: active (running) since Wed 2018-09-05 19:21:48 UTC; 13min ago
 Main PID: 12849 (apache2)
   CGroup: /system.slice/apache2.service
           ├─12849 /usr/sbin/apache2 -k start
           ├─12850 /usr/sbin/apache2 -k start
           └─12852 /usr/sbin/apache2 -k start

Sep 05 19:21:48 apache systemd[1]: Starting The Apache HTTP Server...
Sep 05 19:21:48 apache systemd[1]: Started The Apache HTTP Server.
</code></pre>
<p>Как видно из результатов, служба успешно запущена. Однако лучше всего протестировать ее запуск посредством запроса страницы из Apache.</p>

<p>Откройте страницу Apache по умолчанию, чтобы подтвердить работу программного обеспечения через ваш IP-адрес: Если вы не знаете IP-адрес вашего сервера, есть несколько способов узнать его с помощью командной строки.</p>

<p>Попробуйте ввести в командной строке сервера следующую команду:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">hostname -I
</li></ul></code></pre>
<p>Вы получите несколько адресов, разделенных пробелами. Вы можете попробовать каждый из них в браузере, чтобы убедиться в их работоспособности.</p>

<p>Альтернатива заключается в использовании инструмента <code>curl</code>, который должен предоставить вам публичный IP-адрес, отображаемый в других местах в интернете.</p>

<p>Вначале выполните установку <code>curl</code> с помощью <code>apt</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt install curl
</li></ul></code></pre>
<p>Затем используйте <code>curl</code> для получения icanhazip.com с помощью IPv4:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">curl -4 icanhazip.com
</li></ul></code></pre>
<p>Когда вы узнаете IP-адрес вашего сервера, введите его в адресную строку браузера:</p>
<pre class="code-pre "><code langs="">http://<span class="highlight">your_server_ip</span>
</code></pre>
<p>Вы увидите веб-страницу Debian 9 Apache по умолчанию:</p>

<p><img src="http://assets.digitalocean.com/how-to-install-lamp-debian-9/small_apache_default_debian9.png" alt="Страница Apache по умолчанию"></p>

<p>Эта страница показывает, что Apache работает корректно. Также на ней содержится информация о важных файлах Apache и расположении каталогов.</p>

<h2 id="Шаг-4-—-Управление-процессом-apache">Шаг 4 — Управление процессом Apache</h2>

<p>Теперь ваш веб-сервер запущен и работает, и настало время изучить некоторые простые команды управления.</p>

<p>Чтобы остановить веб-сервер, введите:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl stop apache2
</li></ul></code></pre>
<p>Чтобы запустить остановленный веб-сервер, введите:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl start apache2
</li></ul></code></pre>
<p>Чтобы остановить и снова запустить службу, введите:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart apache2
</li></ul></code></pre>
<p>Если вы просто вносите изменения в конфигурацию, во многих случаях Apache может перезагружаться без отключения соединений. Для этого нужно использовать следующую команду:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl reload apache2
</li></ul></code></pre>
<p>По умолчанию Apache настроен на автоматический запуск при загрузке сервера. Если вы не хотите этого, отключите такое поведение с помощью следующей команды:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl disable apache2
</li></ul></code></pre>
<p>Чтобы перезагрузить службу для запуска во время загрузки, введите:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl enable apache2
</li></ul></code></pre>
<p>Теперь Apache должен запуститься автоматически при следующей загрузке сервера.</p>

<h2 id="Шаг-5-—-Настройка-виртуальных-хостов-рекомендуется">Шаг 5 — Настройка виртуальных хостов (рекомендуется)</h2>

<p>При использовании веб-сервера Apache вы можете использовать <em>виртуальные хосты</em> (аналогичные серверным блокам в Nginx) для инкапсуляции данных конфигурации и размещения на одном сервере нескольких доменов. Мы создадим домен <strong>example.com</strong>, но вы должны <strong>заменить это имя собственным доменным именем</strong>. Чтобы узнать больше о настройке доменного имени с помощью DigitalOcean, пройдите наш обучающий модуль <a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-digitalocean-dns">Введение в DigitalOcean DNS</a>.</p>

<p>В Apache в Debian 9 по умолчанию включен один серверный блок, настроенный на обслуживание документов из каталога <code>/var/www/html</code>. Хотя это хорошо работает для отдельного сайта, при хостинге нескольких сайтов это неудобно. Вместо изменения <code>/var/www/html</code> мы создадим в <code>/var/www</code> структуру каталогов для нашего сайта <strong>example.com</strong>, оставив <code>/var/www/html</code> как каталог по умолчанию для вывода в случае, если запросу клиента не соответствуют никакие другие сайты.</p>

<p>Создайте каталог для <strong>example.com</strong> следующим образом, используя опцию <code>-p</code> для создания необходимых родительских каталогов:</p>
<pre class="code-pre commmand"><code langs="">sudo mkdir -p /var/www/<span class="highlight">example.com</span>/html
</code></pre>
<p>Затем назначьте владение каталогом с помощью переменной среды <code>$USER</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo chown -R $USER:$USER /var/www/<span class="highlight">example.com</span>/html
</li></ul></code></pre>
<p>Разрешения корневых каталогов веб-сервера должны быть правильными, если вы не изменяли значение <code>unmask</code>. Тем не менее, вы можете проверить это с помощью следующей команды:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo chmod -R 755 /var/www/<span class="highlight">example.com</span>
</li></ul></code></pre>
<p>Затем создайте в качестве примера страницу <code>index.html</code>, используя <code>nano</code> или свой любимый редактор:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano /var/www/<span class="highlight">example.com</span>/html/index.html
</li></ul></code></pre>
<p>Добавьте в страницу следующий образец кода HTML:</p>
<div class="code-label " title="/var/www/example.com/html/index.html">/var/www/example.com/html/index.html</div><pre class="code-pre "><code langs="">&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Welcome to <span class="highlight">Example.com</span>!&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Success!  The <span class="highlight">example.com</span> virtual host is working!&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Сохраните файл и закройте его после завершения.</p>

<p>Для обслуживания этого контента Apache необходимо создать файл виртуального хоста с правильными директивами. Вместо изменения файла конфигурации по умолчанию <code>/etc/apache2/sites-available/000-default.conf</code> мы создадим новый файл <code>/etc/apache2/sites-available/<span class="highlight">example.com</span>.conf</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/apache2/sites-available/<span class="highlight">example.com</span>.conf
</li></ul></code></pre>
<p>Введите следующий блок конфигурации, который похож на заданный по умолчанию, но обновлен с учетом нового каталога и доменного имени:</p>
<div class="code-label " title="/etc/apache2/sites-available/example.com.conf">/etc/apache2/sites-available/example.com.conf</div><pre class="code-pre "><code langs="">&lt;VirtualHost *:80&gt;
    ServerAdmin <span class="highlight">admin@example.com</span>
    ServerName <span class="highlight">example.com</span>
    ServerAlias <span class="highlight">www.example.com</span>
    DocumentRoot /var/www/<span class="highlight">example.com</span>/html
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
&lt;/VirtualHost&gt;
</code></pre>
<p>Обратите внимание, что мы изменили <code>DocumentRoot</code> на новый каталог, а <code>ServerAdmin</code> — на адрес электронной почты, доступный администратору сайта <strong>example.com.</strong> Также мы добавили две директивы: директиву <code>ServerName</code>, которая устанавливает базовый домен и должна соответствовать определению виртуального хоста, и директиву <code>ServerAlias</code>, которая задает дополнительные имена, которые должны давать совпадение, как если бы они были базовыми именами.</p>

<p>Сохраните файл и закройте его после завершения.</p>

<p>Активируем файл с помощью инструмента <code>a2ensite</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo a2ensite <span class="highlight">example.com</span>.conf
</li></ul></code></pre>
<p>Отключите сайт по умолчанию, определеный в <code>000-default.conf</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo a2dissite 000-default.conf
</li></ul></code></pre>
<p>Затем проверим ошибки конфигурации:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apache2ctl configtest
</li></ul></code></pre>
<p>Вы должны увидеть следующий результат:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Syntax OK
</code></pre>
<p>Перезапустие Apache для внесения изменений:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart apache2
</li></ul></code></pre>
<p>Теперь Apache должен обслуживать ваше доменное имя. Вы можете проверить это, открыв в браузере адрес <code>http://<span class="highlight">example.com</span></code>, после чего должны увидеть примерно следующее:</p>

<p><img src="https://assets.digitalocean.com/articles/apache_virt_hosts_1404/example.png" alt="Пример виртуального хоста Apache"></p>

<h2 id="Шаг-6-—-Знакомство-с-важными-файлами-и-каталогами-apache">Шаг 6 — Знакомство с важными файлами и каталогами Apache</h2>

<p>Теперь вы научились управлять службой Apache, и настало время познакомиться с несколькими важными каталогами и файлами.</p>

<h3 id="Контент">Контент</h3>

<ul>
<li><code>/var/www/html</code>: веб-контент, в состав которого по умолчанию входит только показанная ранее страница Apache по умолчанию, выводится из каталога <code>/var/www/html</code>. Это можно изменить путем изменения файлов конфигурации Apache.</li>
</ul>

<h3 id="Конфигурация-сервера">Конфигурация сервера</h3>

<ul>
<li><code>/etc/apache2</code>: каталог конфигурации Apache. Здесь хранятся все файлы конфигурации Apache.</li>
<li><code>/etc/apache2/apache2conf</code>: главный файл конфигурации Apache. Его можно изменить для внесения изменений в глобальную конфигурацию Apache. Этот файл отвечает за загрузку многих других файлов в каталоге конфигурации.</li>
<li><code>/etc/apache2/ports.conf</code>: этот файл задает порты, которые будет прослушивать Apache. По умолчанию Apache прослушивает порта 80, а если активирован модуль с функциями SSL, он также прослушивает порт 443.</li>
<li><code>/etc/apache2/sites-available/</code>: каталог, где можно хранить виртуальные хосты для каждого сайта. Apache не будет использовать файлы конфигурации из этого каталога, если они не будут связаны с каталогом <code>sites-enabled</code>. Обычно все изменения конфигурации серверных блоков выполняются в этом каталоге, а затем активируются посредством ссылки на другой каталог с помощью команды <code>a2ensite</code>.</li>
<li><code>/etc/apache2/sites-enabled/</code>: каталог, где хранятся активные виртуальные хосты для каждого сайта. Обычно они создаются посредством создания ссылок на файлы конфигурации из каталога <code>sites-available</code> с помощью команды <code>a2ensite</code>. Apache считывает файлы конфигурации и ссылки из этого каталога при запуске или перезагрузке, когда компилируется полная конфигурация.</li>
<li><code>/etc/apache2/conf-available/</code>, <code>/etc/apache2/conf-enabled/</code>: эти каталоги имеют те же отношения, что и каталоги <code>sites-available</code> и <code>sites-enabled</code>, но используются для хранения фрагментов конфигурации, которые не принадлежат виртуальному хосту. Файлы из каталога <code>conf-available</code> можно активировать с помощью команды <code>a2enconf</code> и отключить с помощью команды <code>a2disconf</code>.</li>
<li><code>/etc/apache2/mods-available/</code>, <code>/etc/apache2/mods-enabled/</code>: эти каталоги содержат доступны и активированные модули соответственно. Файлы с расширением <code>.load</code> содержат фрагменты для загрузки определенных модулей, а файлы с расширением <code>.conf</code> содержат конфигурации этих модулей. Модули можно активировать и отключать с помощью команд <code>a2enmod</code> и <code>a2dismod</code>.</li>
</ul>

<h3 id="Журналы-сервера">Журналы сервера</h3>

<ul>
<li><code>/var/log/apache2/access.log</code>: по умолчанию каждый запрос веб-сервера регистрируется в этом файле журналда, если Apache не настроен по другому.</li>
<li><code>/var/log/apache2/error.log</code>: по умолчанию все ошибки регистрируются в этом файле. Директива <code>LogLevel</code> в конфигурации Apache указывает, насколько детальные записи регистрируются в журналах ошибок.</li>
</ul>

<h2 id="Заключение">Заключение</h2>

<p>Теперь вы установили веб-сервер и у вас есть богатые возможности выбора типа обслуживаемого контента и технологий для расширения возможностей пользователя.</p>

<p>Если вы хотите развернуть более полный комплекс приложений, ознакомьтесь с этой статьей <a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-apache-mariadb-php-lamp-stack-debian9">Настройка набора LAMP в Debian 9</a>.</p>
