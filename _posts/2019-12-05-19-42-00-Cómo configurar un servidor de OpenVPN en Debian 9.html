---
layout: post
title: Cómo configurar un servidor de OpenVPN en Debian 9
network: digitalocean
date: December 05, 2019 at 07:42PM
url: https://www.digitalocean.com/community/tutorials/como-configurar-un-servidor-de-openvpn-en-debian-9-es
image: https://assets.digitalocean.com/articles/openvpn_ubunutu/1.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="introducción">Introducción</h3>

<p>¿Desea acceder a Internet de manera segura desde su teléfono inteligente o desde su notebook cuando está conectado a una red no confiable, como la red wifi de un hotel o una cafetería? Una <a href="https://en.wikipedia.org/wiki/Virtual_private_network">red privada virtual</a> (VPN, por su sigla en inglés) le permite desplazarse por redes no confiables de manera privada y segura, como si estuviera en una red privada. El tráfico se inicia en el servidor de la VPN y continúa su camino hacia el destino.</p>

<p>Cuando se combina con <a href="https://en.wikipedia.org/wiki/HTTP_Secure">conexiones HTTPS</a>, esta configuración le permite proteger los inicios de sesión y las operaciones que realiza por medios inalámbricos. Puede evadir censuras y restricciones geográficas, y  proteger su ubicación y el tráfico de HTTP no cifrado contra la actividad de la red no confiable.</p>

<p><a href="https://openvpn.net">OpenVPN</a> es una solución de capa de conexión segura (SSL) de funciones completas y de código abierto que cuenta con una amplia variedad de configuraciones. A través de este tutorial, configurará un servidor de OpenVPN en un servidor de Debian 9 y luego el acceso a él desde Windows, macOS, iOS o Android. Se intentará brindar el mayor nivel de simplicidad posible para los pasos de instalación y configuración de cada una de las configuraciones.</p>

<span class='note'><p>
<strong>Nota</strong>: Si planea configurar un servidor de OpenVPN en un Droplet de DigitalOcean, tenga en cuenta que nosotros, como muchos proveedores de alojamiento web, aplicamos cobros por excesos de banda ancha. Por este motivo, controle el volumen de tráfico que maneja su servidor.</p>

<p>Consulte <a href="https://www.digitalocean.com/docs/accounts/billing/bandwidth/">esta página</a> para obtener más información.<br></p></span>

<h2 id="requisitos-previos">Requisitos previos</h2>

<p>Para completar este tutorial, necesitará acceso a un servidor de Debian 9 a fin de alojar su servicio de OpenVPN. Antes de comenzar a seguir los pasos de esta guía, deberá configurar un usuario no <strong>root</strong> con privilegios <code>sudo</code>. Puede seguir nuestra <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-debian-9">guía de configuración inicial para servidores de Debian 9</a> para configurar un usuario con los permisos adecuados. A través del tutorial del enlace también se podrá configurar un <strong>firewall</strong>, que para esta guía se supone que está instalado.</p>

<p>Además, necesitará una máquina aparte para que funcione como su autoridad de certificación (CA). Si bien es técnicamente posible usar su servidor de OpenVPN o su máquina local como CA, esto no se recomienda porque expone su VPN a algunas vulnerabilidades de seguridad. Según la <a href="https://openvpn.net/index.php/open-source/documentation/">documentación oficial de OpenVPN</a>, debe instalar su CA en una máquina independiente dedicada a importar y firmar solicitudes de certificados. Por este motivo, para esta guía se supone que su CA se encuentra en un servidor de Debian 9 independiente que también tiene un usuario no <strong>root</strong> con privilegios <code>sudo</code> y un firewall básico.</p>

<p>Tenga en cuenta que si deshabilita la autenticación de contraseña mientras configura estos servidores, es posible que experimente dificultades al transferir archivos entre ellos más adelante en esta guía. Para solucionar este problema, puede volver a habilitar la autenticación de contraseña en cada servidor. De manera alternativa, puede generar un par de claves SSH para cada servidor, luego agregar la clave SSH pública del servidor de OpenVPN al archivo <code>authorized_keys</code> y viceversa. Consulte <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys-on-debian-9">Cómo configurar claves SSH en Debian 9</a> para hallar instrucciones sobre cómo aplicar cualquiera de estas soluciones.</p>

<p>Una vez cumplidos estos requisitos previos, podrá abordar el paso 1 de este tutorial.</p>

<h2 id="paso-1-instalar-openvpn-y-easyrsa">Paso 1: Instalar OpenVPN y EasyRSA</h2>

<p>Para comenzar, actualice el índice de paquetes de su <strong>servidor de VPN</strong> e instale OpenVPN. OpenVPN está disponible en los repositorios predeterminados de Debian, por lo que puede usar <code>apt</code> para la instalación:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt update
</li><li class="line" prefix="$">sudo apt install openvpn
</li></ul></code></pre>
<p>OpenVPN es una VPN TL/SSL. Esto significa que utiliza certificados para cifrar el tráfico entre el servidor y los clientes. Para emitir certificados de confianza, debe configurar su propia autoridad de certificación (CA) simple. Para hacer esto, descargaremos la última versión de EasyRSA, que usaremos para crear nuestra infraestructura de clave pública (PKI) de CA, desde el repositorio de GitHub oficial del proyecto.</p>

<p>Como se mencionó en los requisitos previos, crearemos la CA en un servidor independiente. Este enfoque se basa en la idea de que si un atacante pudiera infiltrarse en su servidor, podría acceder a la clave privada de su CA y usarla para firmar nuevos certificados, con lo cual obtendría acceso a su VPN. Respectivamente, administrar la CA desde una máquina independiente ayuda a evitar que los usuarios no autorizados accedan a su VPN. Tenga también en cuenta que se recomienda mantener el servidor de CA desactivado cuando no esté  en uso para firmar claves como medida de precaución adicional.</p>

<p>A fin de comenzar a crear la infraestructura de CA y PKI, use <code>wget</code> para descargar la última versión de EasyRSA tanto en su máquina de CA como en su <strong>servidor de OpenVPN</strong>. Para obtener la última versión, diríjase a la página <a href="https://github.com/OpenVPN/easy-rsa/releases"><strong>Releases</strong> (versiones) del proyecto oficial EasyRSA de GitHub</a>, copie el enlace de descarga del archivo que termina en <code>.tgz</code> y luego péguelo en el siguiente comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">wget -P ~/ <span class="highlight">https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.4/EasyRSA-3.0.4.tgz</span>
</li></ul></code></pre>
<p>Luego extraiga el tarball:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd ~
</li><li class="line" prefix="$">tar xvf EasyRSA-<span class="highlight">3.0.4</span>.tgz
</li></ul></code></pre>
<p>Con esto, habrá instalado de manera correcta el software necesario en su servidor y en su máquina de CA. Podrá proseguir con la configuración de las variables empleadas por EasyRSA y la fijación de un directorio de CA, desde el cual generará las claves y los certificados necesarios para que su servidor y sus clientes accedan a la VPN.</p>

<h2 id="paso-2-configurar-las-variables-de-easyrsa-y-crear-la-ca">Paso 2: Configurar las variables de EasyRSA y crear la CA</h2>

<p>EasyRSA cuenta con un archivo de configuración que puede editar para definir diversas variables para su CA.</p>

<p>En su *<em>máquina *</em>de CA, diríjase al directorio EasyRSA:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd ~/EasyRSA-<span class="highlight">3.0.4</span>/
</li></ul></code></pre>
<p>Dentro de este directorio, hay un archivo llamado <code>vars.example</code>. Haga una copia de este archivo y asigne a esta el nombre <code>vars</code> sin agregar una extensión:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cp vars.example vars
</li></ul></code></pre>
<p>Abra este archivo nuevo con su editor de texto preferido:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano vars
</li></ul></code></pre>
<p>Encuentre los ajustes que establecen los valores de campos predeterminados para nuevos certificados. El aspecto será similar a este:</p>
<div class="code-label " title="~/EasyRSA-3.0.4/vars">~/EasyRSA-3.0.4/vars</div><pre class="code-pre  second-environment"><code langs="">. . .

#set_var EASYRSA_REQ_COUNTRY    "US"
#set_var EASYRSA_REQ_PROVINCE   "California"
#set_var EASYRSA_REQ_CITY       "San Francisco"
#set_var EASYRSA_REQ_ORG        "Copyleft Certificate Co"
#set_var EASYRSA_REQ_EMAIL      "me@example.net"
#set_var EASYRSA_REQ_OU         "My Organizational Unit"

. . .
</code></pre>
<p>Quite los comentarios de estas líneas y cambie los valores resaltados por los que prefiera, pero no los deje vacíos:</p>
<div class="code-label " title="~/EasyRSA-3.0.4/vars">~/EasyRSA-3.0.4/vars</div><pre class="code-pre  second-environment"><code langs="">. . .

set_var EASYRSA_REQ_COUNTRY    "<span class="highlight">US</span>"
set_var EASYRSA_REQ_PROVINCE   "<span class="highlight">NewYork</span>"
set_var EASYRSA_REQ_CITY       "<span class="highlight">New York City</span>"
set_var EASYRSA_REQ_ORG        "<span class="highlight">DigitalOcean</span>"
set_var EASYRSA_REQ_EMAIL      "<span class="highlight">admin@example.com</span>"
set_var EASYRSA_REQ_OU         "<span class="highlight">Community</span>"

. . .
</code></pre>
<p>Cuando termine, guarde y cierre el archivo.</p>

<p>Dentro del directorio EasyRSA hay una secuencia de comandos llamada ​​​<code>​easyrsa</code>, que se usar para llevar a cabo varias tareas relacionadas con la creación y administración de la CA. Ejecute la secuencia de comandos con la opción <code>init-pki</code> para iniciar la infraestructura de clave pública en el servidor de CA:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa init-pki
</li></ul></code></pre><pre class="code-pre  second-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>. . .
init-pki complete; you may now create a CA or requests.
Your newly created PKI dir is: /home/<span class="highlight">sammy</span>/EasyRSA-<span class="highlight">3.0.4</span>/pki
</code></pre>
<p>Luego, ejecute la secuencia de comandos <code>easyrsa</code> nuevamente, seguida de la opción <code>build-ca</code>. Con esto, se crearán la CA y dos archivos importantes, <code>ca.crt</code> y <code>ca.key</code>, que representarán los lados públicos y privados de un certificado SSL.</p>

<ul>
<li><code>ca.crt</code> es el archivo de certificado público de CA que usan, en el contexto de OpenVPN, el servidor y el cliente para informarse entre sí que son parte de la misma red de confianza y no atacantes desconocidos. Por este motivo, su servidor y todos sus clientes necesitarán una copia del archivo <code>ca.crt</code>.</li>
<li><code>ca.key</code> es la clave privada que la máquina CA usa para firmar claves y certificados para servidores y clientes. Si un atacante logra acceder a su CA, y con ello a su archivo <code>ca.key</code>, podrá firmar solicitudes de certificados y acceder a su VPN, lo que inhabilitará su seguridad. Esta es la razón por la cual su archivo <code>ca.key</code> deberá estar *<em>únicamente *</em>en su máquina de CA. A su vez, lo ideal sería que su máquina de CA estuviera desconectada cuando no firme solicitudes de certificados como medida de seguridad adicional.</li>
</ul>

<p>Si no desea que se le solicite una contraseña cada vez que interactúe con su CA, puede ejecutar el comando <code>build-ca</code> con la opción <code>nopass</code>, de la siguiente forma:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa build-ca nopass
</li></ul></code></pre>
<p>En el resultado, se le solicitará confirmar el <em>nombre común</em> de su CA:</p>
<pre class="code-pre  second-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>. . .
Common Name (eg: your user, host, or server name) [Easy-RSA CA]:
</code></pre>
<p>El nombre común es el que se usa para hacer referencia a esta máquina en el contexto de la autoridad de certificación. Puede ingresar cualquier secuencia de caracteres para el nombre común de la CA. No obstante, para hacerlo más simple, presione <code>ENTER</code> para aceptar el nombre predeterminado.</p>

<p>Con esto, su CA quedará configurada y lista para comenzar a firmar solicitudes de certificado.</p>

<h2 id="paso-3-crear-los-archivos-de-certificado-clave-y-cifrado-del-servidor">Paso 3: Crear los archivos de certificado, clave y cifrado del servidor</h2>

<p>Ahora que ya tiene lista una CA, puede generar una solicitud de clave y certificado privados desde su servidor y luego transferirla a su CA para que la firme y cree el certificado solicitado. También puede crear algunos archivos adicionales que se usan durante el proceso de cifrado.</p>

<p>Comience dirigiéndose al directorio EasyRSA en su <strong>servidor de OpenVPN</strong>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd EasyRSA-<span class="highlight">3.0.4</span>/
</li></ul></code></pre>
<p>Desde allí, ejecute la secuencia de comandos <code>easyrsa</code> con la opción <code>init-pki</code>. Aunque ya ejecutó este comando en la máquina de CA, es necesario ejecutarlo aquí porque su servidor y su CA tendrán directorios de PKI independientes:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa init-pki
</li></ul></code></pre>
<p>Luego, ejecute la secuencia de comandos <code>easyrsa</code> nuevamente, esta vez con la opción <code>gen-req</code> seguida de un nombre común para la máquina. Este nombre, una vez más, puede ser cualquiera, aunque puede ser útil que sea descriptivo. A lo largo de este tutorial, el nombre común del servidor de OpenVPN será simplemente “server”. Asegúrese de incluir también la opción <code>nopass</code>. Si no lo hace, se protegerá con contraseña el archivo de solicitud, lo que puede generar problemas de permisos posteriormente:</p>

<p><span class='note'><strong>Nota</strong>: Si elige otro nombre que no sea “server”, deberá modificar algunas de las instrucciones a continuación. Por ejemplo, al copiar los archivos generados al directorio <code>/etc/openvpn</code>, deberá sustituir los nombres que correspondan. También deberá modificar el archivo <code>/etc/openvpn/server.conf</code>  más adelante para apuntar a los archivos <code>.crt</code> y <code>.key</code> correctos.<br></span></p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa gen-req server nopass
</li></ul></code></pre>
<p>Con esto se crearán una clave privada para el servidor y un archivo de solicitud de certificado llamado <code>server.req</code>. Copie la clave del servidor al directorio <code>/etc/openvpn/</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo cp ~/EasyRSA-<span class="highlight">3.0.4</span>/pki/private/server.key /etc/openvpn/
</li></ul></code></pre>
<p>Transfiera el archivo <code>server.req</code> a su máquina de CA utilizando un método seguro (como SCP, en el ejemplo que ofrecemos a continuación):</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">scp ~/EasyRSA-3.0.4/pki/reqs/server.req <span class="highlight">sammy</span>@<span class="highlight">your_CA_ip</span>:/tmp
</li></ul></code></pre>
<p>Luego, en *<em>su *</em>máquina de CA, diríjase al directorio EasyRSA:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd EasyRSA-<span class="highlight">3.0.4</span>/
</li></ul></code></pre>
<p>Usando nuevamente la secuencia de comandos <code>easyrsa</code>, importe el archivo <code>server.req</code> y siga la ruta de este con su nombre común:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa import-req /tmp/server.req server
</li></ul></code></pre>
<p>Luego, firme la solicitud ejecutando la secuencia <code>easyrsa</code> con la opción <code>sign-req</code>,seguida del <em>tipo de solicitud</em> y el nombre común. El tipo de solicitud puede ser <code>client</code> o <code>server</code>. Por ello, para la solicitud de certificado del servidor de OpenVPN asegúrese de usar el tipo de solicitud <code>server</code>:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa sign-req server server
</li></ul></code></pre>
<p>Al finalizar, se le solicitará verificar que la solicitud provenga de una fuente de confianza. Escriba <code>yes</code> y luego presion e <code>ENTER</code> para confirmarlo:</p>
<pre class="code-pre  second-environment"><code langs="">You are about to sign the following certificate.
Please check over the details shown below for accuracy. Note that this request
has not been cryptographically verified. Please be sure it came from a trusted
source or that you have verified the request checksum with the sender.

Request subject, to be signed as a server certificate for 3650 days:

subject=
    commonName                = server


Type the word 'yes' to continue, or any other input to abort.
  Confirm request details: <span class="highlight">yes</span>
</code></pre>
<p>Si cifró su clave de CA, se le solicitará ingresar la contraseña en este punto.</p>

<p>Luego, transfiera el certificado firmado de vuelta a su servidor de VPN con un método seguro:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">scp pki/issued/server.crt <span class="highlight">sammy</span>@<span class="highlight">your_server_ip</span>:/tmp
</li></ul></code></pre>
<p>Antes de cerrar sesión en su máquina de CA, transfiera también el archivo <code>ca.crt</code> a su servidor:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">scp pki/ca.crt <span class="highlight">sammy</span>@<span class="highlight">your_server_ip</span>:/tmp
</li></ul></code></pre>
<p>Luego, vuelva a iniciar sesión en su servidor de OpenVPN y copie los archivos <code>server.crt</code> y <code>ca.cart</code> a su <code>directorio /etc/openvpn/:</code></p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo cp /tmp/{server.crt,ca.crt} /etc/openvpn/
</li></ul></code></pre>
<p>Luego, diríjase a su directorio EasyRSA:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd EasyRSA-<span class="highlight">3.0.4</span>/
</li></ul></code></pre>
<p>Desde ahí, cree una clave segura Diffie-Hellman para usarla durante el intercambio de claves escribiendo:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa gen-dh
</li></ul></code></pre>
<p>Esta operación puede tardar unos minutos. Una vez que se complete, genere una firma HMAC para fortalecer las capacidades de verificación de integridad TLS del servidor:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo openvpn --genkey --secret ta.key
</li></ul></code></pre>
<p>Cuando el comando se aplique, copie los dos nuevos archivos a su directorio <code>/etc/openvpn/</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo cp ~/EasyRSA-<span class="highlight">3.0.4</span>/ta.key /etc/openvpn/
</li><li class="line" prefix="$">sudo cp ~/EasyRSA-<span class="highlight">3.0.4</span>/pki/dh.pem /etc/openvpn/
</li></ul></code></pre>
<p>Con esto, se generarán todos los archivos de certificados y claves necesarios para su servidor. Ya está listo para crear los certificados y las claves correspondientes que usará su máquina cliente para acceder a su servidor de OpenVPN.</p>

<h2 id="paso-4-generar-un-par-de-certificado-y-clave-de-cliente">Paso 4: Generar un par de certificado y clave de cliente</h2>

<p>Aunque puede generar una solicitud de claves y certificados privados en su máquina cliente y luego enviarla a la CA para que la firme, en esta guía se describe un proceso para generar la solicitud de certificado en el servidor. El beneficio de esto es que podemos crear una secuencia de comandos que generará de manera automática archivos de configuración que contienen las claves y los certificados necesarios. Esto le permite evitar la transferencia de claves, certificados y archivos de configuración a los clientes y optimiza el proceso para unirse a la VPN.</p>

<p>Generaremos un par individual de clave y certificado de cliente para esta guía. Si tiene más de un cliente, puede repetir este proceso para cada uno. Tenga en cuenta que deberá pasar un valor de nombre único a la secuencia de comandos para cada cliente. En este tutorial, el primer par de certificado y clave se denominará <code>“client1”</code>.</p>

<p>Comience por crear una estructura de directorios dentro de su directorio de inicio para almacenar los archivos de certificado y clave de cliente:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">mkdir -p ~/client-configs/keys
</li></ul></code></pre>
<p>Debido a que almacenará los pares de certificado y clave de sus clientes y los archivos de configuración en este directorio, debe bloquear sus permisos ahora como medida de seguridad:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">chmod -R 700 ~/client-configs
</li></ul></code></pre>
<p>Luego, diríjase al directorio EasyRSA y ejecute la secuencia de comandos ​​​​​​<code>easyrsa</code> con las opciones <code>gen-req</code> y <code>nopass</code>, junto con el nombre común para el cliente:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd ~/EasyRSA-<span class="highlight">3.0.4</span>/
</li><li class="line" prefix="$">./easyrsa gen-req client1 nopass
</li></ul></code></pre>
<p>Presione <code>ENTER</code> para confirmar el nombre común. Luego, copie el archivo <code>client1.key</code> al directorio <code>/client-configs/keys/</code> que creó antes:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cp pki/private/client1.key ~/client-configs/keys/
</li></ul></code></pre>
<p>Luego, transfiera el archivo <code>client1.req</code> a su máquina de CA usando un método seguro:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">scp pki/reqs/client1.req <span class="highlight">sammy</span>@<span class="highlight">your_CA_ip</span>:/tmp
</li></ul></code></pre>
<p>Inicie sesión en su máquina de CA, navegue hasta el directorio EasyRSA e importe la solicitud de certificado:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ssh <span class="highlight">sammy</span>@<span class="highlight">your_CA_IP</span>
</li><li class="line" prefix="$">cd EasyRSA-<span class="highlight">3.0.4</span>/
</li><li class="line" prefix="$">./easyrsa import-req /tmp/client1.req client1
</li></ul></code></pre>
<p>Luego firme la solicitud como lo hizo en el caso del servidor en el paso anterior. Esta vez, asegúrese de especificar el tipo de solicitud <code>client</code>:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa sign-req client client1
</li></ul></code></pre>
<p>En la línea de comandos, ingrese <code>yes</code> para confirmar que desea firmar la solicitud de certificado y que esta provino de una fuente confiable:</p>
<pre class="code-pre  second-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>Type the word 'yes' to continue, or any other input to abort.
  Confirm request details: <span class="highlight">yes</span>
</code></pre>
<p>Nuevamente, si cifró su clave de CA, se le solicitará la contraseña en este punto.</p>

<p>Con esto, se creará un archivo de certificado de cliente llamado <code>client1.crt</code>. Transfiera este archivo de vuelta al servidor:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">scp pki/issued/client1.crt <span class="highlight">sammy</span>@<span class="highlight">your_server_ip</span>:/tmp
</li></ul></code></pre>
<p>Establezca una conexión de retorno de SSH en su servidor de OpenVPN y copie el certificado de cliente al directorio <code>/client-configs/keys/</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cp /tmp/client1.crt ~/client-configs/keys/
</li></ul></code></pre>
<p>Luego, copie también los archivos <code>ca.crt</code> y <code>ta.key</code> al directorio <code>/client-configs/keys/</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo cp ~/EasyRSA-<span class="highlight">3.0.4</span>/ta.key ~/client-configs/keys/
</li><li class="line" prefix="$">sudo cp /etc/openvpn/ca.crt ~/client-configs/keys/
</li></ul></code></pre>
<p>Con esto, se generarán los certificados y las claves de su servidor y cliente, y se almacenarán en los directorios correspondientes de su servidor. Aún quedan algunas acciones que se deben realizar con estos archivos, pero se realizarán más adelante. Por ahora, puede comenzar a configurar OpenVPN en su servidor.</p>

<h2 id="paso-5-configurar-el-servicio-de-openvpn">Paso 5: Configurar el servicio de OpenVPN</h2>

<p>Ahora que se generaron los certificados y las claves de su cliente y servidor, puede comenzar a configurar el servicio de OpenVPN para que use estas credenciales.</p>

<p>Comience copiando un archivo de configuración de OpenVPN de muestra al directorio de configuración y luego extráigalo para usarlo como base para su configuración:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo cp /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz /etc/openvpn/
</li><li class="line" prefix="$">sudo gzip -d /etc/openvpn/server.conf.gz
</li></ul></code></pre>
<p>Abra el archivo de configuración del servidor en su editor de texto preferido:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/openvpn/server.conf
</li></ul></code></pre>
<p>Busque la directiva <code>tls-auth</code> para encontrar la sección HMAC. Los comentarios de esta línea no deberían existir, pero si esto no sucede elimine “<strong>;</strong>” para quitar los comentarios:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs="">tls-auth ta.key 0 # This file is secret
</code></pre>
<p>Luego, busque las líneas <code>cipher</code> con comentarios para encontrar la sección de cifrado. El código <code>AES-256-CBC</code> ofrece un buen nivel de cifrado y cuenta con buen respaldo. Una vez más, no debería haber comentarios para esta línea, pero si esto no sucede simplemente elimine el “<strong>;</strong>” que la precede:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs="">cipher AES-256-CBC
</code></pre>
<p>Debajo, agregue una directiva <code>auth</code> para seleccionar el algoritmo de codificación de mensajes HMAC. <code>SHA256</code> es una buena opción:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs=""><span class="highlight">auth SHA256</span>
</code></pre>
<p>Luego, encuentre la línea que contenga la directiva <code>dh</code> que define los parámetros Diffie-Hellman. Debido a algunos cambios recientes realizados en EasyRSA, el nombre de archivo de la clave Diffie-Hellman puede ser distinto del que figura en el ejemplo del archivo de configuración del servidor. Si es necesario, cambie el nombre de archivo que aparece eliminando <code>2048</code> para que coincida con la clave que generó en el paso anterior:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs="">dh dh.pem
</code></pre>
<p>Por último, busque los ajustes <code>user</code> y <code>group</code>, y elimine <strong>“;”</strong> al inicio de cada uno para quitar los comentarios de estas líneas:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs="">user nobody
group nogroup
</code></pre>
<p>Los cambios realizados al archivo de muestra <code>server.conf</code> hasta el momento son necesarios para que OpenVPN funcione. Los cambios mencionados a continuación son opcionales, aunque también se necesitan para muchos casos de uso comunes.</p>

<h3 id="opcional-aplicar-cambios-de-dns-para-redireccionar-todo-el-tráfico-a-través-de-la-vpn">(Opcional) Aplicar cambios de DNS para redireccionar todo el tráfico a través de la VPN</h3>

<p>Con los ajustes anteriores, se creará la conexión de VPN entre las dos máquinas, pero no se forzarán conexiones para usar el túnel. Si desea usar la VPN para dirigir todo su tráfico, probablemente le convenga aplicar los ajustes de sistemas de nombre de domino (DNS) a las computadoras clientes.</p>

<p>Para habilitar esta funcionalidad, debe cambiar algunas directivas del archivo <code>server.conf</code>. Encuentre la sección <code>redirect-gateway</code> y elimine el punto y coma, “<strong>;</strong>”, del inicio de la línea <code>redirect-gateway</code> para quitar los comentarios:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs="">push "redirect-gateway def1 bypass-dhcp"
</code></pre>
<p>Debajo de esto, encontrará la sección <code>dhcp-option</code>. Nuevamente, elimine &ldquo;<strong>;</strong>&rdquo; del inicio de ambas líneas para quitar los comentarios:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs="">push "dhcp-option DNS 208.67.222.222"
push "dhcp-option DNS 208.67.220.220"
</code></pre>
<p>Esto ayudará a los clientes a configurar de nuevo sus ajustes de DNS para usar el túnel de la VPN como puerta de enlace predeterminada.</p>

<h3 id="opcional-ajustar-el-puerto-y-el-protocolo">(Opcional) Ajustar el puerto y el protocolo</h3>

<p>Por defecto, el servidor de OpenVPN usa el puerto <code>1194</code> y el protocolo UDP para aceptar las conexiones de los clientes. Si necesita usar un puerto diferente debido a restricciones de los entornos de red que sus clientes puedan emplear, puede cambiar la opción <code>port</code>. Si no aloja contenido web en su servidor de OpenVPN, el puerto <code>443</code> es una opción común, ya que se suele permitir en las reglas de firewall.</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs=""># Optional!
port <span class="highlight">443</span>
</code></pre>
<p>Algunas veces, el protocolo se limita a ese puerto también. Si esto sucede, cambie <code>proto</code> de UDP a TCP:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs=""># Optional!
proto <span class="highlight">tcp</span>
</code></pre>
<p>Si <strong>cambia</strong> el protocolo a TCP, deberá cambiar el valor de la directiva <code>explicit-exit-notify</code> de <code>1</code> a <code>0</code>, ya que solo UDP la usa. Si no lo hace al usar TCP, se producirán errores al iniciar el servicio de OpenVPN:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs=""># Optional!
explicit-exit-notify <span class="highlight">0</span>
</code></pre>
<p>Si no tiene necesidad de usar un puerto y protocolo distintos, es mejor dejar estos dos ajustes como sus valores predeterminados.</p>

<h3 id="opcional-apuntar-a-credenciales-no-predeterminadas">(Opcional) Apuntar a credenciales no predeterminadas</h3>

<p>Si anteriormente seleccionó un nombre distinto durante el comando <code>./ build-key-server</code>, modifique las líneas <code>cert</code> y <code>key</code> que ve para apuntar a los archivos <code>.crt</code> y <code>.key</code> adecuados. Si usó el nombre predeterminado, “server”, esto ya está correctamente configurado:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs="">cert <span class="highlight">server</span>.crt
key <span class="highlight">server</span>.key
</code></pre>
<p>Cuando termine, guarde y cierre el archivo.</p>

<p>Luego de revisar y aplicar los cambios necesarios a la configuración de su servidor de OpenVPN para sus necesidades de uso específicas, puede comenzar a aplicar algunos cambios a la conexión de su servidor.</p>

<h2 id="paso-6-ajustar-la-configuración-de-redes-del-servidor">Paso 6: Ajustar la configuración de redes del servidor</h2>

<p>Hay algunos aspectos de la configuración de redes del servidor que deben modificarse para que OpenVPN pueda dirigir el tráfico de manera correcta a través de la VPN. El primero es *el enrutamiento *de IP, un método para determinar a dónde se debe dirigir el tráfico de IP. Esto es esencial para la funcionalidad de VPN que proporcionará su servidor.</p>

<p>Para ajustar el enrutamiento de IP predeterminado de su servidor, modifique el archivo <code>/etc/sysctl.conf</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/sysctl.conf
</li></ul></code></pre>
<p>Dentro de este, busque la línea con comentarios que configura <code>net.ipv4.ip_forward</code>. Elimine el carácter “<strong>#</strong>” del inicio de la línea para quitar los comentairos de este ajuste:</p>
<div class="code-label " title="/etc/sysctl.conf">/etc/sysctl.conf</div><pre class="code-pre "><code langs="">net.ipv4.ip_forward=1
</code></pre>
<p>Guarde y cierre el archivo cuando termine.</p>

<p>Para leer el archivo y modificar los valores de la sesión actual, escriba lo siguiente:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo sysctl -p
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>net.ipv4.ip_forward = 1
</code></pre>
<p>Si siguió la guía de instalación inicial para servidores de Debian 9 mencionada en los requisitos previos, debería tener un firewall UFW establecido. Independientemente de que use el firewall para bloquear el tráfico no deseado (algo que debe hacer casi siempre), a los efectos de esta guía necesitará un firewall para manipular parte del tráfico que ingresa al servidor. Algunas de las reglas del firewall deben modificarse para permitir el enmascaramiento, un concepto de iptables que proporciona traducción de direcciones de red (NAT) dinámica sobre la marcha para dirigir de manera correcta las conexiones de los clientes.</p>

<p>Antes de abrir el archivo de configuración de firewall para agregar las reglas de enmascaramiento, primero debe encontrar la interfaz de red pública de su máquina. Para hacer esto, escriba lo siguiente:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ip route | grep default
</li></ul></code></pre>
<p>Su interfaz pública es la secuencia que se halla en el resultado de este comando después de la palabra “dev”. Por ejemplo, este resultado muestra la interfaz denominada <code>eth0</code>, que aparece resaltada a continuación:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>default via 203.0.113.1 dev <span class="highlight">eth0</span> onlink
</code></pre>
<p>Una vez que tenga la interfaz asociada con su ruta predeterminada, abra el archivo <code>/etc/ufw/before.rules</code> para agregar  la configuración pertinente:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/ufw/before.rules
</li></ul></code></pre>
<p>Las reglas de UFW suelen agregarse usando el comando <code>ufw</code>. Sin embargo, las reglas enumeradas en el archivo <code>before.rules</code> se leen e implementan antes de que se carguen las reglas de UFW. En la parte superior del archivo, agregue las líneas resaltadas a continuación. Con esto, se establecerá la política predeterminada de la cadena <code>POSTROUTING</code> en la tabla <code>nat</code> y se enmascarará el tráfico que provenga de la VPN. Recuerde reemplazar <code><span class="highlight">eth0</span></code> en la línea <code>-A POSTROUTING</code> siguiente por la interfaz que encontró en el comando anterior:</p>
<div class="code-label " title="/etc/ufw/before.rules">/etc/ufw/before.rules</div><pre class="code-pre "><code langs="">#
# rules.before
#
# Rules that should be run before the ufw command line added rules. Custom
# rules should be added to one of these chains:
#   ufw-before-input
#   ufw-before-output
#   ufw-before-forward
#

<span class="highlight"># START OPENVPN RULES</span>
<span class="highlight"># NAT table rules</span>
<span class="highlight">*nat</span>
<span class="highlight">:POSTROUTING ACCEPT [0:0]</span> 
<span class="highlight"># Allow traffic from OpenVPN client to </span>eth0<span class="highlight"> (change to the interface you discovered!)</span>
<span class="highlight">-A POSTROUTING -s 10.8.0.0/8 -o </span>eth0<span class="highlight"> -j MASQUERADE</span>
<span class="highlight">COMMIT</span>
<span class="highlight"># END OPENVPN RULES</span>

# Don't delete these required lines, otherwise there will be errors
*filter
. . .
</code></pre>
<p>Guarde y cierre el archivo cuando termine.</p>

<p>Luego, debe indicar a UFW que permita también los paquetes reenviados de forma predeterminada. Para hacer esto, abra el archivo <code>/etc/default/ufw</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/default/ufw
</li></ul></code></pre>
<p>Dentro de este, encuentre la directiva <code>DEFAULT_FORWARD_POLICY</code> y cambie el valor de <code>DROP</code> a <code>ACCEPT</code>:</p>
<div class="code-label " title="/etc/default/ufw">/etc/default/ufw</div><pre class="code-pre "><code langs="">DEFAULT_FORWARD_POLICY="<span class="highlight">ACCEPT</span>"
</code></pre>
<p>Guarde y cierre el archivo cuando termine.</p>

<p>Luego, ajuste el firewall para permitir el tráfico hacia OpenVPN. Si no cambió el puerto ni el protocolo en el archivo <code>/etc/openvpn/server.conf</code>, deberá abrir el tráfico UDP al puerto <code>1194</code>. Si modificó el puerto o el protocolo, sustituya los valores que seleccionó aquí.</p>

<p>En caso de que se haya olvidado de agregar el puerto SSH al seguir el tutorial de los requisitos previos, agréguelo aquí también:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow <span class="highlight">1194</span>/<span class="highlight">udp</span>
</li><li class="line" prefix="$">sudo ufw allow OpenSSH
</li></ul></code></pre>
<p>Luego de agregar esas reglas, deshabilite y vuelva a habilitar UFW para reiniciarlo y cargue los cambios de todos los archivos que haya modificado:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw disable
</li><li class="line" prefix="$">sudo ufw enable
</li></ul></code></pre>
<p>Su servidor quedará, así, configurado para manejar de manera correcta el tráfico de OpenVPN.</p>

<h2 id="paso-7-iniciar-y-habilitar-el-servicio-de-openvpn">Paso 7: Iniciar y habilitar el servicio de OpenVPN</h2>

<p>Finalmente, ya está listo para iniciar el servicio de OpenVPN en su servidor. Esto se hace mediante la utilidad <code>systemctl</code> de systemd.</p>

<p>Inicie el servidor de OpenVPN especificando el nombre de su archivo de configuración como una variable de instancia después del nombre del archivo de unidad de systemd. El archivo de configuración de su servidor se llama <code>/etc/openvpn/<span class="highlight">server</span>.conf</code>. Por lo tanto, debe agregar <code><span class="highlight">@server</span></code> al final de su archivo de unidad cuando lo llame:&ldquo;&rdquo;</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl start openvpn@<span class="highlight">server</span>
</li></ul></code></pre>
<p>Vuelva a controlar que el servicio se haya iniciado correctamente escribiendo lo siguiente:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl status openvpn@server
</li></ul></code></pre>
<p>Si todo salió bien, el resultado será similar a esto:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>● openvpn@server.service - OpenVPN connection to server
   Loaded: loaded (/lib/systemd/system/openvpn@.service; disabled; vendor preset: enabled)
   Active: <span class="highlight">active (running)</span> since Tue 2016-05-03 15:30:05 EDT; 47s ago
     Docs: man:openvpn(8)
           https://community.openvpn.net/openvpn/wiki/Openvpn23ManPage
           https://community.openvpn.net/openvpn/wiki/HOWTO
  Process: 5852 ExecStart=/usr/sbin/openvpn --daemon ovpn-%i --status /run/openvpn/%i.status 10 --cd /etc/openvpn --script-security 2 --config /etc/openvpn/%i.conf --writepid /run/openvpn/%i.pid (code=exited, sta
 Main PID: 5856 (openvpn)
    Tasks: 1 (limit: 512)
   CGroup: /system.slice/system-openvpn.slice/openvpn@server.service
           └─5856 /usr/sbin/openvpn --daemon ovpn-server --status /run/openvpn/server.status 10 --cd /etc/openvpn --script-security 2 --config /etc/openvpn/server.conf --writepid /run/openvpn/server.pid

</code></pre>
<p>También puede controlar que la interfaz <code>tun0</code> de OpenVPN esté disponible escribiendo  lo siguiente:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ip addr show tun0
</li></ul></code></pre>
<p>Esto dará como resultado una interfaz configurada:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>4: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN group default qlen 100
    link/none 
    inet 10.8.0.1 peer 10.8.0.2/32 scope global tun0
       valid_lft forever preferred_lft forever
</code></pre>
<p>Luego de iniciar el servicio, habilítelo para que se cargue de manera automática en el inicio:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl enable openvpn@server
</li></ul></code></pre>
<p>Su servicio de OpenVPN quedará, así, configurado y en funcionamiento. Sin embargo, para comenzar a usarlo debe crear primero un archivo de configuración para la máquina cliente. En el tutorial ya se explicó la forma crear pares de certificado y clave para clientes, y en el siguiente paso demostraremos la forma de crear una infraestructura que generará archivos de configuración de clientes fácilmente.</p>

<h2 id="paso-8-crear-la-infraestructura-de-configuración-de-clientes">Paso 8: Crear la infraestructura de configuración de clientes</h2>

<p>Es posible que se deban crear archivos de configuración para clientes de OpenVPN, ya que todos los clientes deben tener su propia configuración y alinearse con los ajustes mencionados en el archivo de configuración del servicio. En este paso, en lugar de detallarse el proceso para escribir un único archivo de configuración que solo se pueda usar en un cliente, se describe un proceso para crear una infraestructura de configuración de cliente que puede usar para generar archivos de configuración sobre la marcha. Primero creará un archivo de configuración “de base” y luego una secuencia de comandos que le permitirá generar archivos de configuración, certificados y claves de clientes exclusivos según sea necesario.</p>

<p>Comience creando un nuevo directorio en el que almacenará archivos de configuración de clientes dentro del directorio <code>client-configs</code> creado anteriormente:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">mkdir -p ~/client-configs/files
</li></ul></code></pre>
<p>Luego, copie un archivo de configuración de cliente de ejemplo al directorio <code>client-configs</code> para usarlo como su configuración de base:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cp /usr/share/doc/openvpn/examples/sample-config-files/client.conf ~/client-configs/base.conf
</li></ul></code></pre>
<p>Abra este archivo nuevo en su editor de texto preferido:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano ~/client-configs/base.conf
</li></ul></code></pre>
<p>Dentro de este, ubique la directiva <code>remote</code>. Esto dirige al cliente a la dirección de su servidor de OpenVPN: la dirección IP pública de su servidor de OpenVPN. Si decidió cambiar el puerto en el que el servidor de OpenVPN escucha, también deberá cambiar <code>1194</code> por el puerto seleccionado:</p>
<div class="code-label " title="~/client-configs/base.conf">~/client-configs/base.conf</div><pre class="code-pre "><code langs="">. . .
# The hostname/IP and port of the server.
# You can have multiple remote entries
# to load balance between the servers.
remote <span class="highlight">your_server_ip</span> <span class="highlight">1194</span>
. . .
</code></pre>
<p>Asegúrese de que el protocolo coincida con el valor que usa en la configuración del servidor:</p>
<div class="code-label " title="~/client-configs/base.conf">~/client-configs/base.conf</div><pre class="code-pre "><code langs="">proto <span class="highlight">udp</span>
</code></pre>
<p>Luego, elimine los comentarios de las directivas <code>user</code> y <code>group</code> quitando &ldquo;<strong>;</strong>&rdquo; al inicio de cada línea:</p>
<div class="code-label " title="~/client-configs/base.conf">~/client-configs/base.conf</div><pre class="code-pre "><code langs=""># Downgrade privileges after initialization (non-Windows only)
user nobody
group nogroup
</code></pre>
<p>Encuentre las directivas que establecen <code>ca</code>, <code>cert</code> y <code>key</code>. Elimine los comentarios de estas directivas, ya que pronto agregará los certificados y las claves dentro del archivo:</p>
<div class="code-label " title="~/client-configs/base.conf">~/client-configs/base.conf</div><pre class="code-pre "><code langs=""># SSL/TLS parms.
# See the server config file for more
# description.  It's best to use
# a separate .crt/.key file pair
# for each client.  A single ca
# file can be used for all clients.
<span class="highlight">#</span>ca ca.crt
<span class="highlight">#</span>cert client.crt
<span class="highlight">#</span>key client.key
</code></pre>
<p>De manera similar, elimine los comentarios de la directiva <code>tls-auth</code>, ya que agregará <code>ta.key</code> directamente al archivo de configuración de cliente:</p>
<div class="code-label " title="~/client-configs/base.conf">~/client-configs/base.conf</div><pre class="code-pre "><code langs=""># If a tls-auth key is used on the server
# then every client must also have the key.
<span class="highlight">#</span>tls-auth ta.key 1
</code></pre>
<p>Refleje los ajustes de <code>cipher</code> y <code>auth</code> que estableció en el archivo <code>/etc/openvpn/server.conf</code>:</p>
<div class="code-label " title="~/client-configs/base.conf">~/client-configs/base.conf</div><pre class="code-pre "><code langs=""><span class="highlight">cipher AES-256-CBC</span>
<span class="highlight">auth SHA256</span>
</code></pre>
<p>Luego, agregue la directiva <code>key-direction</code> en algún lugar del archivo. Es *<em>necesario que *</em>fije el valor “1” para esta, a fin de que la VPN funcione de manera correcta en la máquina cliente:</p>
<div class="code-label " title="~/client-configs/base.conf">~/client-configs/base.conf</div><pre class="code-pre "><code langs=""><span class="highlight">key-direction 1</span>
</code></pre>
<p>Por último, agregue algunas líneas <strong>no incluidas</strong>. Aunque puede incluir estas directivas en todos los archivos de configuración de clientes, solo debe habilitarlas para clientes Linux que incluyan un archivo <code>/etc/openvpn/update-resolv-conf</code>. Esta secuencia de comandos usa la utilidad <code>resolvconf</code> para actualizar la información de DNS para clientes Linux.</p>
<div class="code-label " title="~/client-configs/base.conf">~/client-configs/base.conf</div><pre class="code-pre "><code langs=""><span class="highlight"># script-security 2</span>
<span class="highlight"># up /etc/openvpn/update-resolv-conf</span>
<span class="highlight"># down /etc/openvpn/update-resolv-conf</span>
</code></pre>
<p>Si su cliente tiene Linux instalado y un archivo <code>/etc/openvpn/update-resolv-conf</code>, elimine los comentarios de estas líneas del archivo de configuración de cliente luego de que se haya generado.</p>

<p>Guarde y cierre el archivo cuando termine.</p>

<p>A continuación, cree una secuencia de comandos simple que compile su configuración de base con el certificado, la clave y los archivos de cifrado pertinentes, y luego ubique la configuración generada en el directorio <code>~/client-configs/files</code>. Abra un nuevo archivo llamado <code>make_config.sh</code> en el directorio <code>~/client-configs</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano ~/client-configs/make_config.sh
</li></ul></code></pre>
<p>Dentro de este, agregue el siguiente contenido y asegúrese de cambiar <code><span class="highlight">sammy</span></code> por el de la cuenta no <strong>root</strong> de su servidor:</p>
<div class="code-label " title="~/client-configs/make_config.sh">~/client-configs/make_config.sh</div><pre class="code-pre "><code class="code-highlight language-sh">#!/bin/bash

# First argument: Client identifier

KEY_DIR=/home/<span class="highlight">sammy</span>/client-configs/keys
OUTPUT_DIR=/home/<span class="highlight">sammy</span>/client-configs/files
BASE_CONFIG=/home/<span class="highlight">sammy</span>/client-configs/base.conf

cat ${BASE_CONFIG} \
    &lt;(echo -e '&lt;ca&gt;') \
    ${KEY_DIR}/ca.crt \
    &lt;(echo -e '&lt;/ca&gt;\n&lt;cert&gt;') \
    ${KEY_DIR}/${1}.crt \
    &lt;(echo -e '&lt;/cert&gt;\n&lt;key&gt;') \
    ${KEY_DIR}/${1}.key \
    &lt;(echo -e '&lt;/key&gt;\n&lt;tls-auth&gt;') \
    ${KEY_DIR}/ta.key \
    &lt;(echo -e '&lt;/tls-auth&gt;') \
    &gt; ${OUTPUT_DIR}/${1}.ovpn
</code></pre>
<p>Guarde y cierre el archivo cuando termine.</p>

<p>Antes de continuar, asegúrese de marcar este archivo como ejecutable escribiendo lo siguiente:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">chmod 700 ~/client-configs/make_config.sh
</li></ul></code></pre>
<p>Esta secuencia de comandos realizará una copia del archivo <code>base.conf</code> que creó, recopilará todos los archivos de certificados y claves que haya confeccionado para su cliente, extraerá el contenido de estos y los anexará a la copia del archivo de configuración de base, y exportará todo este contenido a un nuevo archivo de configuración de cliente. Esto significa que se evita la necesidad de administrar los archivos de configuración, certificado y clave del cliente por separado, y que toda la información necesaria se almacena en un solo lugar. El beneficio de esto es que, si alguna vez necesita agregar  un cliente más adelante, puede simplemente ejecutar esta secuencia de comandos para crear de manera rápida el archivo de configuración y asegurarse de que toda la información importante se almacene en una sola ubicación de acceso sencillo.</p>

<p>Tenga en cuenta que siempre que agregue un nuevo cliente, deberá generar claves y certificados nuevos para poder ejecutar esta secuencia de comandos y generar su archivo de configuración. Podrá practicar con este comando en el siguiente paso.</p>

<h2 id="paso-9-generar-las-configuraciones-de-clientes">Paso 9: Generar las configuraciones de clientes</h2>

<p>Si siguió la guía, creó un certificado y una clave de cliente llamados <code>client1.crt</code> y <code>client1.key</code>, respectivamente, en el paso 4. Puede generar un archivo de configuración para estas credenciales si se dirige al directorio <code>~/client-configs</code> y ejecuta la secuencia de comandos que realizó al final del paso anterior:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd ~/client-configs
</li><li class="line" prefix="$">sudo ./make_config.sh <span class="highlight">client1</span>
</li></ul></code></pre>
<p>Con esto, se creará un archivo llamado <code>client1.ovpn</code> en su directorio <code>~/client-configs/files</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ls ~/client-configs/files
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>client1.ovpn
</code></pre>
<p>Debe transferir este archivo al dispositivo que planee usar como cliente. Por ejemplo, puede ser su computadora local o un dispositivo móvil.</p>

<p>Si bien las aplicaciones exactas empleadas para lograr esta transferencia dependerán del sistema operativo de su dispositivo y sus preferencias personales, un método seguro y confiable consiste en usar el protocolo de transferencia de archivos SSH (SFTP ) o la copia segura (SCP) en el backend. Con esto se transportarán los archivos de autenticación de VPN de su cliente a través de una conexión cifrada.</p>

<p>Aquí se ofrece un comando SFTP de muestra que usa el ejemplo <code><span class="highlight">client1.ovpn</span></code> y que usted puede ejecutar desde su computadora local (macOS o Linux). Dispone el archivo <code>.ovpn</code> en su directorio de inicio:&ldquo;&rdquo;</p>
<pre class="code-pre custom_prefix local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="local$">sftp <span class="highlight">sammy</span>@<span class="highlight">your_server_ip</span>:client-configs/files/client1.ovpn ~/
</li></ul></code></pre>
<p>A continuación, se muestran diferentes herramientas y tutoriales para transferir de manera segura los archivos del servidor a una computadora local:</p>

<ul>
<li><a href="http://winscp.net">WinSCP</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-use-sftp-to-securely-transfer-files-with-a-remote-server">Cómo usar SFTP para transferir archivos de manera segura con un servidor remoto</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-use-filezilla-to-transfer-and-manage-files-securely-on-your-vps">Cómo usar Filezilla para transferir y administrar archivos de manera segura en su VPS</a></li>
</ul>

<h2 id="paso-10-instalar-la-configuración-de-cliente">Paso 10: Instalar la configuración de cliente</h2>

<p>En esta sección se aborda la forma de instalar un perfil de VPN de cliente en Windows, macOS, Linux, iOS y Android. Ninguna de estas instrucciones para clientes depende de la otra. Por lo tanto, no dude en dirigirse directamente a la que corresponda para su dispositivo.</p>

<p>La conexión de OpenVPN tendrá el mismo nombre que utilizó para el archivo <code>.ovpn.</code> En lo que respecta a este tutorial, esto significa que la conexión se llama <code>client1.ovpn</code> y guarda correspondencia con el primer archivo de cliente que generó.</p>

<h3 id="windows">Windows</h3>

<p><strong>Instalación</strong></p>

<p>Descargue la aplicación de cliente de OpenVPN para Windows de la <a href="https://openvpn.net/index.php/open-source/downloads.html">página de descargas de OpenVPN</a>. Seleccione la versión adecuada del instalador para su versión de Windows.</p>

<p><span class='note'><strong>Nota:</strong> OpenVPN necesita privilegios administrativos para instalarse.<br></span></p>

<p>Luego de instalar OpenVPN, copie el archivo <code>.ovpn</code> a esta ubicación:</p>
<pre class="code-pre "><code langs="">C:\Program Files\OpenVPN\config
</code></pre>
<p>Cuando inicie OpenVPN, este detectará el perfil de manera automática y lo dejará disponible.</p>

<p>Debe ejecutar OpenVPN como administrador cada vez que lo use, aun en cuentas administrativas. Para realizar esto sin tener que hacer clic con el botón secundario y seleccionar <strong>Ejecutar como administrador</strong> cada vez que use la VPN, debe fijarlo como ajuste predeterminado desde una cuenta administrativa. Esto también significa que los usuarios estándares deberán ingresar la contraseña del administrador para usar OpenVPN. Por otro lado, los usuarios estándares no pueden conectarse de manera adecuada al servidor a menos que la aplicación OpenVPN del cliente tenga derechos de administrador. Por lo tanto, se necesitan privilegios elevados.</p>

<p>Para configurar la aplicación OpenVPN de modo que se ejecute siempre con privilegios de administrador, haga clic con el botón secundario en su ícono de acceso directo y diríjase a <strong>Propiedades</strong>. Al final de la pestaña <strong>Compatibilidad</strong>, haga clic en el botón <strong>Cambiar la configuración para todos los usuarios</strong>. En la nueva ventana, seleccione <strong>Ejecutar este programa como administrador</strong>.</p>

<p><strong>Conexión</strong></p>

<p>Cada vez que inicie OpenVPN GUI, Windows le preguntará si quiere que el programa realice cambios en su computadora. Haga clic en <strong>Sí</strong>. Iniciar la aplicación OpenVPN de cliente solo ubica el applet en la bandeja del sistema para que pueda conectar y desconectar la VPN según sea necesario; no establece la conexión de VPN.</p>

<p>Una vez que se inicie OpenVPN, establezca una conexión ingresando al área de notificación y haga clic con el botón secundario en el ícono de OpenVPN. Con esto, se abrirá el menú contextual. Seleccione** client1** en la parte superior del menú (su perfil <code>client1.ovpn</code>) y luego** Connect**.</p>

<p>Una ventana de estado se abrirá y mostrará el resultado de registro mientras se establece la conexión,y  se mostrará un mensaje una vez que el cliente esté conectado.</p>

<p>Desconéctese de la VPN de la misma forma: ingrese al applet de la bandeja del sistema, haga clic con el botón secundario en el ícono de OpenVPN, seleccione el perfil del cliente y haga clic en ****Disconnect.</p>

<h3 id="macos">macOS</h3>

<p><strong>Instalación</strong></p>

<p><a href="https://tunnelblick.net/">Tunnelblick</a> es un cliente de OpenVPN gratuito y de código abierto para macOS. Puede descargar la última imagen de disco desde la <a href="https://tunnelblick.net/downloads.html">página de descargas de Tunnelblick</a>. Haga doble clic en el archivo <code>.dmg</code> descargado y siga las instrucciones para instalarlo.</p>

<p>Al finalizar el proceso de instalación, Tunnelblick le preguntará si tiene algún archivo de configuración. Para simplificar el proceso, responda <strong>No</strong> y permita que Tunnelblick se cierre. Abra una ventana de Finder, busque <code>client1.ovpn</code> y haga doble clic sobre él. Tunnelblick instalará el perfil de cliente. Se necesitan privilegios de administrador.</p>

<p><strong>Conexión</strong></p>

<p>Inicie Tunnelblick haciendo doble clic sobre este en la carpeta <strong>Aplicaciones</strong>. Una vez que se haya iniciado Tunnelblick, habrá un ícono de este en la barra de menú de la esquina superior derecha de la pantalla para controlar las conexiones. Haga clic en el ícono y luego en el elemento de menú <strong>Connect *<em>para iniciar la conexión de VPN. Seleccione la conexión *</em>client1</strong>.</p>

<h3 id="linux">Linux</h3>

<h4 id="instalación">Instalación</h4>

<p>Si usa Linux, dispone de varias herramientas según su distribución. En su entorno de escritorio o gestor de ventanas también pueden incluirse utilidades de conexión.</p>

<p>Sin embargo, el método de conexión más universal consiste en simplemente usar el software OpenVPN.</p>

<p>En Ubuntu o Debian, puede instalarlo como en el servidor escribiendo lo siguiente:</p>
<pre class="code-pre custom_prefix local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="client$">sudo apt update
</li><li class="line" prefix="client$">sudo apt install openvpn
</li></ul></code></pre>
<p>En CentOS, puede habilitar los repositorios EPEL y luego instalarlo escribiendo lo siguiente:</p>
<pre class="code-pre custom_prefix local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="client$">sudo yum install epel-release
</li><li class="line" prefix="client$">sudo yum install openvpn
</li></ul></code></pre>
<h4 id="configuración">Configuración</h4>

<p>Verifique si su distribución incluye una secuencia de comandos <code>/etc/openvpn/update-resolv-conf</code>:</p>
<pre class="code-pre custom_prefix local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="client1$">ls /etc/openvpn
</li></ul></code></pre><pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>update-resolv-conf
</code></pre>
<p>A continuación, edite el archivo de configuración de cliente de OpenVPN que transfirió:</p>
<pre class="code-pre custom_prefix local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="client$">nano <span class="highlight">client1</span>.ovpn
</li></ul></code></pre>
<p>Si pudo encontrar un archivo <code>update-resolv-conf</code>, elimine los comentarios de las tres líneas de agregó para modificar los ajustes de DNS:</p>
<div class="code-label " title="client1.ovpn">client1.ovpn</div><pre class="code-pre  local-environment"><code langs="">script-security 2
up /etc/openvpn/update-resolv-conf
down /etc/openvpn/update-resolv-conf
</code></pre>
<p>Si usa CentOS, cambie la directiva <code>group</code> de <code>nogroup</code> a <code>nobody</code> para que coincidan los grupos de distribución disponibles:</p>
<div class="code-label " title="client1.ovpn">client1.ovpn</div><pre class="code-pre  local-environment"><code langs="">group <span class="highlight">nobody</span>
</code></pre>
<p>Guarde y cierre el archivo.</p>

<p>Ahora, podrá conectarse a la VPN simplemente apuntando el comando <code>openvpn</code> hacia el archivo de configuración de cliente:</p>
<pre class="code-pre custom_prefix local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="client$">sudo openvpn --config <span class="highlight">client1</span>.ovpn
</li></ul></code></pre>
<p>Esto debería permitirle establecer conexión con la VPN.</p>

<h3 id="ios">iOS</h3>

<p><strong>Instalación</strong></p>

<p>Desde iTunes App Store, busque e instale <a href="https://itunes.apple.com/us/app/id590379981">OpenVPN</a> Connect, la aplicación de cliente de OpenVPN oficial de iOS. Para transferir su configuración de cliente de iOS al dispositivo, conéctelo directamente a una computadora.</p>

<p>El proceso para completar la transferencia con iTunes se describe aquí. Abra iTunes en la computadora y haga clic en <strong>iPhone</strong> &gt; <strong>apps</strong>. Deslícese hacia la parte inferior, hasta la sección <strong>Compartir archivos</strong> y haga clic en la app OpenVPN. La ventana en blanco de la derecha, <strong>OpenVPN Documents</strong>, sirve para compartir archivos. Arrastre el archivo <code>.ovpn</code> hacia la ventana OpenVPN Documents.</p>

<p><img src="https://assets.digitalocean.com/articles/openvpn_ubunutu/1.png" alt="iTunes muestra el perfil de VPN listo para cargarse en el iPhone">.</p>

<p>Ahora, inicie la aplicación OpenVPN en el iPhone. Recibirá una notificación de que un nuevo perfil está listo para importarse. Toque el símbolo verde del signo de suma para importarlo.</p>

<p><img src="https://assets.digitalocean.com/articles/openvpn_ubunutu/2.png" alt="La app OpenVPN de iOS muestra un nuevo perfil listo para importarse."></p>

<p><strong>Conexión</strong></p>

<p>De esta manera, OpenVPN estará listo para usarse con el nuevo perfil. Inicie la conexión deslizando el botón de <strong>Connect</strong> hasta la posición de <strong>activación</strong>. Finalice la conexión deslizando el mismo botón hasta la posición de <strong>desactivación</strong>.</p>

<p><span class='note'><strong>Nota:</strong> El interruptor de VPN de <strong>Settings</strong> no se puede usar para establecer conexión con la VPN. Si lo intenta, recibirá un aviso que le indicará conectarse únicamente utilizando la aplicación OpenVPN.<br></span></p>

<p><img src="https://assets.digitalocean.com/articles/openvpn_ubunutu/3.png" alt="La aplicación OpenVPN de iOS conectada a la VPN."></p>

<h3 id="android">Android</h3>

<p><strong>Instalación</strong></p>

<p>Abra Google Play Store. Busque e instale <a href="https://play.google.com/store/apps/details?id=net.openvpn.openvpn">Android OpenVPN Connect</a>, la aplicación de cliente de OpenVPN oficial de Android.</p>

<p>Puede transferir el perfil <code>.ovpn</code> conectando el dispositivo Android a su computadora a través de un puerto USB y copiando el archivo. De manera alternativa, si tiene un lector de tarjetas SD, puede quitar la tarjeta SD del dispositivo, copiar el perfil a ella y luego insertarla tarjeta de vuelta en el dispositivo Android.</p>

<p>Inicie la aplicación OpenVPN y haga clic en el menú para importar el perfil.</p>

<p><img src="https://assets.digitalocean.com/articles/openvpn_ubunutu/4.png" alt="Selección del menú de importación de perfiles de la aplicación OpenVPN de Android">.</p>

<p>Luego, diríjase a la ubicación del perfil guardado (en la captura de pantalla se usa <code>/sdcard/Download/</code>) y seleccione el archivo. La aplicación notificará que se importó el perfil.</p>

<p><img src="https://assets.digitalocean.com/articles/openvpn_ubunutu/5.png" alt="Selección de un perfil de VPN para su importación en la aplicación OpenVPN de Android."></p>

<p><strong>Conexión</strong></p>

<p>Para conectarse, simplemente toque el botón <strong>Connect</strong>. Se le preguntará si confía en la aplicación OpenVPN. Seleccione <strong>OK</strong> para iniciar la conexión. Para desconectarse de la VPN, vuelva a la aplicación OpenVPN y seleccione <strong>Disconnect</strong>.</p>

<p><img src="https://assets.digitalocean.com/articles/openvpn_ubunutu/6.png" alt="La aplicación OpenVPN de Android lista para conectarse a la VPN."></p>

<h2 id="paso-11-probar-la-conexión-de-su-vpn-opcional">Paso 11: Probar la conexión de su VPN (opcional)</h2>

<p><span class='note'><strong>Nota:</strong> Este método para probar la conexión de su VPN solo funcionará si eligió dirigir todo el tráfico a través de la VPN en el paso 5.<br></span></p>

<p>Una vez que todo esté instalado, con una simple revisión confirmará que todo funciona de forma correcta. Sin tener una conexión VPN habilitada, abra un navegador e ingrese en <a href="https://www.dnsleaktest.com">DNSLeakTest</a>.</p>

<p>El sitio mostrará la dirección de IP asignada por su proveedor de servicio de Internet y la forma en que aparece para el resto del mundo. Para corroborar sus ajustes de DNS a través del mismo sitio web, haga clic en <strong>Extended Test</strong>. Esto le indicará los servidores DNS que usa.</p>

<p>Ahora, conecte el cliente de OpenVPN a la VPN de su servidor y actualice el navegador. Con esto, debería aparecer una dirección de IP totalmente distinta (la de su servidor de VPN). De esta manera aparecerá ante el mundo. Una vez más, la opción <strong>Extended Test</strong> de <a href="https://www.dnsleaktest.com">DNSLeakTest</a> revisará sus ajustes de DNS y confirmará que ahora use los solucionadores de DNS enviados por su VPN.</p>

<h2 id="paso-12-revocar-certificados-de-clientes">Paso 12: Revocar certificados de clientes</h2>

<p>Es posible que, de tanto en tanto, deba rechazar un certificado de cliente para evitar más accesos al servidor de OpenVPN.</p>

<p>Para hacerlo, en su máquina de CA, diríjase al directorio EasyRSA:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd EasyRSA-<span class="highlight">3.0.4</span>/
</li></ul></code></pre>
<p>Luego, ejecute la secuencia de comandos <code>easyrsa</code> con la opción <code>revoke</code> seguida del nombre del cliente que desee rechazar:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa revoke <span class="highlight">client2</span>
</li></ul></code></pre>
<p>Con esto, se solicitará que confirme el rechazo ingresando <code>yes</code>:</p>
<pre class="code-pre  second-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>Please confirm you wish to revoke the certificate with the following subject:

subject=
    commonName                = client2


Type the word 'yes' to continue, or any other input to abort.
  Continue with revocation: <span class="highlight">yes</span>
</code></pre>
<p>Una vez que se confirme la acción, la CA rechazará por completo el certificado del cliente. Sin embargo, su servidor de OpenVPN actualmente no tiene forma de corroborar si los certificados de clientes se rechazaron y si el cliente seguirá teniendo acceso a la VPN. Para corregir esto, cree una lista de rechazo de certificados (CRL) en su máquina de CA:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa gen-crl
</li></ul></code></pre>
<p>Con esto, se generará un archivo <code>llamado</code> crl.pem. Transfiera este archivo de manera segura a su servidor de OpenVPN:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">scp ~/EasyRSA-<span class="highlight">3.0.4</span>/pki/crl.pem <span class="highlight">sammy</span>@<span class="highlight">your_server_ip</span>:/tmp
</li></ul></code></pre>
<p>En su servidor de OpenVPN, copie este archivo a su directorio <code>/etc/openvpn/</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo cp /tmp/crl.pem /etc/openvpn
</li></ul></code></pre>
<p>Luego, abra el archivo de configuración del servidor de OpenVPN:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/openvpn/server.conf
</li></ul></code></pre>
<p>Al final del archivo, agregue la opción <code>crl-verify</code>, que indicará al servidor OpenVPN que revise la lista de rechazo de certificados que creamos cada vez que se realice un intento de conexión:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs="">crl-verify crl.pem
</code></pre>
<p>Guarde y cierre el archivo.</p>

<p>Por último, reinicie OpenVPN para implementar el rechazo de certificados:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart openvpn@server
</li></ul></code></pre>
<p>El cliente ya no debería poder conectarse de manera correcta al servidor usando la credencial anterior.</p>

<p>Para rechazar clientes adicionales, siga este proceso:</p>

<ol>
<li>Rechace el certificado con el comando <code>./easyrsa revoke <span class="highlight">nombre_cliente</span></code>.</li>
<li>Genere una nueva CRL.</li>
<li>Transfiera el archivo <code>crl.pem</code> nuevo a su servidor de OpenVPN y cópielo al directorio <code>/etc/openvpn</code> para sobrescribir la lista anterior.</li>
<li>Reinicie el servicio de OpenVPN.</li>
</ol>

<p>Puede usar este proceso para rechazar cualquier certificado emitido anteriormente para su servidor.</p>

<h2 id="conclusión">Conclusión</h2>

<p>De esta manera, podrá navegar por Internet protegiendo su identidad, ubicación y tráfico contra fisgones y censores. Si en este punto ya no necesita emitir certificados, recomendamos que apague su máquina de CA o la desconecte de Internet hasta que necesite agregar o rechazar certificados. Esto ayudará a evitar que los atacantes obtengan acceso a su VPN.</p>

<p>Para configurar más clientes, solo debe seguir el paso <strong>4</strong> y los pasos <strong>9 a 11</strong> en el caso de cada dispositivo adicional. Para rechazar el acceso de los clientes, siga el paso <strong>12</strong>.</p>
