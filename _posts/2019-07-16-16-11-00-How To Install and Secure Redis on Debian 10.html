---
layout: post
title: How To Install and Secure Redis on Debian 10
network: digitalocean
date: July 16, 2019 at 04:11PM
url: https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-redis-on-debian-10
image: http://ifttt.com/images/no_image_card.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="introduction">Introduction</h3>

<p><a href="https://redis.io/">Redis</a> is an in-memory key-value store known for its flexibility, performance, and wide language support. This tutorial demonstrates how to install, configure, and secure Redis on a Debian 10 server.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>To complete this guide, you will need access to a Debian 10 server that has a non-root user with <code>sudo</code> privileges and a basic firewall configured. You can set this up by following our <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-debian-10">Initial Server Setup guide</a>.</p>

<p>When you are ready to begin, log in to your server as your sudo-enabled user and continue below.</p>

<h2 id="step-1-—-installing-and-configuring-redis">Step 1 — Installing and Configuring Redis</h2>

<p>In order to get the latest version of Redis, we will use <code>apt</code> to install it from the official Debian repositories.</p>

<p>Update your local <code>apt</code> package cache and install Redis by typing:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt update
</li><li class="line" prefix="$">sudo apt install redis-server
</li></ul></code></pre>
<p>This will download and install Redis and its dependencies. Following this, there is one important configuration change to make in the Redis configuration file, which was generated automatically during the installation.</p>

<p>Open this file with your preferred text editor:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/redis/redis.conf
</li></ul></code></pre>
<p>Inside the file, find the <code>supervised</code> directive. This directive allows you to declare an init system to manage Redis as a service, providing you with more control over its operation. The <code>supervised</code> directive is set to <code>no</code> by default. Since you are running Debian, which uses the systemd init system, change this to <code>systemd</code>:</p>
<div class="code-label " title="/etc/redis/redis.conf">/etc/redis/redis.conf</div><pre class="code-pre "><code langs="">. . .

# If you run Redis from upstart or systemd, Redis can interact with your
# supervision tree. Options:
#   supervised no      - no supervision interaction
#   supervised upstart - signal upstart by putting Redis into SIGSTOP mode
#   supervised systemd - signal systemd by writing READY=1 to $NOTIFY_SOCKET
#   supervised auto    - detect upstart or systemd method based on
#                        UPSTART_JOB or NOTIFY_SOCKET environment variables
# Note: these supervision methods only signal "process is ready."
#       They do not enable continuous liveness pings back to your supervisor.
supervised <span class="highlight">systemd</span>

. . .
</code></pre>
<p>That’s the only change you need to make to the Redis configuration file at this point, so save and close it when you are finished. Then, reload the Redis service file to reflect the changes you made to the configuration file:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart redis
</li></ul></code></pre>
<p>With that, you’ve installed and configured Redis and it’s running on your machine. Before you begin using it, though, it’s prudent to first check whether Redis is functioning correctly.</p>

<h2 id="step-2-—-testing-redis">Step 2 — Testing Redis</h2>

<p>As with any newly-installed software, it’s a good idea to ensure that Redis is functioning as expected before making any further changes to its configuration. We will go over a handful of ways to check that Redis is working correctly in this step.</p>

<p>Start by checking that the Redis service is running:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl status redis
</li></ul></code></pre>
<p>If it is running without any errors, this command will produce output similar to the following:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>● redis-server.service - Advanced key-value store
   Loaded: loaded (/lib/systemd/system/redis-server.service; <span class="highlight">enabled</span>; vendor preset: enabled)
   Active: <span class="highlight">active (running)</span> since Wed 2018-09-05 20:19:44 UTC; 41s ago
     Docs: http://redis.io/documentation,
           man:redis-server(1)
  Process: 10829 ExecStopPost=/bin/run-parts --verbose /etc/redis/redis-server.post-down.d (code=exited, status=0/SUCCESS)
  Process: 10825 ExecStop=/bin/kill -s TERM $MAINPID (code=exited, status=0/SUCCESS)
  Process: 10823 ExecStop=/bin/run-parts --verbose /etc/redis/redis-server.pre-down.d (code=exited, status=0/SUCCESS)
  Process: 10842 ExecStartPost=/bin/run-parts --verbose /etc/redis/redis-server.post-up.d (code=exited, status=0/SUCCESS)
  Process: 10838 ExecStart=/usr/bin/redis-server /etc/redis/redis.conf (code=exited, status=0/SUCCESS)
  Process: 10834 ExecStartPre=/bin/run-parts --verbose /etc/redis/redis-server.pre-up.d (code=exited, status=0/SUCCESS)
 Main PID: 10841 (redis-server)
    Tasks: 3 (limit: 4915)
   CGroup: /system.slice/redis-server.service
           └─10841 /usr/bin/redis-server 127.0.0.1:6379
. . .
</code></pre>
<p>Here, you can see that Redis is running and is already enabled, meaning that it is set to start up every time the server boots.</p>

<span class='note'><p>
<strong>Note:</strong> This setting is desirable for many common use cases of Redis. If, however, you prefer to start up Redis manually every time your server boots, you can configure this with the following command:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl disable redis
</li></ul></code></pre>
<p></p></span>

<p>To test that Redis is functioning correctly, connect to the server using the command-line client:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">redis-cli
</li></ul></code></pre>
<p>In the prompt that follows, test connectivity with the <code>ping</code> command:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="127.0.0.1:6379&gt;">ping
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>PONG
</code></pre>
<p>This output confirms that the server connection is still alive. Next, check that you’re able to set keys by running:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="127.0.0.1:6379&gt;">set test "It's working!"
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>OK
</code></pre>
<p>Retrieve the value by typing:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="127.0.0.1:6379&gt;">get test
</li></ul></code></pre>
<p>Assuming everything is working, you will be able to retrieve the value you stored:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>"It's working!"
</code></pre>
<p>After confirming that you can fetch the value, exit the Redis prompt to get back to the shell:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="127.0.0.1:6379&gt;">exit
</li></ul></code></pre>
<p>As a final test, we will check whether Redis is able to persist data even after it’s been stopped or restarted. To do this, first restart the Redis instance:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart redis
</li></ul></code></pre>
<p>Then connect with the command-line client once again and confirm that your test value is still available:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">redis-cli
</li></ul></code></pre><pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="127.0.0.1:6379&gt;">get test
</li></ul></code></pre>
<p>The value of your key should still be accessible:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>"It's working!"
</code></pre>
<p>Exit out into the shell again when you are finished:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="127.0.0.1:6379&gt;">exit
</li></ul></code></pre>
<p>With that, your Redis installation is fully operational and ready for you to use. However, some of its default configuration settings are insecure and provide malicious actors with opportunities to attack and gain access to your server and its data. The remaining steps in this tutorial cover methods for mitigating these vulnerabilities, as prescribed by the <a href="http://redis.io/topics/security">official Redis website</a>. Although these steps are optional and Redis will still function if you choose not to follow them, it is <em>strongly</em> recommended that you complete them in order to harden your system’s security.</p>

<h2 id="step-3-—-binding-to-localhost">Step 3 — Binding to localhost</h2>

<p>By default, Redis is only accessible from <strong>localhost</strong>. However, if you installed and configured Redis by following a different tutorial than this one, you might have updated the configuration file to allow connections from anywhere. This is not as secure as binding to <strong>localhost</strong>.</p>

<p>To correct this, open the Redis configuration file for editing:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/redis/redis.conf
</li></ul></code></pre>
<p>Locate this line and make sure it is uncommented (remove the <code>#</code> if it exists):</p>
<div class="code-label " title="/etc/redis/redis.conf">/etc/redis/redis.conf</div><pre class="code-pre "><code langs="">bind 127.0.0.1
</code></pre>
<p>Save and close the file when finished (press <code>CTRL + X</code>, <code>Y</code>, then <code>ENTER</code>).</p>

<p>Then, restart the service to ensure that systemd reads your changes:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart redis
</li></ul></code></pre>
<p>To check that this change has gone into effect, run the following <code>netstat</code> command:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo netstat -lnp | grep redis
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>tcp        0      0 127.0.0.1:6379          0.0.0.0:*               LISTEN      10959/redis-server
</code></pre>
<p>This output shows that the <code>redis-server</code> program is bound to <strong>localhost</strong> (<code>127.0.0.1</code>), reflecting the change you just made to the configuration file. If you see another IP address in that column (<code>0.0.0.0</code>, for example), then you should double check that you uncommented the correct line and restart the Redis service again.</p>

<p>Now that your Redis installation is only listening in on <strong>localhost</strong>, it will be more difficult for malicious actors to make requests or gain access to your server. However, Redis isn’t currently set to require users to authenticate themselves before making changes to its configuration or the data it holds. To remedy this, Redis allows you to require users to authenticate with a password before making changes via the Redis client (<code>redis-cli</code>).</p>

<h2 id="step-4-—-configuring-a-redis-password">Step 4 — Configuring a Redis Password</h2>

<p>Configuring a Redis password enables one of its two built-in security features — the <code>auth</code> command, which requires clients to authenticate to access the database. The password is configured directly in Redis's configuration file, <code>/etc/redis/redis.conf</code>, so open that file again with your preferred editor:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/redis/redis.conf
</li></ul></code></pre>
<p>Scroll to the <code>SECURITY</code> section and look for a commented directive that reads:</p>
<div class="code-label " title="/etc/redis/redis.conf">/etc/redis/redis.conf</div><pre class="code-pre "><code langs=""># requirepass foobared
</code></pre>
<p>Uncomment it by removing the <code>#</code>, and change <code>foobared</code> to a secure password.</p>

<span class='note'><p>
<strong>Note:</strong> Above the <code>requirepass</code> directive in the <code>redis.conf</code> file, there is a commented warning:</p>
<pre class="code-pre "><code langs=""># Warning: since Redis is pretty fast an outside user can try up to
# 150k passwords per second against a good box. This means that you should
# use a very strong password otherwise it will be very easy to break.
#
</code></pre>
<p>Thus, it’s important that you specify a very strong and very long value as your password. Rather than make up a password yourself, you can use the <code>openssl</code> command to generate a random one, as in the following example. By piping the output of the first command to the second <code>openssl</code> command, as shown here, it will remove any line breaks produced by that the first command:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">openssl rand 60 | openssl base64 -A
</li></ul></code></pre>
<p>Your output should look something like:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>RBOJ9cCNoGCKhlEBwQLHri1g+atWgn4Xn4HwNUbtzoVxAYxkiYBi7aufl4MILv1nxBqR4L6NNzI0X6cE
</code></pre>
<p>After copying and pasting the output of that command as the new value for <code>requirepass</code>, it should read:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="/etc/redis/redis.conf">/etc/redis/redis.conf</div>requirepass <span class="highlight">RBOJ9cCNoGCKhlEBwQLHri1g+atWgn4Xn4HwNUbtzoVxAYxkiYBi7aufl4MILv1nxBqR4L6NNzI0X6cE</span>
</code></pre>
<p></p></span>

<p>After setting the password, save and close the file, then restart Redis:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart redis.service
</li></ul></code></pre>
<p>To test that the password works, access the Redis command line:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">redis-cli
</li></ul></code></pre>
<p>The following shows a sequence of commands used to test whether the Redis password works. The first command tries to set a key to a value before authentication:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="127.0.0.1:6379&gt;">set key1 10
</li></ul></code></pre>
<p>That won't work because you didn’t authenticate, so Redis returns an error:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>(error) NOAUTH Authentication required.
</code></pre>
<p>The next command authenticates with the password specified in the Redis configuration file:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="127.0.0.1:6379&gt;">auth <span class="highlight">your_redis_password</span>
</li></ul></code></pre>
<p>Redis acknowledges:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>OK
</code></pre>
<p>After that, running the previous command again will succeed:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="127.0.0.1:6379&gt;">set key1 10
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>OK
</code></pre>
<p><code>get key1</code> queries Redis for the value of the new key.</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="127.0.0.1:6379&gt;">get key1
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>"10"
</code></pre>
<p>After confirming that you’re able to run commands in the Redis client after authenticating, you can exit the <code>redis-cli</code>:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="127.0.0.1:6379&gt;">quit
</li></ul></code></pre>
<p>Next, we'll look at renaming Redis commands which, if entered by mistake or by a malicious actor, could cause serious damage to your machine.</p>

<h2 id="step-5-—-renaming-dangerous-commands">Step 5 — Renaming Dangerous Commands</h2>

<p>The other security feature built into Redis involves renaming or completely disabling certain commands that are considered dangerous.</p>

<p>When run by unauthorized users, such commands can be used to reconfigure, destroy, or otherwise wipe your data. Like the authentication password, renaming or disabling commands is configured in the same <code>SECURITY</code> section of the <code>/etc/redis/redis.conf</code> file.</p>

<p>Some of the commands that are considered dangerous include: <strong>FLUSHDB</strong>, <strong>FLUSHALL</strong>, <strong>KEYS</strong>, <strong>PEXPIRE</strong>, <strong>DEL</strong>, <strong>CONFIG</strong>, <strong>SHUTDOWN</strong>, <strong>BGREWRITEAOF</strong>, <strong>BGSAVE</strong>, <strong>SAVE</strong>, <strong>SPOP</strong>, <strong>SREM</strong>, <strong>RENAME</strong>, and <strong>DEBUG</strong>. This is not a comprehensive list, but renaming or disabling all of the commands in that list is a good starting point for enhancing your Redis server’s security.</p>

<p>Whether you should disable or rename a command depends on your specific needs or those of your site. If you know you will never use a command that could be abused, then you may disable it. Otherwise, it might be in your best interest to rename it.</p>

<p>To enable or disable Redis commands, open the configuration file once more:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano  /etc/redis/redis.conf
</li></ul></code></pre>
<p><span class='warning'><strong>Warning:</strong> The following steps showing how to disable and rename commands are examples. You should only choose to disable or rename the commands that make sense for you. You can review the full list of commands for yourself and determine how they might be misused at <a href="http://redis.io/commands">redis.io/commands</a>.<br></span></p>

<p>To disable a command, simply rename it to an empty string (signified by a pair of quotation marks with no characters between them), as shown below:</p>
<div class="code-label " title="/etc/redis/redis.conf">/etc/redis/redis.conf</div><pre class="code-pre "><code langs="">. . .
# It is also possible to completely kill a command by renaming it into
# an empty string:
#
<span class="highlight">rename-command FLUSHDB ""</span>
<span class="highlight">rename-command FLUSHALL ""</span>
<span class="highlight">rename-command DEBUG ""</span>
. . .
</code></pre>
<p>To rename a command, give it another name as shown in the examples below. Renamed commands should be difficult for others to guess, but easy for you to remember:</p>
<div class="code-label " title="/etc/redis/redis.conf">/etc/redis/redis.conf</div><pre class="code-pre "><code langs="">. . .
# rename-command CONFIG ""
<span class="highlight">rename-command SHUTDOWN SHUTDOWN_MENOT</span>
<span class="highlight">rename-command CONFIG ASC12_CONFIG</span>
. . .
</code></pre>
<p>Save your changes and close the file.</p>

<p>After renaming a command, apply the change by restarting Redis:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart redis
</li></ul></code></pre>
<p>To test the new command, enter the Redis command line:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">redis-cli
</li></ul></code></pre>
<p>Then, authenticate:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="127.0.0.1:6379&gt;">auth <span class="highlight">your_redis_password</span>
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>OK
</code></pre>
<p>Let’s assume that you renamed the <code>CONFIG</code> command to <code>ASC12_CONFIG</code>, as in the preceding example. First, try using the original <code>CONFIG</code> command. It should fail, because you’ve renamed it:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="127.0.0.1:6379&gt;">config get requirepass
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>(error) ERR unknown command 'config'
</code></pre>
<p>Calling the renamed command, however, will be successful. It is not case-sensitive:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="127.0.0.1:6379&gt;">asc12_config get requirepass
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>1) "requirepass"
2) "<span class="highlight">your_redis_password</span>"
</code></pre>
<p>Finally, you can exit from <code>redis-cli</code>:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="127.0.0.1:6379&gt;">exit
</li></ul></code></pre>
<p>Note that if you're already using the Redis command line and then restart Redis, you'll need to re-authenticate. Otherwise, you'll get this error if you type a command:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>NOAUTH Authentication required.
</code></pre>
<span class='warning'><p>
Regarding the practice of renaming commands, there's a cautionary statement at the end of the <code>SECURITY</code> section in <code>/etc/redis/redis.conf</code> which reads:</p>

<blockquote>
<p><code>Please note that changing the name of commands that are logged into the AOF file or transmitted to slaves may cause problems.</code></p>
</blockquote>

<p><strong><em>Note:</em></strong> <em>The Redis project chooses to use the terms “master” and “slave” while DigitalOcean generally prefers alternative descriptors. In order to avoid confusion we’ve chosen to use the terms used in the Redis documentation here.</em></p>

<p>That means if the renamed command is not in the AOF file, or if it is but the AOF file has not been transmitted to slaves, then there should be no problem.</p>

<p>So, keep that in mind when you're trying to rename commands. The best time to rename a command is when you're not using AOF persistence, or right after installation, that is, before your Redis-using application has been deployed.</p>

<p>When you're using AOF and dealing with a master-slave installation, consider <a href="https://github.com/antirez/redis/issues/2783">this answer from the project's GitHub issue page</a>. The following is a reply to the author's question:</p>

<blockquote>
<p>The commands are logged to the AOF and replicated to the slave the same way they are sent, so if you try to replay the AOF on an instance that doesn't have the same renaming, you may face inconsistencies as the command cannot be executed (same for slaves).</p>
</blockquote>

<p>Thus, the best way to handle renaming in cases like that is to make sure that renamed commands are applied to all instances in master-slave installations.<br></p></span>

<h2 id="conclusion">Conclusion</h2>

<p>In this tutorial, you installed and configured Redis, validated that your Redis installation is functioning correctly, and used its built-in security features to make it less vulnerable to attacks from malicious actors.</p>

<p>Keep in mind that once someone is logged in to your server, it's very easy to circumvent the Redis-specific security features we've put in place. Therefore, the most important security feature on your Redis server is your firewall (which you configured if you followed the prerequisite <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-debian-10#step-4-%E2%80%94-setting-up-a-basic-firewall">Initial Server Setup</a> tutorial), as this makes it extremely difficult for malicious actors to jump that fence.</p>
