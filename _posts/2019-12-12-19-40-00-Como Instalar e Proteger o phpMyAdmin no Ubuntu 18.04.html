---
layout: post
title: Como Instalar e Proteger o phpMyAdmin no Ubuntu 18.04
network: digitalocean
date: December 12, 2019 at 07:40PM
url: https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-phpmyadmin-on-ubuntu-18-04-pt
image: https://assets.digitalocean.com/articles/phpmyadmin_1804/phpmyadmin_sammy_login_small.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<p><em>Existe uma versão anterior deste tutorial, escrita <a href="https://www.digitalocean.com/community/users/bpb">por Brennan Bearnes</a>.</em></p>

<h3 id="introdução">Introdução</h3>

<p>Embora muitos usuários precisam da funcionalidade de um sistema de gerenciamento de banco de dados como o MySQL, talvez não se sintam à vontade para interagir com o sistema unicamente a partir do prompt do MySQL.</p>

<p>O <a href="https://www.phpmyadmin.net/">phpMyAdmin</a> foi criado para que os usuários possam interagir com o MySQL através de uma interface Web. Neste guia, vamos discutir como instalar e proteger o phpMyAdmin para que você possa usá-lo com segurança para gerenciar seus bancos de dados em um sistema Ubuntu 18.04.</p>

<h2 id="pré-requisitos">Pré-requisitos</h2>

<p>Antes de começar com este guia, será necessário concluir alguns passos básicos.</p>

<p>Primeiramente, vamos supor que o seu servidor tenha um usuário não** rai**z com privilégios <code>sudo</code>, além de um firewall configurado com <code>ufw</code>, como descrito no<a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-18-04">Guia de configuração inicial do servidor para o Ubuntu 18.04</a>.</p>

<p>Também vamos presumir que você completou a instalação do LAMP (Linux, Apache, MySQL e PHP) no seu servidor Ubuntu 18.04. Se ainda não tiver feito isso, siga este guia de <a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-apache-mysql-php-lamp-stack-ubuntu-18-04">Como instalar uma pilha LAMP no Ubuntu 18.04</a>.</p>

<p>Finalmente, existem considerações de segurança importantes ao se usar software como o phpMyAdmin, uma vez que ele:</p>

<ul>
<li>Comunica-se diretamente com sua instalação do MySQL.</li>
<li>Trata da autenticação usando credenciais para o MySQL.</li>
<li>Executa e retorna resultados para consultas SQL arbitrárias.</li>
</ul>

<p>Por isso e também por ser um aplicativo PHP amplamente utilizado - sendo alvo frequente de ataque, nunca execute o phpMyAdmin em sistemas remotos em uma conexão HTTP simples. Se não tiver um domínio existente configurado com um certificado SSL/TLS, siga este guia de <a href="https://www.digitalocean.com/community/tutorials/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-18-04">como proteger o Apache com o Let&rsquo;s Encrypt no Ub</a>untu 18.04. Isso irá exigir que você <a href="https://www.digitalocean.com/community/tutorials/how-to-point-to-digitalocean-nameservers-from-common-domain-registrars">registre um nome de domínio</a>, <a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-digitalocean-dns">crie registros DNS para seu servidor</a> e <a href="https://www.digitalocean.com/community/tutorials/how-to-install-the-apache-web-server-on-ubuntu-18-04#step-5-%E2%80%94-setting-up-virtual-hosts-(recommended)">configure um host Virtual Apache</a>.</p>

<p>Assim que terminar estes passos, você estará pronto para começar com este guia.</p>

<h2 id="passo-1-—-instalando-o-phpmyadmin">Passo 1 — Instalando o phpMyAdmin</h2>

<p>Para começar, instalaremos o phpMyAdmin a partir dos repositórios padrão do Ubuntu.</p>

<p>Isso é feito atualizando-se o índice de pacotes do seu servidor e, depois, usando o sistema de empacotament o <code>apt</code> para pegar os arquivos e instalá-los no seu sistema:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt update
</li><li class="line" prefix="$">sudo apt install phpmyadmin php-mbstring php-gettext
</li></ul></code></pre>
<p>Serão feitas algumas perguntas para configurar sua instalação corretamente.</p>

<p><span class='warning'><strong>Aviso:</strong> quando o prompt surgir, o &ldquo;apache2&rdquo; estará destacado, mas <strong>não</strong> estará selecionado. Se você apertar a tecla <code>SPACE</code> para selecionar o Apache, o instalador *não *irá mover os arquivos necessários durante a instalação. Aperte as teclas <code>SPACE</code>, <code>TAB</code> e, então, <code>ENTER</code> para selecionar o Apache.<br></span></p>

<ul>
<li>Para a seleção do servidor, escolha <code>apache2</code></li>
<li>Selecione <code>Yes</code> quando indagado quanto a se usará o <code>dbconfig-common</code> para configurar o banco de dados</li>
<li>Será solicitado que escolha e confirme a senha do aplicativo MySQL para o phpMyAdmin</li>
</ul>

<p>O processo de instalação adiciona o arquivo de configuração do Apache phpMyAdmin no diretório <code>/etc/apache2/conf-enabled/</code>, onde ele é lido automaticamente. A única coisa que você precisa fazer é habilitar explicitamente a extensão do PHP <code>mbstring</code>, o que pode ser feito digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo phpenmod mbstring
</li></ul></code></pre>
<p>Depois disso, reinicie o Apache para as suas alterações serem reconhecidas:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart apache2
</li></ul></code></pre>
<p>O phpMyAdmin agora está instalado e configurado. Entretanto, antes de fazer login e começar a interagir com seus bancos de dados do MySQL, será necessário garantir que seus usuários do MySQL tenham os privilégios necessários para interagir com o programa.</p>

<h2 id="passo-2-—-ajustando-a-autenticação-e-os-privilégios-do-usuário">Passo 2 — Ajustando a autenticação e os privilégios do usuário</h2>

<p>Quando você instalou o phpMyAdmin no seu servidor, ele criou automaticamente um usuário de banco de dados chamado <code>phpmyadmin</code> que executa certos processos subjacentes para o programa. Em vez de fazer login como esse usuário com a senha administrativa definida durante a instalação, é recomendável que você faça log in como usuário <strong>root</strong> do MySQL ou como um usuário dedicado para gerenciar os bancos de dados através da interface phpMyAdmin.</p>

<h3 id="configurando-a-senha-de-acesso-para-a-conta-de-raiz-do-mysql">Configurando a senha de acesso para a conta de raiz do MySQL</h3>

<p>Nos sitemas Ubuntu que executam o MySQL 5.7 (e as versões posteriores), por padrão, o usuário <strong>root</strong> do MySQL é configurado para autenticar usando o plug-in <code>auth_socket</code> e não com uma senha. Isso permite maior segurança e usabilidade em muitos casos, mas também pode complicar as coisas quando for necessário permitir que um programa externo — como o phpMyAdmin — acesse o usuário.</p>

<p>Para fazer login no pspMyAdmin como seu usuário <strong>root</strong> do MySQL, será necessário mudar seu método de autenticação a partir do <code>auth_socket</code> para o <code>mysql_native_password</code>, se ainda não tiver feito isso. Para fazer isso, abra o prompt do MySQL do seu terminal:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo mysql
</li></ul></code></pre>
<p>Em seguida, verifique quais os métodos de autenticação cada conta de usuário do seu MySQL utilizam com o seguinte comando:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">SELECT user,authentication_string,plugin,host FROM mysql.user;
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>+------------------+-------------------------------------------+-----------------------+-----------+
| user             | authentication_string                     | plugin                | host      |
+------------------+-------------------------------------------+-----------------------+-----------+
| root             |                                           | auth_socket           | localhost |
| mysql.session    | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost |
| mysql.sys        | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost |
| debian-sys-maint | *8486437DE5F65ADC4A4B001CA591363B64746D4C | mysql_native_password | localhost |
| phpmyadmin       | *5FD2B7524254B7F81B32873B1EA6D681503A5CA9 | mysql_native_password | localhost |
+------------------+-------------------------------------------+-----------------------+-----------+
5 rows in set (0.00 sec)
</code></pre>
<p>Neste exemplo, é possível ver que o usuário <strong>root</strong> autenticou usando o plug-in <code>auth_socket</code>. Para configurar a conta <strong>root</strong> para autenticar com uma senha, execute o comando <code>ALTER USER</code>. Certifique-se de trocar a <code><span class="highlight">senha</span></code> por uma senha forte de sua escolha:`</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '<span class="highlight">password</span>';
</li></ul></code></pre>
<p>Então, execute o comando <code>FLUSH</code>  o qual diz para o servidor recarregar as tabelas de permissões e colocar as suas alterações em vigor:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">FLUSH PRIVILEGES;
</li></ul></code></pre>
<p>Verifique novamente os métodos de autenticação utilizados pelos seus usuários para confirmar que *<em>o raiz *</em>já não autentica utilizando o plug-in <code>auth_socket</code>:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">SELECT user,authentication_string,plugin,host FROM mysql.user;
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>+------------------+-------------------------------------------+-----------------------+-----------+
| user             | authentication_string                     | plugin                | host      |
+------------------+-------------------------------------------+-----------------------+-----------+
| root             | *DE06E242B88EFB1FE4B5083587C260BACB2A6158 | <span class="highlight">mysql_native_password</span> | localhost |
| mysql.session    | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost |
| mysql.sys        | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost |
| debian-sys-maint | *8486437DE5F65ADC4A4B001CA591363B64746D4C | mysql_native_password | localhost |
| phpmyadmin       | *5FD2B7524254B7F81B32873B1EA6D681503A5CA9 | mysql_native_password | localhost |
+------------------+-------------------------------------------+-----------------------+-----------+
5 rows in set (0.00 sec)
</code></pre>
<p>Através dessa saída é possível ver que o usuário <strong>raiz</strong> passará a autenticar usando uma senha. Agora, é possível fazer login na interface phpMyAdmin como seu usuário *<em>raiz *</em>com a senha que você definiu para ele aqui.</p>

<h3 id="configurando-a-senha-de-acesso-para-um-usuário-do-mysql-dedicado">Configurando a senha de acesso para um usuário do MySQL dedicado</h3>

<p>Como alternativa, alguns podem achar que é melhor eles se conectarem ao phpMyAdmin com um usuário dedicado. Para fazer isso, abra a shell do MySQL novamente:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo mysql
</li></ul></code></pre>
<span class='note'><p>
<strong>Nota:</strong> se tiver a autenticação de senha habilitada, como descrito na seção anterior, será necessário usar um comando diferente para acessar a shell do MySQL. A sintaxe abaixo executará o seu cliente MySQL com privilégios regulares de usuário. Você somente terá privilégios de administrador dentro do banco de dados através desta autenticação:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">mysql -u root -p
</li></ul></code></pre>
<p></p></span>

<p>A partir daí, crie um novo usuário e dê a ele uma senha forte:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">CREATE USER '<span class="highlight">sammy</span>'@'localhost' IDENTIFIED BY '<span class="highlight">password</span>';
</li></ul></code></pre>
<p>Então, conceda ao seu novo usuário os privilégios apropriados. Por exemplo, é possível conceder os privilégios de usuário para todas as tabelas dentro do banco de dados, além do poder de adicionar, alterar e remover os privilégios de usuário, com este comando:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">GRANT ALL PRIVILEGES ON *.* TO '<span class="highlight">sammy</span>'@'localhost' WITH GRANT OPTION;
</li></ul></code></pre>
<p>Despois disso, saia do shell do MySQL:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">exit
</li></ul></code></pre>
<p>Agora, é possível acessar a interface Web, acessando o nome de domínio ou endereço IP público do seu servidor seguido por <code>/phpmyadmin</code>:</p>
<pre class="code-pre "><code langs="">http://<span class="highlight">your_domain_or_IP</span>/phpmyadmin
</code></pre>
<p><img src="https://assets.digitalocean.com/articles/phpmyadmin_1804/phpmyadmin_sammy_login_small.png" alt="phpMyAdmin login screen"></p>

<p>Faça login na interface como usuário <strong>root</strong> ou com o novo nome de usuário e senha que você acabou de configurar.</p>

<p>Quando fazer login, verá a interface de usuário que se parecerá com isso:</p>

<p><img src="https://assets.digitalocean.com/articles/phpmyadmin_1804/phpmyadmin_sammy_ui.png" alt="phpMyAdmin user interface"></p>

<p>Agora que é capaz de se conectar e interagir com o phpMyAdmin, tudo o que resta a se fazer é fortalecer a segurança dos seus sistemas para protegê-los de ataques.</p>

<h2 id="passo-3-—-protegendo-sua-instância-phpmyadmin">Passo 3 — Protegendo sua instância phpMyAdmin</h2>

<p>Devido a sua onipresença, o phpMyAdmin é alvo conhecido de ataque. Você deverá tomar cuidado extra para evitar o acesso não autorizado. Uma das maneiras mais fáceis de fazer isso é colocar um gateway na frente do aplicativo inteiro, utilizando as funcionalidades integradas do Apache para autenticação e dautorização, ou seja, <code>.htaccess</code>.</p>

<p>Para fazer isso, primeiro você deve habilitar o uso do arquivo <code>.htaccess</code>, editando seu arquivo de configuração do Apache.</p>

<p>Edite o arquivo vinculado que foi colocado no seu diretório de configuração do Apache:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/apache2/conf-available/phpmyadmin.conf
</li></ul></code></pre>
<p>Adicione uma diretiva de <code>AllowOverride All</code> na seção <code>&lt;Directory /usr/share/phpmyadmin&gt;</code> do arquivo de configuração, desta forma:</p>
<div class="code-label " title="/etc/apache2/conf-available/phpmyadmin.conf">/etc/apache2/conf-available/phpmyadmin.conf</div><pre class="code-pre "><code langs="">&lt;Directory /usr/share/phpmyadmin&gt;
    Options FollowSymLinks
    DirectoryIndex index.php
    <span class="highlight">AllowOverride All</span>
    . . .
</code></pre>
<p>Quando tiver adicionado essa linha, salve e feche o arquivo.</p>

<p>Para implementar as alterações feitas, reinicie o Apache:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart apache2
</li></ul></code></pre>
<p>Agora que o <code>.htaccess</code> foi habilitado para seu aplicativo, será necessário criar um arquivo que realmente implemente alguma segurança.</p>

<p>Para que isso seja bem-sucedido, o arquivo deve ser criado dentro do diretório do aplicativo. Crie o arquivo necessário e o abra no seu editor de texto com privilégios raiz, digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /usr/share/phpmyadmin/.htaccess
</li></ul></code></pre>
<p>Dentro desse arquivo, digite as seguintes informações:</p>
<div class="code-label " title="/usr/share/phpmyadmin/.htaccess">/usr/share/phpmyadmin/.htaccess</div><pre class="code-pre "><code langs="">AuthType Basic
AuthName "Restricted Files"
AuthUserFile /etc/phpmyadmin/.htpasswd
Require valid-user
</code></pre>
<p>Eis o que cada uma dessas linhas significa:</p>

<ul>
<li><code>AuthType Basic</code>: esta linha especifica o tipo de autenticação que você está implementando. Esse tipo irá implementar a autenticação por senha, utilizando um arquivo de senha.</li>
<li><code>AuthName</code>: define a mensagem da caixa de diálogo da autenticação. Você deve manter essas definições com texto vago, no intuito de evitar que usuários não autorizados tenham acesso às informações sobre o que estiver sendo protegido.</li>
<li><code>AuthUserFile</code>: define o local do arquivo de senha que será usado para autenticação. Esse arquivo deve permanecer fora dos diretórios que estão sendo atendidos. Criaremos esse arquivo em breve.</li>
<li><code>Require valid-user</code>: especifica que apenas os usuários autenticados devem receber acesso a este recurso. Isto é o que realmente impede os usuários não autorizados de entrarem.</li>
</ul>

<p>Quando você terminar, salve e feche o arquivo.</p>

<p>O local que você selecionou para seu arquivo de senha foi <code>/etc/phpmyadmin/.htpasswd</code>. Agora, é possível criar este arquivo e encaminhá-lo para um usuário inicial com o utilitário <code>htpasswd</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo htpasswd -c /etc/phpmyadmin/.htpasswd <span class="highlight">username</span>
</li></ul></code></pre>
<p>Será solicitado que selecione e confirme uma senha para o usuário que está criando. Depois disso, o arquivo é criado com a senha verificada que você digitou.</p>

<p>Se quiser inserir um usuário adicional, será necessário fazer isso *<em>sem *</em>o sinal<code>iz</code>ador -c, desta maneira:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo htpasswd /etc/phpmyadmin/.htpasswd <span class="highlight">additionaluser</span>
</li></ul></code></pre>
<p>Agora, quando acessar seu subdiretório do phpMyAdmin será solicitado o nome e senha da conta adicional que você acabou de configurar:</p>
<pre class="code-pre "><code langs="">https://<span class="highlight">domain_name_or_IP</span>/phpmyadmin
</code></pre>
<p><img src="https://assets.digitalocean.com/articles/phpmyadmin_1404/apache_auth.png" alt="phpMyAdmin apache password"></p>

<p>Após digitar a autenticação do Apache, você será levado para a página de autenticação regular do phpMyAdmin para digitar suas credenciais do MySQL. Esta configuração adiciona uma camada adicional de segurança, o que é desejável considerando que o phpMyAdmin sofreu vulnerabilidades no passado.</p>

<h2 id="conclusão">Conclusão</h2>

<p>Agora, você deve ter o phpMyAdmin configurado e pronto para usar no seu servidor Ubuntu 18.04. Ao utilizar esta interface, conseguirá criar facilmente bancos de dados, usuários, tabelas etc. e realizar operações usuais como excluir e modificar estruturas e dados.</p>
