---
layout: post
title: Cómo instalar el servidor web de Apache en CentOS 7
network: digitalocean
date: January 22, 2020 at 09:32PM
url: https://www.digitalocean.com/community/tutorials/how-to-install-the-apache-web-server-on-centos-7-es
image: https://assets.digitalocean.com/articles/CART-65406/apache_default_page.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="introducción">Introducción</h3>

<p>El servidor HTTP <a href="https://www.apache.org/">Apache</a> es el más usado del mundo. Ofrece muchas características potentes, entre las que se incluyen módulos que se cargan de forma dinámica, una sólida compatibilidad con medios y amplia integración con otras herramientas de software populares.</p>

<p>A través de esta guía, instalará un servidor web de Apache con hosts virtuales en su servidor de CentOS 7.</p>

<h2 id="requisitos-previos">Requisitos previos</h2>

<p>Necesitará lo siguiente para completar esta guía:</p>

<ul>
<li>Un usuario no root con privilegios sudo configurado en su servidor siguiendo la <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-centos-7">guía de configuración inicial para servidores de CentOS 7</a>.</li>
<li>Un firewall básico configurado siguiendo la guía <a href="https://www.digitalocean.com/community/tutorials/additional-recommended-steps-for-new-centos-7-servers#configuring-a-basic-firewall">Pasos adicionales recomendados para servidores nuevos de CentOS 7.</a></li>
</ul>

<h2 id="paso-1-instalar-apache">Paso 1: Instalar Apache</h2>

<p>Apache está disponible dentro de los repositorios de software predeterminados de CentOS, lo cual significa que puede instalarlo con el administrador de paquetes <code>yum</code>.</p>

<p>Como usuario sudo no root configurado en los requisitos previos, actualice el índice local de paquetes de Apache <code>httpd</code> para reflejar los últimos cambios:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo yum update httpd
</li></ul></code></pre>
<p>Una vez que se actualicen los paquetes, instale el paquete de Apache:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo yum install httpd
</li></ul></code></pre>
<p>Una vez confirmada la instalación, <code>yum</code> instalará Apache y todas las dependencias necesarias. Una vez que la instalación se complete, estará listo para iniciar el servicio.</p>

<h2 id="paso-2-comprobar-su-servidor-web">Paso 2: Comprobar su servidor web</h2>

<p>Apache no se inicia de forma automática en CentOS una vez que se completa la instalación. Deberá iniciar el proceso de Apache de forma manual:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl start httpd
</li></ul></code></pre>
<p>Verifique que el servicio funcione con el siguiente comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl status httpd
</li></ul></code></pre>
<p>Visualizará un estado <code>active</code> cuando el servicio esté en ejecución:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Redirecting to /bin/systemctl status httpd.service
● httpd.service - The Apache HTTP Server
   Loaded: loaded (/usr/lib/systemd/system/httpd.service; enabled; vendor preset: disabled)
   Active: <span class="highlight">active (running)</span> since Wed 2019-02-20 01:29:08 UTC; 5s ago
     Docs: man:httpd(8)
           man:apachectl(8)
 Main PID: 1290 (httpd)
   Status: "Processing requests..."
   CGroup: /system.slice/httpd.service
           ├─1290 /usr/sbin/httpd -DFOREGROUND
           ├─1291 /usr/sbin/httpd -DFOREGROUND
           ├─1292 /usr/sbin/httpd -DFOREGROUND
           ├─1293 /usr/sbin/httpd -DFOREGROUND
           ├─1294 /usr/sbin/httpd -DFOREGROUND
           └─1295 /usr/sbin/httpd -DFOREGROUND
...
</code></pre>
<p>Como puede ver en este resultado, parece que el servicio se inició correctamente. Sin embargo, la mejor forma de comprobarlo es solicitar una página de Apache.</p>

<p>Puede acceder a la página de destino predeterminada de Apache para confirmar que el software funcione correctamente mediante su dirección IP: Si no conoce la dirección IP de su servidor, puede obtenerla de varias formas desde la línea de comandos.</p>

<p>Escriba esto en la línea de comandos de su servidor:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">hostname -I
</li></ul></code></pre>
<p>Con este comando se mostrarán todas las direcciones de red del host, de modo que obtendrá algunas direcciones IP separadas por espacios. Puede probar cada una de ellas en su navegador web para ver si funcionan.</p>

<p>De forma alternativa, puede utilizar <code>curl</code> para solicitar su IP de <code>icanhazip.com</code>, que le brindará su dirección IPv4 pública como se muestra desde otra ubicación en Internet:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">curl -4 icanhazip.com
</li></ul></code></pre>
<p>Cuando tenga la dirección IP de su servidor, introdúzcala en la barra de direcciones de su navegador:</p>
<pre class="code-pre "><code langs="">http://<span class="highlight">your_server_ip</span>
</code></pre>
<p>Visualizará la página web predeterminada para Apache de CentOS 7:</p>

<p><img src="https://assets.digitalocean.com/articles/CART-65406/apache_default_page.png" alt="Página predeterminada de Apache para CentOS 7"></p>

<p>Esta página indica que Apache funciona correctamente. También incluye información básica sobre archivos y ubicaciones de directorios importantes de Apache. Ahora que el servicio está instalado y en ejecución, puede utilizar diferentes comandos de <code>systemctl</code> para administrarlo.</p>

<h2 id="paso-3-administrar-el-proceso-de-apache">Paso 3: Administrar el proceso de Apache</h2>

<p>Ahora el servidor web funciona, repasemos algunos comandos de administración básicos.</p>

<p>Para detener su servidor web, escriba lo siguiente:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl stop httpd
</li></ul></code></pre>
<p>Para iniciar el servidor web cuando se detenga, escriba lo siguiente:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl start httpd
</li></ul></code></pre>
<p>Para detener y luego iniciar el servicio de nuevo, escriba lo siguiente:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart httpd
</li></ul></code></pre>
<p>Si solo realiza cambios de configuración, Apache a menudo puede recargarse sin cerrar conexiones. Para hacerlo, utilice este comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl reload httpd
</li></ul></code></pre>
<p>Por defecto, Apache está configurado para iniciarse automáticamente cuando el servidor lo hace. Si no es lo que quiere, deshabilite este comportamiento escribiendo lo siguiente:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl disable httpd
</li></ul></code></pre>
<p>Para volver a habilitar el servicio de modo que se cargue en el inicio, escriba lo siguiente:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl enable httpd
</li></ul></code></pre>
<p>Ahora, Apache se iniciará de forma automática cuando el servidor se inicie de nuevo.</p>

<p>La configuración predeterminada de Apache permitirá a su servidor host alojar un único sitio web. Si piensa alojar varios dominios en su servidor, deberá configurar hosts virtuales en su servidor web de Apache.</p>

<h2 id="paso-4-configuración-de-hosts-virtuales-recomendado">Paso 4: Configuración de hosts virtuales (recomendado)</h2>

<p>Al emplear el servidor web Apache, puede utilizar <em>hosts virtuales</em> (similares a bloques de servidor de Nginx) para encapsular detalles de configuración y alojar más de un dominio desde un único servidor. En este paso, configurará un dominio llamado <code>example.com</code>, pero debería cambiarlo por su propio nombre de dominio. Consulte nuestra <a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-digitalocean-dns">Introducción a DNS de DigitalOcean para hallar más información sobre la configuración de un nombre de dominio con DigitalOcean</a>.</p>

<p>Por defecto, Apache en CentOS 7  tiene habilitado un bloque de servidor que está configurado para proporcionar documentos del directorio <code>/var/www/html</code>. Si bien esto funciona bien para un solo sitio, puede ser difícil de manejar si aloja varios. En lugar de modificar <code>/var/www/html</code>, creará una estructura de directorio dentro de <code>/var/www</code> para el sitio <code>example.com</code> y dejará <code>/var/www/html</code> instalado como directorio predeterminado que se presentará si una solicitud de cliente no coincide con ningún otro sitio.</p>

<p>Cree el directorio <code>​​​​​html​​​​​​</code> para el sitio <code>example.com</code> de la siguiente manera, utilizando el indicador <code>-p</code> para crear cualquier directorio principal necesario:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo mkdir -p /var/www/<span class="highlight">example.com</span>/html
</li></ul></code></pre>
<p>Cree un directorio adicional para almacenar archivos de registro para el sitio:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo mkdir -p /var/www/<span class="highlight">example.com</span>/log
</li></ul></code></pre>
<p>A continuación, asigne la propiedad del directorio <code>html</code> con la variable de entorno <code>$USER</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo chown -R $USER:$USER /var/www/<span class="highlight">example.com</span>/html
</li></ul></code></pre>
<p>Asegúrese de que estén configurados los permisos  predeterminados de su root web:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo chmod -R 755 /var/www
</li></ul></code></pre>
<p>A continuación, cree una página de ejemplo <code>index.html</code> utilizando <code>vi</code> o su editor favorito:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo vi /var/www/<span class="highlight">example.com</span>/html/index.html
</li></ul></code></pre>
<p>Pulse <code>i</code> para realizar un cambio al modo <code>INSERT</code> y agregar el siguiente ejemplo HTML al archivo:</p>
<div class="code-label " title="/var/www/example.com/html/index.html">/var/www/example.com/html/index.html</div><pre class="code-pre "><code class="code-highlight language-html">&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Welcome to <span class="highlight">Example.com</span>!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Success! The <span class="highlight">example.com</span> virtual host is working!&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Guarde y cierre el archivo presionando <code>ESC</code>, escribiendo <code>:wq</code> y presionando <code>ENTER</code>.</p>

<p>Una vez establecidos el directorio de su sitio y el archivo de índice de ejemplo, casi estará listo para crear archivos de host virtuales. Mediante los archivos de host virtuales se especifica la configuración de sus sitios individuales y se informa al servidor web de Apache la manera de responder a varias solicitudes de dominio.</p>

<p>Antes de crear sus hosts virtuales, deberá crear un directorio <code>sites-available</code> para almacenarlos. También creará el directorio <code>sites-enabled</code> que indica a Apache que un host virtual está preparado para visitantes. En el directorio <code>sites-enabled</code> se almacenarán enlaces simbólicos a hosts virtuales que deseemos publicar. Cree ambos directorios con el siguiente comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo mkdir /etc/httpd/sites-available /etc/httpd/sites-enabled
</li></ul></code></pre>
<p>A continuación, indicará a Apache que busque hosts virtuales en el directorio <code>sites-enabled</code>. Para lograr esto, edite el archivo de configuración principal de Apache y añada una línea que declare un directorio opcional para archivos de configuración adicionales:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo vi /etc/httpd/conf/httpd.conf
</li></ul></code></pre>
<p>Añada esta línea al final del archivo:</p>
<pre class="code-pre "><code langs="">IncludeOptional sites-enabled/*.conf
</code></pre>
<p>Guarde y cierre el archivo cuando termine de añadir esa línea. Ahora que están listos sus directorios de hosts virtuales, creará su archivo de host virtual.</p>

<p>Comience creando un nuevo archivo en el directorio <code>sites-available</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo vi /etc/httpd/sites-available/<span class="highlight">example.com</span>.conf
</li></ul></code></pre>
<p>Agregue el siguiente bloque de configuración y cambie el dominio <code>example.com</code> por su nombre de dominio:</p>
<div class="code-label " title="/etc/httpd/sites-available/example.com.conf">/etc/httpd/sites-available/example.com.conf</div><pre class="code-pre "><code langs="">&lt;VirtualHost *:80&gt;
    ServerName www.<span class="highlight">example.com</span>
    ServerAlias <span class="highlight">example.com</span>
    DocumentRoot /var/www/<span class="highlight">example.com</span>/html
    ErrorLog /var/www/<span class="highlight">example.com</span>/log/error.log
    CustomLog /var/www/<span class="highlight">example.com</span>/log/requests.log combined
&lt;/VirtualHost&gt;
</code></pre>
<p>Esto indicará a Apache dónde encontrar directamente el root que contiene los documentos web de acceso público. También, dónde almacenar errores y solicitar registros para este sitio en particular.</p>

<p>Guarde y cierre el archivo cuando haya terminado.</p>

<p>Ahora que creó archivos de host virtuales, los habilitará para que Apache sepa presentarlos a los visitantes. Para lograrlo, cree un enlace simbólico para cada host virtual en el directorio <code>sites-enabled</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ln -s /etc/httpd/sites-available/<span class="highlight">example.com</span>.conf /etc/httpd/sites-enabled/<span class="highlight">example.com</span>.conf
</li></ul></code></pre>
<p>Su host virtual  quedará, así, configurado y listo para ofrecer contenido. Antes de reiniciar el servicio de Apache, nos aseguraremos de que a través de SELinux se implementen las políticas correctas para sus hosts virtuales.</p>

<h2 id="paso-5-ajustar-los-permisos-de-selinux-para-hosts-virtuales-recomendado">Paso 5: Ajustar los permisos de SELinux para hosts virtuales (recomendado)</h2>

<p><a href="https://www.digitalocean.com/community/tutorial_series/an-introduction-to-selinux-on-centos-7">SELinux</a> está configurado para funcionar con la configuración predeterminada de Apache. Dado que configuró un directorio de registro personalizado en el archivo de configuración de hosts virtuales, verá un mensaje de error si intenta iniciar el servicio de Apache. Para resolver esto, deberá actualizar las políticas SELinux a fin de permitir que Apache escriba en los archivos necesarios. SELinux aporta mayor seguridad a su entorno de CentOS 7. Por lo tanto, no se recomienda desactivar por completo el módulo del kernel.</p>

<p>Existen diferentes formas de configurar políticas según las necesidades de su entorno, ya que SELinux le permite personalizar su nivel de seguridad. En este paso se abarcarán dos métodos de ajuste de políticas de Apache: el universal y el que se aplica a un directorio específico. Ajustar políticas en directorios es más seguro y, por lo tanto, es el enfoque recomendado.</p>

<h3 id="ajustar-políticas-de-apache-de-forma-universal">Ajustar políticas de Apache de forma universal</h3>

<p>Establecer la política de Apache de forma universal indicará a SELinux que trate de forma idéntica todos los procesos de Apache usando el booleano <code>httpd_unified</code>. Si bien este enfoque es más conveniente, no le brindará el mismo nivel de control que uno centrado en una política de archivos o directorios.</p>

<p>Ejecute el siguiente comando para configurar una política universal de Apache:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo setsebool -P httpd_unified 1
</li></ul></code></pre>
<p>El comando <code>setsebool</code> cambia los valores booleanos de SELinux. El marcador <code>-P</code> actualizará el valor de tiempo de inicio y hará que este cambio persista en los reinicios. <code>httpd_unified</code> es el booleano que indicará a SELinux que trate todos los procesos de Apache como el mismo tipo, por lo que lo habrá habilitado con un valor de <code>1</code>.</p>

<h3 id="ajustar-políticas-de-apache-en-un-directorio">Ajustar políticas de Apache en un directorio</h3>

<p>Configurar individualmente los permisos de SELinux para el directorio <code>/var/www/<span class="highlight">example.com</span>/</code>log le brindará mayor control sobre sus políticas de Apache, pero también puede requerir más mantenimiento. Debido a que esta opción no establece políticas de forma universal, deberá fijar de forma manual el tipo de contexto para cualquier nuevo directorio de registro especificado en sus configuraciones de host virtuales.</p>

<p>Primero, compruebe el tipo de contexto que SELinux dio al directorio <code>/var/www/<span class="highlight">example.com</span>/log</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ls -dZ /var/www/<span class="highlight">example.com</span>/log/
</li></ul></code></pre>
<p>Este comando enumera e imprime el contexto de SELinux del directorio. El resultado debe ser similar a lo siguiente:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>drwxr-xr-x. root root unconfined_u:object_r:<span class="highlight">httpd_sys_content_t</span>:s0 /var/www/<span class="highlight">example.com</span>/log/
</code></pre>
<p>El contexto actual es <code>httpd_sys_content_t</code>, que indica a SELinux que el proceso de Apache solo puede leer archivos creados en este directorio. A través de este tutorial, cambiará el tipo de contexto del directorio <code>/var/www/<span class="highlight">example.com</span>/log</code> a <code>httpd_log_t</code>. Este tipo permitirá que Apache genere archivos de registro de la aplicación web y realice anexos a ellos:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo semanage fcontext -a -t <span class="highlight">httpd_log_t</span> "/var/www/<span class="highlight">example.com</span>/log(/.*)?"
</li></ul></code></pre>
<p>A continuación, utilice el comando <code>restorecon</code> para aplicar estos cambios y hacer que persistan a través de los reinicios:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo restorecon -R -v /var/www/<span class="highlight">example.com</span>/log
</li></ul></code></pre>
<p>El indicador <code>-R</code> ejecuta este comando de forma recursiva, lo que significa que actualizará cualquier archivo existente para que utilice el nuevo contexto. El indicador <code>-v</code> imprimirá los cambios de contexto realizados por el comando. Verá el siguiente resultado que confirma los cambios:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>restorecon reset /var/www/example.com/log context unconfined_u:object_r:<span class="highlight">httpd_sys_content_t</span>:s0-&gt;unconfined_u:object_r:<span class="highlight">httpd_log_t</span>:s0
</code></pre>
<p>Puede enumerar los contextos una vez más para ver los cambios:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ls -dZ /var/www/<span class="highlight">example.com</span>/log/
</li></ul></code></pre>
<p>El resultado refleja el tipo de contexto actualizado:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>drwxr-xr-x. root root unconfined_u:object_r:<span class="highlight">httpd_log_t</span>:s0 /var/www/<span class="highlight">example.com</span>/log
</code></pre>
<p>Ahora que el directorio <code>/var/www/<span class="highlight">example.com</span>/log</code> usa el tipo <code>httpd_log_t</code>, estará listo para probar su configuración de host virtual.</p>

<h2 id="paso-6-probar-el-host-virtual-recomendado">Paso 6: Probar el host virtual (recomendado)</h2>

<p>Una vez que el contexto se SELinux se haya actualizado con cualquiera de los métodos, Apache podrá realizar tareas de escritura en el directorio <code>/var/www/<span class="highlight">example.com</span>/log</code>. Ahora podrá reiniciar con éxito el servicio de Apache:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart httpd
</li></ul></code></pre>
<p>Enumere el contenido del directorio <code>/var/www/<span class="highlight">example.com</span>/log</code> para ver si Apache creó los archivos de registro:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ls -lZ /var/www/<span class="highlight">example.com</span>/log
</li></ul></code></pre>
<p>Verá que Apache pudo crear los archivos <code>error.log</code> y <code>requests.log</code> especificados en la configuración del host virtual:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>-rw-r--r--. 1 root root 0 Feb 26 22:54 error.log
-rw-r--r--. 1 root root 0 Feb 26 22:54 requests.log
</code></pre>
<p>Ahora que tiene su host virtual configurado y los permisos SELinux actualizados, Apache proporcionará su nombre de dominio. Puede comprobarlo visitando <code>http://<span class="highlight">example.com</span></code>, donde debería ver algo como esto:</p>

<p><img src="https://assets.digitalocean.com/articles/CART-65406/virtual_host_success.png" alt="¡Éxito! ¡El host virtual example.com funciona!"></p>

<p>Esto confirma que su host virtual está correctamente configurado y ofrece contenido. Repita los pasos 4 y 5 para crear nuevos hosts virtuales con permisos de SELinux para dominios adicionales.</p>

<h2 id="conclusión">Conclusión</h2>

<p>A través de este tutorial, instaló y gestionó el servidor web de Apache. Ahora que ha instaló su servidor web, dispone de varias opciones respecto del tipo de contenido que puede ofrecer y de las tecnologías que puede utilizar para crear una experiencia más completa.</p>

<p>Si desea construir una pila de aplicaciones más completa, puede consultar este artículo sobre cómo configurar una <a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-apache-mysql-php-lamp-stack-on-centos-7#step-four-%E2%80%94-test-php-processing-on-your-web-server">pila LAMP en CentOS 7</a>.</p>
