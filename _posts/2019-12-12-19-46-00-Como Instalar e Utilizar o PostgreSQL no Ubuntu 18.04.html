---
layout: post
title: Como Instalar e Utilizar o PostgreSQL no Ubuntu 18.04
network: digitalocean
date: December 12, 2019 at 07:46PM
url: https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-18-04-pt
image: http://ifttt.com/images/no_image_card.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="introdução">Introdução</h3>

<p>Sistemas de gerenciamento de banco de dados relacionados são um componente fundamental de muitos sites e aplicativos. Eles fornecem uma maneira estruturada de armazenar, organizar e acessar informações.</p>

<p>O <a href="https://www.postgresql.org/">PostgreSQL</a>ou Postgres é um sistema de gerenciamento de banco de dados relacionados que fornece uma implementação da linguagem estruturada SQL. É uma escolha popular para muitos projetos pequenos e grandes e tem a vantagem de ser compatível com padrões e ter muitas funcionalidades avançadas como transações confiáveis e simultaneidade sem bloqueios de leitura.</p>

<p>Este guia demonstra como instalar o Postgres em uma instância Ubuntu 18.04 VPS e também fornece instruções para a administração básica de banco de dados.</p>

<h2 id="pré-requisitos">Pré-requisitos</h2>

<p>Para acompanhar este tutorial, você precisará de um servidor Ubuntu 18.04 que tenha sido configurado seguindo nosso guia <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-18-04">Configuração Inicial de Servidor para Ubuntu 18.04</a>[. Após concluir este tutorial pré-requisito, seu servidor deve ter um usuário não-<strong>root</strong> com permissões sudo e um firewall básico.</p>

<h2 id="passo-1-—-instalando-o-postgresql">Passo 1 — Instalando o PostgreSQL</h2>

<p>Os repositórios padrão do Ubuntu contêm pacotes Postgres, para que você possa instalar esses usando o sistema de empacotamento <code>apt</code>.</p>

<p>Uma vez que essa é a primeira vez que você usa o <code>apt</code> nesta sessão, atualize seu índice de pacotes local. Então, instale o pacote Postgres jutamente com um pacote <code>-contrib</code> que adiciona alguns serviços e funcionalidade adicionais:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt update
</li><li class="line" prefix="$">sudo apt install postgresql postgresql-contrib
</li></ul></code></pre>
<p>Agora que o software está instalado, podemos examinar como ele funciona e como ele pode ser diferente de sistemas similares de gerenciamento de banco de dados que você possa ter usado.</p>

<h2 id="passo-2-—-usando-as-roles-postgresql-e-bancos-de-dados">Passo 2 — Usando as Roles PostgreSQL e Bancos de Dados</h2>

<p>Por padrão, o Postgres usa um conceito chamado &ldquo;roles&rdquo; para lidar com a autenticação e autorização. Essas são, de certa forma, semelhantes a contas regulares estilo Unix, mas o Postgres não distingue entre os usuários e os grupos e, ao invés disso, prefere o termo &ldquo;role&rdquo; mais flexível.</p>

<p>Após a instalação, o Postgres é configurado para usar a autenticação <em>ident</em>, o que significa que ele associa os roles com uma conta do sistema Unix/Linux que combine. Se um role existe no Postgres, um nome de usuário Unix/Linux com o mesmo nome é capaz de fazer login como aquele role.</p>

<p>O procedimento de instalação criou uma conta de usuário chamada <strong>postgres</strong> que está associada ao role padrão do Postgres. Para utilizar o Postgres, você pode logar naquela conta.</p>

<p>Existem algumas maneiras de utilizar essa conta para acessar o Postgres.</p>

<h3 id="mudando-para-a-conta-postgres">Mudando para a Conta postgres</h3>

<p>Mude para a conta <strong>postgres</strong> no seu servidor digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo -i -u postgres
</li></ul></code></pre>
<p>Agora você pode acessar um prompt Postgres imediatamente digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">psql
</li></ul></code></pre>
<p>Isso irá logar você no prompt do PostgreSQL, e daqui você está livre para interagir com o sistema de gerenciamento de banco de dados imediatamente.</p>

<p>Saia do prompt do PostgreSQL digitando:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="postgres=#">\q
</li></ul></code></pre>
<p>Isso irá trazer você de volta ao prompt de comando do Linux <code>postgres</code>.</p>

<h3 id="acessando-um-prompt-do-postgres-sem-mudar-de-contas">Acessando um Prompt do Postgres Sem Mudar de Contas</h3>

<p>Você também pode executar o comando que você quiser com a conta <strong>postgres</strong> diretamente com o <code>sudo</code>.</p>

<p>Por exemplo, no último exemplo, você foi instruído a ir ao prompt do Postgres trocando primeiramente para o usuário <strong>postgres</strong> e então executando o <code>psql</code> para abrir o prompt do Postgres. Você poderia fazer isso em um passo executando o comando único <code>psql</code> como usuário <strong>postgres</strong> com <code>sudo</code>, dessa forma:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo -u postgres psql
</li></ul></code></pre>
<p>Isso irá logar você diretamente no Postgres sem o shell <code>bash</code> intermediário.</p>

<p>Novamente, você pode sair da sessão interativa Postgres digitando:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="postgres=#">\q
</li></ul></code></pre>
<p>Muitas formas de uso requerem mais de um role Postgres. Leia para aprender a configurá-los.</p>

<h2 id="passo-3-—-criando-um-novo-role">Passo 3 — Criando um Novo Role</h2>

<p>Atualmente, você tem o role <strong>postgres</strong> configurado no banco de dados. Você pode criar novos roles na linha de comando com o comando <code>createrole</code>. A flag <code>--interactive</code> irá te solicitar o nome do novo role e também perguntar se ele deveria ter permissões de superusuário.</p>

<p>Se você estiver logado com a conta <strong>postgres</strong>, você pode criar um novo usuário digitando:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="postgres@server:~$">createuser --interactive
</li></ul></code></pre>
<p>Se, ao invés disso, você preferir usar o <code>sudo</code> para cada comando sem mudar da sua conta usual, digite:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo -u postgres createuser --interactive
</li></ul></code></pre>
<p>O script irá te solicitar algumas escolhas e, com base nas suas respostas, executar os comandos corretos do Postgres para criar um usuário nas suas especificações.</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Enter name of role to add: <span class="highlight">sammy</span>
Shall the new role be a superuser? (y/n) <span class="highlight">y</span>
</code></pre>
<p>Você pode ter mais controle passando algumas bandeiras adicionais. Verifique as opções olhando para a página <code>man</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">man createuser
</li></ul></code></pre>
<p>Sua instalação do Postgres agora tem um novo usuário, mas você ainda não adicionou nenhum banco de dados. A próxima seção descreve este processo.</p>

<h2 id="passo-4-—-criando-um-novo-banco-de-dados">Passo 4 — Criando um Novo Banco de Dados</h2>

<p>Outra suposição que o sistema de autenticação do Postgres faz por padrão é que para qualquer role usado para logar, esse role terá um banco de dados com o mesmo nome que ele pode acessar.</p>

<p>Isso significa que, se o usuário que você criou na última seção for chamado <strong>sammy</strong>, esse role irá tentar se conectar a um banco de dados que também seja chamado &ldquo;sammy&rdquo; por padrão. Você pode criar o banco de dados apropriado com o comando <code>createdb</code>.</p>

<p>Se você estiver logado com a conta <strong>postgres</strong>, você digitaria algo como:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="postgres@server:~$">createdb <span class="highlight">sammy</span>
</li></ul></code></pre>
<p>Se, ao invés disso, você preferir usar o <code>sudo</code> para cada comando sem mudar da sua conta usual, você digitaria:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo -u postgres createdb <span class="highlight">sammy</span>
</li></ul></code></pre>
<p>Esta flexibilidade proporciona vários caminhos para a criação de bancos de dados conforme necessário.</p>

<h2 id="passo-5-—-abrindo-um-prompt-do-postgres-com-o-novo-role">Passo 5 — Abrindo um Prompt do Postgres com o Novo Role</h2>

<p>Para logar com a autenticação baseada no <code>ident</code>, você precisará de um usuário Linux com o mesmo nome que seu role e banco de dados do Postgres.</p>

<p>Se você não tiver um usuário do Linux que combine disponível, você pode criar um com o comando <code>adduser</code>. Você terá que fazer isso através da sua conta não-<strong>root</strong> com privilégios <code>sudo</code> (ou seja, não logado como o usuário <strong>postgres</strong>):</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo adduser <span class="highlight">sammy</span>
</li></ul></code></pre>
<p>Uma vez que essa nova conta estiver disponível, você pode ou mudar e se conectar ao banco de dados digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo -i -u <span class="highlight">sammy</span>
</li><li class="line" prefix="$">psql
</li></ul></code></pre>
<p>Ou você pode fazer isso em linha:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo -u <span class="highlight">sammy</span> psql
</li></ul></code></pre>
<p>Este comando irá logar você automaticamente, supondo que todos os componentes tenham sido configurados corretamente.</p>

<p>Se você quiser que seu usuário se conecte a um banco de dados diferente, você pode fazer isso especificando o banco de dados dessa forma:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">psql -d <span class="highlight">postgres</span>
</li></ul></code></pre>
<p>Uma vez logado, você pode verificar sua informação de conexão atual digitando:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="sammy=#">\conninfo
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>You are connected to database "sammy" as user "sammy" via socket in "/var/run/postgresql" at port "5432".
</code></pre>
<p>Isso é útil se você estiver se conectando a bancos de dados fora do padrão ou com usuários que não sejam padrão.</p>

<h2 id="passo-6-—-criando-e-deletando-tabelas">Passo 6 — Criando e Deletando Tabelas</h2>

<p>Agora que você sabe se conectar ao sistema de banco de dados do PostgreSQL, você pode aprender algumas tarefas básicas de gerenciamento do Postgres.</p>

<p>Primeiro, crie uma tabela para armazenar alguns dados. Como um exemplo, uma tabela que descreva alguns equipamentos do playground.</p>

<p>A sintaxe básica para este comando é a seguinte:</p>
<pre class="code-pre "><code langs="">CREATE TABLE <span class="highlight">table_name</span> (
    <span class="highlight">column_name1 col_type</span> (<span class="highlight">field_length</span>) <span class="highlight">column_constraints</span>,
    <span class="highlight">column_name2 col_type</span> (<span class="highlight">field_length</span>),
    <span class="highlight">column_name3 col_type</span> (<span class="highlight">field_length</span>)
);
</code></pre>
<p>Como você pode ver, esses comandos dão à tabela um nome e então definem as colunas, além do tipo de coluna e o comprimento máximo dos dados do campo. Você também pode adicionar de modo opcional tabelas de restrições para cada coluna.</p>

<p>Você pode aprender mais sobre <a href="https://digitalocean.com/community/articles/how-to-create-remove-manage-tables-in-postgresql-on-a-cloud-server">como criar e gerenciar tabelas no Postgres</a> aqui.</p>

<p>Para fins demonstrativos, crie uma tabela simples como essa:</p>
<pre class="code-pre "><code langs="">CREATE TABLE playground (
    equip_id serial PRIMARY KEY,
    type varchar (50) NOT NULL,
    color varchar (25) NOT NULL,
    location varchar(25) check (location in ('north', 'south', 'west', 'east', 'northeast', 'southeast', 'southwest', 'northwest')),
    install_date date
);
</code></pre>
<p>Estes comandos criarão uma tabela que inventaria o equipamento do playground. Isso começa com um ID do equipamento que é do tipo <code>serial</code>. Este tipo de dado é um número inteiro de incremento automático. Você também deu a essa coluna a restrição da <code>primary key</code>, que significa que os valores devem ser únicos e não nulos.</p>

<p>Para duas das colunas (<code>equip_id</code> e <code>install_date</code>), os comandos não especificam um comprimento de campo. Isso é porque alguns tipos de coluna não requerem um comprimento específico porque o comprimento é implícito pelo tipo.</p>

<p>Os dois comandos seguintes criam colunas para o <code>type</code> e <code>color</code> do equipamento respectivamente, cada um dos quais não pode ser vazio. O comando seguinte a esses cria uma coluna <code>location</code> e cria uma restrição que exige que o valor seja um de oito valores possíveis. O último comando cria uma coluna de data que grava a data na qual você instalou o equipamento.</p>

<p>Você pode ver sua nova tabela digitando:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="sammy=#">\d
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>                  List of relations
 Schema |          Name           |   Type   | Owner 
--------+-------------------------+----------+-------
 public | playground              | table    | sammy
 public | playground_equip_id_seq | sequence | sammy
(2 rows)
</code></pre>
<p>Sua tabela do playground está aqui, mas também há algo chamado <code>playground_equip_id_seq</code> que é do tipo <code>sequence</code>. Esta é uma representação do tipo <code>serial</code> que você deu à sua coluna <code>equip_id</code> Isso mantém o rastro do próximo número na sequência e é criado automaticamente para colunas deste tipo.</p>

<p>Se você quiser ver apenas a tabela sem a sequência, você pode digitar:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="sammy=#">\dt
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>          List of relations
 Schema |    Name    | Type  | Owner 
--------+------------+-------+-------
 public | playground | table | sammy
(1 row)
</code></pre>
<h2 id="passo-7-—-adicionando-consultando-e-deletando-dados-em-uma-tabela">Passo 7 — Adicionando, Consultando e Deletando Dados em uma Tabela</h2>

<p>Agora que você tem uma tabela, você pode inserir alguns dados nela.</p>

<p>Como um exemplo, adicione um slide e um swing chamando a tabela na qual você queira adicionar, nomeando as colunas e então fornecendo dados para cada coluna, desta forma:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="sammy=#">INSERT INTO playground (type, color, location, install_date) VALUES ('slide', 'blue', 'south', '2017-04-28');
</li><li class="line" prefix="sammy=#">INSERT INTO playground (type, color, location, install_date) VALUES ('swing', 'yellow', 'northwest', '2018-08-16');
</li></ul></code></pre>
<p>Você deve tomar cuidado ao introduzir os dados para evitar alguns problemas comuns. Por exemplo, não envolva os nomes das colunas em aspas, mas os valores de coluna que você digitar precisam de aspas.</p>

<p>Outra coisa para ficar atento é não digitar um valor para a coluna <code>equip_id</code>. Isso acontece porque isso é gerado automaticamente sempre que uma nova linha na tabela seja criada.</p>

<p>Recupere a informação que você adicionou digitando:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="sammy=#">SELECT * FROM playground;
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div> equip_id | type  | color  | location  | install_date 
----------+-------+--------+-----------+--------------
        1 | slide | blue   | south     | 2017-04-28
        2 | swing | yellow | northwest | 2018-08-16
(2 rows)
</code></pre>
<p>Aqui, você pode ver que seu <code>equip_id</code> foi preenchido com sucesso e que todos os seus outros dados foram organizados corretamente.</p>

<p>Se o slide no playground falhar e você tiver que removê-lo, você também pode remover a linha da sua tabela digitando:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="sammy=#">DELETE FROM playground WHERE type = 'slide';
</li></ul></code></pre>
<p>Consulte a tabela novamente:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="sammy=#">SELECT * FROM playground;
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div> equip_id | type  | color  | location  | install_date 
----------+-------+--------+-----------+--------------
        2 | swing | yellow | northwest | 2018-08-16
(1 row)
</code></pre>
<p>Você percebe que seu slide já não é uma parte da tabela.</p>

<h2 id="passo-8-—-adicionando-e-deletando-colunas-de-uma-tabela">Passo 8 — Adicionando e Deletando Colunas de uma Tabela</h2>

<p>Após criar uma tabela, você pode modificá-la para adicionar ou remover colunas com facilidade. Adicione uma coluna para mostrar a última visita de manutenção para cada peça de equipamento digitando:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="sammy=#">ALTER TABLE playground ADD last_maint date;
</li></ul></code></pre>
<p>Se você ver sua informação da tabela novamente, você verá que a nova coluna foi adicionada (mas nenhum dado foi adicionado):</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="sammy=#">SELECT * FROM playground;
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div> equip_id | type  | color  | location  | install_date | last_maint 
----------+-------+--------+-----------+--------------+------------
        2 | swing | yellow | northwest | 2018-08-16   | 
(1 row)
</code></pre>
<p>Deletar uma coluna é também bastante simples. Se você descobrir que sua equipe de trabalho usa uma ferramenta separada para acompanhar o histórico de manutenção, você pode deletar da coluna digitando:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="sammy=#">ALTER TABLE playground DROP last_maint;
</li></ul></code></pre>
<p>Isso apaga a coluna <code>last_maint</code> e quaisquer valores encontrados nela, mas deixa todos os outros dados intactos.</p>

<h2 id="passo-9-—-atualizando-os-dados-em-uma-tabela">Passo 9 — Atualizando os Dados em uma Tabela</h2>

<p>Até agora, você aprendeu a adicionar registros a uma tabela e como deletá-los, mas este tutorial ainda não cobriu como modificar os itens existentes.</p>

<p>Você pode atualizar os valores de um item existente consultando o registro que você quiser e definindo a coluna para o valor que você deseja usar. Você pode consultar o registro &ldquo;swing&rdquo; (isto irá corresponder a <em>cada</em> swing na sua tabela) e alterar sua cor para &ldquo;vermelho&rdquo;. Isso pode ser útil se você der ao conjunto swing um trabalho de pintura:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="sammy=#">UPDATE playground SET color = 'red' WHERE type = 'swing';
</li></ul></code></pre>
<p>Você pode verificar se a operação foi bem sucedida consultando os dados novamente:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="sammy=#">SELECT * FROM playground;
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div> equip_id | type  | color | location  | install_date 
----------+-------+-------+-----------+--------------
        2 | swing | red   | northwest | 2010-08-16
(1 row)
</code></pre>
<p>Como você pode ver, seu slide agora está registrado como sendo vermelho.</p>

<h2 id="conclusão">Conclusão</h2>

<p>Você agora está com o PostgreSQL  configurado no seu servidor Ubuntu 18.04. No entanto, ainda há <em>muito</em> mais a aprender com o Postgres. Aqui estão mais alguns guias que cobrem como usar o Postgres:</p>

<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/sqlite-vs-mysql-vs-postgresql-a-comparison-of-relational-database-management-systems">Uma comparação com sistemas de gerenciamento de banco de dados relacionados</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-create-remove-manage-tables-in-postgresql-on-a-cloud-server">Aprenda como criar e gerenciar tabelas com o Postgres</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-use-roles-and-manage-grant-permissions-in-postgresql-on-a-vps--2">Melhore sua capacidade de gerenciamento de roles e permissões</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-create-data-queries-in-postgresql-by-using-the-select-command">Crie consultas com o Postgres com Select</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-secure-postgresql-on-an-ubuntu-vps">Aprenda a proteger o PostgreSQL</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-backup-postgresql-databases-on-an-ubuntu-vps">Aprenda como fazer um backup de um banco de dados Postgres</a></li>
</ul>
