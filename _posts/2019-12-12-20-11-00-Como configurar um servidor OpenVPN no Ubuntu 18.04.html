---
layout: post
title: Como configurar um servidor OpenVPN no Ubuntu 18.04
network: digitalocean
date: December 12, 2019 at 08:11PM
url: https://www.digitalocean.com/community/tutorials/how-to-set-up-an-openvpn-server-on-ubuntu-18-04-pt
image: https://assets.digitalocean.com/articles/openvpn_ubunutu/1.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<p><em>Uma versão anterior deste tutorial foi escrita por <a href="https://www.digitalocean.com/community/users/jellingwood">Justin Ellingwood.</a></em></p>

<h3 id="introdução">Introdução</h3>

<p>Quer acessar a Internet com segurança do seu smartphone ou notebook, enquanto estiver conectado a uma rede não confiável como o Wi-Fi de um hotel ou café? Uma <a href="https://en.wikipedia.org/wiki/Virtual_private_network">Virtual Private Network</a> (VPN) permite que você atravesse redes não confiáveis com privacidade e segurança como se estivesse em uma rede privada. O tráfego emerge do servidor VPN e continua sua jornada para o destino.</p>

<p>Quando combinado com <a href="https://en.wikipedia.org/wiki/HTTP_Secure">conexões HTTPS</a>, esta configuração permite que você proteja seus logins e transações sem fio. Você pode contornar restrições geográficas e de censura, e proteger seu local e qualquer tráfego HTTP não criptografado da rede não confiável.</p>

<p>O <a href="https://openvpn.net">OpenVPN</a> é uma solução VPN de código aberto Secure Socket Layer (SSL) completa que acomoda uma ampla gama de configurações. Neste tutorial, você irá configurar um servidor OpenVPN em um servidor Ubuntu 18.04 e, em seguida, irá configurar o acesso a ele do Windows, macOS, iOS e/ou Android. Este tutorial irá manter os passos de instalação e configuração o mais simples possível para cada uma dessas configurações.</p>

<span class='note'><p>
<strong>Nota:</strong> Se você planeja configurar um servidor OpenVPN em um Droplet DigitalOcean, fique ciente de que nós, como muitos provedores de hospedagem, cobramos por excesso de largura de banda. Por este motivo, tenha cuidado acerca de com quanto tráfego seu servidor está lidando.</p>

<p>Veja <a href="https://www.digitalocean.com/docs/accounts/billing/bandwidth/">esta página</a> para maiores informações.<br></p></span>

<h2 id="pré-requisitos">Pré-requisitos</h2>

<p>Para completar este tutorial, você precisará de acesso a um servidor Ubuntu 18.04 para hospedar seu serviço OpenVPN. Você precisará configurar um usuário não <strong>root</strong> com privilégios <code>sudo</code> antes de iniciar este guia. Você pode seguir nosso <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-18-04">guia de configuração inicial do servidor Ubuntu 18.04</a> para configurar um usuário com permissões apropriadas. O tutorial em questão também irá configurar um <strong>firewall</strong>, que assumimos que esteja em funcionamento durante todo este guia.</p>

<p>Além disso, você precisará de uma máquina separada para servir como sua autoridade de certificação (CA). Embora seja tecnicamente possível usar seu servidor OpenVPN ou sua máquina local como sua CA, isso não é recomendado pois abre seu VPN para algumas vulnerabilidades de segurança. Baseando-se na <a href="https://openvpn.net/index.php/open-source/documentation/">documentação oficial do OpenVPN</a>, você deve colocar sua CA em uma máquina autônoma que seja dedicada a importar e assinar pedidos de certificado. Por isso, este guia supõe que seu CA esteja em um servidor Ubuntu 18.04 separado que também tenha um usuário não <strong>root</strong> com privilégios <code>sudo</code> e um firewall básico.</p>

<p>Note que se você desativar a autenticação por senha enquanto configurar esses servidores, poderá ter dificuldades ao transferir arquivos entre eles mais tarde neste guia. Para resolver este problema, você pode reativar a autenticação por senha em cada servidor. Como alternativa, você poderia gerar um par de chaves SSH para cada servidor, então adicionar a chave SSH pública do servidor OpenVPN no arquivo CA <code>authorized_keys</code> da máquina e vice-versa. Veja <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys-on-ubuntu-1804">Como configurar as chaves SSH no Ubuntu 18.04</a> para instruções sobre como utilizar qualquer uma dessas soluções.</p>

<p>Quando tiver esses pré-requisitos funcionando, siga para o Passo 1 deste tutorial.</p>

<h2 id="passo-1-—-instalando-o-openvpn-e-o-easyrsa">Passo 1 — Instalando o OpenVPN e o EasyRSA</h2>

<p>Para começar, atualize o índice de pacotes do seu <strong>servidor VPN</strong> e instale o OpenVPN. O OpenVPN está disponível nos repositórios padrão do Ubuntu, então você pode usar o <code>apt</code> para a instalação:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt update
</li><li class="line" prefix="$">sudo apt install openvpn
</li></ul></code></pre>
<p>O OpenVPN é um VPN TLS/SSL. Isso significa que o OpenVPN utiliza os certificados para criptografar o tráfego entre o servidor e os clientes. Para emitir certificados confiáveis, você irá configurar sua própria autoridade de certificação (CA) simplificada. Para fazer isso, vamos baixar a última versão do EasyRSA, que vamos usar para construir nossa infraestrutura de chaves públicas (PKI) CA, do repositório oficial do projeto no GitHub.</p>

<p>Como mencionado nos pré-requisitos, vamos construir a CA em um servidor autônomo. A razão para esta abordagem é que, se um agressor fosse capaz de se infiltrar no seu servidor, eles seriam capazes de acessar sua chave privada CA e usá-la para assinar novos certificados, dando-lhes acesso ao seu VPN. Dessa forma, gerenciar a CA a partir de uma máquina autônoma ajuda a evitar que usuários não autorizados acessem seu VPN. Note também que é recomendado que você mantenha o servidor CA desligado quando não estiver sendo usado para assinar chaves como uma medida de precaução adicional.</p>

<p>Para começar a construir a infraestrutura CA e PKI, utilize o <code>wget</code> para baixar a última versão do EasyRSA <strong>tanto na máquinas CA quanto no seu servidor OpenVPN</strong>. Para obter a última versão, vá até a página <a href="https://github.com/OpenVPN/easy-rsa/releases"><strong>Releases</strong> no projeto oficial do EasyRSA no GitHub</a>, copie o link de download para o arquivo que termina em <code>.tgz</code> e então cole-o no seguinte comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">wget -P ~/ <span class="highlight">https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.4/EasyRSA-3.0.4.tgz</span>
</li></ul></code></pre>
<p>Então, extraia o tarball:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd ~
</li><li class="line" prefix="$">tar xvf EasyRSA-<span class="highlight">3.0.4</span>.tgz
</li></ul></code></pre>
<p>Você instalou todos os softwares necessários com sucesso no seu servidor e máquina CA. Continue para configurar as variáveis usadas pelo EasyRSA e configurar um diretório CA, do qual você irá gerar as chaves e certificados necessários para que seu servidor e clientes acessem o VPN.</p>

<h2 id="passo-2-—-configurando-as-variáveis-do-easyrsa-e-construindo-a-ca">Passo 2 — Configurando as variáveis do EasyRSA e construindo a CA</h2>

<p>O EasyRSA vem instalado com um arquivo de configuração que você pode editar para definir uma série de variáveis para sua CA.</p>

<p>Na sua <strong>máquina CA</strong>, navegue até o diretório do EasyRSA:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd ~/EasyRSA-<span class="highlight">3.0.4</span>/
</li></ul></code></pre>
<p>Dentro deste diretório há um arquivo chamado <code>vars.example</code>. Faça uma cópia deste arquivo, e dê à cópia o nome de <code>vars</code> sem uma extensão de arquivo:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cp vars.example vars
</li></ul></code></pre>
<p>Abra este novo arquivo com seu editor de texto preferido:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano vars
</li></ul></code></pre>
<p>Encontre as configurações que definam padrões de campo para novos certificados. Eles se parecerão com isso:</p>
<div class="code-label " title="~/EasyRSA-3.0.4/vars">~/EasyRSA-3.0.4/vars</div><pre class="code-pre  second-environment"><code langs="">. . .

#set_var EASYRSA_REQ_COUNTRY    "US"
#set_var EASYRSA_REQ_PROVINCE   "California"
#set_var EASYRSA_REQ_CITY       "San Francisco"
#set_var EASYRSA_REQ_ORG        "Copyleft Certificate Co"
#set_var EASYRSA_REQ_EMAIL      "me@example.net"
#set_var EASYRSA_REQ_OU         "My Organizational Unit"

. . .
</code></pre>
<p>Descomente essas linhas e atualize os valores destacados para os que preferir, mas não os deixe em branco:</p>
<div class="code-label " title="~/EasyRSA-3.0.4/vars">~/EasyRSA-3.0.4/vars</div><pre class="code-pre  second-environment"><code langs="">. . .

set_var EASYRSA_REQ_COUNTRY    "<span class="highlight">US</span>"
set_var EASYRSA_REQ_PROVINCE   "<span class="highlight">NewYork</span>"
set_var EASYRSA_REQ_CITY       "<span class="highlight">New York City</span>"
set_var EASYRSA_REQ_ORG        "<span class="highlight">DigitalOcean</span>"
set_var EASYRSA_REQ_EMAIL      "<span class="highlight">admin@example.com</span>"
set_var EASYRSA_REQ_OU         "<span class="highlight">Community</span>"

. . .
</code></pre>
<p>Quando você terminar, salve e feche o arquivo.</p>

<p>Dentro do diretório do EasyRSA está um script chamado <code>easyrsa</code> que é chamado para realizar uma variedade de tarefas envolvidas com a construção e gerenciamento da CA. Execute este script com a opção <code>init-pki</code> para iniciar a infraestrutura de chaves pública no servidor CA:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa init-pki
</li></ul></code></pre><pre class="code-pre  second-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>. . .
init-pki complete; you may now create a CA or requests.
Your newly created PKI dir is: /home/<span class="highlight">sammy</span>/EasyRSA-<span class="highlight">3.0.4</span>/pki
</code></pre>
<p>Depois disso, chame o script <code>easyrsa</code> novamente, seguindo-o com a opção <code>build-ca</code>. Isso irá construir a CA e criar dois arquivos importantes — <code>ca.crt</code> e <code>ca.key</code> — que constituem os lados público e privado de um certificado SSL.</p>

<ul>
<li>O <code>ca.crt</code> é o arquivo de certificado público CA que, no contexto do OpenVPN, é usado pelo servidor e pelo cliente para informar um ao outro que fazem parte da mesma rede de confiança e não são alguém executando um ataque man-in-the-middle. Por essa razão, seu servidor e todos os seus clientes precisarão de uma cópia do arquivo <code>ca.crt</code>.</li>
<li>A <code>ca.key</code> é a chave privada que a máquina CA usa para assinar chaves e certificados para servidores e clientes. Se um agressor ganha acesso à sua CA e, por sua vez, seu arquivo <code>ca.key</code>, ele poderá assinar pedidos de certificado e obter acesso ao seu VPN, impedindo sua segurança. Esse é o motivo pelo qual seu arquivo <code>ca.key</code> deve estar <strong>apenas</strong> na sua máquina CA e que, idealmente, sua máquina CA deve ser mantida off-line quando não estiver assinando pedidos de certificado como uma medida de segurança extra.</li>
</ul>

<p>Se você não quiser ser solicitado a colocar uma senha sempre que interagir com sua CA, é possível executar o comando <code>build-ca</code> com a opção <code>nopass</code>, desta maneira:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa build-ca nopass
</li></ul></code></pre>
<p>No resultado, será solicitado que você confirme o <em>nome comum</em> para sua CA:</p>
<pre class="code-pre  second-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>. . .
Common Name (eg: your user, host, or server name) [Easy-RSA CA]:
</code></pre>
<p>O nome comum é o nome usado para se referir a esta máquina no contexto da autoridade de certificados. Você pode digitar qualquer string de caracteres para o nome comum da CA mas, para simplificarmos as coisas, pressione <code>ENTER</code> para aceitar o nome padrão.</p>

<p>Com isso, sua CA está funcionando e está pronta para iniciar a assinatura de pedidos de certificados.</p>

<h2 id="passo-3-—-criando-o-certificado-de-servidor-chaves-e-arquivos-de-criptografia">Passo 3 — Criando o certificado de servidor, chaves e arquivos de criptografia</h2>

<p>Agora que tem uma CA pronta para uso, você pode gerar uma chave privada e um pedido de certificado do seu servidor e então transferir o pedido para sua CA ser assinada, criando o certificado necessário. Você também é livre para criar alguns arquivos adicionais usados durante o processo de criptografia.</p>

<p>Inicie navegando até o diretório do EasyRSA no seu <strong>servidor OpenVPN</strong>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd EasyRSA-<span class="highlight">3.0.4</span>/
</li></ul></code></pre>
<p>De lá, execute o script <code>easyrsa</code> com a opção <code>init-pki</code>. Embora você já tenha executado este comando na máquina CA, é necessário executá-lo aqui, pois seu servidor e CA terão diretórios PKI separados:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa init-pki
</li></ul></code></pre>
<p>Então, chame o script <code>easyrsa</code> novamente, desta vez com a opção <code>gen-req</code> seguida de um nome comum para a máquina. Novamente, pode ser o nome que você quiser, mas escolher um nome mais descritivo pode ser útil. Ao longo deste tutorial, o nome comum do OpenVPN será simplesmente &ldquo;server&rdquo;. Certifique-se de incluir também a opção <code>nopass</code>. Se não fizer isso, o arquivo de pedido será protegido por senha, o que pode levar a problemas de permissão mais tarde:</p>

<p><span class='note'><strong>Nota:</strong> Se escolher um nome que não seja &ldquo;server&rdquo;, você terá que ajustar algumas das instruções abaixo. Por exemplo, quando copiar os arquivos gerados para o diretório <code>/etc/openvpn</code>, terá que substituir os nomes corretos. Você também terá que modificar o arquivo <code>/etc/openvpn/server.conf</code> mais tarde para que aponte aos arquivos <code>.crt</code> e <code>.key</code> corretos.<br></span></p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa gen-req server nopass
</li></ul></code></pre>
<p>Isso criará uma chave privada para o servidor e um arquivo de pedido de certificado chamado <code>server.req</code>. Copie a chave do servidor para o diretório <code>/etc/openvpn/</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo cp ~/EasyRSA-<span class="highlight">3.0.4</span>/pki/private/server.key /etc/openvpn/
</li></ul></code></pre>
<p>Usando um método seguro (como o SCP, no nosso exemplo abaixo), transfira o arquivo <code>server.req</code> para sua máquina CA:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">scp ~/EasyRSA-3.0.4/pki/reqs/server.req <span class="highlight">sammy</span>@<span class="highlight">your_CA_ip</span>:/tmp
</li></ul></code></pre>
<p>Em seguida, na <strong>sua máquina CA</strong>, navegue até o diretório do EasyRSA:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd EasyRSA-<span class="highlight">3.0.4</span>/
</li></ul></code></pre>
<p>Utilizando o script <code>easyrsa</code> mais uma vez, importe o arquivo <code>server.req</code> seguindo o caminho do arquivo com seu nome comum:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa import-req /tmp/server.req server
</li></ul></code></pre>
<p>Então, assine o pedido executando o script <code>easyrsa</code> com a opção <code>sign-req</code>, seguida do <em>tipo de pedido</em> e do nome comum. O tipo de pedido pode ser <code>client</code> ou <code>server</code>, então para o pedido de certificado do servidor OpenVPN, certifique-se de usar o tipo de pedido do <code>server</code>:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa sign-req server server
</li></ul></code></pre>
<p>No resultado, você será solicitado a verificar se o pedido vem de uma fonte confiável. Digite <code>yes</code>, então pressione <code>ENTER</code> para confirmar:</p>
<pre class="code-pre  second-environment"><code langs="">You are about to sign the following certificate.
Please check over the details shown below for accuracy. Note that this request
has not been cryptographically verified. Please be sure it came from a trusted
source or that you have verified the request checksum with the sender.

Request subject, to be signed as a server certificate for 3650 days:

subject=
    commonName                = server


Type the word 'yes' to continue, or any other input to abort.
  Confirm request details: <span class="highlight">yes</span>
</code></pre>
<p>Caso tenha criptografado sua chave CA, você será solicitado a colocar sua senha neste ponto.</p>

<p>Em seguida, transfira o certificado assinado de volta para seu servidor VPN usando um método seguro:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">scp pki/issued/server.crt <span class="highlight">sammy</span>@<span class="highlight">your_server_ip</span>:/tmp
</li></ul></code></pre>
<p>Antes de sair da sua máquina CA, transfira também o arquivo <code>ca.crt</code> para seu servidor:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">scp pki/ca.crt <span class="highlight">sammy</span>@<span class="highlight">your_server_ip</span>:/tmp
</li></ul></code></pre>
<p>Em seguida, logue novamente no seu servidor OpenVPN e copie os arquivos <code>server.crt</code> e <code>ca.crt</code> para o seu diretório <code>/etc/openvpn/</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo cp /tmp/{server.crt,ca.crt} /etc/openvpn/
</li></ul></code></pre>
<p>Então, navegue até seu diretório do EasyRSA:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd EasyRSA-<span class="highlight">3.0.4</span>/
</li></ul></code></pre>
<p>Dali, crie uma chave Diffie-Hellman forte para usar durante a troca de chaves, digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa gen-dh
</li></ul></code></pre>
<p>Isso pode levar alguns minutos para completar. Assim que terminar, gere uma assinatura HMAC para reforçar as capacidades de verificação da integridade TLS do servidor:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">openvpn --genkey --secret ta.key
</li></ul></code></pre>
<p>Quando o comando terminar, copie os dois novos arquivos para seu diretório <code>/etc/openvpn/</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo cp ~/EasyRSA-<span class="highlight">3.0.4</span>/ta.key /etc/openvpn/
</li><li class="line" prefix="$">sudo cp ~/EasyRSA-<span class="highlight">3.0.4</span>/pki/dh.pem /etc/openvpn/
</li></ul></code></pre>
<p>Com isso, foram gerados todos os arquivos de certificado e de chave necessários pelo seu servidor. Você está pronto para criar os certificados e chaves correspondentes que sua máquina de cliente usará para acessar seu servidor OpenVPN.</p>

<h2 id="passo-4-—-gerando-um-certificado-de-cliente-e-um-par-de-chaves">Passo 4 — Gerando um certificado de cliente e um par de chaves</h2>

<p>Embora você possa gerar uma chave privada e um pedido de certificado na sua máquina de cliente e então enviá-la para a CA para ser assinada, este guia define um processo para gerar o pedido de certificado no servidor. O benefício disso é que podemos criar um script que irá gerar automaticamente arquivos de configuração do cliente que contêm todas as chaves e certificados necessários. Isso permite que você evite ter que transferir chaves, certificados e arquivos de configuração para clientes e simplifica o processo de conexão ao VPN.</p>

<p>Vamos gerar um único par, chave de cliente e certificado, para este guia. Se tiver mais de um cliente, você pode repetir este processo para cada um deles. Note, porém, que você precisará passar um valor de nome único ao script para cada cliente. Ao longo deste tutorial, o primeiro par de certificado/chave é chamado de <code>client1</code>.</p>

<p>Inicie criando uma estrutura de diretório dentro do seu diretório home para armazenar os arquivos de certificado de cliente e de chave:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">mkdir -p ~/client-configs/keys
</li></ul></code></pre>
<p>Como irá armazenar os pares de certificado/chave e arquivos de configuração dos seus clientes neste diretório, você deve bloquear suas permissões agora, como uma medida de segurança:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">chmod -R 700 ~/client-configs
</li></ul></code></pre>
<p>Em seguida, navegue até o diretório do EasyRSA e execute o script <code>easyrsa</code> com as opções <code>gen-req</code> e <code>nopass</code>, junto com o nome comum para o cliente:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd ~/EasyRSA-<span class="highlight">3.0.4</span>/
</li><li class="line" prefix="$">./easyrsa gen-req client1 nopass
</li></ul></code></pre>
<p>Pressione <code>ENTER</code> para confirmar o nome comum. Então, copie o arquivo <code>client1.key</code> para o diretório <code>/client-configs/keys/</code> que você criou mais cedo:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cp pki/private/client1.key ~/client-configs/keys/
</li></ul></code></pre>
<p>Em seguida, transfira o arquivo <code>client1.req</code> para sua máquina CA usando um método seguro:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">scp pki/reqs/client1.req <span class="highlight">sammy</span>@<span class="highlight">your_CA_ip</span>:/tmp
</li></ul></code></pre>
<p>Faça login na sua máquina CA, navegue até o diretório do EasyRSA, e importe o pedido de certificado:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ssh <span class="highlight">sammy</span>@<span class="highlight">your_CA_ip</span>
</li><li class="line" prefix="$">cd EasyRSA-<span class="highlight">3.0.4</span>/
</li><li class="line" prefix="$">./easyrsa import-req /tmp/client1.req client1
</li></ul></code></pre>
<p>Então, assine o pedido como fez para o servidor no passo anterior. Desta vez, certifique-se de especificar o tipo de pedido do <code>client</code>:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa sign-req client client1
</li></ul></code></pre>
<p>No prompt, digite <code>yes</code> para confirmar que você pretende assinar o pedido de certificado e que ele veio de uma fonte confiável:</p>
<pre class="code-pre  second-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>Type the word 'yes' to continue, or any other input to abort.
  Confirm request details: <span class="highlight">yes</span>
</code></pre>
<p>Novamente, caso tenha criptografado sua chave CA, você será solicitado a colocar sua senha aqui.</p>

<p>Isso criará um arquivo de certificado de cliente chamado <code>client1.crt</code>. Transfira este arquivo de volta para o servidor:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">scp pki/issued/client1.crt <span class="highlight">sammy</span>@<span class="highlight">your_server_ip</span>:/tmp
</li></ul></code></pre>
<p>Use o SSH de volta no seu servidor OpenVPN e copie o certificado de cliente para o diretório <code>/client-configs/keys</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cp /tmp/client1.crt ~/client-configs/keys/
</li></ul></code></pre>
<p>Em seguida, copie também os arquivos <code>ca.crt</code> e <code>ta.key</code> para o diretório <code>/client-configs/keys/</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cp ~/EasyRSA-<span class="highlight">3.0.4</span>/ta.key ~/client-configs/keys/
</li><li class="line" prefix="$">sudo cp /etc/openvpn/ca.crt ~/client-configs/keys/
</li></ul></code></pre>
<p>Com isso, todos os certificados e chaves do seu servidor e do seu cliente foram gerados e estão armazenados nos diretórios apropriados do seu servidor. Ainda existem algumas ações que precisam ser feitas com esses arquivos, mas elas aparecerão em um passo mais adiante. Por enquanto, você pode seguir em frente para configurar o OpenVPN no seu servidor.</p>

<h2 id="passo-5-—-configurando-o-serviço-openvpn">Passo 5 — Configurando o serviço OpenVPN</h2>

<p>Agora que tanto os certificados quanto as chaves do seu cliente e do seu servidor foram gerados, você pode começar a configurar o serviço OpenVPN para usar essas credenciais.</p>

<p>Inicie copiando uma amostra de um arquivo de configuração do OpenVPN para o diretório de configuração e então extraia-o para usá-lo como uma base para sua configuração:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo cp /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz /etc/openvpn/
</li><li class="line" prefix="$">sudo gzip -d /etc/openvpn/server.conf.gz
</li></ul></code></pre>
<p>Abra a configuração do servidor no seu editor de texto preferido:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/openvpn/server.conf
</li></ul></code></pre>
<p>Encontre a seção HMAC procurando a diretriz <code>tls-auth</code>. Esta linha já deve estar descomentada, mas se não estiver, remova o &ldquo;<strong>;</strong>&rdquo; para descomentá-la:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs="">tls-auth ta.key 0 # This file is secret
</code></pre>
<p>Em seguida, encontre a seção sobre cifras criptográficas, procurando as linhas comentadas <code>cipher</code>. A cifra <code>AES-256-CBC</code> oferece um bom nível de criptografia e é bastante suportada. Novamente, esta linha já deve estar descomentada, mas se não estiver remova o &ldquo;<strong>;</strong>&rdquo; anterior a ela:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs="">cipher AES-256-CBC
</code></pre>
<p>Abaixo disso, adicione uma diretriz <code>auth</code> para selecionar o algoritmo message digest HMAC. Para fazer isso, o <code>SHA256</code> é uma boa escolha:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs=""><span class="highlight">auth SHA256</span>
</code></pre>
<p>Em seguida, encontre a linha que contém uma diretriz <code>dh</code> que define os parâmetros Diffie-Hellman. Devido a algumas alterações recentes feitas no EasyRSA, o nome do arquivo para a chave Diffie-Hellman pode ser diferente do que está listado no arquivo de configuração do servidor exemplo. Se necessário, altere o nome do arquivo listado aqui removendo o <code>2048</code> para que ele se alinhe com a chave que você gerou no passo anterior:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs="">dh dh.pem
</code></pre>
<p>Por fim, encontre as configurações <code>user</code> e <code>group</code> e remova os &ldquo;<strong>;</strong>&rdquo; no começo de cada para descomentar essas linhas:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs="">user nobody
group nogroup
</code></pre>
<p>As alterações que você fez no arquivo exemplo <code>server.conf</code> até este ponto são necessárias para que o OpenVPN funcione. As alterações descritas abaixo são opcionais, embora também sejam necessárias para muitos casos de uso comum.</p>

<h3 id="opcional-forçar-alterações-no-dns-para-redirecionar-todo-o-tráfego-através-do-vpn">(Opcional) Forçar alterações no DNS para redirecionar todo o tráfego através do VPN</h3>

<p>As configurações acima criarão a conexão VPN entre as duas máquinas, mas não forçarão nenhuma conexão a usar o túnel. Se quiser usar o VPN para rotear todo o seu tráfego, você provavelmente irá querer forçar as configurações DNS para os computadores do cliente.</p>

<p>Há algumas diretrizes no arquivo <code>server.conf</code> que você deve alterar para habilitar esta funcionalidade. Encontre a seção <code>redirect-gateway</code> e remova o ponto e vírgula &ldquo;<strong>;</strong>&rdquo; do começo da linha <code>redirect-gateway</code> para descomentá-la:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs="">push "redirect-gateway def1 bypass-dhcp"
</code></pre>
<p>Logo abaixo, encontre a seção <code>dhcp-option</code>. Novamente, remova o &ldquo;<strong>;</strong>&rdquo; da frente de ambas as linhas para descomentá-las:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs="">push "dhcp-option DNS 208.67.222.222"
push "dhcp-option DNS 208.67.220.220"
</code></pre>
<p>Isso ajudará os clientes a reconfigurar suas configurações DNS para usar o túnel VPN como gateway padrão.</p>

<h3 id="opcional-ajustar-a-porta-e-o-protocolo">(Opcional) Ajustar a porta e o protocolo</h3>

<p>Por padrão, o servidor OpenVPN usa a porta <code>1194</code> e o protocolo UDP para aceitar conexões de clientes. Se precisar usar uma porta diferente, devido a ambientes de rede restritivos em que seus clientes possam estar, você pode alterar a opção <code>port</code>. Se não estiver hospedando conteúdo Web no seu servidor OpenVPN, a porta <code>443</code> é uma escolha popular, uma vez que ela é geralmente permitida em de regras de firewall.</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs=""># Optional!
port <span class="highlight">443</span>
</code></pre>
<p>Geralmente, o protocolo também é restrito a essa porta. Se for, mude o <code>proto</code> de UDP para TCP:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs=""># Optional!
proto <span class="highlight">tcp</span>
</code></pre>
<p>Se você <strong>de fato</strong> mudar o protocolo para o TCP, precisará alterar o valor <code>explicit-exit-notify</code> da diretriz de <code>1</code> para <code>0</code>, já que essa diretriz é usada apenas pelo UDP. Não fazer isso ao usar o TCP irá causar erros quando você iniciar o serviço OpenVPN:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs=""># Optional!
explicit-exit-notify <span class="highlight">0</span>
</code></pre>
<p>Se não tiver necessidade de usar uma porta e protocolos diferentes, é melhor deixar essas duas opções no seu padrão.</p>

<h3 id="opcional-apontar-para-credenciais-não-padrão">(Opcional) Apontar para credenciais não padrão</h3>

<p>Se você selecionou um nome diferente durante o comando <code>./build-key-server</code> mais cedo, modifique as linhas <code>cert</code> e <code>key</code> que você vê para apontar para os arquivos <code>.crt</code> e <code>.key</code> apropriados. Se você usou o nome padrão, &ldquo;server&rdquo;, isso já está configurado corretamente:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs="">cert <span class="highlight">server</span>.crt
key <span class="highlight">server</span>.key
</code></pre>
<p>Quando você terminar, salve e feche o arquivo.</p>

<p>Após passar e fazer as alterações na configuração OpenVPN do seu servidor que são necessárias para seu caso de uso específico, você pode começar a fazer algumas alterações na rede do seu servidor.</p>

<h2 id="passo-6-—-ajustando-a-configuração-da-rede-do-servidor">Passo 6 — Ajustando a configuração da rede do servidor</h2>

<p>Existem alguns aspectos da configuração de rede do servidor que precisam ser ajustados para que o OpenVPN possa rotear corretamente o tráfego pelo VPN. O primeiro desses é o <em>encaminhamento de IP</em>, um método para determinar onde o tráfego de IP deve ser roteado. Isso é essencial para a funcionalidade VPN que seu servidor irá fornecer.</p>

<p>Ajuste a configuração padrão de encaminhamento de IP do seu servidor, modificando o arquivo <code>/etc/sysctl.conf</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/sysctl.conf
</li></ul></code></pre>
<p>Dentro, procure a linha comentada que define o <code>net.ipv4.ip_forward</code>. Remova o caractere &ldquo;<strong>#</strong>&rdquo; do começo da linha para descomentar esta configuração:</p>
<div class="code-label " title="/etc/sysctl.conf">/etc/sysctl.conf</div><pre class="code-pre "><code langs="">net.ipv4.ip_forward=1
</code></pre>
<p>Salve e feche o arquivo quando você terminar.</p>

<p>Para ler o arquivo e ajustar os valores para a sessão atual, digite:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo sysctl -p
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>net.ipv4.ip_forward = 1
</code></pre>
<p>Se seguiu o guia de configuração inicial do servidor Ubuntu 18.04 listado nos pré-requisitos, você deve ter um firewall UFW em funcionamento. Independentemente de você usar o firewall para bloquear tráfego indesejado (o que quase sempre se deve fazer), para este guia você precisa de um firewall para manipular uma parte do tráfego que vem para o servidor. Algumas das regras do firewall devem ser modificadas para habilitar o mascaramento, que é um conceito iptables que fornece tradução de endereço de rede (NAT) dinâmica e instantânea para rotear conexões com clientes  de maneira correta.</p>

<p>Antes de abrir o arquivo de configuração do firewall para adicionar as regras de mascaramento, você deve primeiro encontrar a interface de rede pública da sua máquina. Para fazer isso, digite:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ip route | grep default
</li></ul></code></pre>
<p>Sua interface pública é a string encontrada dentro do resultado desse comando que vem após a palavra &ldquo;dev&rdquo;. Por exemplo, este resultado mostra a interface chamada <code>wlp11s0</code>, que está destacada abaixo:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>default via 203.0.113.1 dev <span class="highlight">wlp11s0</span> proto static
</code></pre>
<p>Quando tiver a interface associada à sua rota padrão, abra o arquivo <code>/etc/ufw/before.rules</code> para adicionar as configurações relevantes:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/ufw/before.rules
</li></ul></code></pre>
<p>As regras do UFW são normalmente adicionadas usando o comando <code>ufw</code>. As regras listadas no arquivo <code>before.rules</code>, em contrapartida, são lidas e colocadas em funcionamento antes das regras convencionais do UFW serem carregadas. Em direção ao topo do arquivo, adicione as linhas destacadas abaixo. Isso irá definir a política padrão para a cadeia <code>POSTROUTING</code> na tabela <code>nat</code> e mascarar todo o tráfego vindo do VPN. Lembre-se de substituir o <code><span class="highlight">wlp11s0</span></code> na linha <code>-A POSTROUTING</code> abaixo pela interface que você encontrou no comando acima:</p>
<div class="code-label " title="/etc/ufw/before.rules">/etc/ufw/before.rules</div><pre class="code-pre "><code langs="">#
# rules.before
#
# Rules that should be run before the ufw command line added rules. Custom
# rules should be added to one of these chains:
#   ufw-before-input
#   ufw-before-output
#   ufw-before-forward
#

<span class="highlight"># START OPENVPN RULES</span>
<span class="highlight"># NAT table rules</span>
<span class="highlight">*nat</span>
<span class="highlight">:POSTROUTING ACCEPT [0:0]</span> 
<span class="highlight"># Allow traffic from OpenVPN client to </span>wlp11s0<span class="highlight"> (change to the interface you discovered!)</span>
<span class="highlight">-A POSTROUTING -s 10.8.0.0/8 -o </span>wlp11s0<span class="highlight"> -j MASQUERADE</span>
<span class="highlight">COMMIT</span>
<span class="highlight"># END OPENVPN RULES</span>

# Don't delete these required lines, otherwise there will be errors
*filter
. . .
</code></pre>
<p>Salve e feche o arquivo quando você terminar.</p>

<p>Em seguida, você também precisa dizer ao UFW para permitir os pacotes redirecionados por padrão. Para fazer isso, abra o arquivo <code>/etc/default/ufw</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/default/ufw
</li></ul></code></pre>
<p>Dentro, encontre a diretriz <code>DEFAULT_FORWARD_POLICY</code> e altere o valor de <code>DROP</code> para <code>ACCEPT</code>:</p>
<div class="code-label " title="/etc/default/ufw">/etc/default/ufw</div><pre class="code-pre "><code langs="">DEFAULT_FORWARD_POLICY="<span class="highlight">ACCEPT</span>"
</code></pre>
<p>Salve e feche o arquivo quando você terminar.</p>

<p>Em seguida, ajuste o firewall em si para permitir o tráfego para o OpenVPN. Caso não tenha alterado a porta e o protocolo no arquivo <code>/etc/openvpn/server.conf</code>, você precisará abrir o tráfego UDP para a porta <code>1194</code>. Se você modificou a porta e/ou o protocolo, substitua os valores que selecionou aqui.</p>

<p>Caso tenha esquecido de adicionar a porta SSH ao seguir o tutorial pré-requisito, adicione-a também aqui:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow <span class="highlight">1194</span>/<span class="highlight">udp</span>
</li><li class="line" prefix="$">sudo ufw allow OpenSSH
</li></ul></code></pre>
<p>Após adicionar essas regras, desative e reative o UFW para reiniciá-lo e carregar as alterações de todos os arquivos que você modificou:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw disable
</li><li class="line" prefix="$">sudo ufw enable
</li></ul></code></pre>
<p>Seu servidor agora está configurado para lidar corretamente com o tráfego OpenVPN.</p>

<h2 id="passo-7-—-inicializando-e-ativando-o-serviço-openvpn">Passo 7 — Inicializando e ativando o serviço OpenVPN</h2>

<p>Você finalmente está pronto para inicializar o serviço OpenVPN no seu servidor. Isso é feito usando o utilitário <code>systemctl</code> do systemd.</p>

<p>Inicie o servidor OpenVPN especificando o nome do seu arquivo de configuração como uma variável de instância após o nome do arquivo de unidade systemd. O arquivo de configuração para o seu servidor chama-se <code>/etc/openvpn/<span class="highlight">server</span>.conf</code>, então adicione <code><span class="highlight">@server</span></code> ao final do seu arquivo de unidade ao chamá-lo:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl start openvpn@<span class="highlight">server</span>
</li></ul></code></pre>
<p>Verifique novamente se o serviço foi iniciado com sucesso digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl status openvpn@server
</li></ul></code></pre>
<p>Se tudo correu bem, seu resultado se parecerá com este:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>● openvpn@server.service - OpenVPN connection to server
   Loaded: loaded (/lib/systemd/system/openvpn@.service; disabled; vendor preset: enabled)
   Active: <span class="highlight">active (running)</span> since Tue 2016-05-03 15:30:05 EDT; 47s ago
     Docs: man:openvpn(8)
           https://community.openvpn.net/openvpn/wiki/Openvpn23ManPage
           https://community.openvpn.net/openvpn/wiki/HOWTO
  Process: 5852 ExecStart=/usr/sbin/openvpn --daemon ovpn-%i --status /run/openvpn/%i.status 10 --cd /etc/openvpn --script-security 2 --config /etc/openvpn/%i.conf --writepid /run/openvpn/%i.pid (code=exited, sta
 Main PID: 5856 (openvpn)
    Tasks: 1 (limit: 512)
   CGroup: /system.slice/system-openvpn.slice/openvpn@server.service
           └─5856 /usr/sbin/openvpn --daemon ovpn-server --status /run/openvpn/server.status 10 --cd /etc/openvpn --script-security 2 --config /etc/openvpn/server.conf --writepid /run/openvpn/server.pid

</code></pre>
<p>Você também pode verificar se a interface OpenVPN <code>tun0</code> está disponível digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ip addr show tun0
</li></ul></code></pre>
<p>Isso dará como resultado uma interface configurada:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>4: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN group default qlen 100
    link/none 
    inet 10.8.0.1 peer 10.8.0.2/32 scope global tun0
       valid_lft forever preferred_lft forever
</code></pre>
<p>Após inicializar o serviço, habilite-o para que ele seja iniciado automaticamente no boot:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl enable openvpn@server
</li></ul></code></pre>
<p>Seu serviço OpenVPN agora está funcionando. Entretanto, antes de começar a usá-lo, você deve primeiro criar um arquivo de configuração para a máquina do cliente. Este tutorial já mostrou como criar pares de certificado/key para clientes, e no próximo passo vamos demonstrar como criar uma infraestrutura que irá gerar arquivos de configuração do cliente facilmente.</p>

<h2 id="passo-8-—-criando-a-infraestrutura-de-configuração-de-clientes">Passo 8 — Criando a infraestrutura de configuração de clientes</h2>

<p>Criar arquivos de configuração para os clientes OpenVPN pode ser um desafio, já que cada cliente deve ter sua própria configuração e cada um deve se alinhar com as configurações descritas no arquivo de configuração do servidor. Ao invés de escrever um único arquivo de configuração que só pode ser usado para um cliente, este passo define um processo para a construção de uma infraestrutura de configuração de clientes que você pode usar para gerar arquivos de configuração imediatamente. Você criará primeiro um arquivo de configuração &ldquo;base&rdquo; e então construirá um script que permitirá que você gere arquivos únicos de configuração de clientes, certificados e chaves conforme necessário.</p>

<p>Comece criando um novo diretório onde você irá armazenar arquivos de configuração de clientes no diretório <code>client-configs</code> que você criou mais cedo:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">mkdir -p ~/client-configs/files
</li></ul></code></pre>
<p>Em seguida, copie um arquivo de configuração de cliente exemplo para o diretório <code>client-configs</code> para usá-lo como sua configuração base:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cp /usr/share/doc/openvpn/examples/sample-config-files/client.conf ~/client-configs/base.conf
</li></ul></code></pre>
<p>Abra este novo arquivo no seu editor de texto:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano ~/client-configs/base.conf
</li></ul></code></pre>
<p>Dentro, localize a diretriz <code>remote</code>. Isso aponta o cliente para seu endereço de servidor OpenVPN — o endereço IP público do seu servidor OpenVPN. Caso tenha decidido alterar a porta em que o servidor OpenVPN está escutando, também será preciso alterar a <code>1194</code> para a porta que você selecionou:</p>
<div class="code-label " title="~/client-configs/base.conf">~/client-configs/base.conf</div><pre class="code-pre "><code langs="">. . .
# The hostname/IP and port of the server.
# You can have multiple remote entries
# to load balance between the servers.
remote <span class="highlight">your_server_ip</span> <span class="highlight">1194</span>
. . .
</code></pre>
<p>Certifique-se de que o protocolo corresponda ao valor que você está usando na configuração do servidor:</p>
<div class="code-label " title="~/client-configs/base.conf">~/client-configs/base.conf</div><pre class="code-pre "><code langs="">proto <span class="highlight">udp</span>
</code></pre>
<p>Em seguida, descomente as diretrizes <code>user</code> e <code>group</code> removendo o &ldquo;<strong>;</strong>&rdquo; no começo de cada linha:</p>
<div class="code-label " title="~/client-configs/base.conf">~/client-configs/base.conf</div><pre class="code-pre "><code langs=""># Downgrade privileges after initialization (non-Windows only)
user nobody
group nogroup
</code></pre>
<p>Encontre as diretrizes que definem <code>ca</code>, <code>cert</code> e <code>key</code>. Comente essas diretrizes, já que você adicionará os certificados e chaves dentro do arquivo em si em breve:</p>
<div class="code-label " title="~/client-configs/base.conf">~/client-configs/base.conf</div><pre class="code-pre "><code langs=""># SSL/TLS parms.
# See the server config file for more
# description.  It's best to use
# a separate .crt/.key file pair
# for each client.  A single ca
# file can be used for all clients.
<span class="highlight">#</span>ca ca.crt
<span class="highlight">#</span>cert client.crt
<span class="highlight">#</span>key client.key
</code></pre>
<p>Do mesmo modo, comente a diretriz <code>tls-auth</code>, já que você adicionará a <code>ta.key</code> diretamente no arquivo de configuração do cliente:</p>
<div class="code-label " title="~/client-configs/base.conf">~/client-configs/base.conf</div><pre class="code-pre "><code langs=""># If a tls-auth key is used on the server
# then every client must also have the key.
<span class="highlight">#</span>tls-auth ta.key 1
</code></pre>
<p>Espelhe as configurações <code>cipher</code> e <code>auth</code> que você definiu no arquivo <code>/etc/openvpn/server.conf</code>:</p>
<div class="code-label " title="~/client-configs/base.conf">~/client-configs/base.conf</div><pre class="code-pre "><code langs=""><span class="highlight">cipher AES-256-CBC</span>
<span class="highlight">auth SHA256</span>
</code></pre>
<p>Em seguida, adicione a diretriz <code>key-direction</code> em algum lugar no arquivo. Você <strong>deve</strong> definir isso em &ldquo;1&rdquo; para que o VPN funcione corretamente na máquina do cliente:</p>
<div class="code-label " title="~/client-configs/base.conf">~/client-configs/base.conf</div><pre class="code-pre "><code langs=""><span class="highlight">key-direction 1</span>
</code></pre>
<p>Por fim, adicione algumas linhas <strong>comentadas</strong>. Embora possa incluir essas diretrizes em todos os arquivos de configuração de clientes, você precisa habilitá-las para clientes Linux que acompanham um arquivo <code>/etc/openvpn/update-resolv-conf</code>. Este script usa o utilitário <code>resolvconf</code> para atualizar as informações DNS para clientes Linux.</p>
<div class="code-label " title="~/client-configs/base.conf">~/client-configs/base.conf</div><pre class="code-pre "><code langs=""><span class="highlight"># script-security 2</span>
<span class="highlight"># up /etc/openvpn/update-resolv-conf</span>
<span class="highlight"># down /etc/openvpn/update-resolv-conf</span>
</code></pre>
<p>Se seu cliente estiver usando o Linux e tiver um arquivo <code>/etc/openvpn/update-resolv-conf</code>, descomente essas linhas do arquivo de configuração do cliente após terem sido geradas.</p>

<p>Salve e feche o arquivo quando você terminar.</p>

<p>Em seguida, crie um script simples que irá compilar sua configuração base com os arquivos de certificado, chave, e criptografia relevantes e então colocar a configuração gerada no diretório <code>~/client-configs/files</code>. Abra um novo arquivo chamado <code>make_config.sh</code> dentro do diretório <code>~/client-configs</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano ~/client-configs/make_config.sh
</li></ul></code></pre>
<p>Dentro, adicione o seguinte conteúdo:</p>
<div class="code-label " title="~/client-configs/make_config.sh">~/client-configs/make_config.sh</div><pre class="code-pre "><code class="code-highlight language-sh">#!/bin/bash

# First argument: Client identifier

KEY_DIR=~/client-configs/keys
OUTPUT_DIR=~/client-configs/files
BASE_CONFIG=~/client-configs/base.conf

cat ${BASE_CONFIG} \
    &lt;(echo -e '&lt;ca&gt;') \
    ${KEY_DIR}/ca.crt \
    &lt;(echo -e '&lt;/ca&gt;\n&lt;cert&gt;') \
    ${KEY_DIR}/${1}.crt \
    &lt;(echo -e '&lt;/cert&gt;\n&lt;key&gt;') \
    ${KEY_DIR}/${1}.key \
    &lt;(echo -e '&lt;/key&gt;\n&lt;tls-auth&gt;') \
    ${KEY_DIR}/ta.key \
    &lt;(echo -e '&lt;/tls-auth&gt;') \
    &gt; ${OUTPUT_DIR}/${1}.ovpn
</code></pre>
<p>Salve e feche o arquivo quando você terminar.</p>

<p>Antes de seguir em frente, certifique-se de marcar este arquivo como executável digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">chmod 700 ~/client-configs/make_config.sh
</li></ul></code></pre>
<p>Este script fará uma cópia do arquivo <code>base.conf</code> que você fez, coletará todos os arquivos de certificado e chave que você criou para seu cliente, extrairá os conteúdos deles, adicionará esse conteúdo à cópia do arquivo de configuração base e exportará tudo isso para um novo arquivo de configuração de clientes. Isso significa que, ao invés de ter que gerenciar os arquivos de configuração do cliente, certificado e chave separadamente, todas as informações necessárias são armazenadas em um só lugar. O benefício disso é que, caso tenha necessidade de adicionar um cliente no futuro, você pode executar este script para criar rapidamente o arquivo de configuração e garantir que todas as informações importantes são armazenadas em uma única localização de fácil acesso.</p>

<p>Note que, sempre que adicionar um novo cliente, você precisará gerar novas chaves e certificados para ele antes de executar este script e gerar seu arquivo de configuração. Você poderá praticar um pouco a utilização deste script no próximo passo.</p>

<h2 id="passo-9-—-gerando-as-configurações-de-clientes">Passo 9 — Gerando as configurações de clientes</h2>

<p>Se seguiu com o guia, você criou um certificado e chave de cliente nomeados <code>client1.crt</code> e <code>client1.key</code>, respectivamente, no passo 4. É possível gerar um arquivo de configuração para essas credenciais entrando no seu diretório <code>~/client-configs</code> e executando o script que você fez no final do passo anterior:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd ~/client-configs
</li><li class="line" prefix="$">sudo ./make_config.sh <span class="highlight">client1</span>
</li></ul></code></pre>
<p>Isso criará um arquivo chamado <code>client1.ovpn</code> no seu diretório <code>~/client-configs/files</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ls ~/client-configs/files
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>client1.ovpn
</code></pre>
<p>Você precisa transferir esse arquivo para o dispositivo que planeja usar como cliente. Por exemplo, este poderia ser seu computador local ou um dispositivo móvel.</p>

<p>Embora os aplicativos exatos usados para realizar essa transferência dependerão do sistema operacional do seu dispositivo e de suas preferências pessoais, um método confiável e seguro é usar o SFTP (protocolo SSH de transferência de arquivos) ou SCP (cópia segura) no backend. Isso transportará os arquivos de autenticação do VPN do seu cliente através de uma conexão criptografada.</p>

<p>Aqui está um comando SFTP exemplo usando o exemplo <code><span class="highlight">client1.ovpn</span></code> que você pode executar do seu computador local (macOS ou Linux). Ele coloca o arquivo <code>.ovpn</code> no seu diretório home:</p>
<pre class="code-pre custom_prefix local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="local$">sftp <span class="highlight">sammy</span>@<span class="highlight">your_server_ip</span>:client-configs/files/client1.ovpn ~/
</li></ul></code></pre>
<p>Aqui estão diversas ferramentas e tutoriais para transferir arquivos com segurança do servidor para um computador local:</p>

<ul>
<li><a href="http://winscp.net">WinSCP</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-use-sftp-to-securely-transfer-files-with-a-remote-server">Como usar o SFTP para transferir arquivos com segurança com um servidor remoto</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-use-filezilla-to-transfer-and-manage-files-securely-on-your-vps">Como usar o Filezilla para transferir e gerenciar arquivos com segurança no seu VPS</a></li>
</ul>

<h2 id="passo-10-—-instalando-a-configuração-do-cliente">Passo 10 — Instalando a configuração do cliente</h2>

<p>Esta seção aborda como instalar um perfil VPN de um cliente no Windows, macOS, Linux, iOS e Android. Nenhuma dessas instruções de cliente dependem uma da outra, então sinta-se a vontade para pular para alguma que seja aplicável ao seu dispositivo.</p>

<p>A conexão OpenVPN terá o mesmo nome que você chamou o arquivo <code>.ovpn</code>. No que diz respeito a este tutorial, isso significa que a conexão se chama <code>client1.ovpn</code>, de acordo com o primeiro arquivo de cliente que você gerou.</p>

<h3 id="windows">Windows</h3>

<p><strong>Instalando</strong></p>

<p>Faça download do aplicativo do cliente OpenVPN para o Windows da <a href="https://openvpn.net/index.php/open-source/downloads.html">página de download do OpenVPN</a>. Escolha a versão do instalador apropriada para a sua versão do Windows.</p>

<p><span class='note'><strong>Nota:</strong> O OpenVPN precisa de privilégios administrativos para ser instalado.<br></span></p>

<p>Após instalar o OpenVPN, copie o arquivo <code>.ovpn</code> para:</p>
<pre class="code-pre "><code langs="">C:\Program Files\OpenVPN\config
</code></pre>
<p>Quando iniciar o OpenVPN, ele verá o perfil e o disponibilizará automaticamente.</p>

<p>Você deve executar o OpenVPN como administrador sempre que ele é usado, mesmo por contas administrativas. Para fazer isso sem precisar clicar com o botão direito e selecionar <strong>Executar como administrador</strong> sempre que você usar o VPN, é necessário predefinir isso de uma conta administrativa. Isso significa que os usuários padrão também precisam digitar a senha do administrador para usar o OpenVPN. Por outro lado, os usuários padrão não conseguem se conectar devidamente ao servidor a não ser que o aplicativo OpenVPN no cliente tenha direitos de administrador, então são necessários privilégios elevados.</p>

<p>Para definir que o aplicativo OpenVPN sempre execute como administrador, clique com o botão direito no seu atalho e vá em <strong>Propriedades</strong>. No final da aba <strong>Compatibilidade</strong>, clique no botão para <strong>Mudar as configurações para todos os usuários</strong>. Na nova janela, marque <strong>Executar este programa como administrador</strong>.</p>

<p><strong>Conectando</strong></p>

<p>Cada vez que iniciar a OpenVPN GUI, o Windows irá perguntar se você quer permitir que o programa faça alterações no seu computador. Clique em <strong>Yes</strong>. Iniciar o aplicativo do cliente OpenVPN coloca apenas o applet na bandeja do sistema para que você possa conectar e desconectar o VPN conforme necessário; isso não cria de fato a conexão VPN.</p>

<p>Assim que o OpenVPN iniciar, inicie uma conexão entrando no applet da bandeja do sistema e clicando com o botão direito no ícone do applet do OpenVPN. Isso abre o menu de contexto. Selecione <strong>client1</strong> no topo do menu (esse é seu perfil <code>client1.ovpn</code>) e escolha <strong>Connect</strong>.</p>

<p>Uma janela de status abrirá mostrando o registro de saída enquanto a conexão estiver estabelecida, e uma mensagem aparecerá assim que o cliente estiver conectado.</p>

<p>Desconecte-se do VPN da mesma maneira: Vá até o applet da bandeja do sistema, clique com o botão direito no ícone do applet do OpenVPN, selecione o perfil do cliente e clique em <strong>Disconnect</strong>.</p>

<h3 id="macos">macOS</h3>

<p><strong>Instalando</strong></p>

<p>O <a href="https://tunnelblick.net/">Tunnelblick</a> é um cliente OpenVPN gratuito e de código aberto para o macOS. Você pode baixar a imagem de disco mais recente da <a href="https://tunnelblick.net/downloads.html">página de downloads do Tunnelblick</a>. Clique duas vezes no arquivo baixado <code>.dmg</code> e siga os prompts para instalar.</p>

<p>Ao final do processo de instalação, o Tunnelblick irá perguntar se você tem algum arquivo de configuração. Responda <strong>I have configuration files</strong> e deixe o Tunnelblick terminar. Abra uma janela do Finder e clique duas vezes no <code>client1.ovpn</code>. O Tunnelblick instalará o perfil do cliente. São necessário privilégios administrativos.</p>

<p><strong>Conectando</strong></p>

<p>Inicie o Tunnelblick clicando duas vezes no ícone do Tunnelblick na pasta <strong>Applications</strong>. Assim que o Tunnelblick iniciar, haverá um ícone do Tunnelblick na barra do menu no canto superior direito da tela para controle de conexões. Clique no ícone e então no item do menu <strong>Connect client1</strong> para iniciar a conexão VPN.</p>

<h3 id="linux">Linux</h3>

<h4 id="instalando">Instalando</h4>

<p>Se estiver usando o Linux, existe uma variedade de ferramentas que você pode usar dependendo da sua distribuição. Seu ambiente do desktop ou gerenciador de janelas também pode incluir serviços de conexão.</p>

<p>Entretanto, o modo mais universal de se conectar é apenas usar o software OpenVPN.</p>

<p>No Ubuntu ou Debian, você pode instalá-lo assim como fez no servidor digitando:</p>
<pre class="code-pre custom_prefix local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="client$">sudo apt update
</li><li class="line" prefix="client$">sudo apt install openvpn
</li></ul></code></pre>
<p>No CentOS, você pode habilitar os repositórios EPEL e então instalá-lo digitando:</p>
<pre class="code-pre custom_prefix local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="client$">sudo yum install epel-release
</li><li class="line" prefix="client$">sudo yum install openvpn
</li></ul></code></pre>
<h4 id="configurando">Configurando</h4>

<p>Verifique se sua distribuição inclui um script <code>/etc/openvpn/update-resolv-conf</code>:</p>
<pre class="code-pre custom_prefix local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="client1$">ls /etc/openvpn
</li></ul></code></pre><pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>update-resolv-conf
</code></pre>
<p>Em seguida, edite o arquivo de configuração do cliente OpenVPN que você transferiu:</p>
<pre class="code-pre custom_prefix local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="client$">nano <span class="highlight">client1</span>.ovpn
</li></ul></code></pre>
<p>Se conseguir encontrar um arquivo <code>update-resolv-conf</code>, descomente as três linhas que você adicionou para ajustar as configurações DNS:</p>
<div class="code-label " title="client1.ovpn">client1.ovpn</div><pre class="code-pre  local-environment"><code langs="">script-security 2
up /etc/openvpn/update-resolv-conf
down /etc/openvpn/update-resolv-conf
</code></pre>
<p>Se estiver usando o CentOS, altere a diretriz <code>group</code> de <code>nogroup</code> para <code>nobody</code> de forma a corresponder aos grupos disponíveis da distribuição:</p>
<div class="code-label " title="client1.ovpn">client1.ovpn</div><pre class="code-pre  local-environment"><code langs="">group <span class="highlight">nobody</span>
</code></pre>
<p>Salve e feche o arquivo.</p>

<p>Agora, você pode se conectar ao VPN apenas apontando o comando <code>openvpn</code> para o arquivo de configuração do cliente:</p>
<pre class="code-pre custom_prefix local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="client$">sudo openvpn --config <span class="highlight">client1</span>.ovpn
</li></ul></code></pre>
<p>Isso deve conectar você ao seu VPN.</p>

<h3 id="ios">iOS</h3>

<p><strong>Instalando</strong></p>

<p>A partir da App Store do iTunes, procure e instale o <a href="https://itunes.apple.com/us/app/id590379981">OpenVPN Connect</a>, o aplicativo oficial do cliente iOS OpenVPN. Para transferir sua configuração do cliente iOS para o dispositivo, conecte-o diretamente a um computador.</p>

<p>O processo de completar a transferência com o iTunes é descrito aqui. Abra o iTunes no computador e clique em <strong>iPhone</strong> &gt; <strong>apps</strong>. Role até o final da seção <strong>File Sharing</strong> e clique no app OpenVPN. A janela em branco à direita, <strong>OpenVPN Documents</strong>, serve para compartilhar arquivos. Arraste o arquivo <code>.ovpn</code> para a janela OpenVPN Documents.</p>

<p><img src="https://assets.digitalocean.com/articles/openvpn_ubunutu/1.png" alt="iTunes showing the VPN profile ready to load on the iPhone"></p>

<p>Agora, inicie o app OpenVPN no iPhone. Você receberá uma notificação de que um novo perfil está pronto para ser importado. Clique no sinal mais em verde para importá-lo.</p>

<p><img src="https://assets.digitalocean.com/articles/openvpn_ubunutu/2.png" alt="The OpenVPN iOS app showing new profile ready to import"></p>

<p><strong>Conectando</strong></p>

<p>O OpenVPN agora está pronto para ser usado com o novo perfil. Inicie a conexão deslizando o botão <strong>Connect</strong> para a posição <strong>On</strong>. Desconecte deslizando o mesmo botão para <strong>Off</strong>.</p>

<p><span class='note'><strong>Nota:</strong> O switch VPN em <strong>Settings</strong> não pode ser usado para se conectar ao VPN. Se tentar fazer isso, receberá uma notificação para se conectar apenas usando o app OpenVPN.<br></span></p>

<p><img src="https://assets.digitalocean.com/articles/openvpn_ubunutu/3.png" alt="The OpenVPN iOS app connected to the VPN"></p>

<h3 id="android">Android</h3>

<p><strong>Instalando</strong></p>

<p>Abra a Google Play Store. Procure e instale o <a href="https://play.google.com/store/apps/details?id=net.openvpn.openvpn">Android OpenVPN Connect</a>, o aplicativo oficial do cliente Android OpenVPN.</p>

<p>Você pode transferir o perfil <code>.ovpn</code> conectando o dispositivo Android ao seu computador por USB e copiando o arquivo. Como alternativa, caso tenha um leitor de cartões SD, você pode remover o cartão SD do dispositivo, copiar o perfil nele e então inserir o cartão de volta no dispositivo Android.</p>

<p>Inicie o app OpenVPN e clique no menu para importar o perfil.</p>

<p><img src="https://assets.digitalocean.com/articles/openvpn_ubunutu/4.png" alt="The OpenVPN Android app profile import menu selection"></p>

<p>Então navegue até a localização do perfil salvo (a captura de tela usa <code>/sdcard/Download/</code>) e selecione o arquivo. O app criará uma nota de que o perfil foi importado.</p>

<p><img src="https://assets.digitalocean.com/articles/openvpn_ubunutu/5.png" alt="The OpenVPN Android app selecting VPN profile to import"></p>

<p><strong>Conectando</strong></p>

<p>Para se conectar, basta apertar o botão <strong>Connect</strong>. Você será questionado se confia no aplicativo OpenVPN. Escolha <strong>OK</strong> para iniciar a conexão. Para se desconectar do VPN, volte para o app OpenVPN e escolha <strong>Disconnect</strong>.</p>

<p><img src="https://assets.digitalocean.com/articles/openvpn_ubunutu/6.png" alt="The OpenVPN Android app ready to connect to the VPN"></p>

<h2 id="passo-11-—-testando-sua-conexão-vpn-opcional">Passo 11 — Testando sua conexão VPN (opcional)</h2>

<p><span class='note'><strong>Nota:</strong> Este método utilizado no teste da sua conexão VPN funcionará apenas se você optou por rotear todo o seu tráfego através do VPN no Passo 5.<br></span></p>

<p>Assim que tudo estiver instalado, um simples visto confirma que tudo está funcionando corretamente. Sem ter uma conexão VPN habilitada, abra um navegador e vá para <a href="https://www.dnsleaktest.com">DNSLeakTest</a>.</p>

<p>O site irá retornar o endereço IP atribuído pelo seu provedor de serviço de Internet e como você se mostra para o resto do mundo. Para verificar suas configurações DNS através do mesmo site, clique em <strong>Extended Test</strong> e ele dirá a você quais servidores DNS você está usando.</p>

<p>Agora, conecte o cliente OpenVPN ao seu VPN do Droplet e atualize o navegador. Um endereço IP completamente diferente (daquele do seu servidor VPN) deve aparecer agora e é assim que você aparece para o mundo. Novamente, o <strong>Extended Test</strong> do <a href="https://www.dnsleaktest.com">DNSLeakTest</a> irá verificar suas configurações DNS e confirmar que você agora está usando os resolvers DNS definidos pelo seu VPN.</p>

<h2 id="passo-12-—-revogando-certificados-de-clientes">Passo 12 — Revogando certificados de clientes</h2>

<p>De vez em quando, você pode precisar revogar um certificado de cliente para impedir o acesso adicional ao servidor OpenVPN.</p>

<p>Para fazer isso, navegue até o diretório EasyRSA na sua máquina CA:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd EasyRSA-<span class="highlight">3.0.4</span>/
</li></ul></code></pre>
<p>Em seguida, execute o script <code>easyrsa</code> com a opção <code>revoke</code>, seguida do nome do cliente que você deseja revogar:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa revoke <span class="highlight">client2</span>
</li></ul></code></pre>
<p>Isso irá pedir que você confirme a revogação digitando <code>yes</code>:</p>
<pre class="code-pre  second-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>Please confirm you wish to revoke the certificate with the following subject:

subject=
    commonName                = client2


Type the word 'yes' to continue, or any other input to abort.
  Continue with revocation: <span class="highlight">yes</span>
</code></pre>
<p>Após confirmar a ação, a CA irá revogar completamente o certificado do cliente. Entretanto, seu servidor OpenVPN ainda não tem como verificar se os certificados de clientes foram revogados e se o cliente ainda terá acesso ao VPN. Para corrigir isso, crie uma lista de revogação de certificados (CRL) na sua máquina CA:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">./easyrsa gen-crl
</li></ul></code></pre>
<p>Isso irá gerar um arquivo chamado <code>crl.pem</code>. Transfira com segurança este arquivo para seu servidor OpenVPN:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">scp ~/EasyRSA-<span class="highlight">3.0.4</span>/pki/crl.pem <span class="highlight">sammy</span>@<span class="highlight">your_server_ip</span>:/tmp
</li></ul></code></pre>
<p>No seu servidor OpenVPN, copie este arquivo para seu diretório <code>/etc/openvpn/</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo cp /tmp/crl.pem /etc/openvpn
</li></ul></code></pre>
<p>Em seguida, abra o arquivo de configuração do servidor OpenVPN:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/openvpn/server.conf
</li></ul></code></pre>
<p>No final do arquivo, adicione a opção <code>crl-verify</code> que irá instruir o servidor OpenVPN para verificar a lista de revogação de certificados que criamos sempre que uma tentativa de conexão for feita:</p>
<div class="code-label " title="/etc/openvpn/server.conf">/etc/openvpn/server.conf</div><pre class="code-pre "><code langs="">crl-verify crl.pem
</code></pre>
<p>Salve e feche o arquivo.</p>

<p>Por fim, reinicie o OpenVPN para implementar a revogação do certificado:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart openvpn@server
</li></ul></code></pre>
<p>O cliente já não deve conseguir se conectar com sucesso ao servidor usando a credencial antiga.</p>

<p>Para revogar outros clientes, siga este processo:</p>

<ol>
<li>Revogue o certificado com o comando <code>./easyrsa revoke <span class="highlight">client_name</span></code></li>
<li>Gere um novo CRL</li>
<li>Transfira o novo arquivo <code>crl.pem</code> para seu servidor OpenVPN e copie-o para o diretório <code>/etc/openvpn</code> para sobrepor a lista antiga.</li>
<li>Reinicie o serviço OpenVPN.</li>
</ol>

<p>Você pode usar este processo para revogar quaisquer certificados que você tenha emitido anteriormente para seu servidor.</p>

<h2 id="conclusão">Conclusão</h2>

<p>Agora, você está navegando na Internet com segurança protegendo sua identidade, local e tráfego de bisbilhoteiros e censuradores.</p>

<p>Para configurar mais clientes, você só precisa seguir os passos <strong>4</strong> e <strong>9-11</strong> para cada dispositivo adicional. Para revogar o acesso a clientes, siga o passo <strong>12</strong>.</p>
