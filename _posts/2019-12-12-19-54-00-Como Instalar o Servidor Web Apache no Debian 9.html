---
layout: post
title: Como Instalar o Servidor Web Apache no Debian 9
network: digitalocean
date: December 12, 2019 at 07:54PM
url: https://www.digitalocean.com/community/tutorials/how-to-install-the-apache-web-server-on-debian-9-pt
image: http://assets.digitalocean.com/how-to-install-lamp-debian-9/small_apache_default_debian9.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="introdução">Introdução</h3>

<p>O servidor HTTP Apache é o servidor Web mais amplamente usado no mundo. Ele fornece muitas características poderosas, incluindo módulos carregáveis dinamicamente, suporte robusto de mídia e uma integração extensa com outros softwares populares.</p>

<p>Neste guia, vamos explicar como instalar um servidor Web Apache no seu servidor Debian 9.</p>

<h2 id="pré-requisitos">Pré-requisitos</h2>

<p>Antes de iniciar este guia, você deve ter um usuário regular e não-root com privilégios sudo configurado no seu servidor. Além disso, você precisará habilitar um firewall básico para bloquear portas não essenciais. Você pode aprender como configurar uma conta de usuário regular e configurar um firewall para seu servidor seguindo nosso <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-debian-9">guia de configuração inicial de servidor para o Debian 9</a>.</p>

<p>Quando você tiver uma conta disponível, logue com seu usuário não-root para começar.</p>

<h2 id="passo-1-—-instalando-o-apache">Passo 1 — Instalando o Apache</h2>

<p>O Apache está disponível dentro dos repositórios de software padrões do Debian, possibilitando que ele seja instalado usando ferramentas de gerenciamento de pacotes convencionais.</p>

<p>Vamos começar atualizando o índice de pacotes local para refletir as últimas alterações a montante:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt update
</li></ul></code></pre>
<p>Então, instale o pacote <code>apache2</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt install apache2
</li></ul></code></pre>
<p>Após confirmar a instalação, o <code>apt</code> irá instalar o Apache e todas as dependências necessárias.</p>

<h2 id="passo-2-—-ajustando-o-firewall">Passo 2 — Ajustando o Firewall</h2>

<p>Antes de testar o Apache, é necessário modificar as configurações do firewall para permitir o acesso exterior às portas Web padrão. Supondo que você tenha seguido as instruções nos pré-requisitos, você deve ter um firewall UFW configurado para restringir o acesso ao seu servidor.</p>

<p>Durante a instalação, o Apache registra-se com o UFW para fornecer alguns perfis de aplicativo que podem ser usados para habilitar ou desabilitar o acesso ao Apache através do firewall.</p>

<p>Liste os perfis de aplicativo <code>ufw</code> digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw app list
</li></ul></code></pre>
<p>Você verá uma lista dos perfis dos aplicativos:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Available applications:
  AIM
  Bonjour
  CIFS
. . . 
 WWW
 WWW Cache
 WWW Full
 WWW Secure
. . . 
</code></pre>
<p>Os perfis Apache começam com WWW:</p>

<ul>
<li><strong>WWW</strong>: Este perfil abre apenas a porta 80 (normal, tráfego Web não criptografado)</li>
<li><strong>WWW Cache</strong>: Este perfil abre apenas a porta 8080 (por vezes usada para cache e proxies Web)</li>
<li><strong>WWW Full</strong>: Este perfil abre ambas as portas 80 (normal, tráfego Web não criptografado) e 443 (tráfego TLS/SSL criptografado)</li>
<li><strong>WWW Secure</strong>: Este perfil abre apenas a porta 443 (tráfego TLS/SSL criptografado)</li>
</ul>

<p>É recomendável que habilite o perfil mais restritivo que ainda assim permitirá o tráfego que você configurou. Como ainda não configurou o SSL para seu servidor neste guia, nós precisaremos apenas permitir o tráfego na porta 80:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow 'WWW'
</li></ul></code></pre>
<p>Você pode verificar a mudança digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw status
</li></ul></code></pre>
<p>Você deve ver o tráfego HTTP como permitido no resultado exibido:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Status: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere
WWW                        ALLOW       Anywhere
OpenSSH (v6)               ALLOW       Anywhere (v6)
WWW (v6)                   ALLOW       Anywhere (v6)
</code></pre>
<p>Como você pode ver, o perfil foi ativado para permitir o acesso ao servidor Web.</p>

<h2 id="passo-3-—-verificando-seu-servidor-web">Passo 3 — Verificando seu Servidor Web</h2>

<p>No final do processo de instalação, o Debian 9 inicia o Apache. O servidor Web já deve estar em funcionamento.</p>

<p>Verifique com o sistema init <code>systemd</code> para garantir que o serviço está funcionando digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl status apache2
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>● apache2.service - The Apache HTTP Server
   Loaded: loaded (/lib/systemd/system/apache2.service; enabled; vendor preset: enabled)
   Active: active (running) since Wed 2018-09-05 19:21:48 UTC; 13min ago
 Main PID: 12849 (apache2)
   CGroup: /system.slice/apache2.service
           ├─12849 /usr/sbin/apache2 -k start
           ├─12850 /usr/sbin/apache2 -k start
           └─12852 /usr/sbin/apache2 -k start

Sep 05 19:21:48 apache systemd[1]: Starting The Apache HTTP Server...
Sep 05 19:21:48 apache systemd[1]: Started The Apache HTTP Server.
</code></pre>
<p>Como você pode ver a partir deste resultado, o serviço parece ter sido iniciado com sucesso. No entanto, a melhor maneira de testar isso é solicitando uma página do Apache.</p>

<p>Você pode acessar a página de destino padrão do Apache para confirmar que o software está funcionando corretamente através do seu endereço IP: Se você não sabe o endereço IP do seu servidor, você pode obtê-lo de algumas maneiras diferentes a partir da linha de comando.</p>

<p>Tente digitar isso no prompt de comando do seu servidor:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">hostname -I
</li></ul></code></pre>
<p>Você receberá alguns endereços separados por espaços. Você pode testar cada um no seu navegador Web para ver se eles funcionam.</p>

<p>Uma alternativa é usar a ferramento <code>curl</code>, que deve dar a você seu endereço IP público como visto de outro local na internet:</p>

<p>Primeiro, instale o <code>curl</code> usando o <code>apt</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt install curl
</li></ul></code></pre>
<p>Então, use o <code>curl</code> para recuperar o icanhazip.com usando IPv4:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">curl -4 icanhazip.com
</li></ul></code></pre>
<p>Quando você tiver o endereço IP do seu servidor, digite ele na barra de endereço do seu navegador:</p>
<pre class="code-pre "><code langs="">http://<span class="highlight">your_server_ip</span>
</code></pre>
<p>Você deve ver a página Web padrão Apache do Debian 9:</p>

<p><img src="http://assets.digitalocean.com/how-to-install-lamp-debian-9/small_apache_default_debian9.png" alt="Apache default page"></p>

<p>Esta página indica que o Apache está funcionando corretamente. Ela também inclui algumas informações básicas sobre arquivos importantes do Apache e localizações de diretórios importantes.</p>

<h2 id="passo-4-—-gerenciando-o-processo-apache">Passo 4 — Gerenciando o Processo Apache</h2>

<p>Agora que você tem seu servidor Web funcionamento, vamos ver alguns comandos básicos de gerenciamento.</p>

<p>Para parar seu servidor Web, digite:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl stop apache2
</li></ul></code></pre>
<p>Para iniciar o servidor quando ele for parado, digite:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl start apache2
</li></ul></code></pre>
<p>Para parar e então iniciar o serviço novamente, digite:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart apache2
</li></ul></code></pre>
<p>Se você estiver simplesmente fazendo alterações de configuração, o Apache geralmente pode recarregar sem quedas na conexão. Para fazer isso, utilize este comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl reload apache2
</li></ul></code></pre>
<p>Por padrão, o Apache está configurado para iniciar automaticamente quando o servidor for iniciado. Se isso não é o que você quer, desative este comportamento digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl disable apache2
</li></ul></code></pre>
<p>Para reativar o serviço de inicialização no boot, digite:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl enable apache2
</li></ul></code></pre>
<p>O Apache deve começar automaticamente quando o servidor for iniciado outra vez.</p>

<h2 id="passo-5-—-configurando-hosts-virtuais-recomendado">Passo 5 — Configurando Hosts Virtuais (Recomendado)</h2>

<p>Ao usar o servidor Web Apache, você pode usar _hosts virtuais _(similares a blocos de servidor no Nginx) para encapsular detalhes de configuração e hospedar mais de um domínio de um único servidor. Vamos configurar um domínio chamado <strong>example.com</strong>, mas você deve <strong>substituí-lo por seu próprio nome de domínio</strong>. Para aprender mais sobre como configurar um nome de domínio com o DigitalOcean, veja nossa <a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-digitalocean-dns">Introdução ao DNS do DigitalOcean</a>.</p>

<p>O Apache no Debian 9 tem um bloco de servidor habilitado por padrão que está configurado para atender documentos do diretório <code>/var/www/html</code>. Enquanto isso funciona bem para um único site, ele pode tornar-se indevido se você estiver hospedado vários sites. Ao invés de modificar o <code>/var/www/html</code>, vamos criar uma estrutura de diretórios dentro do <code>/var/www</code> para nosso site <strong>example.com</strong>, deixando o <code>/var/www/html</code> no lugar como o diretório padrão para ser servido se um pedido de cliente não corresponder a nenhum outro site.</p>

<p>Crie o diretório para <strong>example.com</strong> como segue, usando a flag <code>-p</code> para criar quaisquer diretórios parentais necessários:</p>
<pre class="code-pre commmand"><code langs="">sudo mkdir -p /var/www/<span class="highlight">example.com</span>/html
</code></pre>
<p>Em seguida, atribua a posse do diretório com a variável de ambiente <code>$USER</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo chown -R $USER:$USER /var/www/<span class="highlight">example.com</span>/html
</li></ul></code></pre>
<p>As permissões das suas roots Web devem estar corretas se ainda não tiver modificado seu valor <code>unmask</code>, mas você pode certificar-se digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo chmod -R 755 /var/www/<span class="highlight">example.com</span>
</li></ul></code></pre>
<p>A seguir, crie uma página de amostra <code>index.html</code> utilizando o <code>nano</code> ou seu editor favorito:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano /var/www/<span class="highlight">example.com</span>/html/index.html
</li></ul></code></pre>
<p>Dentro, adicione a seguinte amostra HTML:</p>
<div class="code-label " title="/var/www/example.com/html/index.html">/var/www/example.com/html/index.html</div><pre class="code-pre "><code langs="">&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Welcome to <span class="highlight">Example.com</span>!&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Success!  The <span class="highlight">example.com</span> virtual host is working!&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Salve e feche o arquivo quando você terminar.</p>

<p>Para que o Apache sirva este conteúdo, é necessário criar um arquivo de host virtual com as diretivas corretas. Ao invés de modificar o arquivo de configuração padrão localizado em <code>/etc/apache2/sites-available/000-default.conf</code> diretamente, vamos fazer um novo em <code>/etc/apache2/sites-available/<span class="highlight">example.com</span>.conf</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/apache2/sites-available/<span class="highlight">example.com</span>.conf
</li></ul></code></pre>
<p>Cole no seguinte bloco de configuração, que é similar ao padrão, mas atualizado para nosso novo diretório e nome de domínio:</p>
<div class="code-label " title="/etc/apache2/sites-available/example.com.conf">/etc/apache2/sites-available/example.com.conf</div><pre class="code-pre "><code langs="">&lt;VirtualHost *:80&gt;
    ServerAdmin <span class="highlight">admin@example.com</span>
    ServerName <span class="highlight">example.com</span>
    ServerAlias <span class="highlight">www.example.com</span>
    DocumentRoot /var/www/<span class="highlight">example.com</span>/html
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
&lt;/VirtualHost&gt;
</code></pre>
<p>Note que atualizamos o <code>DocumentRoot</code> para nosso novo diretório e o <code>ServerAdmin</code> para um e-mail que o administrador do site <strong>example.com</strong> pode acessar. Também adicionamos duas diretivas: o <code>ServerName</code>, que estabelece o domínio base que deve corresponder e essa definição de host virtual e o <code>ServerAlias</code>, que define nomes adicionais que devem corresponder como se fossem o nome base.</p>

<p>Salve e feche o arquivo quando você terminar.</p>

<p>Vamos habilitar o arquivo com a ferramenta <code>a2ensite</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo a2ensite <span class="highlight">example.com</span>.conf
</li></ul></code></pre>
<p>Desabilite o site padrão definido em <code>000-default.conf</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo a2dissite 000-default.conf
</li></ul></code></pre>
<p>Em seguida, vamos testar à procura de erros de configuração:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apache2ctl configtest
</li></ul></code></pre>
<p>Você deve ver o seguinte resultado:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Syntax OK
</code></pre>
<p>Reinicie o Apache para implementar as suas alterações:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart apache2
</li></ul></code></pre>
<p>O Apache agora deve estar atendendo seu nome de domínio. Você pode testar isso navegando para <code>http://<span class="highlight">example.com</span></code>, onde você deve ver algo como isso:</p>

<p><img src="https://assets.digitalocean.com/articles/apache_virt_hosts_1404/example.png" alt="Apache virtual host example"></p>

<h2 id="passo-6-—-familiarizando-se-com-arquivos-e-diretórios-importantes-do-apache">Passo 6 — Familiarizando-se com Arquivos e Diretórios Importantes do Apache</h2>

<p>Agora que você sabe como gerenciar o serviço do Apache, você deve gastar alguns minutos para familiarizar-se com alguns diretórios e arquivos importantes.</p>

<h3 id="conteúdo">Conteúdo</h3>

<ul>
<li><code>/var/www/html</code>: O conteúdo Web em si, que por padrão apenas consiste na página Apache padrão que você viu antes, é servido do diretório <code>/var/www/html</code>. Isso pode ser alterado mudando os arquivos de configuração do Apache.</li>
</ul>

<h3 id="configuração-do-servidor">Configuração do Servidor</h3>

<ul>
<li><code>/etc/apache2</code>: O diretório de configuração do Apache. Todos os arquivos de configuração do Apache residem aqui.</li>
<li><code>/etc/apache2/apache2.conf</code>: O arquivo de configuração principal do Apache. Isso pode ser modificado para fazer alterações na configuração global do Apache. Este arquivo é o responsável por carregar muitos dos outros arquivos no diretório de configuração.</li>
<li><code>/etc/apache2/ports.conf</code>: Este arquivo especifica as portas nas quais o Apache irá escutar. Por padrão, o Apache escuta na porta 80 e adicionalmente escuta na porta 443 quando um módulo que fornece capacidades SSL está ativo.</li>
<li><code>/etc/apache2/sites-available/</code>: O diretório onde hosts virtuais de cada site podem ser armazenados. O Apache não usará os arquivos de configuração encontrados neste diretório a menos que estejam ligados ao diretório <code>sites-enabled</code>. Normalmente, todas as configurações de bloco do servidor são feitas neste diretório e então habilitadas ligando-as ao outro diretório com o comando <code>a2ensite.</code></li>
<li><code>/etc/apache2/sites-enabled/</code>: O diretório onde hosts virtuais habilitados de cada site são armazenados. Normalmente, eles são criados ligando arquivos de configuração encontrados no diretório <code>sites-available</code> com o <code>a2ensite</code>. O Apache lê os arquivos de configuração e links encontrados neste diretório quando inicia ou recarrega para compilar uma configuração completa.</li>
<li><code>/etc/apache2/conf-available/</code>, <code>/etc/apache2/conf-enabled/</code>: Estes diretórios têm a mesma relação que os diretórios <code>sites-available</code> e <code>sites-enabled</code>, mas são usados para armazenar fragmentos de configuração que não pertencem em um host virtual. Arquivos no diretório <code>conf-available</code> podem ser habilitados com o comando <code>a2enconf</code> e desabilitados com o comando <code>a2disconf</code>.</li>
<li><code>/etc/apache2/mods-available/</code>, <code>/etc/apache2/mod-enabled/</code>: Estes diretórios contêm os módulos disponíveis e habilitados, respectivamente. Arquivos com final <code>.load</code> contêm fragmentos para carregar módulos específicos, enquanto os arquivos com final <code>.conf</code> contêm a configuração para esses módulos. Módulos podem ser habilitados e desabilitados utilizando os comandos <code>a2enmod</code> e <code>a2dismod</code>.</li>
</ul>

<h3 id="registros-do-servidor">Registros do Servidor</h3>

<ul>
<li><code>/var/log/apache2/access.log</code>: Por padrão, cada solicitação feita para seu servidor é gravada neste arquivo de registro a menos que o Apache esteja configurado para fazer de outro modo.</li>
<li><code>/var/log/apache2/error.log</code>: Por padrão, todos os erros são gravados neste arquivo. A diretiva <code>LogLevel</code> na configuração do Apache especifica quanto detalhe os registros de erros irão conter.</li>
</ul>

<h2 id="conclusão">Conclusão</h2>

<p>Agora que você tem seu servidor Web instalado, você tem muitas opções para o tipo de conteúdo que você pode oferecer e as tecnologias que você quiser usar para criar uma experiência mais rica.</p>

<p>Se você quiser construir uma pilha de aplicativo mais completa, verifique este artigo sobre <a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-apache-mariadb-php-lamp-stack-debian9">como configurar uma pilha LAMP no Debian 9</a>.</p>
