---
layout: post
title: How To Install and Use ClickHouse on Debian 10
network: digitalocean
date: December 05, 2019 at 08:46PM
url: https://www.digitalocean.com/community/tutorials/how-to-install-and-use-clickhouse-on-debian-10
image: http://ifttt.com/images/no_image_card.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<p><em>The author selected the <a href="https://www.brightfunds.org/funds/foss-nonprofits">Free and Open Source Fund</a> to receive a donation as part of the <a href="https://do.co/w4do-cta">Write for DOnations</a> program.</em></p>

<h3 id="introduction">Introduction</h3>

<p><a href="https://clickhouse.yandex">ClickHouse</a> is an open-source, column-oriented analytics database created by <a href="https://yandex.com">Yandex</a> for <a href="https://en.wikipedia.org/wiki/Online_analytical_processing">OLAP</a> and big data use cases. ClickHouse&rsquo;s support for real-time query processing makes it suitable for applications that require sub-second analytical results. ClickHouse&rsquo;s query language is a dialect of SQL that enables powerful declarative querying capabilities while offering familiarity and a smaller learning curve for the end user.</p>

<p><em>Column-oriented</em> databases store records in blocks grouped by columns instead of rows. By not loading data for columns absent in the query, column-oriented databases spend less time reading data while completing queries. As a result, these databases can compute and return results much faster than traditional row-based systems for certain workloads, such as OLAP.</p>

<p><em>Online Analytics Processing</em> (OLAP) systems allow for organizing large amounts of data and performing complex queries. They are capable of managing petabytes of data and returning query results quickly. In this way, OLAP is useful for work in areas like data science and business analytics.</p>

<p>In this tutorial, you&rsquo;ll install the ClickHouse database server and client on your machine. You&rsquo;ll use the DBMS for typical tasks and optionally enable remote access from another server so that you&rsquo;ll be able to connect to the database from another machine. Then you&rsquo;ll test ClickHouse by modeling and querying example website-visit data.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
<li>One Debian 10 with a <code>sudo</code> enabled non-root user and firewall setup. You can follow the initial server setup <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-debian-10">tutorial</a> to create the user and set up the firewall.</li>
<li>(Optional) A secondary Debian 10 with a <code>sudo</code> enabled non-root user and firewall setup. You can follow the initial server setup <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-debian-10">tutorial</a>.</li>
</ul>

<h2 id="step-1-—-installing-clickhouse">Step 1 — Installing ClickHouse</h2>

<p>In this section, you will install the ClickHouse server and client programs using <code>apt</code>.</p>

<p>First, SSH into your server by running:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ssh <span class="highlight">sammy</span>@<span class="highlight">your_server_ip</span>
</li></ul></code></pre>
<p><code>dirmngr</code> is a server for managing certificates and keys. It is required for adding and verifying remote repository keys, install it by running:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt install dirmngr
</li></ul></code></pre>
<p>Yandex maintains an APT repository that has the latest version of ClickHouse. Add the repository&rsquo;s GPG key so that you&rsquo;ll be able to securely download validated ClickHouse packages:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt-key adv --keyserver keyserver.ubuntu.com --recv E0C56BD4
</li></ul></code></pre>
<p>You will see output similar to the following:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Executing: /tmp/apt-key-gpghome.JkkcKnBAFY/gpg.1.sh --keyserver keyserver.ubuntu.com --recv E0C56BD4

gpg: key C8F1E19FE0C56BD4: public key "ClickHouse Repository Key &lt;milovidov@yandex-team.ru&gt;" imported
gpg: Total number processed: 1
gpg:               imported: 1
</code></pre>
<p>The output confirms it has successfully verified and added the key.</p>

<p>Add the repository to your APT repositories list by executing:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">echo "deb http://repo.yandex.ru/clickhouse/deb/stable/ main/" | sudo tee /etc/apt/sources.list.d/clickhouse.list
</li></ul></code></pre>
<p>Here you&rsquo;ve piped the output of <code>echo</code> to <code>sudo tee</code> so that this output can print to a root-owned file.</p>

<p>Now, run <code>apt update</code> to update your packages:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt update
</li></ul></code></pre>
<p>The <code>clickhouse-server</code> and <code>clickhouse-client</code> packages will now be available for installation.</p>

<p>As of ClickHouse version 19.13.3, certain OpenSSL 1.1.1 configurations such as MinProtocol and CipherVersion are not read correctly. In order to workaround this incompatibility, modify the OpenSSL config file and comment out the <code>ssl_conf = ssl_sect</code> line in <code>/etc/ssl/openssl.cnf</code>.</p>

<p>Edit the configuration file by executing:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/ssl/openssl.cnf
</li></ul></code></pre>
<p>Then comment out the line containing <code>ssl_conf = ssl_sect</code>, so it looks like the following file:</p>
<div class="code-label " title="/etc/ssl/openssl.cnf">/etc/ssl/openssl.cnf</div><pre class="code-pre "><code langs="">...

tsa_name        = yes   # Must the TSA name be included in the reply?
                # (optional, default: no)
ess_cert_id_chain   = no    # Must the ESS cert id chain be included?
                # (optional, default: no)
ess_cert_id_alg     = sha1  # algorithm to compute certificate
                # identifier (optional, default: sha1)
[default_conf]
<span class="highlight">#ssl_conf = ssl_sect</span>

[ssl_sect]
...
</code></pre>
<p>Now that the OpenSSL config has been patched, you&rsquo;re ready to install the ClickHouse server and client packages. Install them with:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt install clickhouse-server clickhouse-client
</li></ul></code></pre>
<p>During the installation, you will be asked to set a password for the default ClickHouse user.</p>

<p>You&rsquo;ve installed the ClickHouse server and client successfully. You&rsquo;re now ready to start the database service and ensure that it&rsquo;s running correctly.</p>

<h2 id="step-2-—-starting-the-service">Step 2 — Starting the Service</h2>

<p>The <code>clickhouse-server</code> package that you installed in the previous section creates a <code>systemd</code> service, which performs actions such as starting, stopping, and restarting the database server. <a href="https://www.digitalocean.com/community/tutorials/understanding-systemd-units-and-unit-files"><code>systemd</code></a> is an init system for Linux to initialize and manage services. In this section you&rsquo;ll start the service and verify that it is running successfully.</p>

<p>Start the <code>clickhouse-server</code> service by running:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo service clickhouse-server start
</li></ul></code></pre>
<p>The previous command will not display any output. To verify that the service is running successfully, execute:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo service clickhouse-server status
</li></ul></code></pre>
<p>You&rsquo;ll see output similar to the following:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>● clickhouse-server.service - ClickHouse Server (analytic DBMS for big data)
   Loaded: loaded (/etc/systemd/system/clickhouse-server.service; enabled; vendor preset: enabled)
   Active: active (running) since Sat 2018-12-22 07:23:20 UTC; 1h 9min ago
 Main PID: 27101 (ClickHouse-serv)
    Tasks: 34 (limit: 1152)
   CGroup: /system.slice/ClickHouse-server.service
           └─27101 /usr/bin/ClickHouse-server --config=/etc/ClickHouse-server/config.xml
</code></pre>
<p>The output notes that the server is running.</p>

<p>You have successfully started the ClickHouse server and will now be able to use the <code>clickhouse-client</code> CLI program to connect to the server.</p>

<h2 id="step-3-—-creating-databases-and-tables">Step 3 — Creating Databases and Tables</h2>

<p>In ClickHouse, you can create and delete databases by executing SQL statements directly in the interactive database prompt. Statements consist of commands following a particular syntax that tell the database server to perform a requested operation along with any data required. You create databases by using the <code>CREATE DATABASE <span class="highlight">table_name</span></code> syntax. To create a database, first start a client session by running the following command:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">clickhouse-client --password
</li></ul></code></pre>
<p>You will be asked to enter the password you had set during the installation—enter it to successfully start the client session.</p>

<p>The previous command will log you in to the client prompt where you can run ClickHouse SQL statements to perform actions such as:</p>

<ul>
<li><p>Creating, updating, and deleting databases, tables, indexes, partitions, and views.</p></li>
<li><p>Executing queries to retrieve data that is optionally filtered and grouped using various conditions.</p></li>
</ul>

<p>In this step, with the ClickHouse client ready for inserting data, you&rsquo;re going to create a database and table. For the purposes of this tutorial, you&rsquo;ll create a database named <code><span class="highlight">test</span></code>, and inside that you&rsquo;ll create a table named <code><span class="highlight">visits</span></code> that tracks website-visit durations.</p>

<p>Now that you&rsquo;re inside the ClickHouse command prompt, create your <code><span class="highlight">test</span></code> database by executing:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ch:)">CREATE DATABASE <span class="highlight">test</span>;
</li></ul></code></pre>
<p>You&rsquo;ll see the following output that shows that you have created the database:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>CREATE DATABASE <span class="highlight">test</span>

Ok.

0 rows in set. Elapsed: 0.003 sec.
</code></pre>
<p>A ClickHouse table is similar to tables in other relational databases; it holds a collection of related data in a structured format. You can specify columns along with their types, add rows of data, and execute different kinds of queries on tables.</p>

<p>The syntax for creating tables in ClickHouse follows this example structure:</p>
<pre class="code-pre "><code langs="">CREATE TABLE <span class="highlight">table_name</span>
(
    <span class="highlight">column_name1 column_type</span> <span class="highlight">[options]</span>,
    <span class="highlight">column_name2 column_type</span> <span class="highlight">[options]</span>,
    ...
) ENGINE = <span class="highlight">engine</span>
</code></pre>
<p>The <code>table_name</code> and <code>column_name</code> values can be any valid ASCII identifiers. ClickHouse supports a wide range of column types; some of the most popular are:</p>

<ul>
<li><p><code>UInt64</code>: used for storing integer values in the range 0 to 18446744073709551615.</p></li>
<li><p><code>Float64</code>: used for storing floating point numbers such as 2039.23, 10.5, etc.</p></li>
<li><p><code>String</code>: used for storing variable length characters. It does not require a max-length attribute since it can store arbitrary lengths.</p></li>
<li><p><code>Date</code>: used for storing dates that follow the <code>YYYY-MM-DD</code> format.</p></li>
<li><p><code>DateTime</code>: used for storing dates coupled with time and follows the <code>YYYY-MM-DD HH:MM:SS</code> format.</p></li>
</ul>

<p>After the column definitions, you specify the engine used for the table. In ClickHouse, <em>Engines</em> determine the physical structure of the underlying data, the table&rsquo;s querying capabilities, its concurrent access modes, and support for indexes. Different engine types are suitable for different application requirements. The most commonly used and widely applicable engine type is <code>MergeTree</code>.</p>

<p>Now that you have an overview of table creation, you&rsquo;ll create a table. Start by confirming the database you&rsquo;ll be modifying:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ch:)">USE <span class="highlight">test</span>;
</li></ul></code></pre>
<p>You will see the following output showing that you have switched to the <code><span class="highlight">test</span></code> database from the <code>default</code> database:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>USE <span class="highlight">test</span>

Ok.

0 rows in set. Elapsed: 0.001 sec.
</code></pre>
<p>The remainder of this guide will assume that you are executing statements within this database&rsquo;s context.</p>

<p>Create your <code><span class="highlight">visits</span></code> table by running this command:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ch:)">CREATE TABLE <span class="highlight">visits</span> (
</li><li class="line" prefix="ch:)"> <span class="highlight">id UInt64</span>,
</li><li class="line" prefix="ch:)"> <span class="highlight">duration Float64</span>,
</li><li class="line" prefix="ch:)"> <span class="highlight">url String</span>,
</li><li class="line" prefix="ch:)"> <span class="highlight">created DateTime</span>
</li><li class="line" prefix="ch:)">) ENGINE = <span class="highlight">MergeTree() </span>
</li><li class="line" prefix="ch:)">PRIMARY KEY <span class="highlight">id </span>
</li><li class="line" prefix="ch:)">ORDER BY <span class="highlight">id</span>;
</li></ul></code></pre>
<p>Here&rsquo;s a breakdown of what the command does. You create a table named <code><span class="highlight">visits</span></code> that has four columns:</p>

<ul>
<li><p><code>id</code>: The primary key column. Similarly to other RDBMS systems, a primary key column in ClickHouse uniquely identifies a row; each row should have a unique value for this column.</p></li>
<li><p><code>duration</code>: A float column used to store the duration of each visit in seconds. <code>float</code> columns can store decimal values such as 12.50.</p></li>
<li><p><code>url</code>: A string column that stores the URL visited, such as <code>http://example.com</code>.</p></li>
<li><p><code>created</code>: A date and time column that tracks when the visit occurred.</p></li>
</ul>

<p>After the column definitions, you specify <code>MergeTree</code> as the storage engine for the table. The <a href="https://clickhouse.yandex/docs/en/operations/table_engines/mergetree/">MergeTree family</a> of engines is recommended for production databases due to its optimized support for large real-time inserts, overall robustness, and query support. Additionally, MergeTree engines support sorting of rows by primary key, partitioning of rows, and replicating and sampling data.</p>

<p>If you intend to use ClickHouse for archiving data that is not queried often or for storing temporary data, you can use the <a href="https://clickhouse.yandex/docs/en/operations/table_engines/log_family/">Log family</a> of engines to optimize for that use-case.</p>

<p>After the column definitions, you&rsquo;ll define other table-level options. The <code>PRIMARY KEY</code> clause sets <code>id</code> as the primary key column and the <code>ORDER BY</code> clause will store values sorted by the <code>id</code> column. A primary key uniquely identifies a row and is used for efficiently accessing a single row and efficient colocation of rows.</p>

<p>On executing the create statement, you will see the following output:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>CREATE TABLE visits
(
    id UInt64,
    duration Float64,
    url String,
    created DateTime
)
ENGINE = MergeTree()
PRIMARY KEY id
ORDER BY id

Ok.

0 rows in set. Elapsed: 0.010 sec.
</code></pre>
<p>In this section, you&rsquo;ve created a database and a table to track website-visit data. In the next step, you&rsquo;ll insert data into the table, update existing data, and delete that data.</p>

<h2 id="step-4-—-inserting-updating-and-deleting-data-and-columns">Step 4 — Inserting, Updating, and Deleting Data and Columns</h2>

<p>In this step, you&rsquo;ll use your <code><span class="highlight">visits</span></code> table to insert, update, and delete data. The following command is an example of the syntax for inserting rows into a ClickHouse table:</p>
<pre class="code-pre "><code langs="">INSERT INTO <span class="highlight">table_name</span> VALUES (<span class="highlight">column_1_value</span>, <span class="highlight">column_2_value, ....</span>);
</code></pre>
<p>Now, insert a few rows of example website-visit data into your <code><span class="highlight">visits</span></code> table by running each of the following statements:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ch:)">INSERT INTO <span class="highlight">visits</span> VALUES (<span class="highlight">1, 10.5, 'http://example.com', '2019-01-01 00:01:01'</span>);
</li></ul></code></pre><pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ch:)">INSERT INTO <span class="highlight">visits</span> VALUES (<span class="highlight">2, 40.2, 'http://example1.com', '2019-01-03 10:01:01'</span>);
</li></ul></code></pre><pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ch:)">INSERT INTO <span class="highlight">visits</span> VALUES (<span class="highlight">3, 13, 'http://example2.com', '2019-01-03 12:01:01'</span>);
</li></ul></code></pre><pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ch:)">INSERT INTO <span class="highlight">visits</span> VALUES (<span class="highlight">4, 2, 'http://example3.com', '2019-01-04 02:01:01'</span>);
</li></ul></code></pre>
<p>You&rsquo;ll see the following output repeated for each insert statement.</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>INSERT INTO <span class="highlight">visits</span> VALUES

Ok.

1 rows in set. Elapsed: 0.004 sec.
</code></pre>
<p>The output for each row shows that you&rsquo;ve inserted it successfully into the <code><span class="highlight">visits</span></code> table.</p>

<p>Now you&rsquo;ll add an additional column to the <code><span class="highlight">visits</span></code> table. When adding or deleting columns from existing tables, ClickHouse supports the <code>ALTER</code> syntax.</p>

<p>For example, the basic syntax for adding a column to a table is as follows:</p>
<pre class="code-pre "><code langs="">ALTER TABLE <span class="highlight">table_name</span> ADD COLUMN <span class="highlight">column_name column_type</span>;
</code></pre>
<p>Add a column named <code><span class="highlight">location</span></code> that will store the location of the visits to a website by running the following statement:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ch:)">ALTER TABLE <span class="highlight">visits</span> ADD COLUMN <span class="highlight">location String</span>;
</li></ul></code></pre>
<p>You&rsquo;ll see output similar to the following:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>ALTER TABLE <span class="highlight">visits</span>
    ADD COLUMN
    location String


Ok.

0 rows in set. Elapsed: 0.014 sec.
</code></pre>
<p>The output shows that you have added the <code><span class="highlight">location</span></code> column successfully.</p>

<p>As of version 19.13.3, ClickHouse doesn&rsquo;t support updating and deleting individual rows of data due to implementation constraints. ClickHouse has support for bulk updates and deletes, however, and has a distinct SQL syntax for these operations to highlight their non-standard usage.</p>

<p>The following syntax is an example for bulk updating rows:</p>
<pre class="code-pre "><code langs="">ALTER TABLE <span class="highlight">table_name</span> UPDATE <span class="highlight"> column_1 = value_1, column_2 = value_2 ... </span> WHERE <span class="highlight"> filter_conditions</span>;
</code></pre>
<p>You&rsquo;ll run the following statement to update the <code>url</code> column of all rows that have a <code>duration</code> of less than 15. Enter it into the database prompt to execute:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ch:)">ALTER TABLE <span class="highlight">visits</span> UPDATE url = '<span class="highlight">http://example2.com</span>' WHERE <span class="highlight">duration &lt; 15</span>;
</li></ul></code></pre>
<p>The output of the bulk update statement will be as follows:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>ALTER TABLE <span class="highlight">visits</span>
    UPDATE url = '<span class="highlight">http://example2.com</span>' WHERE duration &lt; 15


Ok.

0 rows in set. Elapsed: 0.003 sec.
</code></pre>
<p>The output shows that your update query completed successfully. The <code>0 rows in set</code> in the output denotes that the query did not return any rows; this will be the case for any update and delete queries.</p>

<p>The example syntax for bulk deleting rows is similar to updating rows and has the following structure:</p>
<pre class="code-pre "><code langs="">ALTER TABLE <span class="highlight">table_name</span> DELETE WHERE <span class="highlight">filter_conditions</span>;
</code></pre>
<p>To test deleting data, run the following statement to remove all rows that have a <code>duration</code> of less than <code>5</code>:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ch:)">ALTER TABLE <span class="highlight">visits</span> DELETE WHERE <span class="highlight">duration &lt; 5</span>;
</li></ul></code></pre>
<p>The output of the bulk delete statement will be similar to:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>ALTER TABLE <span class="highlight">visits</span>
    DELETE WHERE duration &lt; 5


Ok.

0 rows in set. Elapsed: 0.003 sec.
</code></pre>
<p>The output confirms that you have deleted the rows with a duration of less than five seconds.</p>

<p>To delete columns from your table, the syntax would follow this example structure:</p>
<pre class="code-pre "><code langs="">ALTER TABLE <span class="highlight">table_name</span> DROP COLUMN <span class="highlight">column_name</span>;
</code></pre>
<p>Delete the <code>location</code> column you added previously by running the following:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ch:)">ALTER TABLE <span class="highlight">visits</span> DROP COLUMN <span class="highlight">location</span>;
</li></ul></code></pre>
<p>The <code>DROP COLUMN</code> output confirming that you have deleted the column will be as follows:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>ALTER TABLE <span class="highlight">visits</span>
    DROP COLUMN
    location String


Ok.

0 rows in set. Elapsed: 0.010 sec.
</code></pre>
<p>Now that you&rsquo;ve successfully inserted, updated, and deleted rows and columns in your <code><span class="highlight">visits</span></code> table, you&rsquo;ll move on to query data in the next step.</p>

<h2 id="step-5-—-querying-data">Step 5 — Querying Data</h2>

<p>ClickHouse&rsquo;s query language is a custom dialect of SQL with extensions and functions suited for analytics workloads. In this step, you&rsquo;ll run selection and aggregation queries to retrieve data and results from your <code><span class="highlight">visits</span></code> table.</p>

<p>Selection queries allow you to retrieve rows and columns of data filtered by conditions that you specify, along with options such as the number of rows to return. You can select rows and columns of data using the <code>SELECT</code> syntax. The basic syntax for <code>SELECT</code> queries is:</p>
<pre class="code-pre "><code langs="">SELECT <span class="highlight">func_1(column_1), func_2(column_2)</span> FROM <span class="highlight">table_name</span> WHERE <span class="highlight">filter_conditions row_options</span>;
</code></pre>
<p>Execute the following statement to retrieve <code>url</code> and <code>duration</code> values for rows where the <code>url</code> is <code>http://example.com</code>.</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ch:)">SELECT url, duration FROM <span class="highlight">visits</span> WHERE url = 'http://example2.com' LIMIT 2;
</li></ul></code></pre>
<p>You will see the following output:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>SELECT
    url,
    duration
FROM <span class="highlight">visits</span>
WHERE url = 'http://example2.com'
LIMIT 2

┌─url─────────────────┬─duration─┐
│ http://example2.com │     10.5 │
└─────────────────────┴──────────┘
┌─url─────────────────┬─duration─┐
│ http://example2.com │       13 │
└─────────────────────┴──────────┘

2 rows in set. Elapsed: 0.013 sec.
</code></pre>
<p>The output has returned two rows that match the conditions you specified. Now that you&rsquo;ve selected values, you can move on to executing <em>aggregation queries</em>.</p>

<p>Aggregation queries are queries that operate on a set of values and return single output values. In analytics databases, these queries are run frequently and are well optimized by the database. Some aggregate functions supported by ClickHouse are:</p>

<ul>
<li><p><code>count</code>: returns the count of rows matching the conditions specified.</p></li>
<li><p><code>sum</code>: returns the sum of selected column values.</p></li>
<li><p><code>avg</code>: returns the average of selected column values.</p></li>
</ul>

<p>Some ClickHouse-specific aggregate functions include:</p>

<ul>
<li><p><code>uniq</code>: returns an approximate number of distinct rows matched.</p></li>
<li><p><code>topK</code>: returns an array of the most frequent values of a specific column using an approximation algorithm.</p></li>
</ul>

<p>To demonstrate the execution of aggregation queries, you&rsquo;ll calculate the total duration of visits by running the <code>sum</code> query:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ch:)">SELECT <span class="highlight">SUM(duration)</span> FROM <span class="highlight">visits</span>;
</li></ul></code></pre>
<p>You will see output similar to the following:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>SELECT <span class="highlight">SUM(duration)</span>
FROM <span class="highlight">visits</span>

┌─SUM(duration)─┐
│          63.7 │
└───────────────┘

1 rows in set. Elapsed: 0.010 sec.
</code></pre>
<p>Now, calculate the top two URLs by executing:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ch:)">SELECT <span class="highlight">topK(2)(url)</span> FROM <span class="highlight">visits</span>;
</li></ul></code></pre>
<p>You will see output similar to the following:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>SELECT topK(2)(url)
FROM visits

┌─topK(2)(url)──────────────────────────────────┐
│ ['http://example2.com','http://example1.com'] │
└───────────────────────────────────────────────┘

1 rows in set. Elapsed: 0.010 sec.
</code></pre>
<p>Now that you have successfully queried your <code><span class="highlight">visits</span></code> table, you&rsquo;ll delete tables and databases in the next step.</p>

<h2 id="step-6-—-deleting-tables-and-databases">Step 6 — Deleting Tables and Databases</h2>

<p>In this section, you&rsquo;ll delete your <code><span class="highlight">visits</span></code> table and <code><span class="highlight">test</span></code> database.</p>

<p>The syntax for deleting tables follows this example:</p>
<pre class="code-pre "><code langs="">DROP TABLE <span class="highlight">table_name</span>;
</code></pre>
<p>To delete the <code><span class="highlight">visits</span></code> table, run the following statement:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ch:)">DROP TABLE <span class="highlight">visits</span>;
</li></ul></code></pre>
<p>You will see the following output declaring that you&rsquo;ve deleted the table successfully:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="output">output</div>DROP TABLE <span class="highlight">visits</span>

Ok.

0 rows in set. Elapsed: 0.005 sec.
</code></pre>
<p>You can delete databases using the <code>DROP database <span class="highlight">table_name</span></code> syntax. To delete the <code><span class="highlight">test</span></code> database, execute the following statement:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ch:)">DROP DATABASE <span class="highlight">test</span>;
</li></ul></code></pre>
<p>The resulting output shows that you&rsquo;ve deleted the database successfully.</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>DROP DATABASE <span class="highlight">test</span>

Ok.

0 rows in set. Elapsed: 0.003 sec.
</code></pre>
<p>You&rsquo;ve deleted tables and databases in this step. Now that you&rsquo;ve created, updated, and deleted databases, tables, and data in your ClickHouse instance, you&rsquo;ll enable remote access to your database server in the next section.</p>

<h2 id="step-7-—-setting-up-firewall-rules-optional">Step 7 — Setting Up Firewall Rules (Optional)</h2>

<p>If you intend to only use ClickHouse locally with applications running on the same server, or do not have a firewall enabled on your server, you don&rsquo;t need to complete this section. If instead, you&rsquo;ll be connecting to the ClickHouse database server remotely, you should follow this step.</p>

<p>Currently your server has a firewall enabled that disables your public IP address accessing all ports. You&rsquo;ll complete the following two steps to allow remote access:</p>

<ul>
<li><p>Modify ClickHouse&rsquo;s configuration and allow it to listen on all interfaces.</p></li>
<li><p>Add a firewall rule allowing incoming connections to port <code>8123</code>, which is the HTTP port that the ClickHouse server runs.</p></li>
</ul>

<p>If you are inside the database prompt, exit it by typing <code>CTRL+D</code>.</p>

<p>Edit the configuration file by executing:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/clickhouse-server/config.xml
</li></ul></code></pre>
<p>Then uncomment the line containing <code>&lt;!-- &lt;listen_host&gt;0.0.0.0&lt;/listen_host&gt; --&gt;</code>, like the following file:</p>
<div class="code-label " title="/etc/clickhouse-server/config.xml">/etc/clickhouse-server/config.xml</div><pre class="code-pre "><code langs="">...
 &lt;interserver_http_host&gt;example.yandex.ru&lt;/interserver_http_host&gt;
    --&gt;

    &lt;!-- Listen specified host. use :: (wildcard IPv6 address), if you want to accept connections both with IPv4 and IPv6 from everywhere. --&gt;
    &lt;!-- &lt;listen_host&gt;::&lt;/listen_host&gt; --&gt;
    &lt;!-- Same for hosts with disabled ipv6: --&gt;
    <span class="highlight">&lt;listen_host&gt;0.0.0.0&lt;/listen_host&gt;</span>

    &lt;!-- Default values - try listen localhost on ipv4 and ipv6: --&gt;
    &lt;!--
    &lt;listen_host&gt;::1&lt;/listen_host&gt;
    &lt;listen_host&gt;127.0.0.1&lt;/listen_host&gt;
    --&gt;
...
</code></pre>
<p>Save the file and exit. For the new configuration to apply restart the service by running:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo service clickhouse-server restart
</li></ul></code></pre>
<p>You won&rsquo;t see any output from this command. ClickHouse&rsquo;s server listens on port <code>8123</code> for HTTP connections and port <code>9000</code> for connections from <code>clickhouse-client</code>. Allow access to both ports for your second server&rsquo;s IP address with the following command:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow from <span class="highlight">second_server_ip</span>/32 to any port 8123  
</li></ul></code></pre><pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow from <span class="highlight">second_server_ip</span>/32 to any port 9000  
</li></ul></code></pre>
<p>You will see the following output for both commands that shows that you&rsquo;ve enabled access to both ports:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Rule added
</code></pre>
<p>ClickHouse will now be accessible from the IP that you added. Feel free to add additional IPs such as your local machine&rsquo;s address if required.</p>

<p>To verify that you can connect to the ClickHouse server from the remote machine, first follow the steps in Step 1 of this tutorial on the second server and ensure that you have the <code>clickhouse-client</code> installed on it.</p>

<p>Now that you have logged in to the second server, start a client session by executing:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">clickhouse-client --host <span class="highlight">your_server_ip</span> --password
</li></ul></code></pre>
<p>You will see the following output that shows that you have connected successfully to the server:</p>
<pre class="code-pre  second-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>ClickHouse client version 19.13.3.26 (official build).
Password for user (default):
Connecting to <span class="highlight">your_server_ip</span>:9000 as user default.
Connected to ClickHouse server version 19.13.3 revision 54425.

<span class="highlight">hostname</span> :)
</code></pre>
<p>In this step, you&rsquo;ve enabled remote access to your ClickHouse database server by adjusting your firewall rules.</p>

<h2 id="conclusion">Conclusion</h2>

<p>You have successfully set up a ClickHouse database instance on your server and created a database and table, added data, performed queries, and deleted the database. Within ClickHouse&rsquo;s documentation you can read about their <a href="https://ClickHouse.yandex/benchmark.html">benchmarks</a> against other open-source and commercial analytics databases and general reference <a href="https://ClickHouse.yandex/docs/en/">documents</a>.</p>

<p>Further <a href="https://ClickHouse.yandex/docs/en/introduction/distinctive_features/">features</a> ClickHouse offers include distributed query processing across multiple servers to improve performance and protect against data loss by storing data over different <a href="https://www.digitalocean.com/community/tutorials/understanding-database-sharding">shards</a>.</p>
