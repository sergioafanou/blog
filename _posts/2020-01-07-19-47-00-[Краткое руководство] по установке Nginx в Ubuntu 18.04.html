---
layout: post
title: [Краткое руководство] по установке Nginx в Ubuntu 18.04
network: digitalocean
date: January 07, 2020 at 07:47PM
url: https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-18-04-quickstart-ru
image: https://assets.digitalocean.com/articles/nginx_1604/default_page.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="Введение">Введение</h3>

<p>Nginx — один из самых популярных в мире веб-серверов, на базе которого размещены некоторые из самых крупных сайтов интернета с огромным трафиком. Обычно он использует ресурсы эффективнее, чем Apache, и может использоваться как веб-сервер или обратный прокси-сервер.</p>

<p>В этом обучающем модуле мы расскажем, как установить Nginx на сервере Ubuntu 18.04. Более подробную версию этого обучающего модуля можно найти в <a href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-18-04">документе Установка Nginx в Ubuntu 18.04</a>.</p>

<h2 id="Предварительные-требования">Предварительные требования</h2>

<p>Для прохождения этого обучающего модуля вам потребуется следующее:</p>

<ul>
<li>Один сервер Ubuntu 18.04 и обычный пользователь без прав root с привилегиями sudo. Также вам потребуется включить базовый брандмауэр, чтобы заблокировать все порты, кроме необходимых. Вы научитесь настраивать учетную запись обычного пользователя и брандмауэр, следуя указаниям руководства <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-18-04">Начальная настройка сервера Ubuntu 18.04</a>.</li>
</ul>

<p>Создав учетную запись, войдите в систему как пользователь без привилегий root.</p>

<h2 id="Шаг-1-–-Установка-nginx">Шаг 1 – Установка Nginx</h2>

<p>Поскольку Nginx доступен в хранилищах Ubuntu по умолчанию, вы можете установить его с помощью системы пакетов <code>apt</code>.</p>

<p>Обновите локальный индекс пакетов:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt update
</li></ul></code></pre>
<p>Установите Nginx:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt install nginx
</li></ul></code></pre>
<h2 id="Шаг-2-—-Настройка-брандмауэра">Шаг 2 — Настройка брандмауэра</h2>

<p>Если вы выполнили указания обучающего модуля по предварительной настройке сервера, вы уже активировали брандмауэр UFW. Проверьте доступные профили приложений <code>ufw</code> с помощью следующей команды:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw app list
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Available applications:
  Nginx Full
  Nginx HTTP
  Nginx HTTPS
  OpenSSH
</code></pre>
<p>Мы активируем профиль с наибольшими ограничениями, который будет разрешать заданный трафик, а именно трафик на порту <code>80</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow 'Nginx HTTP'
</li></ul></code></pre>
<p>Проверьте изменения:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw status
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Status: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere                  
Nginx HTTP                 ALLOW       Anywhere                  
OpenSSH (v6)               ALLOW       Anywhere (v6)             
Nginx HTTP (v6)            ALLOW       Anywhere (v6)
</code></pre>
<h2 id="Шаг-3-–-Проверка-веб-сервера">Шаг 3 – Проверка веб-сервера</h2>

<p>Используйте команду <code>systemd</code> init system, чтобы проверить работу службы:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">systemctl status nginx
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>● nginx.service - A high performance web server and a reverse proxy server
   Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)
   Active: <span class="highlight">active (running)</span> since Fri 2018-04-20 16:08:19 UTC; 3 days ago
     Docs: man:nginx(8)
 Main PID: 2369 (nginx)
    Tasks: 2 (limit: 1153)
   CGroup: /system.slice/nginx.service
           ├─2369 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;
           └─2380 nginx: worker process
</code></pre>
<p>Откройте страницу Nginx по умолчанию, чтобы подтвердить работу программного обеспечения через ваш IP-адрес:</p>
<pre class="code-pre "><code langs="">http://<span class="highlight">your_server_ip</span>
</code></pre>
<p>Вы увидите начальную страницу Nginx по умолчанию:</p>

<p><img src="https://assets.digitalocean.com/articles/nginx_1604/default_page.png" alt="Страница Nginx по умолчанию"></p>

<h2 id="Шаг-4-—-Настройка-блоков-сервера-рекомендуется">Шаг 4 — Настройка блоков сервера (рекомендуется)</h2>

<p>При использовании веб-сервера Nginx вы можете использовать <em>блоки сервера</em> (аналогичные виртуальным хостам в Apache) для инкапсуляции данных конфигурации и размещения на одном сервере нескольких доменов. Мы создадим домен <strong>example.com</strong>, но вы должны <strong>заменить это имя собственным доменным именем</strong>. Чтобы узнать больше о настройке доменного имени с помощью DigitalOcean, пройдите наш обучающий модуль <a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-digitalocean-dns">Введение в DigitalOcean DNS</a>.</p>

<p>Создайте каталог для <code><span class="highlight">example.com</span></code>, используя опцию <code>-p</code> для создания необходимых родительских каталогов:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo mkdir -p /var/www/<span class="highlight">example.com</span>/html
</li></ul></code></pre>
<p>Назначьте владельца каталога:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo chown -R $USER:$USER /var/www/<span class="highlight">example.com</span>/html
</li></ul></code></pre>
<p>Разрешения корневых каталогов веб-сервера должны быть правильными, если вы не изменяли значение <code>umask</code>. Тем не менее, вы можете проверить это с помощью следующей команды:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo chmod -R 755 /var/www/<span class="highlight">example.com</span>
</li></ul></code></pre>
<p>Создайте в качестве примера страницу <code>index.html</code>, используя <code>nano</code> или свой любимый редактор:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano /var/www/<span class="highlight">example.com</span>/html/index.html
</li></ul></code></pre>
<p>Добавьте в страницу следующий образец кода HTML:</p>
<div class="code-label " title="/var/www/example.com/html/index.html">/var/www/example.com/html/index.html</div><pre class="code-pre "><code langs="">&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Welcome to <span class="highlight">Example.com</span>!&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Success!  The <span class="highlight">example.com</span> server block is working!&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Сохраните файл и закройте его после завершения.</p>

<p>Создайте новый серверный блок в <code>/etc/nginx/sites-available/<span class="highlight">example.com</span></code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/nginx/sites-available/<span class="highlight">example.com</span>
</li></ul></code></pre>
<p>Вставьте следующий блок конфигурации, обновленный с учетом новых имен каталога и домена:</p>
<div class="code-label " title="/etc/nginx/sites-available/example.com">/etc/nginx/sites-available/example.com</div><pre class="code-pre "><code langs="">server {
        listen 80;
        listen [::]:80;

        root /var/www/<span class="highlight">example.com</span>/html;
        index index.html index.htm index.nginx-debian.html;

        server_name <span class="highlight">example.com</span> www.<span class="highlight">example.com</span>;

        location / {
                try_files $uri $uri/ =404;
        }
}
</code></pre>
<p>Сохраните файл и закройте его после завершения.</p>

<p>Активируйте файл, создав ссылку от него в каталог <code>sites-enabled</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ln -s /etc/nginx/sites-available/<span class="highlight">example.com</span> /etc/nginx/sites-enabled/
</li></ul></code></pre>
<p>Теперь два серверных блока активированы и настроены отвечать на запросы на базе директив <code>listen</code> и <code>server_name</code>:</p>

<ul>
<li><code>example.com</code>: будет отвечать на запросы <code>example.com</code> и <code>www.example.com</code>.</li>
<li><code>default</code>: будет отвечать на любые запросы порта <code>80</code>, не соответствующие двум другим блокам.</li>
</ul>

<p>Чтобы избежать возможной проблемы с хэшированием памяти при добавлении дополнительных имен серверов, необходимо изменить одно значение в файле <code>/etc/nginx/nginx.conf.</code> Откройте файл:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/nginx/nginx.conf
</li></ul></code></pre>
<p>Найдите директиву <code>server_names_hash_bucket_size</code> и удалите символ <code>#</code>, чтобы убрать режим комментариев для строки:</p>
<div class="code-label " title="/etc/nginx/nginx.conf">/etc/nginx/nginx.conf</div><pre class="code-pre "><code langs="">...
http {
    ...
    server_names_hash_bucket_size 64;
    ...
}
...
</code></pre>
<p>Проверьте ошибки синтаксиса:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nginx -t
</li></ul></code></pre>
<p>Перезапустите Nginx, чтобы активировать изменения:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart nginx
</li></ul></code></pre>
<p>Теперь Nginx должен обслуживать ваше доменное имя. Вы можете проверить это, открыв в браузере адрес <code>http://<span class="highlight">example.com</span></code>, после чего должны увидеть примерно следующее:</p>

<p><img src="https://assets.digitalocean.com/articles/nginx_server_block_1404/first_block.png" alt="Первый блок сервера Nginx"></p>

<h2 id="Заключение">Заключение</h2>

<p>Теперь вы установили веб-сервер и у вас есть богатые возможности выбора типа обслуживаемого контента и технологий для расширения возможностей пользователя.</p>

<p>Если вы хотите развернуть более сложный набор обслуживания приложений, ознакомьтесь с этой статьей о <a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-nginx-mysql-php-lemp-stack-ubuntu-18-04">настройке набора LEMP в Ubuntu 18.04</a>.</p>
