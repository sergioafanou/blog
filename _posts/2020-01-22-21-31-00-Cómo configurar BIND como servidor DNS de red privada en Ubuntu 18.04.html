---
layout: post
title: Cómo configurar BIND como servidor DNS de red privada en Ubuntu 18.04
network: digitalocean
date: January 22, 2020 at 09:31PM
url: https://www.digitalocean.com/community/tutorials/how-to-configure-bind-as-a-private-network-dns-server-on-ubuntu-18-04-es
image: http://ifttt.com/images/no_image_card.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="introducción">Introducción</h3>

<p>Una parte importante de la administración de la configuración e infraestructura de servidores incluye el uso sostenido de un método sencillo para buscar las interfaces de red y direcciones IP por nombre mediante la configuración de un sistema de nombres de dominio (DNS) adecuado. El empleo de nombres de dominio completos (FQDN), en vez de direcciones IP, para especificar las direcciones de red puede facilitar la configuración de servicios y aplicaciones, y aumenta la capacidad de mantenimiento de los archivos de configuración. Configurar su propio DNS para su red privada es una excelente opción para mejorar la administración de sus servidores.</p>

<p>En este tutorial, veremos la manera de configurar un servidor DNS interno usando el software de servidor de nombres BIND (BIND9) en Ubuntu 18.04, que sus servidores pueden usar para resolver direcciones IP y nombres de hosts privados. Esto ofrece una alternativa centralizada para administrar sus nombres de hosts internos y direcciones IP privadas, lo cual es indispensable cuando su entorno abarca más de unos pocos hosts.</p>

<p>Puede encontrar la versión de CentOS de este tutorial <a href="https://www.digitalocean.com/community/tutorials/how-to-configure-bind-as-a-private-network-dns-server-on-centos-7">aquí</a>.</p>

<h2 id="requisitos-previos">Requisitos previos</h2>

<p>Para completar este tutorial, necesitará la infraestructura siguiente. Cree cada servidor <strong>en el mismo centro de datos</strong> con <strong><a href="https://www.digitalocean.com/docs/networking/private-networking/quickstart/">red privada habilitada</a></strong>:</p>

<ul>
<li>Un servidor de Ubuntu 18.04 nuevo que servirá como el servidor DNS primario, <strong>ns1</strong>.</li>
<li>(Recomendado) Un segundo servidor Ubuntu 18.04 que servirá como servidor DNS secundario, <strong>ns2</strong>.</li>
<li>Servidores adicionales en el mismo centro de datos que usarán sus servidores DNS.</li>
</ul>

<p>En cada uno de estos servidores, configure un acceso administrativo mediante un usuario <code>sudo</code> y un firewall siguiendo nuestra <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-18-04">guía de configuración inicial para servidores de Ubuntu 18.04</a>.</p>

<p>Si no está familiarizado con los conceptos de DNS, se recomienda que lea al menos las tres primeras partes de nuestra <a href="https://www.digitalocean.com/community/tutorial_series/an-introduction-to-managing-dns">Introducción a la administración de DNS</a>.</p>

<h3 id="ejemplo-e-infraestructura-y-objetivos">Ejemplo e infraestructura y objetivos</h3>

<p>A efectos de este artículo, supondremos lo siguiente:</p>

<ul>
<li>Tenemos dos servidores que se designarán como nuestros servidores de nombres DNS. En esta guía, nos referiremos a estos como <strong>ns1</strong> y <strong>ns2</strong>.</li>
<li>Disponemos de dos servidores clientes adicionales que usarán la infraestructura DNS que creemos. En esta guía, los llamaremos <strong>host1</strong> y <strong>host2</strong>. Puede añadir tantos como desee en su infraestructura.</li>
<li>Todos estos servidores existen en el mismo centro de datos. Supondremos que este es el centro de datos <strong>nyc3</strong>.</li>
<li>Todos estos servidores tienen habilitada una red privada y están en la subred <code>10.128.0.0/16</code>. Probablemente deba ajustar esto para sus servidores.</li>
<li>Todos los servidores se conectan a un proyecto que se ejecuta en “example.com”. Ya que nuestro sistema DNS será totalmente interno y privado, no es necesario que compre un nombre de dominio. Sin embargo, el uso de un dominio propio puede evitar conflictos con dominios públicos enrutables.</li>
</ul>

<p>Con estas suposiciones, decidimos que tiene sentido usar un esquema de nomenclatura que emplee “nyc3.example.com” para hacer referencia a nuestra subred o zona privada. Por tanto, el nombre de dominio completo (FQDN) privado de <strong>host1</strong>, será <strong>host1.ny3.example.com</strong>. Consulte la siguiente tabla que contiene la información pertinente:</p>

<table><thead>
<tr>
<th>host</th>
<th>Rol</th>
<th>FQDN privada</th>
<th>Dirección IP privada</th>
</tr>
</thead><tbody>
<tr>
<td>ns1</td>
<td>Servidor DNS primario</td>
<td>ns1.nyc3.example.com</td>
<td>10.128.10.11</td>
</tr>
<tr>
<td>ns2</td>
<td>Servidor DNS secundario</td>
<td>ns2.nyc3.example.com</td>
<td>10.128.20.12</td>
</tr>
<tr>
<td>host1</td>
<td>Host genérico 1</td>
<td>host1.nyc3.example.com</td>
<td>10.128.100.101</td>
</tr>
<tr>
<td>host2</td>
<td>Host genérico 2</td>
<td>host2.nyc3.example.com</td>
<td>10.128.200.102</td>
</tr>
</tbody></table>

<p><span class='note'><strong>Nota:</strong> Su configuración existente será diferente, pero los nombres de ejemplo y las direcciones IP se utilizarán para demostrar la forma de configurar un servidor DNS para que proporcione un DNS interno funcional. Debería poder adaptar fácilmente esta configuración para su propio entorno sustituyendo los nombres de hosts y direcciones IP privadas por los suyos. No es necesario usar el nombre de la región del centro de datos en su esquema de nomenclatura, pero lo utilizaremos aquí para denotar que estos hosts pertenecen a la red privada de un centro de datos concreto. Si utiliza varios centros de datos, puede configurar un DNS interno con cada centro de datos respectivo.<br></span></p>

<p>Al final de este tutorial, dispondremos de un servidor DNS primario, <strong>ns1</strong>, y de forma opcional uno secundario, <strong>ns2</strong>, que servirá como respaldo.</p>

<p>Comenzaremos instalando nuestro servidor DNS primario, ns1.</p>

<h2 id="instalar-bind-en-servidores-dns">Instalar BIND en servidores DNS</h2>

<p><span class='note'><strong>Nota:</strong> El texto resaltado en <span class="highlight">rojo</span> es importante. A menudo se usará para indicar algo que debe sustituirse por sus propios ajustes o que debería modificarse o añadirse a un archivo de configuración. Por ejemplo, si ve algo similar a <code><span class="highlight">host1.nyc3.example.com</span></code>, sustitúyalo por el FQDN de su servidor. Asimismo, si ve <code><span class="highlight">host1_private_IP</span>,</code> sustitúyalo por la dirección IP privada de su propio servidor.<br></span></p>

<p>En ambos servidores DNS, <strong>ns1</strong> y <strong>ns2</strong>, actualice la caché del paquete <code>apt</code> escribiendo lo siguiente:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ns$">sudo apt-get update
</li></ul></code></pre>
<p>Ahora instale BIND:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ns$">sudo apt-get install bind9 bind9utils bind9-doc
</li></ul></code></pre>
<h3 id="configurar-bind-para-el-modo-ipv4">Configurar Bind para el modo IPv4</h3>

<p>Antes de continuar, configuraremos BIND para el modo IPv4, ya que nuestra red privada utiliza IPv4 exclusivamente. En ambos servidores, edite la configuración predeterminada de <code>bind9</code> escribiendo lo siguiente:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ns$">sudo nano /etc/default/bind9
</li></ul></code></pre>
<p>Añada “-4” al final del parámetro <code>OPTIONS</code>. Debería tener el siguiente aspecto:</p>
<div class="code-label " title="/etc/default/bind9">/etc/default/bind9</div><pre class="code-pre "><code langs="">. . .
OPTIONS="-u bind <span class="highlight">-4</span>"
</code></pre>
<p>Guarde y cierre el archivo cuando haya terminado.</p>

<p>Reinicie BIND para implementar los cambios:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="ns$">sudo systemctl restart bind9
</li></ul></code></pre>
<p>Ahora que BIND está instalado, configuraremos el servidor DNS primario.</p>

<h2 id="configurar-el-servidor-dns-primario">Configurar el servidor DNS primario</h2>

<p>La configuración de BIND consta de varios archivos que se incluyen desde el archivo de configuración principal, <code>named.conf</code>. Estos nombres de archivos comienzan con <code>named</code> porque ese es el nombre del proceso que BIND ejecuta (abreviatura de “domain name daemon”). Comenzaremos configurando el archivo de opciones.</p>

<h3 id="configurar-el-archivo-de-opciones">Configurar el archivo de opciones</h3>

<p>En <strong>ns1</strong>, abra el archivo <code>named.conf.options</code> para editarlo:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ns1$">sudo nano /etc/bind/named.conf.options
</li></ul></code></pre>
<p>Sobre el bloque <code>options</code> existente, cree un <em>nuevo</em> bloque ACL (lista de control de acceso) llamado “trusted”. Aquí definiremos una lista de clientes desde los que permitiremos consultas de DNS recurrentes (es decir, sus servidores que están en el mismo centro de datos que <strong>ns1</strong>). Usando nuestras direcciones IP privadas de ejemplo, añadiremos <strong>ns1</strong>, <strong>ns2</strong>, <strong>host1</strong> y <strong>host2</strong> a nuestra lista de clientes de confianza:</p>
<div class="code-label " title="/etc/bind/named.conf.options — 1 of 3">/etc/bind/named.conf.options — 1 of 3</div><pre class="code-pre  second-environment"><code langs="">acl "trusted" {
        <span class="highlight">10.128.10.11</span>;    # ns1 - can be set to localhost
        <span class="highlight">10.128.20.12</span>;    # ns2
        <span class="highlight">10.128.100.101</span>;  # host1
        <span class="highlight">10.128.200.102</span>;  # host2
};

options {

        . . .
</code></pre>
<p>Ahora que tenemos nuestra lista de clientes DNS de confianza, nos convendrá editar el bloque <code>options</code>. En este momento, el inicio del bloque tiene el siguiente aspecto:</p>
<div class="code-label " title="/etc/bind/named.conf.options — 2 of 3">/etc/bind/named.conf.options — 2 of 3</div><pre class="code-pre  second-environment"><code langs="">        . . .
};

options {
        directory "/var/cache/bind";
        . . .
}
</code></pre>
<p>Debajo de la directiva <code>directory</code>, añada las líneas de configuración resaltadas (y realice la sustitución en la dirección IP adecuada de <strong>ns1</strong>) para que tenga un aspecto similar a este:</p>
<div class="code-label " title="/etc/bind/named.conf.options — 3 of 3">/etc/bind/named.conf.options — 3 of 3</div><pre class="code-pre  second-environment"><code langs="">        . . .

};

options {
        directory "/var/cache/bind";

        <span class="highlight">recursion yes;</span>                 # enables resursive queries
        <span class="highlight">allow-recursion { trusted; };</span>  # allows recursive queries from "trusted" clients
        <span class="highlight">listen-on { 10.128.10.11; };</span>   # ns1 private IP address - listen on private network only
        <span class="highlight">allow-transfer { none; };</span>      # disable zone transfers by default

        <span class="highlight">forwarders {</span>
                <span class="highlight">8.8.8.8;</span>
                <span class="highlight">8.8.4.4;</span>
        <span class="highlight">};</span>

        . . .
};
</code></pre>
<p>Cuando termine, guarde y cierre el archivo <code>named.conf.options</code>. En la configuración anterior se especifica que solo sus propios servidores (los “trusted”) podrán consultar su servidor DNS en busca de dominios externos.</p>

<p>A continuación, configuraremos el archivo local para especificar nuestras zonas de DNS.</p>

<h3 id="configurar-el-archivo-local">Configurar el archivo local</h3>

<p>En <strong>ns1</strong>, abra el archivo <code>named.conf.options</code> para editarlo:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ns1$">sudo nano /etc/bind/named.conf.local
</li></ul></code></pre>
<p>Aparte de algunos contener algunos comentarios, el archivo debería estar vacío. Aquí especificaremos nuestras zonas de reenvío e inversas. Las <strong>zonas DNS</strong> designan un alcance específico para administrar y definir registros DNS. Debido a que todos nuestros dominios estarán en el subdominio “nyc3.example.com”, usaremos eso como nuestra zona de reenvío. Debido a que las direcciones IP privadas de nuestros servidores están en el espacio IP <code>10.128.0.0/16</code>, configuraremos una zona inversa para poder definir búsquedas inversas en ese intervalo.</p>

<p>Añada la zona de reenvío con las siguientes líneas, sustituyendo el nombre de la zona por el suyo y la <strong>dirección IP privada del servidor DNS secundario</strong> en la directiva <code>allow-transfer</code>:</p>
<div class="code-label " title="/etc/bind/named.conf.local — 1 of 2">/etc/bind/named.conf.local — 1 of 2</div><pre class="code-pre  second-environment"><code langs="">zone "<span class="highlight">nyc3.example.com</span>" {
    type master;
    file "/etc/bind/zones/db.<span class="highlight">nyc3.example.com</span>"; # zone file path
    allow-transfer { <span class="highlight">10.128.20.12</span>; };           # ns2 private IP address - secondary
};
</code></pre>
<p>Suponiendo que nuestra subred privada es <code>10.128.0.0/16</code>, agregue la zona inversa con las siguientes líneas (<strong>tenga en cuenta que el nombre de nuestra zona inversa comienza con “128.10”, que es el octeto inverso de “10.128”</strong>):</p>
<div class="code-label " title="/etc/bind/named.conf.local — 2 of 2">/etc/bind/named.conf.local — 2 of 2</div><pre class="code-pre  second-environment"><code langs="">    . . .
};

zone "<span class="highlight">128.10</span>.in-addr.arpa" {
    type master;
    file "/etc/bind/zones/db.<span class="highlight">10.128</span>";  # 10.128.0.0/16 subnet
    allow-transfer { <span class="highlight">10.128.20.12</span>; };  # ns2 private IP address - secondary
};
</code></pre>
<p>Si sus servidores abarcan varias subredes privadas, pero están en el mismo centro de datos, asegúrese de especificar una zona adicional y un archivo de zona para cada subred distinta. Cuando termine de añadir todas las zonas deseadas, guarde el archivo <code>named.conf.local</code> y ciérrelo.</p>

<p>Ahora que nuestras zonas están especificadas en BIND, debemos crear los archivos correspondientes de la zona de reenvío e inversa.</p>

<h3 id="crear-el-archivo-de-la-zona-de-reenvío">Crear el archivo de la zona de reenvío</h3>

<p>El archivo de la zona de reenvío representa el punto en el que definimos los registros DNS para reenviar búsquedas DNS. Es decir, cuando el DNS reciba una consulta de nombre, “host1.nyc3.example.com”, por ejemplo, realizará en el archivo de la zona de reenvío para resolver la dirección IP privada correspondiente de <strong>host1</strong>.</p>

<p>Crearemos el directorio en el que se alojarán nuestros archivos de zona. Según nuestra configuración de <strong>named.conf.local</strong>, esa ubicación debería ser <code>/etc/bind/zones</code>:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ns1$">sudo mkdir /etc/bind/zones
</li></ul></code></pre>
<p>Basaremos nuestro archivo de la zona de reenvío en el archivo de zona <code>db.local</code> de muestra. Cópielo a la ubicación adecuada con los siguientes comandos:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ns1$">sudo cp /etc/bind/db.local /etc/bind/zones/db.<span class="highlight">nyc3.example.com</span>
</li></ul></code></pre>
<p>Ahora, editaremos nuestro archivo de la zona de reenvío:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ns1$">sudo nano /etc/bind/zones/db.<span class="highlight">nyc3.example.com</span>
</li></ul></code></pre>
<p>Inicialmente, tendrá un aspecto similar al siguiente:</p>
<div class="code-label " title="/etc/bind/zones/db.nyc3.example.com — original">/etc/bind/zones/db.nyc3.example.com — original</div><pre class="code-pre  second-environment"><code langs="">$TTL    604800
@       IN      SOA     localhost. root.localhost. (
                              2         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                         604800 )       ; Negative Cache TTL
;
@       IN      NS      localhost.      ; delete this line
@       IN      A       127.0.0.1       ; delete this line
@       IN      AAAA    ::1             ; delete this line
</code></pre>
<p>Primero, deberá editar el registro SOA. Sustituya el primer “localhost” por el FQDN de <strong>ns1</strong> y luego “root.localhost” por &ldquo;admin.nyc3.example.com&rdquo;. Cada vez que edite un archivo de zona, deberá incrementar el valor <strong>serial</strong> antes de reiniciar el proceso <code>named</code>. Lo incrementaremos a “3”. Ahora debería tener un aspecto similar a este:</p>
<div class="code-label " title="/etc/bind/zones/db.nyc3.example.com — updated 1 of 3">/etc/bind/zones/db.nyc3.example.com — updated 1 of 3</div><pre class="code-pre  second-environment"><code langs="">@       IN      SOA     <span class="highlight">ns1.nyc3.example.com</span>. <span class="highlight">admin</span>.<span class="highlight">nyc3.example.com</span>. (
                              <span class="highlight">3</span>         ; Serial

                              . . .
</code></pre>
<p>A continuación, elimine los tres registros al final del archivo (después del registro SOA). Si no está seguro de las líneas que debe eliminar, estas se marcan con un comentario “delete this line” (eliminar esta línea) encima.</p>

<p>Al final del archivo, añada los registros de su servidor de nombres con las siguientes líneas (sustituya los nombres por los suyos). Observe que en la segunda columna se especifica que estos son registros “NS”:</p>
<div class="code-label " title="/etc/bind/zones/db.nyc3.example.com — updated 2 of 3">/etc/bind/zones/db.nyc3.example.com — updated 2 of 3</div><pre class="code-pre  second-environment"><code langs="">. . .

; name servers - NS records
    IN      NS      ns1.<span class="highlight">nyc3.example.com</span>.
    IN      NS      ns2.<span class="highlight">nyc3.example.com</span>.
</code></pre>
<p>Ahora, añada los registros A para sus hosts que pertenecen a esta zona. Esto incluye cualquier servidor cuyo nombre deseemos que termine con “.nyc3.example.com” (sustituya los nombres y las direcciones IP privadas). Usando nuestros nombres de ejemplo y las direcciones IP privadas, añadiremos registros A para <strong>ns1</strong>, <strong>ns2</strong>, <strong>host1</strong> y <strong>host2</strong>:</p>
<div class="code-label " title="/etc/bind/zones/db.nyc3.example.com — updated 3 of 3">/etc/bind/zones/db.nyc3.example.com — updated 3 of 3</div><pre class="code-pre  second-environment"><code langs="">. . .

; name servers - A records
ns1.<span class="highlight">nyc3.example.com</span>.          IN      A       <span class="highlight">10.128.10.11</span>
ns2.<span class="highlight">nyc3.example.com</span>.          IN      A       <span class="highlight">10.128.20.12</span>

; 10.128.0.0/16 - A records
<span class="highlight">host1.nyc3.example.com</span>.        IN      A      <span class="highlight">10.128.100.101</span>
<span class="highlight">host2.nyc3.example.com</span>.        IN      A      <span class="highlight">10.128.200.102</span>
</code></pre>
<p>Guarde y cierre el archivo <code>db.nyc3.example.com</code>.</p>

<p>Nuestra zona de reenvío de ejemplo final tendrá el siguiente aspecto:</p>
<div class="code-label " title="/etc/bind/zones/db.nyc3.example.com — updated">/etc/bind/zones/db.nyc3.example.com — updated</div><pre class="code-pre  second-environment"><code langs="">$TTL    604800
@       IN      SOA     <span class="highlight">ns1.nyc3.example.com</span>. admin.<span class="highlight">nyc3.example.com</span>. (
                  <span class="highlight">3</span>     ; Serial
             604800     ; Refresh
              86400     ; Retry
            2419200     ; Expire
             604800 )   ; Negative Cache TTL
;
; name servers - NS records
     IN      NS      ns1.<span class="highlight">nyc3.example.com</span>.
     IN      NS      ns2.<span class="highlight">nyc3.example.com</span>.

; name servers - A records
ns1.<span class="highlight">nyc3.example.com</span>.          IN      A       <span class="highlight">10.128.10.11</span>
ns2.<span class="highlight">nyc3.example.com</span>.          IN      A       <span class="highlight">10.128.20.12</span>

; 10.128.0.0/16 - A records
<span class="highlight">host1.nyc3.example.com</span>.        IN      A      <span class="highlight">10.128.100.101</span>
<span class="highlight">host2.nyc3.example.com</span>.        IN      A      <span class="highlight">10.128.200.102</span>
</code></pre>
<p>Ahora, prosigamos con los archivos de la zona inversa.</p>

<h3 id="crear-los-archivos-de-la-zona-inversa">Crear los archivos de la zona inversa</h3>

<p>En los archivos de la zona inversa definimos los registros DNS PTR para las búsquedas de DNS inversas. Es decir, cuando el DNS reciba una consulta por dirección IP, “10.128.100.101”, por ejemplo, buscará el los archivos de la zona inversa para resolver el FQDN corespondiente, “host1.nyc3.example.com” en este caso.</p>

<p>En <strong>ns1</strong>, para cada zona inversa especificada en el archivo <code>named.conf.local</code>, cree un archivo de zona inversa. Basaremos nuestros archivos de zona inversa en el archivo de zona <code>db.127</code> de muestra. Cópielo en la ubicación adecuada con los siguientes comandos (sustituyendo el nombre de archivo de destino para que coincida con la definición de su zona inversa):</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ns1$">sudo cp /etc/bind/db.127 /etc/bind/zones/db.<span class="highlight">10.128</span>
</li></ul></code></pre>
<p>Edite el archivo de la zona inversa que se corresponda con la zona o las zonas inversas definidas en <code>named.conf.local</code>:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ns1$">sudo nano /etc/bind/zones/db.<span class="highlight">10.128</span>
</li></ul></code></pre>
<p>Inicialmente, tendrá un aspecto similar al siguiente:</p>
<div class="code-label " title="/etc/bind/zones/db.10.128 — original">/etc/bind/zones/db.10.128 — original</div><pre class="code-pre  second-environment"><code langs="">$TTL    604800
@       IN      SOA     localhost. root.localhost. (
                              1         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                         604800 )       ; Negative Cache TTL
;
@       IN      NS      localhost.      ; delete this line
1.0.0   IN      PTR     localhost.      ; delete this line
</code></pre>
<p>Como en el caso del archivo de la zona de reenvío, deberá editar el registro SOA e incrementar el valor <strong>serial</strong>. Debería tener un aspecto similar a esto:</p>
<div class="code-label " title="/etc/bind/zones/db.10.128 — updated 1 of 3">/etc/bind/zones/db.10.128 — updated 1 of 3</div><pre class="code-pre  second-environment"><code langs="">@       IN      SOA     <span class="highlight">ns1.nyc3.example.com</span>. <span class="highlight">admin</span>.<span class="highlight">nyc3.example.com</span>. (
                              <span class="highlight">3</span>         ; Serial

                              . . .
</code></pre>
<p>A continuación, elimine los dos registros al final del archivo (después del registro SOA). Si no está seguro de las líneas que eliminará, se marcan con un comentario “delete this line” (elimine esta línea) encima.</p>

<p>Al final del archivo, añada los registros de su servidor de nombres con las siguientes líneas (sustituya los nombres por los suyos). Observe que en la segunda columna se especifica que estos son registros “NS”:</p>
<div class="code-label " title="/etc/bind/zones/db.10.128 — updated 2 of 3">/etc/bind/zones/db.10.128 — updated 2 of 3</div><pre class="code-pre  second-environment"><code langs="">. . .

; name servers - NS records
      IN      NS      ns1.<span class="highlight">nyc3.example.com</span>.
      IN      NS      ns2.<span class="highlight">nyc3.example.com</span>.
</code></pre>
<p>Luego añada registros <code>PTR</code> para todos sus servidores cuyas direcciones IP estén en la subred del archivo de zona que está editando. En nuestro ejemplo, esto incluye todos nuestros hosts, porque todos están en la subred <code>10.128.0.0/16</code>. Tenga en cuenta que la primera columna consiste en los dos últimos octetos de las direcciones IP privadas de sus servidores en <strong>orden inverso</strong>. Asegúrese de sustituir los nombres y las direcciones IP privadas para que coincidan con sus servidores:</p>
<div class="code-label " title="/etc/bind/zones/db.10.128 — updated 3 of 3">/etc/bind/zones/db.10.128 — updated 3 of 3</div><pre class="code-pre  second-environment"><code langs="">. . .

; PTR Records
<span class="highlight">11.10</span>   IN      PTR     ns1.<span class="highlight">nyc3.example.com</span>.    ; 10.128.10.11
<span class="highlight">12.20</span>   IN      PTR     ns2.<span class="highlight">nyc3.example.com</span>.    ; 10.128.20.12
<span class="highlight">101.100</span> IN      PTR     <span class="highlight">host1.nyc3.example.com</span>.  ; 10.128.100.101
<span class="highlight">102.200</span> IN      PTR     <span class="highlight">host2.nyc3.example.com</span>.  ; 10.128.200.102
</code></pre>
<p>Guarde y cierre el archivo de la zona inversa (repita los pasos de esta sección si debe añadir más archivos de zona inversa).</p>

<p>Nuestro archivo de zona inversa de ejemplo tiene el siguiente aspecto:</p>
<div class="code-label " title="/etc/bind/zones/db.10.128 — updated">/etc/bind/zones/db.10.128 — updated</div><pre class="code-pre  second-environment"><code langs="">$TTL    604800
@       IN      SOA     <span class="highlight">nyc3.example.com</span>. admin.nyc3.example.com. (
                              <span class="highlight">3</span>         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                         604800 )       ; Negative Cache TTL
; name servers
      IN      NS      ns1.<span class="highlight">nyc3.example.com</span>.
      IN      NS      ns2.<span class="highlight">nyc3.example.com</span>.

; PTR Records
<span class="highlight">11.10</span>   IN      PTR     ns1.<span class="highlight">nyc3.example.com</span>.    ; 10.128.10.11
<span class="highlight">12.20</span>   IN      PTR     ns2.<span class="highlight">nyc3.example.com</span>.    ; 10.128.20.12
<span class="highlight">101.100</span> IN      PTR     <span class="highlight">host1.nyc3.example.com</span>.  ; 10.128.100.101
<span class="highlight">102.200</span> IN      PTR     <span class="highlight">host2.nyc3.example.com</span>.  ; 10.128.200.102
</code></pre>
<p>Terminamos de editar nuestros archivos. Ahora podemos comprobar si hay errores en nuestros archivos.</p>

<h3 id="comprobar-la-sintaxis-de-la-configuración-bind">Comprobar la sintaxis de la configuración BIND</h3>

<p>Ejecute el siguiente comando para comprobar la sintaxis de los archivos <code>named.conf*</code>:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ns1$">sudo named-checkconf
</li></ul></code></pre>
<p>Si sus archivos de configuración named no tienen errores de sintaxis, volverá a su intérprete de comandos de shell y no verá mensajes de error. Si existen problemas en sus archivos de configuración, revise los mensajes de error y la sección “Configurar un servidor DNS primario”, y luego pruebe <code>named-checkconf</code> una vez más.</p>

<p>El comando <code>named-checkzone</code> se puede utilizar para verificar que sus archivos de zona sean correctos. En el primer argumento de este se especifica el nombre de la zona y en el segundo el archivo de zona correspondiente, que están definidos en <code>named.conf.local</code>.</p>

<p>Por ejemplo, para comprobar la configuración de la zona de reenvío “<span class="highlight">nyc3.example.com</span>”, ejecute el siguiente comando (cambie los nombres para que coincidan con su zona y archivo de reenvío).</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo named-checkzone <span class="highlight">nyc3.example.com</span> db.<span class="highlight">nyc3.example.com</span>
</li></ul></code></pre>
<p>Para omprobar la configuración de la zona inversa “<span class="highlight">128.10</span>.in-addr.arpa”, ejecute el siguiente comando (cambie los números para que coincidan con su zona y archivo inversos):</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo named-checkzone <span class="highlight">128.10</span>.in-addr.arpa /etc/bind/zones/db.<span class="highlight">10.128</span>
</li></ul></code></pre>
<p>Cuando no haya errores en sus archivos de configuración y zona, debería estar listo para reiniciar el servicio BIND.</p>

<h3 id="reiniciar-bind">Reiniciar BIND</h3>

<p>Reinicie BIND:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ns1$">sudo systemctl restart bind9
</li></ul></code></pre>
<p>Si configuró el firewall UFW, abra el acceso a BIND escribiendo lo siguiente:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ns1$">sudo ufw allow Bind9
</li></ul></code></pre>
<p>Con esto, servidor DNS primario quedará configurado y listo para responder a las consultas DNS. Ahora, crearemos el servidor DNS secundario.</p>

<h2 id="configurar-el-servidor-dns-secundario">Configurar el servidor DNS secundario</h2>

<p>En la mayoría de los entornos, se recomienda configurar un servidor DNS secundario que responda a las solicitudes si el primario deja de estar disponible. Afortunadamente, el servidor DNS secundario se puede configurar de una manera mucho más sencilla.</p>

<p>En <strong>ns2</strong>, edite el archivo <code>named.conf.options</code>:</p>
<pre class="code-pre custom_prefix third-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ns2$">sudo nano /etc/bind/named.conf.options
</li></ul></code></pre>
<p>En la parte superior del archivo, añada el ACL con las direcciones IP privadas de todos sus servidores de confianza:</p>
<div class="code-label " title="/etc/bind/named.conf.options — updated 1 of 2 (secondary)">/etc/bind/named.conf.options — updated 1 of 2 (secondary)</div><pre class="code-pre  third-environment"><code langs="">acl "trusted" {
        <span class="highlight">10.128.10.11</span>;   # ns1
        <span class="highlight">10.128.20.12</span>;   # ns2 - can be set to localhost
        <span class="highlight">10.128.100.101</span>;  # host1
        <span class="highlight">10.128.200.102</span>;  # host2
};

options {

        . . .
</code></pre>
<p>Debajo de la directiva <code>directory</code>, añada las siguientes líneas:</p>
<div class="code-label " title="/etc/bind/named.conf.options — updated 2 of 2 (secondary)">/etc/bind/named.conf.options — updated 2 of 2 (secondary)</div><pre class="code-pre  third-environment"><code langs="">        recursion yes;
        allow-recursion { trusted; };
        listen-on { <span class="highlight">10.128.20.12</span>; };      # ns2 private IP address
        allow-transfer { none; };          # disable zone transfers by default

        forwarders {
                8.8.8.8;
                8.8.4.4;
        };
</code></pre>
<p>Guarde y cierre el archivo <code>named.conf.options</code>. El archivo debería ser exactamente igual al archivo <code>named.conf.options</code> de <strong>ns1</strong>, excepto porque debería estar configurado para escuchar en la dirección IP privada de <strong>ns2</strong>.</p>

<p>Ahora, edite el archivo <code>named.conf.local</code>:</p>
<pre class="code-pre custom_prefix third-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ns2$">sudo nano /etc/bind/named.conf.local
</li></ul></code></pre>
<p>Defina las zonas esclavas que se corresponden con las zonas maestras en el servidor DNS primario. Observe que el tipo es “slave”, el archivo no contiene una ruta y hay una directiva <code>masters</code> que debería fijarse en la dirección IP privada del servidor DNS primario. Si definió varias zonas inversas en el servidor DNS primario, asegúrese de añadirlas en su totalidad aquí:</p>
<div class="code-label " title="/etc/bind/named.conf.local — updated (secondary)">/etc/bind/named.conf.local — updated (secondary)</div><pre class="code-pre  third-environment"><code langs="">zone "<span class="highlight">nyc3.example.com</span>" {
    type slave;
    file "db.<span class="highlight">nyc3.example.com</span>";
    masters { <span class="highlight">10.128.10.11</span>; };  # ns1 private IP
};

zone "<span class="highlight">128.10</span>.in-addr.arpa" {
    type slave;
    file "db.<span class="highlight">10.128</span>";
    masters { <span class="highlight">10.128.10.11</span>; };  # ns1 private IP
};
</code></pre>
<p>Ahora, guarde y cierre el archivo <code>named.conf.local</code>.</p>

<p>Ejecute el siguiente comando para comprobar la validez de sus archivos de configuración:</p>
<pre class="code-pre custom_prefix third-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ns2$">sudo named-checkconf
</li></ul></code></pre>
<p>Una vez comprobado esto, reinicie BIND:</p>
<pre class="code-pre custom_prefix third-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ns2$">sudo systemctl restart bind9
</li></ul></code></pre>
<p>Permita conexiones DNS al servidor alterando las reglas del firewall UFW:</p>
<pre class="code-pre custom_prefix third-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="ns2$">sudo ufw allow Bind9
</li></ul></code></pre>
<p>Ahora, tiene servidores DNS primario y secundario para la resolución de nombres y direcciones IP de la red privada. Ahora debe configurar sus servidores clientes para usar sus servidores DNS privados.</p>

<h2 id="configurar-clientes-dns">Configurar clientes DNS</h2>

<p>A fin de que todos sus servidores en el ACL “trusted” puedan consultar sus servidores DNS, debe configurar cada uno de ellos para que utilicen <strong>ns1</strong> y <strong>ns2</strong> como servidores de nombres. Este proceso varía dependiendo de su sistema operativo, pero para la mayoría de distribuciones Linux implica añadir sus servidores de nombres al archivo <code>/etc/resolv.conf</code>.</p>

<h3 id="clientes-de-ubuntu-18-04">Clientes de Ubuntu 18.04</h3>

<p>En Ubuntu 18.04, la red se configura con Netplan, una abstracción que le permite escribir una configuración de red estandarizada y aplicarla a software de redes de backend no compatible. Para configurar el DNS, debemos escribir un archivo de configuración de Netplan.</p>

<p>Primero, encuentre el dispositivo asociado con su red privada consultando la subred privada con el comando <code>ip address</code>:</p>
<pre class="code-pre command fourth-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ip address show to <span class="highlight">10.128.0.0/16</span>
</li></ul></code></pre><pre class="code-pre  fourth-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>3: <span class="highlight">eth1</span>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
    inet 10.128.100.101/16 brd 10.128.255.255 scope global eth1
           valid_lft forever preferred_lft forever
</code></pre>
<p>En este ejemplo, la interfaz privada es <code>eth1</code>.</p>

<p>A continuación, cree un nuevo archivo en <code>/etc/netplan</code> llamado <code>00-private-nameservers.yaml</code>:</p>
<pre class="code-pre command fourth-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/netplan/00-private-nameservers.yaml
</li></ul></code></pre>
<p>Dentro de este, pegue el contenido siguiente. Deberá modificar la interfaz de la red privada, las direcciones de sus servidores DNS <strong>ns1</strong> y <strong>ns2</strong>, y la zona DNS.</p>

<p><span class='note'><strong>Nota:</strong> Netplan usa el <a href="http://yaml.org/">formato de serialización de datos YAML</a> para sus archivos de configuración. Debido a que YAML utiliza sangría y espacios en blanco para definir la estructura de sus datos, asegúrese de que en su definición se utilice una sangría uniforme para evitar errores.<br></span></p>
<div class="code-label " title="/etc/netplan 00-private-nameservers.yaml">/etc/netplan 00-private-nameservers.yaml</div><pre class="code-pre  fourth-environment"><code langs="">network:
    version: 2
    ethernets:
        <span class="highlight">eth1</span>:                                 # Private network interface
            nameservers:
                addresses:
                - <span class="highlight">10.128.10.11</span>                # Private IP for ns1
                - <span class="highlight">10.132.20.12</span>                # Private IP for ns2
                search: [ <span class="highlight">nyc3.example.com</span> ]  # DNS zone

</code></pre>
<p>Guarde y cierre el archivo cuando haya terminado.</p>

<p>A continuación, indique a Netplan que intente usar el nuevo archivo de configuración con <code>netplan try</code>. Si existen problemas que ocasionen una pérdida de redes, Netplan cancelará los cambios tras un tiempo de espera:</p>
<pre class="code-pre command fourth-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo netplan try
</li></ul></code></pre><pre class="code-pre  fourth-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>Warning: Stopping systemd-networkd.service, but it can still be activated by:
  systemd-networkd.socket
Do you want to keep these settings?


Press ENTER before the timeout to accept the new configuration


Changes will revert in 120 seconds
</code></pre>
<p>Si la cuenta regresiva se actualiza correctamente en la parte inferior, la nueva configuración es al menos suficientemente funcional como para no interrumpir su conexión SSH. Pulse <strong>ENTER</strong> para aceptar la nueva configuración.</p>

<p>Ahora, verifique la resolución DNS del sistema para determinar si se plicó su configuración de DNS:</p>
<pre class="code-pre command fourth-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemd-resolve --status
</li></ul></code></pre>
<p>Desplácese hasta ver la sección de la interfaz de su red privada. Debería ver las direcciones IP privadas de sus servidores DNS enumeradas primero, seguidas de algunos valores alternativos. Su dominio debería figurar en “DNS Domain”:</p>
<pre class="code-pre  fourth-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>. . .
Link 3 (eth1)
      Current Scopes: DNS
       LLMNR setting: yes
MulticastDNS setting: no
      DNSSEC setting: no
    DNSSEC supported: no
         DNS Servers: <span class="highlight">10.128.10.11</span>
                      <span class="highlight">10.128.20.12</span>
                      67.207.67.2
                      67.207.67.3
          DNS Domain: <span class="highlight">nyc3.example.com</span>
. . .
</code></pre>
<p>Con esto, su cliente debería quedar configurado para usar sus servidores DNS internos.</p>

<h3 id="clientes-de-ubuntu-16-04-y-debian">Clientes de Ubuntu 16.04 y Debian</h3>

<p>En servidores de Ubuntu 16.04 y Debian Linux, puede editar el archivo <code>/etc/network/interfaces</code>:</p>
<pre class="code-pre command fourth-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/network/interfaces
</li></ul></code></pre>
<p>En su interior, encuentre la línea <code>dns-nameservers</code> y anteponga sus propios servidores de nombres a la lista que se encuentra allí. Debajo de esa línea, añada una opción <code>dns-search</code> orientada al dominio base de su infraestructura. En nuestro caso, esto sería “nyc3.example.com”:</p>
<div class="code-label " title="/etc/network/interfaces">/etc/network/interfaces</div><pre class="code-pre  fourth-environment"><code langs="">    . . .

    dns-nameservers <span class="highlight">10.128.10.11</span> <span class="highlight">10.128.20.12</span> 8.8.8.8
    <span class="highlight">dns-search nyc3.example.com</span>

    . . .
</code></pre>
<p>Guarde y cierre el archivo cuando haya terminado.</p>

<p>Ahora, reinicie sus servicios de red y aplique los nuevos cambios con los comandos siguientes. Asegúrese de sustituir <code>eth0</code> por el nombre de su interfaz de red:</p>
<pre class="code-pre command fourth-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ifdown --force <span class="highlight">eth0</span> &amp;&amp; sudo ip addr flush dev <span class="highlight">eth0</span> &amp;&amp; sudo ifup --force <span class="highlight">eth0</span>
</li></ul></code></pre>
<p>Con esto debería reiniciarse su red sin que se desactive su conexión actual. Si funcionó correctamente, debería ver algo como esto:</p>
<pre class="code-pre  fourth-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>RTNETLINK answers: No such process
Waiting for DAD... Done
</code></pre>
<p>Compruebe que sus ajustes se hayan aplicado escribiendo lo siguiente:</p>
<pre class="code-pre command fourth-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cat /etc/resolv.conf
</li></ul></code></pre>
<p>Debería ver sus servidores de nombres en el archivo <code>/etc/resolv.conf</code>, además de su dominio de búsqueda:</p>
<pre class="code-pre  fourth-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div># Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
nameserver 10.128.10.11
nameserver 10.128.20.12
nameserver 8.8.8.8
search nyc3.example.com
</code></pre>
<p>Con esto, su cliente quedará configurado para usar sus servidores DNS.</p>

<h3 id="clientes-centos">Clientes CentOS</h3>

<p>En CentOS, RedHat y Fedora Linux, edite el archivo <code>/etc/sysconfig/network-scripts/ifcfg-<span class="highlight">eth0</span></code>. Es posible que deba sustituir <code>eth0</code> por el nombre de su interfaz de red primaria:</p>
<pre class="code-pre command fourth-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/sysconfig/network-scripts/ifcfg-<span class="highlight">eth0</span>
</li></ul></code></pre>
<p>Busque las opciones <code>DNS1</code> y <code>DNS2</code>, y fije para ellas las direcciones IP privadas de sus servidores de nombres primario y secundario. Añada un parámetro <code>DOMAIN</code> que será el dominio básico de su infraestructura. En esta guía, sería “nyc3.example.com”:</p>
<div class="code-label " title="/etc/sysconfig/network-scripts/ifcfg-eth0">/etc/sysconfig/network-scripts/ifcfg-eth0</div><pre class="code-pre  fourth-environment"><code langs="">. . .
DNS1=<span class="highlight">10.128.10.11</span>
DNS2=<span class="highlight">10.128.20.12</span>
<span class="highlight">DOMAIN='nyc3.example.com'</span>
. . .
</code></pre>
<p>Guarde y cierre el archivo cuando haya terminado.</p>

<p>Ahora, reinicie el servicio de red escribiendo lo siguiente:</p>
<pre class="code-pre command fourth-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart network
</li></ul></code></pre>
<p>El comando puede demorarse unos segundos, pero debería hacer que regrese a la línea de comandos pronto.</p>

<p>Compruebe que sus cambios se hayan aplicado escribiendo lo siguiente:</p>
<pre class="code-pre command fourth-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cat /etc/resolv.conf
</li></ul></code></pre>
<p>Debería ver sus servidores de nombres y el dominio de búsqueda en la lista:</p>
<div class="code-label " title="/etc/resolv.conf">/etc/resolv.conf</div><pre class="code-pre  fourth-environment"><code langs="">nameserver 10.128.10.11
nameserver 10.128.20.12
search nyc3.example.com
</code></pre>
<p>Su cliente ahora debería poder conectarse a sus servidores DNS y usarlos.</p>

<h2 id="probar-clientes">Probar clientes</h2>

<p>Utilice <code>nslookup</code> para comprobar si sus clientes pueden enviar consultas a sus servidores de nombres. Debería poder hacer esto en todos los clientes que haya configurado y estén en el ACL “trusted”.</p>

<p>Para los clientes de CentOS, es posible que deba instalar la utilidad con lo siguiente:</p>
<pre class="code-pre command fourth-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo yum install bind-utils
</li></ul></code></pre>
<p>Podemos comenzar realizando una búsqueda directa.</p>

<h3 id="búsqueda-directa">Búsqueda directa</h3>

<p>Por ejemplo, podemos realizar una búsqueda directa para obtener la dirección IP de ho<strong>st1.nyc3.example.com</strong> ejecutando el siguiente comando:</p>
<pre class="code-pre command fourth-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nslookup host1
</li></ul></code></pre>
<p>La consulta de “host1” se expande a “host1.nyc3.example.com” porque la opción <code>search</code> se fijó en su subdominio privado y las consultas de DNS intentarán realizar búsquedas en ese subdominio antes de buscar el host en otra parte. El resultado del comando anterior debería tener este aspecto:</p>
<pre class="code-pre  fourth-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>Server:     127.0.0.53
Address:    127.0.0.53#53

Non-authoritative answer:
Name:   host1.nyc3.example.com
Address: 10.128.100.101
</code></pre>
<p>A continuación, podemos comprobar búsquedas inversas.</p>

<h3 id="búsqueda-inversa">Búsqueda inversa</h3>

<p>Para probar la búsqueda inversa, consulte el servidor DNS con la dirección IP privada de <strong>host1</strong>:</p>
<pre class="code-pre command fourth-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nslookup 10.128.100.101
</li></ul></code></pre>
<p>El resultado debería tener el siguiente aspecto:</p>
<pre class="code-pre  fourth-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>11.10.128.10.in-addr.arpa   name = host1.nyc3.example.com.

Authoritative answers can be found from:
</code></pre>
<p>Si los nombres y las direcciones IP se resuelven a los valores correctos, eso significa que sus archivos de zona se configuraron correctamente. Si recibe valores inesperados, asegúrese de revisar los archivos de zona en su servidor DNS primario (por ejemplo, <code>db.nyc3.example.com</code> y <code>db.10.128</code>).</p>

<p>¡Felicitaciones! Sus servidores DNS internos ahora estarán correctamente configurados. A continuación, abordaremos el mantenimiento de sus registros de zona.</p>

<h2 id="mantener-registros-dns">Mantener registros DNS</h2>

<p>Ahora que dispone de un DNS interno activo, deberá mantener sus registros DNS para que se reflejen de forma precisa en su entorno de servidor.</p>

<h3 id="añadir-un-host-a-un-dns">Añadir un host a un DNS</h3>

<p>Siempre que añada un host a su entorno (en el mismo centro de datos), le convendrá añadirlo al DNS. A continuación, se ofrece una lista de los pasos que debe seguir:</p>

<h4 id="servidor-de-nombres-primario">Servidor de nombres primario</h4>

<ul>
<li>Archivo de zona de reenvío: añada un registro “A” para el nuevo host e incremente el valor de “Serial”.</li>
<li>Archivo de zona inversa: añada un registro “PTR” para el nuevo host e incremente el valor de “Serial”.</li>
<li>Añada la dirección IP privada del nuevo host al ACL “trusted” (<code>named.conf.options</code>).</li>
</ul>

<p>Pruebe sus archivos de configuración:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo named-checkconf
</li><li class="line" prefix="$">sudo named-checkzone <span class="highlight">nyc3.example.com</span> db.<span class="highlight">nyc3.example.com</span>
</li><li class="line" prefix="$">sudo named-checkzone <span class="highlight">128.10</span>.in-addr.arpa /etc/bind/zones/db.<span class="highlight">10.128</span>
</li></ul></code></pre>
<p>A continuación, vuelva a cargar BIND:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl reload bind9
</li></ul></code></pre>
<p>Con esto, su servidor primario debería estar configurado para el nuevo host.</p>

<h4 id="servidor-de-nombres-secundarios">Servidor de nombres secundarios</h4>

<ul>
<li>Añada la dirección IP privada del nuevo host al ACL “trusted” (<code>named.conf.options</code>).</li>
</ul>

<p>Compruebe la sintaxis  de la configuración:</p>
<pre class="code-pre command third-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo named-checkconf
</li></ul></code></pre>
<p>A continuación, vuelva a cargar BIND:</p>
<pre class="code-pre command third-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl reload bind9
</li></ul></code></pre>
<p>Su servidor secundario ahora aceptará conexiones del nuevo host.</p>

<h4 id="configure-el-nuevo-host-para-que-use-su-dns">Configure el nuevo host para que use su DNS</h4>

<ul>
<li>Configure <code>/etc/resolv.conf</code> para que use sus servidores DNS.</li>
<li>Realice una prueba usando <code>nslookup</code>.</li>
</ul>

<h3 id="eliminar-el-host-del-dns">Eliminar el host del DNS</h3>

<p>Si elimina un host de su entorno, o quiere quitarlo del DNS, simplemente quite todo lo que se añadió cuando agregó el servidor al DNS (es decir, el procedimiento inverso de los pasos anteriores).</p>

<h2 id="conclusión">Conclusión</h2>

<p>Ahora puede consultar las interfaces de red privada de sus servidores por nombre, en lugar de hacerlo por dirección IP. Esto hace que la configuración de los servicios y aplicaciones sea más fácil porque ya no tendrá que recordar las direcciones IP privadas, y será más fácil leer y comprender los archivos. Además, ahora podrá cambiar sus configuraciones para que apunten a un nuevo servidor en un único lugar, su servidor DNS primario, en vez de tener que editar una variedad de archivos de configuración distribuidos, lo cual facilita el mantenimiento.</p>

<p>Una vez que complete su configuración de DNS interna, y que sus archivos de configuración usen FQDN privados para especificar las conexiones de red, será <strong>esencial</strong> que se realice un mantenimiento correcto de sus servidores DNS. Si los dos dejan de estar disponibles, aquellos de sus servicios y aplicaciones que dependan de ellos dejarán de funcionar correctamente. Por ello, se recomienda configurar su DNS con al menos un servidor secundario y realizar copias de seguridad funcionales de todos ellos.</p>
