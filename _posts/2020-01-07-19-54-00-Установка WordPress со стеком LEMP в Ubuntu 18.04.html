---
layout: post
title: Установка WordPress со стеком LEMP в Ubuntu 18.04
network: digitalocean
date: January 07, 2020 at 07:54PM
url: https://www.digitalocean.com/community/tutorials/how-to-install-wordpress-with-lemp-on-ubuntu-18-04-ru
image: https://assets.digitalocean.com/articles/wordpress_lemp_1604/language_selection.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="Введение">Введение</h3>

<p>WordPress — это самая популярная CMS (система управления контентов) в сети Интернет. Она позволяет вам легко настраивать блоги и веб-сайты, устанавливаемые поверх отвечающего за за серверную часть MySQL с поддержкой PHP. WordPress обладает невероятной адаптивностью и позволяет в кратчайшие сроки создать и запустить веб-сайт. После настройки практически все административные функции доступны через пользовательский веб-интерфейс.</p>

<p>В этом руководстве мы сфокусируемся главным образом на создании экземпляра WordPress на стеке LEMP (Linux, Nginx, MySQL и PHP) на сервере Ubuntu 18.04.</p>

<h2 id="Предварительные-требования">Предварительные требования</h2>

<p>Для выполнения этого обучающего руководства вам потребуется доступ к серверу Ubuntu 18.04.</p>

<p>Вам нужно будет выполнить следующие действия перед выполнением инструкций из данного руководства:</p>

<ul>
<li><strong>Создайте пользователя <code>sudo</code> на вашем сервере</strong>: мы будем выполнять шаги из этого руководства, используя пользователя без прав root с привилегиями <code>sudo</code>. Вы можете создать пользователя с привилегиями <code>sudo</code>, следуя указаниям нашего <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-18-04">Руководства по начальной настройке сервера Ubuntu 18.04</a>.</li>
<li>*<em>Установите стек LEMP *</em>: WordPress требуется веб-сервер, база данных и PHP для корректной работы. Настройка стека LEMP (Linux, Nginx, MySQL и PHP) позволяет удовлетворить все эти требования. Воспользуйтесь <a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-nginx-mysql-php-lemp-stack-ubuntu-18-04">этим руководством</a> для установки и настройки данного программного обеспечения.</li>
<li><strong>Защитите ваш сайт с помощью SSL</strong>: WordPress обслуживает динамический контент и отвечает за аутентификацию и авторизацию пользователя. TLS/SSL — это технология, которая позволяет вам шифровать трафик с сайта для защиты вашего соединения. Способ настройки SSL зависит от того, есть ли у вашего сайта доменное имя.

<ul>
<li><strong>Если у вас есть доменное имя&hellip;</strong> самым простым способом защиты вашего сайта будет использование Let&rsquo;s Encrypt, который предоставляет бесплатные доверенные сертификаты. Воспользуйтесь нашим <a href="https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-18-04">Руководством по Nginx</a> для выполнения настройки.</li>
<li><strong>Если у вас нет домена&hellip;</strong> и вы просто используете данную конфигурацию для тестирования или в личных целях, вы можете использовать самоподписанный сертификат. Данный способ обеспечивает аналогичный тип шифрования, но без подтверждения домена. Воспользуйтесь нашим <a href="https://www.digitalocean.com/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-in-ubuntu-18-04">руководством по самоподписанным сертификатам SSL для Nginx</a> для настройки.</li>
</ul></li>
</ul>

<p>Завершив выполнение действий по настройке, выполните вход на ваш сервер с помощью пользователя <code>sudo</code> и переходите к описанным ниже действиям.</p>

<h2 id="Шаг-1-—-Создание-базы-данных-mysql-и-пользователя-для-wordpress">Шаг 1 — Создание базы данных MySQL и пользователя для WordPress</h2>

<p>Первый шаг, который мы выполним, будет подготовительным. WordPress использует MySQL для управления и хранения сайта, а также информации пользователя. Мы уже установили MySQL, но нам нужно создать базу данных и пользователя, которые будет использовать WordPress.</p>

<p>Выполните вход в учетную запись MySQL с правами root (административную запись). Если MySQL настроен для использования плагина аутентификации <code>auth_socket</code> (по умолчанию), вы можете войти в административную учетную запись MySQL с помощью <code>sudo</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo mysql
</li></ul></code></pre>
<p>Если вы измените метод аутентификации на использование пароля для учетной записи MySQL с правами root, воспользуйтесь следующим форматом:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">mysql -u root -p
</li></ul></code></pre>
<p>Вам будет предложено ввести пароль, который вы задали для учетной записи MySQL с правами root.</p>

<p>Сначала нам нужно создать отдельную базу данных, которую сможет контролировать WordPress. Вы можете использовать любое название, но мы в этом руководстве будем использовать <code>wordpress</code> для простоты. Создайте базу данных для WordPress, введя следующую команду:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">CREATE DATABASE <span class="highlight">wordpress</span> DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci;
</li></ul></code></pre>
<p><span class='note'><strong>Примечание.</strong> Каждый оператор MySQL должен заканчиваться точкой с запятой (;). Убедитесь, что это правило не нарушено, если вы столкнетесь с какими-либо проблемами.<br></span></p>

<p>Затем мы создадим отдельную учетную запись пользователя MySQL, которую будем использовать исключительно для работы с нашей новой базы данных. Создание баз данных и учетных записей с одной функцией является хорошей идеей с точки зрения управления и безопасности. В этом руководстве мы будем использовать имя <code>wordpressuser</code>. Вы можете использовать любое имя по вашему желанию.</p>

<p>Мы создадим учетную запись, установим пароль и предоставим доступ к созданной нами базе данных. Для этого мы воспользуемся следующей командой: Не забудьте задать надежный для пользователя базы данных на этом шаге:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">GRANT ALL ON <span class="highlight">wordpress</span>.* TO '<span class="highlight">wordpressuser</span>'@'localhost' IDENTIFIED BY '<span class="highlight">password</span>';
</li></ul></code></pre>
<p>Теперь у вас есть база данных и учетная запись пользователя, которые созданы специально для WordPress. Нам нужно установить права, чтобы текущий экземпляр MySQL узнал о последних внесенных нами изменениях:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">FLUSH PRIVILEGES;
</li></ul></code></pre>
<p>Выйдите из MySQL, введя следующую команду:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">EXIT;
</li></ul></code></pre>
<p>Сессия MySQL будет закрыта, а вы вернетесь к стандартной командной строке Linux.</p>

<h2 id="Шаг-2-—-Установка-дополнительных-расширений-php">Шаг 2 — Установка дополнительных расширений PHP</h2>

<p>При настройке нашего стека LEMP нам требуется только минимальный набор расширений, чтобы реализовать коммуникацию PHP с MySQL. WordPress и многие плагины используют дополнительные расширения PHP.</p>

<p>Мы можем загрузить и установить некоторые из самых популярных расширений PHP, которые будет использовать WordPress, введя следующую команду:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt update
</li><li class="line" prefix="$">sudo apt install php-curl php-gd php-intl php-mbstring php-soap php-xml php-xmlrpc php-zip
</li></ul></code></pre>
<p><span class='note'><strong>Примечание.</strong> Каждый плагин WordPress имеет собственный набор требований. Для поддержки некоторых из них может потребоваться установка дополнительных пакетов PHP. Ознакомьтесь с документацией плагина для получения информации о требованиях к PHP. Если они доступны, их можно установить с помощью <code>apt</code>, как показано выше.<br></span></p>

<p>Завершив установку расширений, перезапустите процесс PHP-FPM, чтобы запущенный процессор PHP мог использовать новые установленные функции:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart php7.2-fpm
</li></ul></code></pre>
<p>Теперь у нас на сервере есть все необходимые расширения PHP.</p>

<h2 id="Шаг-3-—-Настройка-nginx">Шаг 3 — Настройка Nginx</h2>

<p>Далее мы внесем несколько незначительных изменений в наши файлы серверного блока Nginx. Согласно руководствам по предварительным требованиям, у вас должен быть файл конфигурации для вашего сайта в директории <code>/etc/nginx/sites-available/</code>, настроенный на ответ на доменное имя или IP-адрес вашего сервера, и защищенный сертификат TLS/SSL. В качестве примера мы будем использовать <code>/etc/apache2/sites-available/wordpress</code>, но вы должны использовать путь к вашему файлу конфигурации при необходимости.</p>

<p>Также мы будем использовать <code>/var/www/wordpress</code> в качестве корневой директории для нашей установки WordPress. Вы должны корневой веб-узел, указанный в вашей собственной конфигурации.</p>

<p><span class='note'><strong>Примечание.</strong> вы можете использовать конфигурацию <code>/etc/nginx/sites-available/default</code> по умолчанию (с <code>/var/www/html</code> в качестве корневого веб-узла). Это допустимо, если вы собираетесь размещать только один веб-сайт на этом сервере. Если нет, рекомендуется разделить необходимую конфигурацию на логические части, по одному файлу на каждый сайт.<br></span></p>

<p>Чтобы начать, откройте файл серверного блока вашего сайта с привилегиями <code>sudo</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/nginx/sites-available/<span class="highlight">wordpress</span>
</li></ul></code></pre>
<p>Внутри основного блока <code>server</code> нам нужно добавить несколько блоков <code>location</code>.</p>

<p>Начнем с создания блоков с точным совпадением расположения для запросов к <code>/favicon.ico</code> и <code>/robots.txt</code>, для которых мы не хотим регистрировать запросы.</p>

<p>Мы будем использовать регулярное выражение расположения для проверки на совпадение с любыми запросами для статичных файлов. Мы снова отключим регистрацию для этих запросов и пометим их как высоко кэшируемые, так как обслуживание подобных ресурсов может повлечь серьезные затраты. Вы можете изменить этот статичный список файлов и включить любые другие расширения файла, которые вы можете использовать на вашем сайте:</p>
<div class="code-label " title="/etc/nginx/sites-available/wordpress">/etc/nginx/sites-available/wordpress</div><pre class="code-pre "><code langs="">server {
    . . .

    <span class="highlight">location = /favicon.ico { log_not_found off; access_log off; }</span>
    <span class="highlight">location = /robots.txt { log_not_found off; access_log off; allow all; }</span>
    <span class="highlight">location ~* \.(css|gif|ico|jpeg|jpg|js|png)$ {</span>
        <span class="highlight">expires max;</span>
        <span class="highlight">log_not_found off;</span>
    <span class="highlight">}</span>
    . . .
}
</code></pre>
<p>Внутри существующего блока <code>location /</code> нам нужно изменить список <code>try_files</code>, чтобы вместо возвращения ошибки 404 по умолчанию, управление передавалось файлу <code>index.php</code> с аргументами запроса.</p>

<p>Вы должны получить примерно следующий вывод:</p>
<div class="code-label " title="/etc/nginx/sites-available/wordpress">/etc/nginx/sites-available/wordpress</div><pre class="code-pre "><code langs="">server {
    . . .
    location / {
        <span class="highlight">#</span>try_files $uri $uri/ =404;
        <span class="highlight">try_files $uri $uri/ /index.php$is_args$args;</span>
    }
    . . .
}
</code></pre>
<p>После завершения редактирования сохраните и закройте файл.</p>

<p>Теперь мы можем проверить нашу конфигурацию на наличие ошибок в синтаксисе, введя следующую команду:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nginx -t
</li></ul></code></pre>
<p>Если не будет выявлено ошибок, перезагрузите Nginx, введя следующую команду:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl reload nginx
</li></ul></code></pre>
<p>Теперь мы загрузим и настроим непосредственно WordPress.</p>

<h2 id="Шаг-4-—-Загрузка-wordpress">Шаг 4 — Загрузка WordPress</h2>

<p>Теперь, когда программное обеспечение для сервера настроено, мы можем загрузить и настроить WordPress. В целях обеспечения безопасности обычно рекомендуется использовать последнюю версию WordPress с официального сайта.</p>

<p>Перейдите в директорию с возможностью записи и загрузите сжатый релиз, введя следующую команду:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd /tmp
</li><li class="line" prefix="$">curl -LO https://wordpress.org/latest.tar.gz
</li></ul></code></pre>
<p>Извлеките сжатый файл для создания структуры директории WordPress:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">tar xzvf latest.tar.gz
</li></ul></code></pre>
<p>Мы сразу же перенесем эти файлы в корневую директорию документов. Перед этим мы можем скопировать пример файла конфигурации и присвоить имя файла, который считывается WordPress:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cp /tmp/wordpress/wp-config-sample.php /tmp/wordpress/wp-config.php
</li></ul></code></pre>
<p>Теперь мы можем скопировать все содержимое директории в корневую директорию. Мы будем использовать флаг <code>-a</code> для гарантии того, что наши разрешения поддерживаются. Мы используем точку в конце директории источника, чтобы указать, что все содержимое директории должно быть скопировано, включая любые скрытые файлы.</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo cp -a /tmp/wordpress/. /var/www/<span class="highlight">wordpress</span>
</li></ul></code></pre>
<p>Теперь, когда наши файлы на месте, мы укажем принадлежность к пользователю и группе <code>www-data</code>. Именно этот пользователь и группа используются Nginx, а Nginx потребуется выполнять чтение и запись файлов WordPress для обслуживания веб-сайта и выполнения автоматических обновлений.</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo chown -R www-data:www-data /var/www/<span class="highlight">wordpress</span>
</li></ul></code></pre>
<p>Теперь наши файлы находятся в корневой директории нашего сервера, мы указали принадлежность, но нам нужно выполнить дополнительную конфигурацию.</p>

<h2 id="Шаг-5-—-Настройка-файла-конфигурации-wordpress">Шаг 5 — Настройка файла конфигурации WordPress</h2>

<p>Далее нам нужно внести некоторые изменения в основной файл конфигурации WordPress.</p>

<p>При первом открытии файла нам в первую очередь нужно будет изменить некоторые секретные ключи для обеспечения безопасности нашей установки. WordPress позволяет использовать защищенный генератор для этих значений, чтобы вам не нужно было пытаться самостоятельно придумывать подходящие значения. Они используются исключительно внутри, поэтому использование сложных и безопасных значений никак не скажется на удобстве использования.</p>

<p>Чтобы получить безопасные значения из генератора секретных ключей WordPress, введите:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">curl -s https://api.wordpress.org/secret-key/1.1/salt/
</li></ul></code></pre>
<p>Вы получите уникальные значения, которые будут выглядеть следующим образом:</p>

<p><span class='warning'><strong>Предупреждение.</strong> Важно каждый раз запрашивать уникальные значения. <strong>НЕ</strong> копируйте значения, приведенные ниже!<br></span></p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>define('AUTH_KEY',         '1jl/vqfs&lt;XhdXoAPz9 <span class="highlight">DO NOT COPY THESE VALUES</span> c_j{iwqD^&lt;+c9.k&lt;J@4H');
define('SECURE_AUTH_KEY',  'E2N-h2]Dcvp+aS/p7X <span class="highlight">DO NOT COPY THESE VALUES</span> {Ka(f;rv?Pxf})CgLi-3');
define('LOGGED_IN_KEY',    'W(50,{W^,OPB%PB&lt;JF <span class="highlight">DO NOT COPY THESE VALUES</span> 2;y&amp;,2m%3]R6DUth[;88');
define('NONCE_KEY',        'll,4UC)7ua+8&lt;!4VM+ <span class="highlight">DO NOT COPY THESE VALUES</span> #`DXF+[$atzM7 o^-C7g');
define('AUTH_SALT',        'koMrurzOA+|L_lG}kf <span class="highlight">DO NOT COPY THESE VALUES</span>  07VC*Lj*lD&amp;?3w!BT#-');
define('SECURE_AUTH_SALT', 'p32*p,]z%LZ+pAu:VY <span class="highlight">DO NOT COPY THESE VALUES</span> C-?y+K0DK_+F|0h{!_xY');
define('LOGGED_IN_SALT',   'i^/G2W7!-1H2OQ+t$3 <span class="highlight">DO NOT COPY THESE VALUES</span> t6**bRVFSD[Hi])-qS`|');
define('NONCE_SALT',       'Q6]U:K?j4L%Z]}h^q7 <span class="highlight">DO NOT COPY THESE VALUES</span> 1% ^qUswWgn+6&amp;xqHN&amp;%');
</code></pre>
<p>Это строки конфигурации, которые мы можем вставить прямо в наш файл конфигурации для установки защищенных ключей. Скопируйте вывод, который вы получили.</p>

<p>Теперь откройте файл конфигурации WordPress:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /var/www/<span class="highlight">wordpress</span>/wp-config.php
</li></ul></code></pre>
<p>Найдите раздел, содержащий фиктивные значения для этих настроек. Он будет выглядеть примерно так:</p>
<div class="code-label " title="/var/www/wordpress/wp-config.php">/var/www/wordpress/wp-config.php</div><pre class="code-pre "><code langs="">. . .

define('AUTH_KEY',         'put your unique phrase here');
define('SECURE_AUTH_KEY',  'put your unique phrase here');
define('LOGGED_IN_KEY',    'put your unique phrase here');
define('NONCE_KEY',        'put your unique phrase here');
define('AUTH_SALT',        'put your unique phrase here');
define('SECURE_AUTH_SALT', 'put your unique phrase here');
define('LOGGED_IN_SALT',   'put your unique phrase here');
define('NONCE_SALT',       'put your unique phrase here');

. . .
</code></pre>
<p>Удалите эти строки и добавьте значения, которые вы скопировали из командной строки:</p>
<div class="code-label " title="/var/www/wordpress/wp-config.php">/var/www/wordpress/wp-config.php</div><pre class="code-pre "><code langs="">. . .

define('AUTH_KEY',         '<span class="highlight">VALUES COPIED FROM THE COMMAND LINE</span>');
define('SECURE_AUTH_KEY',  '<span class="highlight">VALUES COPIED FROM THE COMMAND LINE</span>');
define('LOGGED_IN_KEY',    '<span class="highlight">VALUES COPIED FROM THE COMMAND LINE</span>');
define('NONCE_KEY',        '<span class="highlight">VALUES COPIED FROM THE COMMAND LINE</span>');
define('AUTH_SALT',        '<span class="highlight">VALUES COPIED FROM THE COMMAND LINE</span>');
define('SECURE_AUTH_SALT', '<span class="highlight">VALUES COPIED FROM THE COMMAND LINE</span>');
define('LOGGED_IN_SALT',   '<span class="highlight">VALUES COPIED FROM THE COMMAND LINE</span>');
define('NONCE_SALT',       '<span class="highlight">VALUES COPIED FROM THE COMMAND LINE</span>');

. . .
</code></pre>
<p>Теперь нам нужно изменить некоторые настройки подключения базы данных в начале файла. Вам нужно изменить имя базы данных, пользователя базы данных и соответствующий пароль, которые мы настроили в MySQL.</p>

<p>Еще одно изменение, которое нам нужно внести, — это настройка метода, который WordPress должен использовать для записи данных в файловой системе. Поскольку мы предоставили веб-серверу разрешение на запись там, где ему потребуется, мы можем прямо установить для метода записи значение «прямая». Если бы мы не внесли это изменение в текущие настройки, это привело бы к тому, что при выполнении некоторых действий WordPress будет запрашивать данные учетной записи для FTP. Эта настройка может быть добавлена под настройками подключения базы данных или в любом другом месте в файле:</p>
<div class="code-label " title="/var/www/wordpress/wp-config.php">/var/www/wordpress/wp-config.php</div><pre class="code-pre "><code langs="">. . .

define('DB_NAME', '<span class="highlight">wordpress</span>');

/** MySQL database username */
define('DB_USER', '<span class="highlight">wordpressuser</span>');

/** MySQL database password */
define('DB_PASSWORD', '<span class="highlight">password</span>');

. . .

<span class="highlight">define('FS_METHOD', 'direct');</span>
</code></pre>
<p>Сохраните файл и закройте его после завершения.</p>

<h2 id="Шаг-6-—-Завершение-установки-через-веб-интерфейс">Шаг 6 — Завершение установки через веб-интерфейс</h2>

<p>Теперь, когда настройка сервера завершена, мы можем завершить установку через веб-интерфейс.</p>

<p>В адресной строке браузера введите доменное имя или открытый IP-адрес вашего сервера:</p>
<pre class="code-pre "><code langs="">http://<span class="highlight">server_domain_or_IP</span>
</code></pre>
<p>Выберите язык, который вы хотите использовать:</p>

<p><img src="https://assets.digitalocean.com/articles/wordpress_lemp_1604/language_selection.png" alt="Выбор языка WordPress"></p>

<p>После этого вы должны попасть на главную страницу настройки.</p>

<p>Выберите имя для вашего сайта WordPress и имя пользователя (не рекомендуется использовать имя «admin» или что-то подобное в целях безопасности). Надежный пароль создается автоматически. Сохраните этот пароль или выберите другой надежный пароль.</p>

<p>Введите адрес электронной почты и укажите, хотите ли вы, чтобы поисковые машины индексировали ваш сайт:</p>

<p><img src="https://assets.digitalocean.com/articles/wordpress_lemp_1604/setup_installation.png" alt="Настройка установки WordPress"></p>

<p>При нажатии далее вы перейдете на страницу входа:</p>

<p><img src="https://assets.digitalocean.com/articles/wordpress_lemp_1604/login_prompt.png" alt="Запрос входа в WordPress"></p>

<p>После входа вы перейдете в панель управления WordPress:</p>

<p><img src="https://assets.digitalocean.com/articles/wordpress_lemp_1604/admin_screen.png" alt="Запрос входа в WordPress"></p>

<h2 id="Заключение">Заключение</h2>

<p>WordPress установлен и готов к использованию! Ниже представлены некоторые общие шаги по выбору параметров для постоянных ссылок для ваших постов (см. <code>Настройка &gt; Постоянные ссылки</code>) или выбора новой темы (см. <code>Внешний вид &gt; Темы</code>). Если вы впервые работаете с WordPress, краткое изучите интерфейс для знакомства с вашей новой CMS.</p>
