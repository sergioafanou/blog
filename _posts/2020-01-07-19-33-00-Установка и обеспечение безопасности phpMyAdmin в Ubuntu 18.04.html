---
layout: post
title: Установка и обеспечение безопасности phpMyAdmin в Ubuntu 18.04
network: digitalocean
date: January 07, 2020 at 07:33PM
url: https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-phpmyadmin-on-ubuntu-18-04-ru
image: https://assets.digitalocean.com/articles/phpmyadmin_1804/phpmyadmin_sammy_login_small.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<p><em>Предыдущая версия данного руководства была написана <a href="https://www.digitalocean.com/community/users/bpb">Бреннаном Бернсом</a>.</em></p>

<h3 id="Введение">Введение</h3>

<p>Хотя многим пользователям требуются функциональные возможности систем управления базами данных, например, MySQL, им может показаться неудобным взаимодействие с системой исключительно с помощью командной строки MySQL</p>

<p><a href="https://www.phpmyadmin.net/">phpMyAdmin</a> был создан, чтобы пользователи могли взаимодействовать с MySQL через веб-интерфейс. В этом руководстве мы расскажем, как выполнить установку и обеспечить безопасность phpMyAdmin, чтобы вы могли безопасно использовать данный инструмент для управления своими базами данных в Ubuntu 18.04.</p>

<h2 id="Предварительные-требования">Предварительные требования</h2>

<p>Прежде чем приступить к изучению данного руководства, вам нужно выполнить несколько базовых действий.</p>

<p>Во-первых, мы полагаем, что ваш сервер имеет пользователя user без <strong>root</strong> прав с привилегиями <code>sudo</code>, а также брандмауэр с <code>ufw</code>, как указано в <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-18-04">руководстве по начальной настройке сервера для Ubuntu 18.04</a>.</p>

<p>Мы также предполагаем, что вы выполнили установку LAMP (Linux, Apache, MySQL и PHP) на вашем сервере с Ubuntu 18.04. Если вы еще не сделали этого, вы можете воспользоваться данным руководством по <a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-apache-mysql-php-lamp-stack-ubuntu-18-04">установке стека LAMP на Ubuntu 18.04</a>.</p>

<p>Наконец, существует ряд важных соображений безопасности при использовании таких программных средств, как phpMyAdmin, поскольку phpMyAdmin:</p>

<ul>
<li>напрямую связывается с установленной у вас версией MySQL;</li>
<li>управляет аутентификацией, используя учетные данные MySQL;</li>
<li>исполняет и возвращает результаты для произвольных SQL запросов.</li>
</ul>

<p>По этим причинам, и поскольку это широко применяемое PHP приложение, которое часто становится мишенью для атак, вы ни при каких условиях не должны запускать phpMyAdmin на удаленных системах, используя обычное HTTP-соединение. Если у вас нет существующего домена с настроенным SSL/TLS сертификатом, вы можете воспользоваться следующим руководством по <a href="https://www.digitalocean.com/community/tutorials/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-18-04">обеспечению безопасности Apache с помощью  Let&rsquo;s Encrypt  в Ubuntu 18.04</a>. Для этого вам потребуется <a href="https://www.digitalocean.com/community/tutorials/how-to-point-to-digitalocean-nameservers-from-common-domain-registrars">зарегистрировать доменное имя</a>, <a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-digitalocean-dns">создать DNS запись для вашего сервера</a> и <a href="https://www.digitalocean.com/community/tutorials/how-to-install-the-apache-web-server-on-ubuntu-18-04#step-5-%E2%80%94-setting-up-virtual-hosts-(recommended)">настроить виртуальный хост Apache</a>.</p>

<p>После завершения этих шагов вы будете готовы начать работу с данным руководством.</p>

<h2 id="Шаг-1-—-Установка-phpmyadmin">Шаг 1 — Установка phpMyAdmin</h2>

<p>Во-первых, мы установим phpMyAdmin из репозиториев Ubuntu по умолчанию.</p>

<p>Это делается с помощью обновления индекса пакета вашего сервера, после чего с помощью системы управления пакетами <code>APT</code> загружаются файлы и устанавливаются в вашей системе.</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt update
</li><li class="line" prefix="$">sudo apt install phpmyadmin php-mbstring php-gettext
</li></ul></code></pre>
<p>На этом этапе вам потребуется ответить на несколько вопросов для корректной настройки установки.</p>

<p><span class='warning'><strong>Предупреждение.</strong> При появлении первого диалогового окна вариант «apache2» выделен, но <strong>не</strong> выбран. Если вы не нажмете <code>ПРОБЕЛ</code> для выбора Apache, установщик <em>не</em> будет перемещать необходимые файлы при установке. Нажмите <code>ПРОБЕЛ,</code> <code>затем TAB,</code> а потом <code>ENTER</code> для выбора Apache.<br></span></p>

<ul>
<li>Для выбора сервера нажмите <code>apache2</code></li>
<li>Выберите <code>Да</code> при ответе на вопрос о том, необходимо ли использовать  <code>dbconfig-common</code> для настройки базы данных.</li>
<li>Затем вам будет предложено выбрать и подтвердить пароль приложения MySQL для phpMyAdmin</li>
</ul>

<p>В процессе установки будет добавлен файл конфигурации phpMyAdmin в каталог <code>/etc/apache2/-enabled/</code>, где он будет считываться автоматически. От вас потребуется только явным образом активировать PHP расширение <code>mbstring</code>, что можно сделать с помощью следующей команды:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo phpenmod mbstring
</li></ul></code></pre>
<p>Перезапустите Apache для вступления изменений в силу.</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart apache2
</li></ul></code></pre>
<p>После этого phpMyAdmin будет установлен и настроен. Однако, прежде чем вы сможете войти и начать взаимодействие с базами данных MySQL, вам нужно убедиться, что у пользователей MySQL есть права, необходимые для взаимодействия с программой.</p>

<h2 id="Шаг-2-—-Настройка-аутентификации-и-прав-пользователя">Шаг 2 — Настройка аутентификации и прав пользователя</h2>

<p>При установке phpMyAdmin на ваш сервер автоматически создал пользователь базы данных с именем <code>phpmyadmin</code>, который отвечает за определенные базовые процессы программы. Вместо того, чтобы выполнять вход с помощью этого пользователя и пароля администратора, которые вы задали при установке, рекомендуется войти с использование вашего <strong>root</strong> пользователя MySQL или пользователя, предназначенного для управления базами данных через интерфейс phpMyAdmin.</p>

<h3 id="Настройка-доступа-по-паролю-для-учетной-записи-root-в-mysql">Настройка доступа по паролю для учетной записи root в MySQL</h3>

<p>В системах Ubuntu при запуске MySQL 5.7 (и более поздние версии) для <strong>root</strong> пользователя MySQL по умолчанию устанавливается аутентификация с помощью плагина <code>auth_socket</code>, а не пароля. Это позволяет обеспечить большую безопасность и удобство во многих случаях, однако это также может осложнить ситуацию, когда вам нужно предоставить внешней программе, например, phpMyAdmin, доступ к пользователю.</p>

<p>Чтобы войти в phpMyAdmin с <strong>root</strong> пользователем MySQL, вам нужно переключить метод аутентификации с <code>auth_socket</code> на <code>mysql_native_password</code>, если вы еще не сделали этого. Для этого откройте командную строку MySQL через терминал:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo mysql
</li></ul></code></pre>
<p>Затем проверьте, какой метод аутентификации используют ваши аккаунты пользователей MySQL с помощью следующей команды:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">SELECT user,authentication_string,plugin,host FROM mysql.user;
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>+------------------+-------------------------------------------+-----------------------+-----------+
| user             | authentication_string                     | plugin                | host      |
+------------------+-------------------------------------------+-----------------------+-----------+
| root             |                                           | auth_socket           | localhost |
| mysql.session    | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost |
| mysql.sys        | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost |
| debian-sys-maint | *8486437DE5F65ADC4A4B001CA591363B64746D4C | mysql_native_password | localhost |
| phpmyadmin       | *5FD2B7524254B7F81B32873B1EA6D681503A5CA9 | mysql_native_password | localhost |
+------------------+-------------------------------------------+-----------------------+-----------+
5 rows in set (0.00 sec)
</code></pre>
<p>В этом примере вы можете видеть, что <strong>root</strong> пользователь действительно использует метод аутентификации с помощью плагина <code>auth_socket</code>. Чтобы настроить <strong>для учетной записи root</strong> аутентификацию с помощью пароля, выполните следующую команду <code>ALTER USER</code>. Обязательно измените значение <code><span class="highlight">password</span></code> на надежный пароль по вашему выбору:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '<span class="highlight">password</span>';
</li></ul></code></pre>
<p>Затем выполните команду <code>FLUSH PRIVILEGES</code>, которая просит сервер перезагрузить предоставленные таблицы и ввести в действие изменения:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">FLUSH PRIVILEGES;
</li></ul></code></pre>
<p>Проверьте методы аутентификации, применяемые для каждого из ваших пользователей, чтобы подтвердить, что <strong>root пользователь</strong> больше не использует для аутентификации плагин <code>auth_socket</code>:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">SELECT user,authentication_string,plugin,host FROM mysql.user;
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>+------------------+-------------------------------------------+-----------------------+-----------+
| user             | authentication_string                     | plugin                | host      |
+------------------+-------------------------------------------+-----------------------+-----------+
| root             | *DE06E242B88EFB1FE4B5083587C260BACB2A6158 | <span class="highlight">mysql_native_password</span> | localhost |
| mysql.session    | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost |
| mysql.sys        | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost |
| debian-sys-maint | *8486437DE5F65ADC4A4B001CA591363B64746D4C | mysql_native_password | localhost |
| phpmyadmin       | *5FD2B7524254B7F81B32873B1EA6D681503A5CA9 | mysql_native_password | localhost |
+------------------+-------------------------------------------+-----------------------+-----------+
5 rows in set (0.00 sec)
</code></pre>
<p>В этом выводе вы можете увидеть, что пользователь <strong>root</strong> будет использовать аутентификацию по паролю. Теперь вы можете выполнить вход в интерфейс phpMyAdmin с помощью <strong>root</strong> пользователя с паролем, который вы задали ранее.</p>

<h3 id="Настройка-доступа-по-паролю-для-выделенного-пользователя-mysql">Настройка доступа по паролю для выделенного пользователя MySQL</h3>

<p>Некоторые могут посчитать, что для их рабочего процесса лучше подходит подключение к phpMyAdmin с помощью специально выделенного пользователя. Чтобы сделать это, снова откройте командную строку MySQL:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo mysql
</li></ul></code></pre>
<span class='note'><p>
<strong>Примечание.</strong> Если вы активировали аутентификацию по паролю, как указано в предыдущем разделе, вам потребуются другие команды для доступа к командной строке MySQL. Следующая команда будет запускать ваш клиент MySQL с обычными правами пользователя, и вы получите права администратора внутри базы данных только с помощью аутентификации:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">mysql -u root -p
</li></ul></code></pre>
<p></p></span>

<p>Создайте нового пользователя и придумайте для него надежный пароль:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">CREATE USER '<span class="highlight">sammy</span>'@'localhost' IDENTIFIED BY '<span class="highlight">password</span>';
</li></ul></code></pre>
<p>Затем предоставьте вашему новому пользователю соответствующие права. Например, вы можете предоставить пользователю права доступа ко всем таблицам в базе данных, а также можете добавлять, изменять и удалять права пользователя с помощью этой команды:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">GRANT ALL PRIVILEGES ON *.* TO '<span class="highlight">sammy</span>'@'localhost' WITH GRANT OPTION;
</li></ul></code></pre>
<p>После этого закройте командную строку MySQL:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="mysql&gt;">exit
</li></ul></code></pre>
<p>Теперь вы можете получить доступ к веб-интерфейсу, набрав доменное имя или открытый IP-адрес вашего сервера и добавив <code>/phpmyadmin:</code></p>
<pre class="code-pre "><code langs="">http://<span class="highlight">your_domain_or_IP</span>/phpmyadmin
</code></pre>
<p><img src="https://assets.digitalocean.com/articles/phpmyadmin_1804/phpmyadmin_sammy_login_small.png" alt="phpMyAdmin login screen"></p>

<p>Выполните вход в интерфейс с помощью <strong>root</strong> пользователя или с новым именем пользователя и паролем, которые вы только что задали.</p>

<p>При входе вы увидите пользовательский интерфейс, который будет выглядеть следующим образом:</p>

<p><img src="https://assets.digitalocean.com/articles/phpmyadmin_1804/phpmyadmin_sammy_ui.png" alt="phpMyAdmin user interface"></p>

<p>Теперь, когда вы можете подключаться и взаимодействовать с phpMyAdmin, осталось только установить более жесткие правила безопасности системы, чтобы защитить ее от атак.</p>

<h2 id="Шаг-3-—-Обеспечение-безопасности-phpmyadmin">Шаг 3 — Обеспечение безопасности phpMyAdmin</h2>

<p>Из-за своей вездесущности phpMyAdmin часто становится мишенью для атак, поэтому вам нужно дополнительно позаботиться о предотвращении несанкционированного доступа. Один из самых простых способов – поместить шлюз перед всем приложением, используя встроенный в Apache метод аутентификации <code>.htaccess​​​</code> и функции авторизации.</p>

<p>Чтобы сделать это, вы должны сначала активировать перезапись файла <code>.htaccess</code>, изменив файл конфигурации Apache.</p>

<p>Отредактируйте связанный файл, помещенный в каталог конфигурации Apache:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/apache2/conf-available/phpmyadmin.conf
</li></ul></code></pre>
<p>Добавьте директиву <code>AllowOverride All</code> в раздел файла конфигурации <code>&lt;Directory /usr/share/phpmyadmin&gt;</code>, например:</p>
<div class="code-label " title="/etc/apache2/conf-available/phpmyadmin.conf">/etc/apache2/conf-available/phpmyadmin.conf</div><pre class="code-pre "><code langs="">&lt;Directory /usr/share/phpmyadmin&gt;
    Options FollowSymLinks
    DirectoryIndex index.php
    <span class="highlight">AllowOverride All</span>
    . . .
</code></pre>
<p>После добавления этой строки сохраните и закройте файл.</p>

<p>Перезапустите Apache, чтобы изменения вступили в силу.</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart apache2
</li></ul></code></pre>
<p>Теперь, когда вы активировали использование <code>.htaccess</code> для вашего приложения, вам нужно создать этот файл для реализации этого уровня защиты.</p>

<p>Чтобы этот файл мог использоваться, он должен находиться в каталоге приложения. Вы можете создать необходимый файл и открыть его в текстовом редакторе с помощью следующей команды:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /usr/share/phpmyadmin/.htaccess
</li></ul></code></pre>
<p>В этом файле введите следующую информацию:</p>
<div class="code-label " title="/usr/share/phpmyadmin/.htaccess">/usr/share/phpmyadmin/.htaccess</div><pre class="code-pre "><code langs="">AuthType Basic
AuthName "Restricted Files"
AuthUserFile /etc/phpmyadmin/.htpasswd
Require valid-user
</code></pre>
<p>Вот что означает каждая из этих строк:</p>

<ul>
<li><code>AuthType Basic</code>: эта строка указывает тип аутентификации, используемый вами. Данный тип подразумевает использование аутентификации по паролю с помощью файла пароля.</li>
<li><code>AuthName</code>: данная строка устанавливает сообщение для диалогового окна аутентификации. Вы должны указывать только общую информацию, чтобы неавторизованные пользователи не получили никакой информации о том, что вы защищаете.</li>
<li><code>AuthUserFile</code>: указывает местоположение файла пароля, который будет использоваться для аутентификации. Он должен находиться вне обслуживаемых каталогов. Скоро мы создадим этот файл.</li>
<li><code>Require valid-user</code>: указывает, что только выполнившие аутентификацию пользователи должны иметь доступ к этому ресурсу. Благодаря этому параметру неавторизованные пользователи не смогут выполнить вход.</li>
</ul>

<p>После завершения редактирования сохраните и закройте файл.</p>

<p>Вы использовали следующее местонахождение для вашего файла пароля <code>/etc/phpmyadmin/.htpasswd</code>. Теперь вы можете создать этот файл и передать его для первоначального пользователя с помощью утилиты <code>htpasswd</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo htpasswd -c /etc/phpmyadmin/.htpasswd <span class="highlight">username</span>
</li></ul></code></pre>
<p>Вам будет предложено выбрать и подтвердить пароль для пользователя, которого вы создаете. В результате будет создан файл с хэшированным паролем, который вы добавили.</p>

<p>Если вы хотите ввести дополнительного пользователя, вам нужно сделать это <strong>без</strong> флага <code>-c</code>, например:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo htpasswd /etc/phpmyadmin/.htpasswd <span class="highlight">additionaluser</span>
</li></ul></code></pre>
<p>Теперь, когда вы можете получить доступ к подкаталогу phpMyAdmin, вам будет предложено указать дополнительное имя учетной записи и пароль, которые вы только что задали:</p>
<pre class="code-pre "><code langs="">https://<span class="highlight">domain_name_or_IP</span>/phpmyadmin
</code></pre>
<p><img src="https://assets.digitalocean.com/articles/phpmyadmin_1404/apache_auth.png" alt="phpMyAdmin apache password"></p>

<p>После выполнения аутентификации в Apache вы перейдете на стандартную страницу аутентификации phpMyAdmin для ввода ваших учетных данных MySQL. Эта настройка добавляет дополнительный уровень безопасности, который желательно использовать, поскольку phpMyAdmin ранее страдал от уязвимостей.</p>

<h2 id="Заключение">Заключение</h2>

<p>Вы успешно настроили phpMyAdmin и теперь можете использовать phpMyAdmin на вашем сервере Ubuntu 18.04. Используя этот интерфейс, вы можете легко создавать базы данных, пользователей, таблицы и т. д., а также выполнять стандартные операции, например удалять и изменять структуры и данные.</p>
