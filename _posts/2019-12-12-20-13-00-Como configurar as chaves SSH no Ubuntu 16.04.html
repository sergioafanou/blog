---
layout: post
title: Como configurar as chaves SSH no Ubuntu 16.04
network: digitalocean
date: December 12, 2019 at 08:13PM
url: https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys-on-ubuntu-1604-pt
image: http://ifttt.com/images/no_image_card.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="introdução">Introdução</h3>

<p>O SSH, ou shell seguro, é um protocolo criptografado usado para administrar e se comunicar com servidores. Ao trabalhar com um servidor Ubuntu, existem boas chances de você gastar a maior parte do seu tempo em uma sessão de terminal conectada ao seu servidor através do SSH.</p>

<p>Neste guia, vamos focar na configuração de chaves SSH para uma instalação básica do Ubuntu 16.04. As chaves SSH fornecem uma maneira fácil e segura de fazer login no seu servidor e são recomendadas para todos os usuários.</p>

<h2 id="passo-1-—-criar-um-par-de-chaves-rsa">Passo 1 — Criar um par de chaves RSA</h2>

<p>O primeiro passo é criar uma par de chaves na máquina do cliente (geralmente seu computador):</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ssh-keygen
</li></ul></code></pre>
<p>Por padrão, o <code>ssh-keygen</code> criará um par de chaves RSA de 2048-bit, que é seguro o suficiente para a maioria dos casos (você pode opcionalmente adicionar a flag <code>-b 4096</code> para criar uma chave maior de 4096-bit).</p>

<p>Após digitar o comando, você deve ver o seguinte resultado:</p>
<pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>Generating public/private rsa key pair.
Enter file in which to save the key (/<span class="highlight">your_home</span>/.ssh/id_rsa):
</code></pre>
<p>Pressione <code>ENTER</code> para salvar o par de chaves no sub-diretório <code>.ssh/</code> no seu diretório home, ou especifique um caminho alternativo.</p>

<p>Se você tivesse gerado anteriormente um par de chaves SSH, pode ser que veja o seguinte prompt:</p>
<pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>/home/<span class="highlight">your_home</span>/.ssh/id_rsa already exists.
Overwrite (y/n)?
</code></pre>
<p>Se escolher substituir a chave no disco, você <strong>não</strong> poderá autenticar-se usando a chave anterior. Seja cuidadoso ao selecionar o sim, uma vez que este é um processo destrutivo que não pode ser revertido.</p>

<p>Então, você deve ver o seguinte prompt:</p>
<pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>Enter passphrase (empty for no passphrase):
</code></pre>
<p>Aqui você pode digitar uma frase secreta de forma opcional, o que é altamente recomendado. Uma frase secreta adiciona uma camada adicional de segurança para evitar que os usuários não autorizados façam login. Para aprender mais sobre segurança, consulte nosso tutorial sobre <a href="https://www.digitalocean.com/community/tutorials/how-to-configure-ssh-key-based-authentication-on-a-linux-server">Como configurar a autenticação baseada em chaves SSH em um servidor Linux</a>.</p>

<p>Você deve ver o seguinte resultado:</p>
<pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>Your identification has been saved in /<span class="highlight">your_home</span>/.ssh/id_rsa.
Your public key has been saved in /<span class="highlight">your_home</span>/.ssh/id_rsa.pub.
The key fingerprint is:
a9:49:2e:2a:5e:33:3e:a9:de:4e:77:11:58:b6:90:26 username@remote_host
The key's randomart image is:
+--[ RSA 2048]----+
|     ..o         |
|   E o= .        |
|    o. o         |
|        ..       |
|      ..S        |
|     o o.        |
|   =o.+.         |
|. =++..          |
|o=++.            |
+-----------------+
</code></pre>
<p>Agora, você tem uma chave pública e privada que pode usar para se autenticar. O próximo passo é colocar a chave pública no seu servidor para que você possa usar a autenticação baseada em chaves SSH para fazer login.</p>

<h2 id="passo-2-—-copiar-a-chave-pública-para-o-servidor-ubuntu">Passo 2 — Copiar a chave pública para o servidor Ubuntu</h2>

<p>A maneira mais rápida de copiar sua chave pública para o host do Ubuntu é usar um utilitário chamado <code>ssh-copy-id</code>. Devido a sua simplicidade, este método é altamente recomendado se estiver disponível. Se não tiver o <code>ssh-copy-id</code> disponível na sua máquina do cliente, você pode usar um dos dois métodos alternativos fornecidos nesta seção (copiar através do SSH baseado em senha, ou copiar manualmente a chave).</p>

<h3 id="copiando-sua-chave-pública-usando-o-ssh-copy-id">Copiando sua chave pública usando o <code>ssh-copy-id</code></h3>

<p>A ferramenta <code>ssh-copy-id</code> é incluída por padrão em muitos sistemas operacionais, então você pode tê-la disponível no seu sistema local. Para que este método funcione, você já deve ter acesso via SSH baseado em senha ao seu servidor.</p>

<p>Para usar o utilitário, você precisa especificar apenas o host remoto ao qual gostaria de se conectar e a conta do usuário que tem acesso SSH via senha. Esta é a conta na qual sua chave SSH pública será copiada.</p>

<p>A sintaxe é:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ssh-copy-id <span class="highlight">username</span>@<span class="highlight">remote_host</span>
</li></ul></code></pre>
<p>Pode ser que você veja a seguinte mensagem:</p>
<pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>The authenticity of host '<span class="highlight">203.0.113.1</span> (<span class="highlight">203.0.113.1</span>)' can't be established.
ECDSA key fingerprint is fd:fd:d4:f9:77:fe:73:84:e1:55:00:ad:d6:6d:22:fe.
Are you sure you want to continue connecting (yes/no)? <span class="highlight">yes</span>
</code></pre>
<p>Isso significa que seu computador local não reconhece o host remoto. Isso acontecerá na primeira vez que você se conectar a um novo host. Digite &ldquo;yes&rdquo; e pressione <code>ENTER</code> para continuar.</p>

<p>Em seguida, o utilitário irá analisar sua conta local em busca da chave <code>id_rsa.pub</code> que criamos mais cedo. Quando ele encontrar a chave, irá solicitar a senha da conta do usuário remoto:</p>
<pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
<span class="highlight">username</span>@<span class="highlight">203.0.113.1</span>'s password:
</code></pre>
<p>Digite a senha (sua digitação não será exibida para fins de segurança) e pressione <code>ENTER</code>. O utilitário se conectará à conta no host remoto usando a senha que você forneceu. Então, ele copiará o conteúdo da sua chave <code>~/.ssh/id_rsa.pub</code> em um arquivo no diretório da conta remota home <code>~/.ssh</code> chamado <code>authorized_keys</code>.</p>

<p>Você deve ver o seguinte resultado:</p>
<pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>Number of key(s) added: 1

Now try logging into the machine, with:   "ssh '<span class="highlight">username</span>@<span class="highlight">203.0.113.1</span>'"
and check to make sure that only the key(s) you wanted were added.
</code></pre>
<p>Neste ponto, sua chave <code>id_rsa.pub</code> foi enviada para a conta remota. Você pode continuar para o <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys-on-ubuntu-1604#step-3-%E2%80%94-authenticate-to-ubuntu-server-using-ssh-keys">Passo 3</a>.</p>

<h3 id="copiando-a-chave-pública-usando-o-ssh">Copiando a chave pública usando o SSH</h3>

<p>Se não tiver o <code>ssh-copy-id</code> disponível, mas tiver acesso SSH baseado em senha a uma conta do seu servidor, você pode fazer o upload das suas chaves usando um método SSH convencional.</p>

<p>Podemos fazer isso usando o comando <code>cat</code> para ler o conteúdo da chave SSH pública no nosso computador local e passando isso através de uma conexão SSH ao servidor remoto.</p>

<p>Do outro lado, podemos garantir que o diretório <code>~/.ssh</code> exista e que tenha as permissões corretas na conta que estamos usando.</p>

<p>Então, podemos entregar o conteúdo que foi passado em um arquivo chamado <code>authorized_keys</code> dentro deste diretório. Vamos usar o símbolo de redirecionamento <code>&gt;&gt;</code> para adicionar o conteúdo ao invés de substituí-lo. Isso permitirá que adicionemos chaves sem destruir chaves previamente adicionadas.</p>

<p>O comando completo se parece com este:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cat ~/.ssh/id_rsa.pub | ssh <span class="highlight">username</span>@<span class="highlight">remote_host</span> "mkdir -p ~/.ssh &amp;&amp; touch ~/.ssh/authorized_keys &amp;&amp; chmod -R go= ~/.ssh &amp;&amp; cat &gt;&gt; ~/.ssh/authorized_keys"
</li></ul></code></pre>
<p>Pode ser que você veja a seguinte mensagem:</p>
<pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>The authenticity of host '<span class="highlight">203.0.113.1</span> (<span class="highlight">203.0.113.1</span>)' can't be established.
ECDSA key fingerprint is fd:fd:d4:f9:77:fe:73:84:e1:55:00:ad:d6:6d:22:fe.
Are you sure you want to continue connecting (yes/no)? <span class="highlight">yes</span>
</code></pre>
<p>Isso significa que seu computador local não reconhece o host remoto. Isso acontecerá na primeira vez que você se conectar a um novo host. Digite &ldquo;yes&rdquo; e pressione <code>ENTER</code> para continuar.</p>

<p>Depois disso, você deve ser solicitado a digitar a senha da conta de usuário remoto:</p>
<pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div><span class="highlight">username</span>@<span class="highlight">203.0.113.1</span>'s password:
</code></pre>
<p>Após digitar sua senha, o conteúdo da sua chave <code>id_rsa.pub</code> será copiado para o final do arquivo <code>authorized_keys</code> da conta do usuário remoto. Continue para o <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys-on-ubuntu-1604#step-3-%E2%80%94-authenticate-to-ubuntu-server-using-ssh-keys">Passo 3</a> se isso foi bem-sucedido.</p>

<h3 id="copiando-a-chave-pública-manualmente">Copiando a chave pública manualmente</h3>

<p>Se não tiver acesso SSH baseado em senha ao seu servidor disponível, você terá que completar o processo acima manualmente.</p>

<p>Vamos adicionar manualmente o conteúdo do seu arquivo <code>id_rsa.pub</code> ao arquivo <code>~/.ssh/authorized_keys</code> na sua máquina remota.</p>

<p>Para exibir o conteúdo da sua chave <code>id_rsa.pub</code>, digite isso no seu computador local:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cat ~/.ssh/id_rsa.pub
</li></ul></code></pre>
<p>Você verá o conteúdo da chave, que deve ser parecido com este:</p>
<pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCqql6MzstZYh1TmWWv11q5O3pISj2ZFl9HgH1JLknLLx44+tXfJ7mIrKNxOOwxIxvcBF8PXSYvobFYEZjGIVCEAjrUzLiIxbyCoxVyle7Q+bqgZ8SeeM8wzytsY+dVGcBxF6N4JS+zVk5eMcV385gG3Y6ON3EG112n6d+SMXY0OEBIcO6x+PnUSGHrSgpBgX7Ks1r7xqFa7heJLLt2wWwkARptX7udSq05paBhcpB0pHtA1Rfz3K2B+ZVIpSDfki9UVKzT8JUmwW6NNzSgxUfQHGwnW7kj4jp4AT0VZk3ADw497M2G/12N0PPB5CnhHf7ovgy6nL1ikrygTKRFmNZISvAcywB9GVqNAVE+ZHDSCuURNsAInVzgYo9xgJDW8wUw2o8U77+xiFxgI5QSZX3Iq7YLMgeksaO4rBJEa54k8m5wEiEE1nUhLuJ0X/vh2xPff6SQ1BL/zkOhvJCACK6Vb15mDOeCSq54Cr7kvS46itMosi/uS66+PujOO+xt/2FWYepz6ZlN70bRly57Q06J+ZJoc9FfBCbCyYH7U/ASsmY095ywPsBo1XQ9PqhnN1/YOorJ068foQDNVpm146mUpILVxmq41Cj55YKHEazXGsdBIbXWhcrRf4G2fJLRcGUr9q8/lERo9oxRm5JFX6TCmj6kmiFqv+Ow9gI0x8GvaQ== demo@test
</code></pre>
<p>Acesse seu host remoto usando algum método que você tenha disponível.</p>

<p>Assim que tiver acesso à sua conta no servidor remoto, você deve garantir que o diretório <code>~/.ssh</code> exista. Este comando criará o diretório se necessário, ou não fará nada se ele já existir:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">mkdir -p ~/.ssh
</li></ul></code></pre>
<p>Agora, você pode criar ou modificar o arquivo <code>authorized_keys</code> dentro deste diretório. Você pode adicionar o conteúdo do seu arquivo <code>id_rsa.pub</code> ao final do arquivo <code>authorized_keys</code>, criando-o se for necessário, usando este comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">echo <span class="highlight">public_key_string</span> &gt;&gt; ~/.ssh/authorized_keys
</li></ul></code></pre>
<p>No comando acima, substitua o <code><span class="highlight">public_key_string</span></code>pelo resultado do comando <code>cat ~/.ssh/id_rsa.pub</code>que você executou no seu sistema local. Ela deve começar com <code>ssh-rsa AAAA...</code>.</p>

<p>Por fim, vamos garantir que o diretório <code>~/.ssh</code> e o arquivo <code>authorized_keys</code> tenha as permissões apropriadas configuradas:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">chmod -R go= ~/.ssh
</li></ul></code></pre>
<p>Isso remove recursivamente todas as permissões &ldquo;group&rdquo; e &ldquo;other&rdquo; para o diretório <code>~/.ssh/</code>.</p>

<p>Se você estiver usando a conta <code>root</code> para configurar chaves para uma conta de usuário, também é importante que o diretório <code>~/.ssh</code> pertença ao usuário e não ao <code>root</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">chown -R <span class="highlight">sammy</span>:<span class="highlight">sammy</span> ~/.ssh
</li></ul></code></pre>
<p>Neste tutorial, nosso usuário chama-se <span class="highlight">sammy</span>, mas você deve substituí-lo pelo nome de usuário apropriado no comando acima.</p>

<p>Agora, podemos tentar uma autenticação sem senha com nosso servidor Ubuntu.</p>

<h2 id="passo-3-—-autenticação-para-o-servidor-ubuntu-usando-chaves-ssh">Passo 3 — Autenticação para o servidor Ubuntu usando chaves SSH</h2>

<p>Se tiver completado um dos procedimentos acima, você deve conseguir fazer login no host remoto <em>sem</em> a senha da conta remota.</p>

<p>O processo básico é o mesmo:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ssh <span class="highlight">username</span>@<span class="highlight">remote_host</span>
</li></ul></code></pre>
<p>Se essa é a primeira vez que você se conecta a este host (caso tenha usado o último método acima), pode ser que veja algo como isso:</p>
<pre class="code-pre  local-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>The authenticity of host '<span class="highlight">203.0.113.1</span> (<span class="highlight">203.0.113.1</span>)' can't be established.
ECDSA key fingerprint is fd:fd:d4:f9:77:fe:73:84:e1:55:00:ad:d6:6d:22:fe.
Are you sure you want to continue connecting (yes/no)? <span class="highlight">yes</span>
</code></pre>
<p>Isso significa que seu computador local não reconhece o host remoto. Digite &ldquo;yes&rdquo; e então pressione <code>ENTER</code> para continuar.</p>

<p>Se não forneceu uma frase secreta para sua chave privada, você será logado imediatamente. Caso tenha fornecido uma frase secreta para a chave privada quando criou a chave, você será solicitado a digitá-la agora (note que sua digitação não será exibida na sessão do terminal como medida de segurança). Após a autenticação, uma nova sessão de shell deve abrir para você com a conta configurada no servidor Ubuntu.</p>

<p>Se a autenticação baseada em chaves foi bem-sucedida, continue para aprender a proteger ainda mais o seu sistema, desativando a autenticação por senha.</p>

<h2 id="passo-4-—-desativar-a-autenticação-por-senha-no-seu-servidor">Passo 4 — Desativar a autenticação por senha no seu servidor</h2>

<p>Se conseguiu logar na sua conta usando o SSH sem uma senha, você configurou com sucesso a autenticação baseada em chaves SSH na sua conta. Entretanto, seu mecanismo de autenticação baseado em senha ainda está ativo, o que significa que seu servidor ainda está exposto a ataques por força bruta.</p>

<p>Antes de completar os passos nesta seção, certifique-se de que você tenha uma autenticação baseada em chaves SSH configurada para a conta raiz neste servidor, ou, de preferência, que tenha uma autenticação baseada em senhas SSH configurada para uma conta não raiz neste servidor com privilégios <code>sudo</code>. Este passo irá bloquear os logins baseados em senha, então garantir que você ainda consiga obter acesso administrativo é crucial.</p>

<p>Assim que você tiver confirmado que sua conta remota tem privilégios administrativos, logue no seu servidor remoto com chaves SSH, como raiz ou com uma conta com privilégios <code>sudo</code>. Então, abra o arquivo de configuração do daemon SSH:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/ssh/sshd_config
</li></ul></code></pre>
<p>Dentro do arquivo, procure por uma diretriz chamada <code>PasswordAuthentication</code>. Isso pode ser transformado em comentário. Descomente a linha e configure o valor em &ldquo;no&rdquo;. Isso irá desativar a sua capacidade de fazer login através do SSH usando senhas de conta:</p>
<div class="code-label " title="/etc/ssh/sshd_config">/etc/ssh/sshd_config</div><pre class="code-pre "><code langs="">...
PasswordAuthentication no
...
</code></pre>
<p>Salve e feche o arquivo quando terminar pressionando <code>CTRL+X</code>, então <code>Y</code> para confirmar o salvamento do arquivo e, por fim, <code>ENTER</code> para sair do nano. Para realmente implementar essas alterações, precisamos reiniciar o serviço <code>sshd</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart ssh
</li></ul></code></pre>
<p>Como uma precaução, abra uma nova janela de terminal e teste se o serviço SSH está funcionando corretamente antes de fechar esta sessão:</p>
<pre class="code-pre command local-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ssh <span class="highlight">username</span>@<span class="highlight">remote_host</span>
</li></ul></code></pre>
<p>Assim que tiver verificado seu serviço SSH, você pode fechar todas as sessões atuais do servidor com segurança.</p>

<p>O daemon SSH no seu servidor Ubuntu agora responde apenas às chaves SSH. A autenticação baseada em senha foi desativada com sucesso.</p>

<h2 id="conclusão">Conclusão</h2>

<p>Agora, você deve ter uma autenticação baseada em chaves SSH configurada no seu servidor, permitindo que você faça login sem fornecer uma senha da conta.</p>

<p>Se você quiser aprender mais sobre como trabalhar com o SSH, veja nosso <a href="https://www.digitalocean.com/community/tutorials/ssh-essentials-working-with-ssh-servers-clients-and-keys">Guia dos fundamentos SSH</a>.</p>
