---
layout: post
title: How To Add Stimulus to a Ruby on Rails Application
network: digitalocean
date: September 26, 2019 at 08:29PM
url: https://www.digitalocean.com/community/tutorials/how-to-add-stimulus-to-a-ruby-on-rails-application
image: https://assets.digitalocean.com/articles/stimulus/stimulus_landing.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="introduction">Introduction</h3>

<p>If you are working with a <a href="https://rubyonrails.org/">Ruby on Rails</a> project, your requirements may include some interactivity with the HTML generated by your <a href="https://guides.rubyonrails.org/v5.2/action_view_overview.html">view templates</a>. If so, you have a few choices for how to implement this interactivity.</p>

<p>For example, you could implement a <a href="https://www.digitalocean.com/community/tags/javascript?type=tutorials">JavaScript</a> framework like <a href="https://reactjs.org/">React</a> or <a href="https://emberjs.com/">Ember</a>. If your requirements include handling state on the client side, or if you are concerned about performance issues associated with frequent queries to the server, then choosing one of these frameworks may make sense. Many Single Page Applications (SPAs) take this approach.</p>

<p>However, there are several considerations to keep in mind when implementing a framework that manages state and frequent updates on the client side:</p>

<ol>
<li>It&rsquo;s possible for loading and conversion requirements â€” things like parsing JavaScript, and fetching and converting JSON to HTML â€”  to limit performance. </li>
<li>Commitment to a framework may involve writing more code than your particular use case requires, particularly if you are looking for small-scale JavaScript enhancements.</li>
<li>State managed on both the client and server side can lead to a duplication of efforts, and increases the surface area for errors.</li>
</ol>

<p>As an alternative, the team at <a href="https://basecamp.com/">Basecamp</a> (the same team that wrote Rails) has created <a href="https://stimulusjs.org">Stimulus.js</a>, which they describe as &ldquo;a modest JavaScript framework for the HTML you already have.&rdquo; Stimulus is meant to enhance a modern Rails application by working with server-side generated HTML. State lives in the <a href="https://www.digitalocean.com/community/tutorial_series/understanding-the-dom-document-object-model">Document Object Model (DOM)</a>, and the framework offers standard ways of interacting with elements and events in the DOM. It works side by side with <a href="https://github.com/turbolinks/turbolinks">Turbolinks</a> (included in Rails 5+ by default) to improve performance and load times with code that is limited and scoped to a clearly defined purpose.</p>

<p>In this tutorial, you will install and use Stimulus to build on an existing Rails application that offers readers information about sharks. The application already has a model for handling shark data, but you will add a nested resource for posts about individual sharks, allowing users to build out a body of thoughts and opinions about sharks. This piece runs roughly parallel to <a href="https://www.digitalocean.com/community/tutorials/how-to-create-nested-resources-for-a-ruby-on-rails-application">How To Create Nested Resources for a Ruby on Rails Application</a>, except that we will be using JavaScript to manipulate the position and appearance of posts on the page. We will also take a slightly different approach to building out the post model itself.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>To follow this tutorial, you will need: </p>

<ul>
<li>A local machine or development server running Ubuntu 18.04. Your development machine should have a non-root user with administrative privileges and a firewall configured with <code>ufw</code>. For instructions on how to set this up, see our <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-18-04">Initial Server Setup with Ubuntu 18.04</a> tutorial.</li>
<li><a href="https://nodejs.org">Node.js</a> and <a href="https://www.npmjs.com/">npm</a> installed on your local machine or development server. This tutorial uses Node.js version <span class="highlight">10.16.3</span> and npm version <span class="highlight">6.9.0</span>. For guidance on installing Node.js and npm on Ubuntu 18.04, follow the instructions in the <strong>&ldquo;Installing Using a PPA&rdquo;</strong> section of <a href="https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-18-04#installing-using-a-ppa">How To Install Node.js on Ubuntu 18.04</a>. </li>
<li>Ruby, <a href="https://github.com/rbenv/rbenv">rbenv</a>, and Rails installed on your local machine or development server, following <strong>Steps 1-4</strong> in <a href="https://www.digitalocean.com/community/tutorials/how-to-install-ruby-on-rails-with-rbenv-on-ubuntu-18-04">How To Install Ruby on Rails with rbenv on Ubuntu 18.04</a>. This tutorial uses Ruby <span class="highlight">2.5.1</span>, rbenv <span class="highlight">1.1.2</span>, and Rails <span class="highlight">5.2.3</span>.</li>
<li>SQLite installed, and a basic shark information application created, following the directions in <a href="https://www.digitalocean.com/community/tutorials/how-to-build-a-ruby-on-rails-application">How To Build a Ruby on Rails Application</a>.</li>
</ul>

<h2 id="step-1-â€”-creating-a-nested-model">Step 1 â€” Creating a Nested Model</h2>

<p>Our first step will be to create a nested <code>Post</code> <a href="https://guides.rubyonrails.org/active_record_basics.html">model</a>, which we will associate with our existing <code>Shark</code> model. We will do this by creating Active Record <a href="https://guides.rubyonrails.org/association_basics.html"><em>associations</em></a> between our models: posts will belong to particular sharks, and each shark can have multiple posts.</p>

<p>To get started, navigate to the <code>sharkapp</code> directory that you created for your Rails project in the prerequisites:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd sharkapp
</li></ul></code></pre>
<p>To create our <code>Post</code> model, we&rsquo;ll use the <a href="https://guides.rubyonrails.org/command_line.html#rails-generate"><code>rails generate</code></a> command with the <code>model</code> generator. Type the following command to create the model:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">rails generate model Post body:text shark:references
</li></ul></code></pre>
<p>With <code>body:text</code>, we&rsquo;re telling Rails to include a <code>body</code> field in the <code>posts</code> database table â€” the table that maps to the <code>Post</code> model. We&rsquo;re also including the <code>:references</code> keyword, which sets up an association between the <code>Shark</code> and <code>Post</code> models. Specifically, this will ensure that a <a href="https://en.wikipedia.org/wiki/Foreign_key">foreign key</a> representing each shark entry in the <code>sharks</code> database is added to the <code>posts</code> database.</p>

<p>Once you have run the command, you will see output confirming the resources that Rails has generated for the application. Before moving on, you can check your database migration file to look at the relationship that now exists between your models and database tables. Use the following command to look at the contents of the file, making sure to substitute the timestamp on your own migration file for what&rsquo;s shown here:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cat db/migrate/<span class="highlight">20190805132506</span>_create_posts.rb
</li></ul></code></pre>
<p>You will see the following output:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>class CreatePosts &lt; ActiveRecord::Migration[5.2]
  def change
    create_table :posts do |t|
      t.text :body
      <span class="highlight">t.references :shark, foreign_key: true</span>

      t.timestamps
    end
  end
end
</code></pre>
<p>As you can see, the table includes a column for a shark foreign key. This key will take the form of <code><span class="highlight">model_name</span>_id</code> â€” in our case, <code><span class="highlight">shark</span>_id</code>.</p>

<p>Rails has established the relationship between the models elsewhere as well. Take a look at the newly generated <code>Post</code> model with the following command:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cat app/models/post.rb
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>class Post &lt; ApplicationRecord
  belongs_to :shark
end
</code></pre>
<p>The <code>belongs_to</code> association sets up a relationship between models in which a single instance of the declaring model belongs to a single instance of the named model. In the case of our application, this means that a single post belongs to a single shark.</p>

<p>Though Rails has already set the <code>belongs_to</code> association in our <code>Post</code> model, we will need to specify a <code>has_many</code> association in our <code>Shark</code> model as well in order for that relationship to function properly. </p>

<p>To add the <code>has_many</code> association to the <code>Shark</code> model, open <code>app/models/shark.rb</code> using <code>nano</code> or your favorite editor:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano app/models/shark.rb
</li></ul></code></pre>
<p>Add the following line to the file to establish the relationship between sharks and posts:</p>
<div class="code-label " title="~/sharkapp/app/models/shark.rb">~/sharkapp/app/models/shark.rb</div><pre class="code-pre "><code langs="">class Shark &lt; ApplicationRecord
  <span class="highlight">has_many :posts</span>
  validates :name, presence: true, uniqueness: true
  validates :facts, presence: true
end
</code></pre>
<p>One thing that is worth thinking about here is what happens to posts once a particular shark is deleted. We likely do not want the posts associated with a deleted shark persisting in the database. To ensure that any posts associated with a given shark are eliminated when that shark is deleted, we can include the <code>dependent</code> option with the association.</p>

<p>Add the following code to the file to ensure that the <code>destroy</code> action on a given shark deletes any associated posts:</p>
<div class="code-label " title="~/sharkapp/app/models/shark.rb">~/sharkapp/app/models/shark.rb</div><pre class="code-pre "><code langs="">class Shark &lt; ApplicationRecord
  has_many :posts <span class="highlight">, dependent: :destroy</span>
  validates :name, presence: true, uniqueness: true
  validates :facts, presence: true
end
</code></pre>
<p>Once you have finished making these changes, save and close the file. If you are working with <code>nano</code>, do this by pressing <code>CTRL+X</code>, <code>Y</code>, then <code>ENTER</code>.</p>

<p>You now have a model generated for your posts, but you will also need a <a href="https://guides.rubyonrails.org/action_controller_overview.html">controller</a> to coordinate between the data in your database and the HTML that&rsquo;s generated and presented to users.</p>

<h2 id="step-2-â€”-creating-a-controller-for-a-nested-resource">Step 2 â€” Creating a Controller for a Nested Resource</h2>

<p>Creating a posts controller will involve setting a nested resource route in the application&rsquo;s main routing file and creating the controller file itself to specify the methods we want associated with particular actions.</p>

<p>To begin, open your <code>config/routes.rb</code> file to establish the relationship between your resourceful routes:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano config/routes.rb
</li></ul></code></pre>
<p>Currently, the file looks like this:</p>
<div class="code-label " title="~/sharkapp/config/routes.rb">~/sharkapp/config/routes.rb</div><pre class="code-pre "><code langs="">Rails.application.routes.draw do
  resources :sharks

  root 'sharks#index'
  # For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html
end
</code></pre>
<p>We want to create a <a href="https://guides.rubyonrails.org/routing.html#nested-resources">dependent relationship</a> relationship between shark and post resources. To do this, update your route declaration to make <code>:sharks</code> the parent of <code>:posts</code>. Update the code in the file to look like the following:</p>
<div class="code-label " title="~/sharkapp/config/routes.rb">~/sharkapp/config/routes.rb</div><pre class="code-pre "><code langs="">Rails.application.routes.draw do
  resources :sharks <span class="highlight">do</span>
    <span class="highlight">resources :posts</span>
  <span class="highlight">end</span>
  root 'sharks#index'
  # For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html
end
</code></pre>
<p>Save and close the file when you are finished editing.</p>

<p>Next, create a new file called <code>app/controllers/posts_controller.rb</code> for the controller:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano app/controllers/posts_controller.rb
</li></ul></code></pre>
<p>In this file, we&rsquo;ll define the methods that we will use to create and destroy individual posts. However, because this is a nested model, we&rsquo;ll also want to create a local instance variable, <code>@shark</code>, that we can use to associate particular posts with specific sharks.</p>

<p>First, we can create the <code>PostsController</code> class itself, along with two <code>private</code> methods: <code>get_shark</code>, which will allow us to reference a particular shark, and <code>post_params</code>, which gives us access to user-submitted information by way of the <a href="https://api.rubyonrails.org/classes/ActionController/Parameters.html">params method</a>.</p>

<p>Add the following code to the file:</p>
<div class="code-label " title="~/sharkapp/app/controllers/posts_controller.rb">~/sharkapp/app/controllers/posts_controller.rb</div><pre class="code-pre "><code langs="">class PostsController &lt; ApplicationController
  before_action :get_shark 

  private

  def get_shark
    @shark = Shark.find(params[:shark_id])
  end

  def post_params
    params.require(:post).permit(:body, :shark_id)
  end
end
</code></pre>
<p>You now have methods to get the particular shark instances with which your posts will be associated, using the <code>:shark_id</code> key, and the data that users are inputting to create posts. Both of these objects will now be available for the methods you will define to handle creating and destroying posts.</p>

<p>Next, above the <code>private</code> methods, add the following code to the file to define your <code>create</code> and <code>destroy</code> methods:</p>
<div class="code-label " title="~/sharkapp/app/controllers/posts_controller.rb">~/sharkapp/app/controllers/posts_controller.rb</div><pre class="code-pre "><code langs="">. . .
  def create
    @post = @shark.posts.create(post_params)
  end

  def destroy
    @post = @shark.posts.find(params[:id])
    @post.destroy   
  end
. . .
</code></pre>
<p>These methods associate <code>@post</code> instances with particular <code>@shark</code> instances, and use the <a href="https://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html#method-i-has_many">collection methods</a> that became available to us when we created the <code>has_many</code> association between sharks and posts. Methods such as <code>find</code> and <code>create</code> allow us to target the collection of posts associated with a particular shark. </p>

<p>The finished file will look like this:</p>
<div class="code-label " title="~/sharkapp/app/controllers/posts_controller.rb">~/sharkapp/app/controllers/posts_controller.rb</div><pre class="code-pre "><code langs="">class PostsController &lt; ApplicationController
  before_action :get_shark 

  def create
    @post = @shark.posts.create(post_params)
  end

  def destroy
    @post = @shark.posts.find(params[:id])
    @post.destroy   
  end

  private

  def get_shark
    @shark = Shark.find(params[:shark_id])
  end

  def post_params
    params.require(:post).permit(:body, :shark_id)
  end
end
</code></pre>
<p>Save and close the file when you are finished editing. </p>

<p>With your controller and model in place, you can begin thinking about your view templates and how you will organize your application&rsquo;s generated HTML. </p>

<h2 id="step-3-â€”-reorganizing-views-with-partials">Step 3 â€” Reorganizing Views with Partials</h2>

<p>You have created a <code>Post</code> model and controller, so the last thing to think about from a Rails perspective will be the views that present and allow users to input information about sharks. Views are also the place where you will have a chance to build out interactivity with Stimulus. </p>

<p>In this step, you will map out your views and partials, which will be the starting point for your work with Stimulus.</p>

<p>The view that will act as the base for posts and all partials associated with posts is the <code>sharks/show</code> view. </p>

<p>Open the file:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano app/views/sharks/show.html.erb
</li></ul></code></pre>
<p>Currently, the file looks like this:</p>
<div class="code-label " title="~/sharkapp/app/views/sharks/show.html.erb">~/sharkapp/app/views/sharks/show.html.erb</div><pre class="code-pre "><code langs="">&lt;p id="notice"&gt;&lt;%= notice %&gt;&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Name:&lt;/strong&gt;
  &lt;%= @shark.name %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Facts:&lt;/strong&gt;
  &lt;%= @shark.facts %&gt;
&lt;/p&gt;

&lt;%= link_to 'Edit', edit_shark_path(@shark) %&gt; |
&lt;%= link_to 'Back', sharks_path %&gt;
</code></pre>
<p>When we created our <code>Post</code> model, we opted not to generate views for our posts, since we will handle them through our <code>sharks/show</code> view. So in this view, the first thing we will address is how we will accept user input for new posts, and how we will present posts back to the user.</p>

<p><span class='note'><strong>Note:</strong> For an alternative to this approach, please see <a href="https://www.digitalocean.com/community/tutorials/how-to-create-nested-resources-for-a-ruby-on-rails-application">How To Create Nested Resources for a Ruby on Rails Application</a>, which sets up post views using the full range of <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">Create, Read, Update, Delete</a> (CRUD) methods defined in the posts controller. For a discussion of these methods and how they work, please see <a href="https://www.digitalocean.com/community/tutorials/how-to-build-a-ruby-on-rails-application#step-3-%E2%80%94-scaffolding-the-application">Step 3</a> of <a href="https://www.digitalocean.com/community/tutorials/how-to-build-a-ruby-on-rails-application">How To Build a Ruby on Rails Application</a>.<br></span></p>

<p>Instead of building all of our functionality into this view, we will use partials â€” reusable templates that serve a particular function. We will create one partial for new posts, and another to control how posts are displayed back to the user. Throughout, we&rsquo;ll be thinking about how and where we can use Stimulus to manipulate the appearance of posts on the page, since our goal is to control the presentation of posts with JavaScript.</p>

<p>First, below shark facts, add an <code>&lt;h2&gt;</code> header for posts and a line to render a partial called <code>sharks/posts</code>:</p>
<div class="code-label " title="~/sharkapp/app/views/sharks/show.html.erb">~/sharkapp/app/views/sharks/show.html.erb</div><pre class="code-pre "><code langs="">. . . 
&lt;p&gt;
  &lt;strong&gt;Facts:&lt;/strong&gt;
  &lt;%= <a href="https://www.digitalocean.com/community/users/shark-facts" class="username-tag">@shark.facts</a> %&gt;
&lt;/p&gt;

<span class="highlight">&lt;h2&gt;Posts&lt;/h2&gt;</span>
<span class="highlight">&lt;%= render 'sharks/posts' %&gt;</span>
. . . 
</code></pre>
<p>This will render the partial with the form builder for new post objects. </p>

<p>Next, below the <code>Edit</code> and <code>Back</code> links, we will add a section to control the presentation of older posts on the page. Add the following lines to the file to render a partial called <code>sharks/all</code>:</p>
<div class="code-label " title="~/sharkapp/app/views/sharks/show.html.erb">~/sharkapp/app/views/sharks/show.html.erb</div><pre class="code-pre "><code langs="">&lt;%= link_to 'Edit', edit_shark_path(@shark) %&gt; |
&lt;%= link_to 'Back', sharks_path %&gt;

<span class="highlight">&lt;div&gt;</span>
  <span class="highlight">&lt;%= render 'sharks/all' %&gt;</span>
<span class="highlight">&lt;/div&gt;</span>
</code></pre>
<p>The <code>&lt;div&gt;</code> element will be useful when we start integrating Stimulus into this file.</p>

<p>Once you are finished making these edits, save and close the file. With the changes you&rsquo;ve made on the Rails side, you can now move on to installing and integrating Stimulus into your application. </p>

<h2 id="step-4-â€”-installing-stimulus">Step 4 â€” Installing Stimulus</h2>

<p>The first step in using Stimulus will be to install and configure our application to work with it. This will include making sure we have the correct dependencies, including the <a href="https://yarnpkg.com">Yarn</a> package manager and <a href="https://github.com/rails/webpacker">Webpacker</a>, the gem that will allow us to work with the JavaScript pre-processor and bundler <a href="https://webpack.js.org/">webpack</a>. With these dependencies in place, we will be able to install Stimulus and use JavaScript to manipulate events and elements in the DOM.</p>

<p>Let&rsquo;s begin by installing Yarn. First, update your package list:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt update
</li></ul></code></pre>
<p>Next, add the GPG key for the Debian Yarn repository:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
</li></ul></code></pre>
<p>Add the repository to your APT sources:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
</li></ul></code></pre>
<p>Update the package database with the newly added Yarn packages:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt update
</li></ul></code></pre>
<p>And finally, install Yarn:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt install yarn
</li></ul></code></pre>
<p>With <code>yarn</code> installed, you can move on to adding the <code>webpacker</code> gem to your project.</p>

<p>Open your project&rsquo;s Gemfile, which lists the gem dependencies for your project:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano Gemfile
</li></ul></code></pre>
<p>Inside the file, you will see Turbolinks enabled by default:</p>
<div class="code-label " title="~/sharkapp/Gemfile">~/sharkapp/Gemfile</div><pre class="code-pre "><code langs="">. . . 
# Turbolinks makes navigating your web application faster. Read more: https://github.com/turbolinks/turbolinks
gem 'turbolinks', '~&gt; 5'
. . . 
</code></pre>
<p>Turbolinks is designed to improve performance by optimizing page loads: instead of having link clicks navigate to a new page, Turbolinks intercepts these click events and makes the page request using <a href="https://en.wikipedia.org/wiki/Ajax_(programming)">Asynchronous JavaScript and HTML (AJAX)</a>. It then replaces the body of the current page and merges the contents of the <code>&lt;head&gt;</code> sections, while the JavaScript <code>window</code> and <code>document</code> objects and the <code>&lt;html&gt;</code> element persist between renders. This addresses one of the main causes of slow page load times: the reloading of CSS and JavaScript resources.</p>

<p>We get Turbolinks by default in our Gemfile, but we will need to add the <code>webpacker</code> gem so that we can install and use Stimulus. Below the <code>turbolinks</code> gem, add <code>webpacker</code>:</p>
<div class="code-label " title="~/sharkapp/Gemfile">~/sharkapp/Gemfile</div><pre class="code-pre "><code langs="">. . . 
# Turbolinks makes navigating your web application faster. Read more: https://github.com/turbolinks/turbolinks
gem 'turbolinks', '~&gt; 5'
<span class="highlight">gem 'webpacker', '~&gt; 4.x'</span>
. . . 
</code></pre>
<p>Save and close the file when you are finished. </p>

<p>Next, add the gem to your project&rsquo;s bundle with the <code>bundle</code> command:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">bundle
</li></ul></code></pre>
<p>This will generate a new <code>Gemfile.lock</code> file â€” the definitive record of gems and versions for your project.</p>

<p>Next, install the gem in the context of your bundle with the following <code>bundle exec</code> command:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">bundle exec rails webpacker:install
</li></ul></code></pre>
<p>Once the installation is complete, we will need to make one small adjustment to our application&rsquo;s content security file. This is due to the fact that we are working with Rails 5.2+, which is a <a href="https://guides.rubyonrails.org/security.html#content-security-policy">Content Security Policy (CSP)</a> restricted environment, meaning that the only scripts allowed in the application must be from trusted sources.</p>

<p>Open <code>config/initializers/content_security_policy.rb</code>, which is the default file Rails gives us for defining application-wide security policies:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano config/initializers/content_security_policy.rb
</li></ul></code></pre>
<p>Add the following lines to the bottom of the file to allow <code>webpack-dev-server</code> â€” the server that serves our application&rsquo;s webpack bundle â€” as an allowed origin:</p>
<div class="code-label " title="~/sharkapp/config/initializers/content_security_policy.rb">~/sharkapp/config/initializers/content_security_policy.rb</div><pre class="code-pre "><code langs="">. . . 
Rails.application.config.content_security_policy do |policy|
  policy.connect_src :self, :https, 'http://localhost:3035', 'ws://localhost:3035' if Rails.env.development?
end
</code></pre>
<p>This will ensure that the <code>webpacker-dev-server</code> is recognized as a trusted asset source.</p>

<p>Save and close the file when you are finished making this change.</p>

<p>By installing <code>webpacker</code>, you created two new directories in your project&rsquo;s <code>app</code> directory, the directory where your main application code is located. The new parent directory, <code>app/javascript</code>, will be where your project&rsquo;s JavaScript code will live, and it will have the following structure:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>â”œâ”€â”€ javascript
â”‚   â”œâ”€â”€ controllers
â”‚   â”‚   â”œâ”€â”€ hello_controller.js
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â””â”€â”€ packs
â”‚       â””â”€â”€ application.js
</code></pre>
<p>The <code>app/javascript</code> directory will contain two child directories: <code>app/javascript/packs</code>, which will have your webpack entry points, and <code>app/javascript/controllers</code>, where you will define your Stimulus <a href="https://stimulusjs.org/reference/controllers">controllers</a>. The <code>bundle exec</code> command that we just used will create the <code>app/javascript/packs</code> directory, but we will need to install Stimulus for the <code>app/javascript/controllers</code> directory to be autogenerated.</p>

<p>With <code>webpacker</code> installed, we can now install Stimulus with the following command:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">bundle exec rails webpacker:install:stimulus
</li></ul></code></pre>
<p>You will see output like the following, indicating that the installation was successful:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>. . . 
success Saved lockfile.
success Saved 5 new dependencies.
info Direct dependencies
â””â”€ stimulus@1.1.1
info All dependencies
â”œâ”€ @stimulus/core@1.1.1
â”œâ”€ @stimulus/multimap@1.1.1
â”œâ”€ @stimulus/mutation-observers@1.1.1
â”œâ”€ @stimulus/webpack-helpers@1.1.1
â””â”€ stimulus@1.1.1
Done in 8.30s.
Webpacker now supports Stimulus.js ðŸŽ‰
</code></pre>
<p>We now have Stimulus installed, and the main directories we need to work with it in place. Before moving on to writing any code, we&rsquo;ll need to make a few application-level adjustments to complete the installation process. </p>

<p>First, we&rsquo;ll need to make an adjustment to <code>app/views/layouts/application.html.erb</code> to ensure that our JavaScript code is available and that the code defined in our main <code>webpacker</code> entry point, <code>app/javascript/packs/application.js</code>, runs each time a page is loaded.</p>

<p>Open that file:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano app/views/layouts/application.html.erb
</li></ul></code></pre>
<p>Change the following <code>javascript_include_tag</code> tag to <code>javascript_<span class="highlight">pack</span>_tag</code> to load <code>app/javascript/packs/application.js</code>:</p>
<div class="code-label " title="~/sharkapp/app/views/layouts/application.html.erb">~/sharkapp/app/views/layouts/application.html.erb</div><pre class="code-pre "><code langs="">. . .
    &lt;%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %&gt;
    &lt;%= javascript_<span class="highlight">pack</span>_tag 'application', 'data-turbolinks-track': 'reload' %&gt;
. . . 
</code></pre>
<p>Save and close the file when you have made this change.</p>

<p>Next, open <code>app/javascript/packs/application.js</code>: </p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano app/javascript/packs/application.js
</li></ul></code></pre>
<p>Initially, the file will look like this:</p>
<div class="code-label " title="~/sharkapp/app/javascript/packs/application.js">~/sharkapp/app/javascript/packs/application.js</div><pre class="code-pre "><code langs="">. . . 
console.log('Hello World from Webpacker')

import "controllers"
</code></pre>
<p>Delete the boilerplate code that&rsquo;s there, and add the following code to load your Stimulus controller files and boot the application instance:</p>
<div class="code-label " title="~/sharkapp/app/javascript/packs/application.js">~/sharkapp/app/javascript/packs/application.js</div><pre class="code-pre "><code langs="">. . . 
import { Application } from "stimulus"
import { definitionsFromContext } from "stimulus/webpack-helpers"

const application = Application.start()
const context = require.context("../controllers", true, /\.js$/)
application.load(definitionsFromContext(context))
</code></pre>
<p>This code uses webpack helper methods to require the controllers in the <code>app/javascript/controllers</code> directory and load this context for use in your application.</p>

<p>Save and close the file when you are finished editing.</p>

<p>You now have Stimulus installed and ready to use in your application. Next, we&rsquo;ll build out the partials that we referenced in our sharks <code>show</code> view â€” <code>sharks/posts</code> and <code>sharks/all</code> â€” using Stimulus <em>controllers</em>, <em>targets</em>, and <em>actions</em>. </p>

<h2 id="step-5-â€”-using-stimulus-in-rails-partials">Step 5 â€” Using Stimulus in Rails Partials</h2>

<p>Our <code>sharks/posts</code> partial will use the <a href="https://api.rubyonrails.org/v5.2.3/classes/ActionView/Helpers/FormHelper.html"><code>form_with</code> form helper</a> to create a new post object. It will also make use of Stimulus&rsquo;s three core concepts: controllers, targets, and actions. These concepts work as follows:</p>

<ul>
<li>Controllers are JavaScript classes that are defined in JavaScript modules and exported as the module&rsquo;s default object. Through controllers, you have access to particular HTML elements and the Stimulus Application instance defined in <code>app/javascript/packs/application.js</code>.</li>
<li>Targets allow you to reference particular HTML elements by name, and are associated with particular controllers.</li>
<li>Actions control how DOM events are handled by controllers, and are also associated with particular controllers. They create a connection between the HTML element associated with the controller, the methods defined in the controller, and a DOM event listener.</li>
</ul>

<p>In our partial, we&rsquo;re first going to build a form as we normally would using Rails. We will then add a Stimulus controller, action, and targets to the form in order to use JavaScript to control how new posts get added to the page.</p>

<p>First, create a new file for the partial:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano app/views/sharks/_posts.html.erb
</li></ul></code></pre>
<p>Inside the file, add the following code to create a new post object using the <code>form_with</code> helper:</p>
<div class="code-label " title="~/sharkapp/app/views/sharks/_posts.html.erb">~/sharkapp/app/views/sharks/_posts.html.erb</div><pre class="code-pre "><code langs="">        &lt;%= form_with model: [@shark, @shark.posts.build] do |form| %&gt;
                &lt;%= form.text_area :body, placeholder: "Your post here" %&gt;
                &lt;br&gt;
                &lt;%= form.submit %&gt;
        &lt;% end %&gt;
</code></pre>
<p>So far, this form behaves like a typical Rails form, using the <code>form_with</code> helper to build a post object with the fields defined for the <code>Post</code> model. Thus, the form has a field for the post <code>:body</code>, to which we&rsquo;ve added a <code>placeholder</code> with a prompt for filling in a post. </p>

<p>Additionally, the form is scoped to take advantage of the collection methods that come with the associations between the <code>Shark</code> and <code>Post</code> models. In this case, the new post object that&rsquo;s created from user-submitted data will belong to the collection of posts associated with the shark we&rsquo;re currently viewing.</p>

<p>Our goal now is to add some Stimulus controllers, events, and actions to control how the post data gets displayed on the page. The user will ultimately submit post data and see it posted to the page thanks to a Stimulus action. </p>

<p>First, we&rsquo;ll add a controller to the form called <code><span class="highlight">posts</span></code> in a <code>&lt;div&gt;</code> element:</p>
<div class="code-label " title="~/sharkapp/app/views/sharks/_posts.html.erb">~/sharkapp/app/views/sharks/_posts.html.erb</div><pre class="code-pre "><code langs=""><span class="highlight">&lt;div data-controller="posts"&gt;</span>
        &lt;%= form_with model: [@shark, <a href="https://www.digitalocean.com/community/users/shark-posts-build" class="username-tag">@shark.posts.build</a>] do |form| %&gt;
                 &lt;%= form.text_area :body, placeholder: "Your post here" %&gt;
                 &lt;br&gt;
                 &lt;%= form.submit %&gt;
        &lt;% end %&gt;
<span class="highlight">&lt;/div&gt;</span>
</code></pre>
<p><strong>Make sure you add the closing <code>&lt;div&gt;</code> tag</strong> to scope the controller properly.</p>

<p>Next, we&rsquo;ll attach an action to the form that will be triggered by the form submit event. This action will control how user input is displayed on the page. It will reference an <code>addPost</code> method that we will define in the posts Stimulus controller:</p>
<div class="code-label " title="~/sharkapp/app/views/sharks/_posts.html.erb">~/sharkapp/app/views/sharks/_posts.html.erb</div><pre class="code-pre "><code langs="">&lt;div data-controller="posts"&gt;
        &lt;%= form_with model: [@shark, <a href="https://www.digitalocean.com/community/users/shark-posts-build" class="username-tag">@shark.posts.build</a>]<span class="highlight">, data: { action: "posts#addBody" }</span> do |form| %&gt;
        . . . 
                 &lt;%= form.submit %&gt;
        &lt;% end %&gt;
&lt;/div&gt;
</code></pre>
<p>We use the <code>:data</code> option with <code>form_with</code> to submit the Stimulus action as an additional HTML data attribute. The action itself has a value called an <em>action descriptor</em> made up of the following:</p>

<ul>
<li><strong>The DOM event to listen for</strong>. Here, we are using the default event associated with form elements, submit, so we do not need to specify the event in the descriptor itself. For more information about common element/event pairs, see the <a href="https://stimulusjs.org/reference/actions#event-shorthand">Stimulus documentation</a>.</li>
<li><strong>The controller identifier</strong>, in our case <code>posts</code>.</li>
<li><strong>The method that the event should invoke</strong>. In our case, this is the <code>addBody</code> method that we will define in the controller.</li>
</ul>

<p>Next, we&rsquo;ll attach a data target to the user input defined in the <code>:body</code> <code>&lt;textarea&gt;</code> element, since we will use this inputted value in the <code>addBody</code> method.</p>

<p>Add the following <code>:data</code> option to the <code>:body</code> <code>&lt;textarea&gt;</code> element:</p>
<div class="code-label " title="~/sharkapp/app/views/sharks/_posts.html.erb">~/sharkapp/app/views/sharks/_posts.html.erb</div><pre class="code-pre "><code langs="">&lt;div data-controller="posts"&gt;
        &lt;%= form_with model: [@shark, <a href="https://www.digitalocean.com/community/users/shark-posts-build" class="username-tag">@shark.posts.build</a>], data: { action: "posts#addBody" } do |form| %&gt;
                &lt;%= form.text_area :body, placeholder: "Your post here"<span class="highlight">, data: { target: "posts.body" }</span> %&gt;
. . .
</code></pre>
<p>Much like action descriptors, Stimulus targets have <em>target descriptors</em>, which include the controller identifier and the target name. In this case, <code>posts</code> is our controller, and <code>body</code> is the target itself.</p>

<p>As a last step, we&rsquo;ll add a data target for the inputted <code>body</code> values so that users will be able to see their posts as soon as they are submitted. </p>

<p>Add the following <code>&lt;ul&gt;</code> element with an <code>add</code> target below the form and above the closing <code>&lt;div&gt;</code>:</p>
<div class="code-label " title="~/sharkapp/app/views/sharks/_posts.html.erb">~/sharkapp/app/views/sharks/_posts.html.erb</div><pre class="code-pre "><code langs="">. . .
        &lt;% end %&gt;
  <span class="highlight">&lt;ul data-target="posts.add"&gt;</span>
  <span class="highlight">&lt;/ul&gt;</span>

&lt;/div&gt;
</code></pre>
<p>As with the <code>body</code> target, our target descriptor includes both the name of the controller and the target â€” in this case, <code>add</code>.</p>

<p>The finished partial will look like this:</p>
<div class="code-label " title="~/sharkapp/app/views/sharks/_posts.html.erb">~/sharkapp/app/views/sharks/_posts.html.erb</div><pre class="code-pre "><code langs="">&lt;div data-controller="posts"&gt;
        &lt;%= form_with model: [@shark, @shark.posts.build], data: { action: "posts#addBody"} do |form| %&gt;
                &lt;%= form.text_area :body, placeholder: "Your post here", data: { target: "posts.body" } %&gt;
                &lt;br&gt;
                &lt;%= form.submit %&gt;
        &lt;% end %&gt;
  &lt;ul data-target="posts.add"&gt;
  &lt;/ul&gt;

&lt;/div&gt;
</code></pre>
<p>Once you have made these changes, you can save and close the file. </p>

<p>You have now created one of the two partials you added to the <code>sharks/show</code> view template. Next, you&rsquo;ll create the second, <code>sharks/all</code>, which will show all of the older posts from the database.</p>

<p>Create a new file named <code>_all.html.erb</code> in the <code>app/views/sharks/</code> directory:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano app/views/sharks/_all.html.erb
</li></ul></code></pre>
<p>Add the following code to the file to iterate through the collection of posts associated with the selected shark:</p>
<div class="code-label " title="~/sharkapp/app/views/sharks/_all.html.erb">~/sharkapp/app/views/sharks/_all.html.erb</div><pre class="code-pre "><code langs="">&lt;% for post in @shark.posts  %&gt;
    &lt;ul&gt;

        &lt;li class="post"&gt;
            &lt;%= post.body %&gt;
        &lt;/li&gt;

    &lt;/ul&gt;
    &lt;% end %&gt;
</code></pre>
<p>This code uses a for loop to iterate through each post instance in the collection of post objects associated with a particular shark.</p>

<p>We can now add some Stimulus actions to this partial to control the appearance of posts on the page. Specifically, we will add actions that will control upvotes and whether or not posts are visible on the page</p>

<p>Before we do that, however, we will need to add a gem to our project so that we can work with <a href="https://fontawesome.com/">Font Awesome</a> icons, which we&rsquo;ll use to register upvotes. Open a second terminal window, and navigate to your <code>sharkapp</code> project directory.</p>

<p>Open your Gemfile:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano Gemfile
</li></ul></code></pre>
<p>Below your <code>webpacker</code> gem, add the following line to include the <a href="https://github.com/bokmann/font-awesome-rails"><code>font-awesome-rails</code> gem</a> in the project:</p>
<div class="code-label " title="~/sharkapp/Gemfile">~/sharkapp/Gemfile</div><pre class="code-pre  second-environment"><code langs="">. . . 
gem 'webpacker', '~&gt; 4.x'
<span class="highlight">gem 'font-awesome-rails', '~&gt;4.x'</span>
. . . 
</code></pre>
<p>Save and close the file.</p>

<p>Next, install the gem:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">bundle install
</li></ul></code></pre>
<p>Finally, open your application&rsquo;s main stylesheet, <code>app/assets/stylesheets/application.css</code>:</p>
<pre class="code-pre command second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano app/assets/stylesheets/application.css
</li></ul></code></pre>
<p>Add the following line to include Font Awesome&rsquo;s styles in your project:</p>
<div class="code-label " title="~/sharkapp/app/assets/stylesheets/application.css">~/sharkapp/app/assets/stylesheets/application.css</div><pre class="code-pre  second-environment"><code langs="">. . . 
*
 *= require_tree .
 *= require_self
 <span class="highlight">*= require font-awesome</span>
 */
</code></pre>
<p>Save and close the file. You can now close your second terminal window.</p>

<p>Back in your <code>app/views/sharks/_all.html.erb</code> partial, you can now add two <a href="https://api.rubyonrails.org/v5.2.3/classes/ActionView/Helpers/FormTagHelper.html#method-i-button_tag"><code>button_tags</code></a> with associated Stimulus actions, which will be triggered on click events. One button will give users the option to upvote a post and the other will give them the option to remove it from the page view. </p>

<p>Add the following code to <code>app/views/sharks/_all.html.erb</code>:</p>
<div class="code-label " title="~/sharkapp/app/views/sharks/_all.html.erb">~/sharkapp/app/views/sharks/_all.html.erb</div><pre class="code-pre "><code langs="">&lt;% for post in <a href="https://www.digitalocean.com/community/users/shark-posts" class="username-tag">@shark.posts</a>  %&gt;
    &lt;ul&gt;

        &lt;li class="post"&gt;
            &lt;%= post.body %&gt;
            <span class="highlight">&lt;%= button_tag "Remove Post", data: { controller: "posts", action: "posts#remove" } %&gt;</span>
            <span class="highlight">&lt;%= button_tag "Upvote Post", data: { controller: "posts", action: "posts#upvote" } %&gt;</span>
        &lt;/li&gt;

    &lt;/ul&gt;
    &lt;% end %&gt;
</code></pre>
<p>Button tags also take a <code>:data</code> option, so we&rsquo;ve added our posts Stimulus controller and two actions: <code>remove</code> and <code>upvote</code>. Once again, in the action descriptors, we only need to define our controller and method, since the default event associated with button elements is click. Clicking on each of these buttons will trigger the respective <code>remove</code> and <code>upvote</code> methods defined in our controller.</p>

<p>Save and close the file when you have finished editing.</p>

<p>The final change we will make before moving on to defining our controller is to set a data target and action to control how and when the <code>sharks/all</code> partial will be displayed.</p>

<p>Open the <code>show</code> template again, where the initial call to render <code>sharks/all</code> is currently defined:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano app/views/sharks/show.html.erb
</li></ul></code></pre>
<p>At the bottom of the file, we have a <code>&lt;div&gt;</code> element that currently looks like this:</p>
<div class="code-label " title="~/sharkapp/app/views/sharks/show.html.erb">~/sharkapp/app/views/sharks/show.html.erb</div><pre class="code-pre "><code langs="">. . . 
&lt;div&gt;
  &lt;%= render 'sharks/all' %&gt;
&lt;/div&gt;
</code></pre>
<p>First, add a controller to this <code>&lt;div&gt;</code> element to scope actions and targets:</p>
<div class="code-label " title="~/sharkapp/app/views/sharks/show.html.erb">~/sharkapp/app/views/sharks/show.html.erb</div><pre class="code-pre "><code langs="">. . . 
&lt;div <span class="highlight">data-controller="posts"</span>&gt;
  &lt;%= render 'sharks/all' %&gt;
&lt;/div&gt;
</code></pre>
<p>Next, add a button to control the appearance of the partial on the page. This button will trigger a <code>showAll</code> method in our posts controller. </p>

<p>Add the button below the <code>&lt;div&gt;</code> element and above the <code>render</code> statement:</p>
<div class="code-label " title="~/sharkapp/app/views/sharks/show.html.erb">~/sharkapp/app/views/sharks/show.html.erb</div><pre class="code-pre "><code langs="">. . . 
&lt;div data-controller="posts"&gt;

<span class="highlight">&lt;button data-action="posts#showAll"&gt;Show Older Posts&lt;/button&gt;</span>

  &lt;%= render 'sharks/all' %&gt;
</code></pre>
<p>Again, we only need to identify our <code>posts</code> controller and <code>showAll</code> method here â€” the action will be triggered by a click event.</p>

<p>Next, we will add a data target. The goal of setting this target is to control the appearance of the partial on the page. Ultimately, we want users to see older posts only if they have opted into doing so by clicking on the <code>Show Older Posts</code> button.</p>

<p>We will therefore attach a data target called <code>show</code> to the <code>sharks/all</code> partial, and set its default style to <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/visibility"><code>visibility:hidden</code></a>. This will hide the partial unless users opt in to seeing it by clicking on the button.</p>

<p>Add the following <code>&lt;div&gt;</code> element with the <code>show</code> target and <code>style</code> definition below the button and above the partial render statement:</p>
<div class="code-label " title="~/sharkapp/app/views/sharks/show.html.erb">~/sharkapp/app/views/sharks/show.html.erb</div><pre class="code-pre "><code langs="">. . . 
&lt;div data-controller="posts"&gt;

&lt;button data-action="posts#showAll"&gt;Show Older Posts&lt;/button&gt;

<span class="highlight">&lt;div data-target="posts.show" style="visibility:hidden"&gt;</span>
  &lt;%= render 'sharks/all' %&gt;
<span class="highlight">&lt;/div&gt;</span>
</code></pre>
<p><strong>Be sure to add the closing <code>&lt;/div&gt;</code> tag.</strong></p>

<p>The finished <code>show</code> template will look like this:</p>
<div class="code-label " title="~/sharkapp/app/views/sharks/show.html.erb">~/sharkapp/app/views/sharks/show.html.erb</div><pre class="code-pre "><code langs="">&lt;p id="notice"&gt;&lt;%= notice %&gt;&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Name:&lt;/strong&gt;
  &lt;%= @shark.name %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Facts:&lt;/strong&gt;
  &lt;%= @shark.facts %&gt;
&lt;/p&gt;

&lt;h2&gt;Posts&lt;/h2&gt;

&lt;%= render 'sharks/posts' %&gt;

&lt;%= link_to 'Edit', edit_shark_path(@shark) %&gt; |
&lt;%= link_to 'Back', sharks_path %&gt;

&lt;div data-controller="posts"&gt;

&lt;button data-action="posts#showAll"&gt;Show Older Posts&lt;/button&gt;

&lt;div data-target="posts.show" style="visibility:hidden"&gt;
  &lt;%= render 'sharks/all' %&gt;
&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p>Save and close the file when you are finished editing.</p>

<p>With this template and its associated partials finished, you can move on to creating the controller with the methods you&rsquo;ve referenced in these files.</p>

<h2 id="step-6-â€”-creating-the-stimulus-controller">Step 6 â€” Creating the Stimulus Controller</h2>

<p>Installing Stimulus created the <code>app/javascript/controllers</code> directory, which is where webpack is loading our application context from, so we will create our posts controller in this directory. This controller will include each of the methods we referenced in the previous step:</p>

<ul>
<li><code>addBody()</code>, to add new posts.</li>
<li><code>showAll()</code>, to show older posts.</li>
<li><code>remove()</code>, to remove posts from the current view.</li>
<li><code>upvote()</code>, to attach an upvote icon to posts.</li>
</ul>

<p>Create a file called <code>posts_controller.js</code> in the <code>app/javascript/controllers</code> directory:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano app/javascript/controllers/posts_controller.js
</li></ul></code></pre>
<p>First, at the top of the file, extend Stimulus&rsquo;s built-in <code>Controller</code> class: </p>
<div class="code-label " title="~/sharkapp/app/javascript/controllers/posts_controller.js">~/sharkapp/app/javascript/controllers/posts_controller.js</div><pre class="code-pre "><code langs="">import { Controller } from "stimulus"

export default class extends Controller {
}
</code></pre>
<p>Next, add the following target definitions to the file:</p>
<div class="code-label " title="~/sharkapp/app/javascript/controllers/posts_controller.js">~/sharkapp/app/javascript/controllers/posts_controller.js</div><pre class="code-pre "><code langs="">. . .
export default class extends Controller {
    <span class="highlight">static targets = ["body", "add", "show"]</span>
}
</code></pre>
<p>Defining targets in this way will allow us to access them in our methods with the <code>this.<span class="highlight">target-name</span>Target</code> property, which gives us the first matching target element. So, for example, to match the <code>body</code> data target defined in our targets array, we would use <code>this.<span class="highlight">body</span>Target</code>. This property allows us to manipulate things like input values or css styles. </p>

<p>Next, we can define the <code>addBody</code> method, which will control the appearance of new posts on the page. Add the following code below the target definitions to define this method:</p>
<div class="code-label " title="~/sharkapp/app/javascript/controllers/posts_controller.js">~/sharkapp/app/javascript/controllers/posts_controller.js</div><pre class="code-pre "><code langs="">. . .
export default class extends Controller {
    static targets = [ "body", "add", "show"]

    <span class="highlight">addBody() {</span>
        <span class="highlight">let content = this.bodyTarget.value;</span>
        <span class="highlight">this.addTarget.insertAdjacentHTML('beforebegin', "&lt;li&gt;" + content + "&lt;/li&gt;");</span>
    <span class="highlight">}</span>
}
</code></pre>
<p>This method defines a <code>content</code> variable with the <a href="https://www.digitalocean.com/community/tutorials/understanding-variables-scope-hoisting-in-javascript#difference-between-var,-let,-and-const"><code>let</code> keyword</a> and sets it equal to the post input string that users entered into the posts form. It does this by virtue of the <code>body</code> data target that we attached to the <code>&lt;textarea&gt;</code> element in our form. Using <code>this.bodyTarget</code> to match this element, we can then use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLTextAreaElement"><code>value</code> property</a> that is associated with that element to set the value of <code>content</code> as the post input users have entered.</p>

<p>Next, the method adds this post input to the <code>add</code> target we added to the <code>&lt;ul&gt;</code> element below the form builder in the <code>sharks/posts</code> partial. It does this using the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/insertAdjacentHTML"><code>Element.insertAdjacentHTML()</code> method</a>, which will insert the content of the new post, set in the <code>content</code> variable, before the <code>add</code> target element. We&rsquo;ve also enclosed the new post in an <code>&lt;li&gt;</code> element, so that new posts appear as bulleted list items.</p>

<p>Next, below the <code>addBody</code> method, we can add the <code>showAll</code> method, which will control the appearance of older posts on the page:</p>
<div class="code-label " title="~/sharkapp/app/javascript/controllers/posts_controller.js">~/sharkapp/app/javascript/controllers/posts_controller.js</div><pre class="code-pre "><code langs="">. . . 
export default class extends Controller {
. . .
    addBody() {
        let content = this.bodyTarget.value;
        this.addTarget.insertAdjacentHTML('beforebegin', "&lt;li&gt;" + content + "&lt;/li&gt;");
    }

    <span class="highlight">showAll() {</span>
        <span class="highlight">this.showTarget.style.visibility = "visible";</span>
    <span class="highlight">}</span>

}
</code></pre>
<p>Here, we again use the <code>this.<span class="highlight">target-name</span>Target</code> property to match our <code>show</code> target, which is attached to the <code>&lt;div&gt;</code> element with the <code>sharks/all</code> partial. We gave it a default style, <code>"visibility:hidden"</code>, so in this method, we simply change the style to <code>"visible"</code>. This will show the partial to users who have opted into seeing older posts.</p>

<p>Below <code>showAll</code>, we&rsquo;ll next add an <code>upvote</code> method, to allow users to &ldquo;upvote&rdquo; posts on the page by attaching the <a href="https://fontawesome.com/icons?d=gallery&amp;m=free">free</a> Font Awesome <code>check-circle</code> icon to a particular post.</p>

<p>Add the following code to define this method:</p>
<div class="code-label " title="~/sharkapp/app/javascript/controllers/posts_controller.js">~/sharkapp/app/javascript/controllers/posts_controller.js</div><pre class="code-pre "><code langs="">. . . 
export default class extends Controller {
. . . 

    showAll() {
        this.showTarget.style.visibility = "visible";
    }

    <span class="highlight">upvote() {</span>
        <span class="highlight">let post = event.target.closest(".post");</span>
        <span class="highlight">post.insertAdjacentHTML('beforeend', '&lt;i class="fa fa-check-circle"&gt;&lt;/i&gt;');</span>
    <span class="highlight">}</span>

}
</code></pre>
<p>Here, we&rsquo;re creating a <code>post</code> variable that will target the closest <code>&lt;li&gt;</code> element with the class <code>post</code> â€” the class we attached to each <code>&lt;li&gt;</code> element in our loop iteration in <code>sharks/all</code>. This will target the closest post and add the <code>check-circle</code> icon just inside <code>&lt;li&gt;</code> element, after its last child. </p>

<p>Next, we&rsquo;ll use a similar method to hide posts on the page. Add the following code below the <code>upvote</code> method to define a <code>remove</code> method:</p>
<div class="code-label " title="~/sharkapp/app/javascript/controllers/posts_controller.js">~/sharkapp/app/javascript/controllers/posts_controller.js</div><pre class="code-pre "><code langs="">. . . 
export default class extends Controller {
. . . 

    upvote() {
        let post = event.target.closest(".post");
        post.insertAdjacentHTML('beforeend', '&lt;i class="fa fa-check-circle"&gt;&lt;/i&gt;');
    }

    <span class="highlight">remove() {</span>
        <span class="highlight">let post = event.target.closest(".post");</span>
        <span class="highlight">post.style.visibility = "hidden";</span>
    <span class="highlight">}</span>
}
</code></pre>
<p>Once again, our <code>post</code> variable will target the closest <code>&lt;li&gt;</code> element with the class <code>post</code>. It will then set the visibility property to <code>"hidden"</code> to hide the post on the page.</p>

<p>The finished controller file will now look like this:</p>
<div class="code-label " title="~/sharkapp/app/javascript/controllers/posts_controller.js">~/sharkapp/app/javascript/controllers/posts_controller.js</div><pre class="code-pre "><code langs="">import { Controller } from "stimulus"

export default class extends Controller {

    static targets = ["body", "add", "show"]

    addBody() {
        let content = this.bodyTarget.value;
        this.addTarget.insertAdjacentHTML('beforebegin', "&lt;li&gt;" + content + "&lt;/li&gt;");
    }

    showAll() {
        this.showTarget.style.visibility = "visible";
    }

    upvote() {
        let post = event.target.closest(".post");
        post.insertAdjacentHTML('beforeend', '&lt;i class="fa fa-check-circle"&gt;&lt;/i&gt;');
    }

    remove() {
        let post = event.target.closest(".post");
        post.style.visibility = "hidden";
    }
} 
</code></pre>
<p>Save and close the file when you are finished editing.</p>

<p>With your Stimulus controller in place, you can move on to making some final changes to the <code>index</code> view and testing your application.</p>

<h2 id="step-7-â€”-modifying-the-index-view-and-testing-the-application">Step 7 â€” Modifying the Index View and Testing the Application</h2>

<p>With one final change to the sharks <code>index</code> view you will be ready to test out your application. The <code>index</code> view is the root of the application, which you set in <a href="https://www.digitalocean.com/community/tutorials/how-to-build-a-ruby-on-rails-application#step-4-%E2%80%94-creating-the-application-root-view-and-testing-functionality">Step 4</a> of <a href="https://www.digitalocean.com/community/tutorials/how-to-build-a-ruby-on-rails-application">How To Build a Ruby on Rails Application</a>. </p>

<p>Open the file:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano app/views/sharks/index.html.erb
</li></ul></code></pre>
<p>In place of the <code>link_to</code> helpers that were autogenerated for us to display and destroy sharks, we&rsquo;ll use <code>button_to</code> helpers. This will help us work with generated HTML code instead of the default Rails JavaScript assets, which we specified we would no longer use in Step 1, when we changed <code>javascript_include_tag</code> to <code>javascript_pack_tag</code> in <code>app/views/layouts/application.html.erb</code>.</p>

<p>Replace the existing <code>link_to</code> helpers in the file with the following <code>button_to</code> helpers:</p>
<div class="code-label " title="~/sharkapp/app/views/sharks/index.html.erb">~/sharkapp/app/views/sharks/index.html.erb</div><pre class="code-pre "><code langs="">. . . 
  &lt;tbody&gt;
    &lt;% <a href="https://www.digitalocean.com/community/users/sharks-each" class="username-tag">@sharks.each</a> do |shark| %&gt;
      &lt;tr&gt;
        &lt;td&gt;&lt;%= shark.name %&gt;&lt;/td&gt;
        &lt;td&gt;&lt;%= shark.facts %&gt;&lt;/td&gt;
        &lt;td&gt;<span class="highlight">&lt;%= button_to 'Show', shark_path(:id =&gt; shark.id), :method =&gt; :get %&gt;</span>&lt;/td&gt;
        &lt;td&gt;<span class="highlight">&lt;%= button_to 'Edit', edit_shark_path(:id =&gt; shark.id), :method =&gt; :get %&gt;</span>&lt;/td&gt;
        &lt;td&gt;<span class="highlight">&lt;%= button_to 'Destroy', shark_path(:id =&gt; shark.id), :method =&gt; :delete %&gt;</span>&lt;/td&gt;
      &lt;/tr&gt;
    &lt;% end %&gt;
  &lt;/tbody&gt;
. . . 
</code></pre>
<p>These helpers accomplish much the same things as their <code>link_to</code> counterparts, but the <code>Destroy</code> helper now relies on generated HTML rather than Rails&rsquo;s default JavaScript.</p>

<p>Save and close the file when you are finished editing.</p>

<p>You are now ready to test your application.</p>

<p>First, run your database migrations:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">rails db:migrate
</li></ul></code></pre>
<p>Next, start your server. If you are working locally, you can do this with the following command:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">rails s
</li></ul></code></pre>
<p>If you are working on a development server, you can start the application with:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">rails s --binding=<span class="highlight">your_server_ip</span>
</li></ul></code></pre>
<p>Navigate to the application landing page in your browser. If you are working locally, this will be <code>localhost:3000</code>, or <code>http://<span class="highlight">your_server_ip</span>:3000</code> if you are working on a server.</p>

<p>You will see the following landing page:</p>

<p><img src="https://assets.digitalocean.com/articles/stimulus/stimulus_landing.png" alt="Application Landing Page"></p>

<p>Clicking on <strong>Show</strong> will take you to the <code>show</code> view for this shark. Here you will see a form to fill out a post:</p>

<p><img src="https://assets.digitalocean.com/articles/stimulus/stimulus_empty_post.png" alt="Shark Show Page"></p>

<p>In the post form, type &ldquo;These sharks are scary!&rdquo;:</p>

<p><img src="https://assets.digitalocean.com/articles/stimulus/stimulus_fill_post.png" alt="Filled in Post"></p>

<p>Click on <strong>Create Post</strong>. You will now see the new post on the page:</p>

<p><img src="https://assets.digitalocean.com/articles/stimulus/stimulus_show_post.png%20.png" alt="New Post Added to Page"></p>

<p>You can add another new post, if you would like. This time, type &ldquo;These sharks are often misrepresented in films&rdquo; and click <strong>Create Post</strong>:</p>

<p><img src="https://assets.digitalocean.com/articles/stimulus/stimulus_two_posts.png" alt="Second Post Added to Page"></p>

<p>In order to test the functionality of the <strong>Show Older Posts</strong> feature, we will need to leave this page, since our Great White does not currently have any posts that are older than the ones we&rsquo;ve just added. </p>

<p>Click <strong>Back</strong> to get to the main page, and then <strong>Show</strong> to return to the Great White landing page:</p>

<p><img src="https://assets.digitalocean.com/articles/stimulus/stimulus_empty_post.png" alt="Shark Show Page"></p>

<p>Clicking on <strong>Show Older Posts</strong> will now show you the posts you created:</p>

<p><img src="https://assets.digitalocean.com/articles/stimulus/stimulus_show_older.png" alt="Show Older Posts"></p>

<p>You can now upvote a post by clicking on the <strong>Upvote Post</strong> button:</p>

<p><img src="https://assets.digitalocean.com/articles/stimulus/stimulus_upvote.png" alt="Upvote a Post"></p>

<p>Similarly, clicking <strong>Remove Post</strong> will hide the post: </p>

<p><img src="https://assets.digitalocean.com/articles/stimulus/stimulus_remove.png" alt="Remove a Post"></p>

<p>You have now confirmed that you have a working Rails application that uses Stimulus to control how nested post resources are displayed on individual shark pages. You can use this as the jumping off point for future development and experimentation with Stimulus.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Stimulus represents a possible alternative to working with <a href="https://github.com/rails/rails/tree/master/actionview/app/assets/javascripts">rails-ujs</a>, <a href="https://jquery.com/">JQuery</a>, and frameworks like React and Vue. </p>

<p>As discussed in the introduction, Stimulus makes the most sense when you need to work directly with HTML generated by the server. It is lightweight, and aims to make code â€“ particularly HTML â€“ self-explanatory to the highest degree possible. If you don&rsquo;t need to manage state on the client side, then Stimulus may be a good choice. </p>

<p>If you are interested in how to create nested resources without a Stimulus integration, you can consult <a href="https://www.digitalocean.com/community/tutorials/how-to-create-nested-resources-for-a-ruby-on-rails-application">How To Create Nested Resources for a Ruby on Rails Application</a>.</p>

<p>For more information on how you would integrate React with a Rails application, see <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-ruby-on-rails-project-with-a-react-frontend">How To Set Up a Ruby on Rails Project with a React Frontend</a>.</p>
