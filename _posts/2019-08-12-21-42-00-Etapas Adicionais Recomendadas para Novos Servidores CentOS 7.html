---
layout: post
title: Etapas Adicionais Recomendadas para Novos Servidores CentOS 7
network: digitalocean
date: August 12, 2019 at 09:42PM
url: https://www.digitalocean.com/community/tutorials/etapas-adicionais-recomendadas-para-novos-servidores-centos-7-pt
image: https://assets.digitalocean.com/articles/1404_optional_recommended/snapshots.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="introdução">Introdução</h3>

<p>Depois de definir a configuração mínima para um novo servidor, existem algumas etapas adicionais que são altamente recomendadas na maioria dos casos. Neste guia, continuaremos a configuração de nossos servidores, abordando alguns procedimentos recomendados, mas opcionais.</p>

<h2 id="pré-requisitos-e-objetivos">Pré-requisitos e Objetivos</h2>

<p>Antes de iniciar este guia, você deve passar pelo guia de <a href="https://www.digitalocean.com/community/tutorials/configuracao-inicial-do-servidor-com-o-centos-7-pt">Configuração Inicial do Servidor com o CentOS 7</a>. Isso é necessário para configurar suas contas de usuário, configurar a elevação de privilégios com o <code>sudo</code> e bloquear o SSH por segurança.</p>

<p>Depois de concluir o guia acima, você pode continuar com este artigo. Neste guia, nos concentraremos na configuração de alguns componentes opcionais, mas recomendados. Isso envolverá a configuração do nosso sistema com um firewall e um arquivo de swap, e configurar a sincronização do Network Time Protocol.</p>

<h2 id="configurando-um-firewall-básico">Configurando um Firewall Básico</h2>

<p>Os firewalls fornecem um nível básico de segurança para o seu servidor. Esses aplicativos são responsáveis por negar tráfego a todas as portas do servidor com exceções das portas/serviços que você aprovou. O CentOS vem com um firewall chamado <code>firewalld</code>. Uma ferramenta chamada <code>firewall-cmd</code> pode ser usada para configurar suas políticas de firewall. Nossa estratégia básica será bloquear tudo o que não tivermos uma boa razão para manter em aberto. Primeiro instale o <code>firewalld</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo yum install firewalld
</li></ul></code></pre>
<p>O serviço <code>firewalld</code> tem a capacidade de fazer modificações sem perder as conexões atuais, assim podemos ativá-lo antes de criar nossas exceções:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl start firewalld
</li></ul></code></pre>
<p>Agora que o serviço está funcionando, podemos usar o utilitário <code>firewall-cmd</code> para obter e definir informações de política para o firewall. O aplicativo <code>firewalld</code> usa o conceito de "zonas" para rotular a confiabilidade dos outros hosts em uma rede. Essa rotulagem nos dá a capacidade de atribuir regras diferentes, dependendo de quanto confiamos em uma rede.</p>

<p>Neste guia, estaremos ajustando somente as políticas para a zona padrão ou default. Quando recarregarmos nosso firewall, essa será a zona aplicada às nossas interfaces. Devemos começar adicionando exceções ao nosso firewall para serviços aprovados. O mais essencial deles é o SSH, já que precisamos manter o acesso administrativo remoto ao servidor.</p>

<p>Se você <strong>não</strong> modificou a porta em que o daemon SSH está sendo executado, é possível ativar o serviço pelo nome digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo firewall-cmd --permanent --add-service=ssh
</li></ul></code></pre>
<p>Se você <strong>alterou</strong> a porta SSH do seu servidor, você terá que especificar a nova porta explicitamente. Você também precisará incluir o protocolo que o serviço utiliza. Somente digite o seguinte caso seu servidor SSH já tenha sido reiniciado para usar a nova porta:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo firewall-cmd --permanent --remove-service=ssh
</li><li class="line" prefix="$">sudo firewall-cmd --permanent --add-port=<span class="highlight">4444</span>/tcp
</li></ul></code></pre>
<p>Isso é o mínimo necessário para manter o acesso administrativo ao servidor. Se você planeja executar serviços adicionais, também precisa abrir o firewall para esses serviços.</p>

<p>Se você planeja executar um servidor web HTTP convencional, você precisará habilitar o serviço <code>http</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo firewall-cmd --permanent --add-service=http
</li></ul></code></pre>
<p>Se você planeja executar um servidor web com SSL/TLS ativado, você também deve permitir o tráfego de <code>https</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo firewall-cmd --permanent --add-service=https
</li></ul></code></pre>
<p>Se você precisar que o email SMTP esteja ativado, você pode digitar:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo firewall-cmd --permanent --add-service=smtp
</li></ul></code></pre>
<p>Para ver quaisquer serviços adicionais que você possa ativar por nome, digite:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo firewall-cmd --get-services
</li></ul></code></pre>
<p>Quando terminar, você poderá ver a lista das exceções que serão implementadas digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo firewall-cmd --permanent --list-all
</li></ul></code></pre>
<p>Quando você estiver pronto para implementar as mudanças, recarregue o firewall:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo firewall-cmd --reload
</li></ul></code></pre>
<p>Se, após o teste, tudo funcionar conforme o esperado, você deverá certificar-se de que o firewall será iniciado na inicialização:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl enable firewalld
</li></ul></code></pre>
<p>Lembre-se de que você terá que abrir explicitamente o firewall (com serviços ou portas) para quaisquer serviços adicionais que você venha a configurar posteriormente.</p>

<h2 id="configurar-fuso-horário-e-sincronização-do-network-time-protocol">Configurar Fuso Horário e Sincronização do Network Time Protocol</h2>

<p>O próximo passo é ajustar as configurações de localização do seu servidor e configurar a sincronização do Network Time Protocol (NTP).</p>

<p>O primeiro passo garantirá que seu servidor esteja operando no fuso horário correto. O segundo passo configurará seu servidor para sincronizar o relógio do sistema com o horário padrão mantido por uma rede global de servidores NTP. Isso ajudará a evitar algum comportamento inconsistente que pode surgir com relógios fora de sincronia.</p>

<h3 id="configurar-fusos-horários">Configurar Fusos Horários</h3>

<p>Nosso primeiro passo é definir o fuso horário do nosso servidor. Este é um procedimento muito simples que pode ser realizado usando o comando <code>timedatectl</code>:</p>

<p>Primeiro, dê uma olhada nos fusos horários disponíveis digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo timedatectl list-timezones
</li></ul></code></pre>
<p>Isto lhe dará uma lista dos fusos horários disponíveis para o seu servidor. Quando você encontrar a configuração de região/fuso horário que estiver correta para o seu servidor, defina-a digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo timedatectl set-timezone <span class="highlight">região</span>/<span class="highlight">fuso_horário</span>
</li></ul></code></pre>
<p>Por exemplo, para configurá-lo para o horário do leste dos Estados Unidos, você pode digitar:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo timedatectl set-timezone America/New_York
</li></ul></code></pre>
<p>Seu sistema será atualizado para usar o fuso horário selecionado. Você pode confirmar isso digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo timedatectl
</li></ul></code></pre>
<h3 id="configurar-a-sincronização-ntp">Configurar a Sincronização NTP</h3>

<p>Agora que você tem o seu fuso horário definido, devemos configurar o NTP. Isso permitirá que seu computador fique em sincronia com outros servidores, levando a uma maior previsibilidade nas operações que dependem da hora correta.</p>

<p>Para a sincronização NTP, usaremos um serviço chamado <code>ntp</code>, que podemos instalar a partir dos repositórios padrão do CentOS:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo yum install ntp
</li></ul></code></pre>
<p>Em seguida, você precisa iniciar o serviço para esta sessão. Também habilitaremos o serviço para que ele seja iniciado automaticamente sempre que o servidor for inicializado:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl start ntpd
</li><li class="line" prefix="$">sudo systemctl enable ntpd
</li></ul></code></pre>
<p>Seu servidor agora corrigirá automaticamente o relógio do sistema para se alinhar aos servidores globais.</p>

<h2 id="criar-um-arquivo-de-swap">Criar um Arquivo de Swap</h2>

<p>Adicionar "swap" a um servidor Linux permite que o sistema mova as informações acessadas por um programa em execução com menos frequência da RAM para um local no disco. Acessar os dados armazenados no disco é muito mais lento do que acessar a RAM, mas ter o swap disponível pode ser a diferença entre o aplicativo permanecer ativo e a falha. Isso é especialmente útil se você planeja hospedar bancos de dados em seu sistema.</p>

<p>Conselhos sobre o melhor tamanho para um espaço de swap variam significativamente dependendo da fonte consultada. Geralmente, um valor igual ou o dobro da quantidade de RAM do seu sistema é um bom ponto de partida.</p>

<p>Aloque o espaço que você deseja usar para o seu arquivo de swap usando o utilitário <code>fallocate</code>. Por exemplo, se precisarmos de um arquivo de 4 Gigabytes, podemos criar um arquivo de swap localizado em <code>/swapfile</code> digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo fallocate -l <span class="highlight">4G</span> /swapfile
</li></ul></code></pre>
<p>Depois de criar o arquivo, precisamos restringir o acesso a ele para que outros usuários ou processos não consigam ver o que é gravado lá:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo chmod 600 /swapfile
</li></ul></code></pre>
<p>Agora temos um arquivo com as permissões corretas. Para dizer ao nosso sistema para formatar o arquivo para swap, podemos digitar:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo mkswap /swapfile
</li></ul></code></pre>
<p>Agora, diga ao sistema que ele pode usar o arquivo de swap digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo swapon /swapfile
</li></ul></code></pre>
<p>Nosso sistema está usando o arquivo de swap para esta sessão, mas precisamos modificar um arquivo de sistema para que nosso servidor faça isso automaticamente na inicialização. Você pode fazer isso digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo sh -c 'echo "/swapfile none swap sw 0 0" &gt;&gt; /etc/fstab'
</li></ul></code></pre>
<p>Com essa adição, seu sistema deve usar seu arquivo de swap automaticamente a cada inicialização.</p>

<h2 id="para-onde-ir-a-partir-daqui">Para Onde Ir a partir Daqui?</h2>

<p>Agora você tem uma configuração inicial muito decente para o seu servidor Linux. A partir daqui, existem alguns lugares que você pode ir. Primeiro, você pode querer tirar um instantâneo ou snapshot do seu servidor em sua configuração atual.</p>

<h3 id="tirando-um-snapshot-da-sua-configuração-atual">Tirando um Snapshot da sua Configuração atual</h3>

<p>Se você está satisfeito com sua configuração e deseja usar isso como uma base para futuras instalações, você pode tirar um snapshot do seu servidor através do painel de controle da DigitalOcean. A partir de outubro de 2016, os snapshots custam $0.05 por gigabyte por mês, com base na quantidade de espaço utilizado no sistema de arquivos.</p>

<p>Para fazer isso, desligue seu servidor pela linha de comando. Embora seja possível fazer um snapshot de um sistema em execução, o desligamento garante que os arquivos no disco estejam todos em um estado consistente:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo poweroff
</li></ul></code></pre>
<p>Agora, no painel de controle da DigitalOcean, você pode tirar um snapshot visitando a guia "Snapshots" do seu servidor:</p>

<p><img src="https://assets.digitalocean.com/articles/1404_optional_recommended/snapshots.png" alt="DigitalOcean snapshot"></p>

<p>Depois de tirar seu snapshot, você poderá usar essa imagem como base para instalações futuras, selecionando o snapshot a partir da guia "My Snapshots" para imagens durante o processo de criação:</p>

<p><img src="https://assets.digitalocean.com/articles/1404_optional_recommended/use_snapshot.png" alt="DigitalOcean use snapshot"></p>

<h3 id="recursos-adicionais-e-próximos-passos">Recursos Adicionais e Próximos Passos</h3>

<p>A partir daqui, o seu caminho depende inteiramente do que você deseja fazer com o seu servidor. A lista de guias abaixo não é de forma alguma exaustiva, mas representa algumas das configurações mais comuns que os usuários recorrem:</p>

<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-apache-mysql-php-lamp-stack-on-centos-7">Setting up a LAMP (Linux, Apache, MySQL/MariaDB, PHP) stack</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-nginx-mysql-php-lemp-stack-on-centos-7">Setting up a LEMP (Linux, Nginx, MySQL/MariaDB, PHP) stack</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-wordpress-on-centos-7">Installing the WordPress CMS</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-a-centos-7-server">Installing Node.js</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-puppet-in-standalone-mode-on-centos-7">Installing Puppet to manage your infrastructure</a></li>
</ul>

<h2 id="conclusão">Conclusão</h2>

<p>Nesse ponto, você deve saber como configurar uma base sólida para seus novos servidores. Espero que você também tenha uma boa ideia para os próximos passos. Sinta-se à vontade para explorar o site para mais ideias que você pode implementar em seu servidor.</p>
