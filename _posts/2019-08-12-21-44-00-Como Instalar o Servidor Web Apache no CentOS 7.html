---
layout: post
title: Como Instalar o Servidor Web Apache no CentOS 7
network: digitalocean
date: August 12, 2019 at 09:44PM
url: https://www.digitalocean.com/community/tutorials/como-instalar-o-servidor-web-apache-no-centos-7-pt
image: https://assets.digitalocean.com/articles/CART-65406/apache_default_page.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="introdução">Introdução</h3>

<p>O servidor HTTP <a href="https://www.apache.org/">Apache</a> é o servidor web mais utilizado no mundo. Ele fornece muitos recursos poderosos incluindo módulos dinamicamente carregáveis, suporte robusto a mídia, e integração extensiva com outros softwares populares.</p>

<p>Neste guia, você instalará um servidor web Apache com virtual hosts em seu servidor CentOS 7.</p>

<h2 id="pré-requisitos">Pré-requisitos</h2>

<p>Você precisará do seguinte para concluir este guia:</p>

<ul>
<li><p>Um usuário não-root com privilégios sudo definidos em seu servidor, configurado seguindo o guia de <a href="https://www.digitalocean.com/community/tutorials/configuracao-inicial-do-servidor-com-o-centos-7-pt">Configuração Inicial do Servidor com o CentOS 7</a>.</p></li>
<li><p>Um firewall básico configurado seguindo o guia <a href="https://www.digitalocean.com/community/tutorials/additional-recommended-steps-for-new-centos-7-servers-pt">Etapas adicionais recomendadas para novos servidores CentOS 7</a></p></li>
</ul>

<h2 id="passo-1-—-instalando-o-apache">Passo 1 — Instalando o Apache</h2>

<p>O Apache está disponível nos repositórios de software padrão do CentOS, o que significa que você pode instalá-lo com o gerenciador de pacotes <code>yum</code>.</p>

<p>Agindo como o usuário não-root, com privilégios sudo configurado nos pré-requisitos, atualize o índice de pacotes local <code>httpd</code> do Apache para refletir as alterações mais recentes do upstream:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo yum update httpd
</li></ul></code></pre>
<p>Depois que os pacotes forem atualizados, instale o pacote Apache:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo yum install httpd
</li></ul></code></pre>
<p>Após confirmar a instalação, o <code>yum</code> instalará o Apache e todas as dependências necessárias. Quando a instalação estiver concluída, você estará pronto para iniciar o serviço.</p>

<h2 id="passo-2-—-verificando-seu-servidor-web">Passo 2 — Verificando seu Servidor Web</h2>

<p>O Apache não inicia automaticamente no CentOS depois que a instalação é concluída. Você precisará iniciar o processo do Apache manualmente:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl start httpd
</li></ul></code></pre>
<p>Verifique se o serviço está sendo executado com o seguinte comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl status httpd
</li></ul></code></pre>
<p>Você verá um status <code>active</code> quando o serviço estiver em execução:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Redirecting to /bin/systemctl status httpd.service
● httpd.service - The Apache HTTP Server
   Loaded: loaded (/usr/lib/systemd/system/httpd.service; enabled; vendor preset: disabled)
   Active: <span class="highlight">active (running)</span> since Wed 2019-02-20 01:29:08 UTC; 5s ago
     Docs: man:httpd(8)
           man:apachectl(8)
 Main PID: 1290 (httpd)
   Status: "Processing requests..."
   CGroup: /system.slice/httpd.service
           ├─1290 /usr/sbin/httpd -DFOREGROUND
           ├─1291 /usr/sbin/httpd -DFOREGROUND
           ├─1292 /usr/sbin/httpd -DFOREGROUND
           ├─1293 /usr/sbin/httpd -DFOREGROUND
           ├─1294 /usr/sbin/httpd -DFOREGROUND
           └─1295 /usr/sbin/httpd -DFOREGROUND
...
</code></pre>
<p>Como você pode ver nesta saída, o serviço parece ter sido iniciado com sucesso. No entanto, a melhor maneira de testar isso é solicitar uma página do Apache.</p>

<p>Você pode acessar a página inicial padrão do Apache para confirmar que o software está sendo executado corretamente através do seu endereço IP. Se você não souber o endereço IP do seu servidor, poderá obtê-lo de algumas maneiras diferentes a partir da linha de comando.</p>

<p>Digite isto no prompt de comando do seu servidor:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">hostname -I
</li></ul></code></pre>
<p>Esse comando exibirá todos os endereços de rede do host, assim você receberá um retorno com alguns endereços IP separados por espaços. Você pode experimentar cada um em seu navegador para ver se eles funcionam.</p>

<p>Alternativamente, você pode usar o <code>curl</code> para solicitar seu IP através do <code>icanhazip.com</code>, que lhe dará seu endereço IPv4 público como visto de outro local na internet:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">curl -4 icanhazip.com
</li></ul></code></pre>
<p>Quando você tiver o endereço IP do seu servidor, insira-o na barra de endereços do seu navegador:</p>
<pre class="code-pre "><code langs="">http://<span class="highlight">ip_do_seu_servidor</span>
</code></pre>
<p>Você verá a página padrão do Apache do CentOS 7:</p>

<p><img src="https://assets.digitalocean.com/articles/CART-65406/apache_default_page.png" alt="Default Apache page for CentOS 7"></p>

<p>Esta página indica que o Apache está funcionando corretamente. Ela também inclui algumas informações básicas sobre arquivos importantes do Apache e sobre localizações de diretórios. Agora que o serviço está instalado e em execução, você pode usar diferentes comandos <code>systemctl</code> para gerenciar o serviço.</p>

<h2 id="passo-3-—-gerenciando-o-processo-do-apache">Passo 3 — Gerenciando o Processo do Apache</h2>

<p>Agora que você tem seu servidor web funcionando, vamos passar por alguns comandos básicos de gerenciamento.</p>

<p>Para parar seu servidor web, digite:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl stop httpd
</li></ul></code></pre>
<p>Para iniciar o servidor web quando ele estiver parado, digite:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl start httpd
</li></ul></code></pre>
<p>Para parar e iniciar o serviço novamente, digite:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart httpd
</li></ul></code></pre>
<p>Se você estiver simplesmente fazendo alterações de configuração, o Apache pode muita vezes recarregar sem perder conexões. Para fazer isso, use este comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl reload httpd
</li></ul></code></pre>
<p>Por padrão, o Apache é configurado para iniciar automaticamente quando o servidor é inicializado. Se isso não é o que você deseja, desabilite esse comportamento digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl disable httpd
</li></ul></code></pre>
<p>Para reativar o serviço para iniciar na inicialização, digite:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl enable httpd
</li></ul></code></pre>
<p>O Apache agora será iniciado automaticamente quando o servidor inicializar novamente.</p>

<p>A configuração padrão do Apache permitirá que seu servidor hospede um único site. Se você planeja hospedar vários domínios em seu servidor, precisará configurar virtual hosts em seu servidor Apache.</p>

<h2 id="passo-4-—-configurando-virtual-hosts-recomendado">Passo 4 — Configurando Virtual Hosts (Recomendado)</h2>

<p>Ao utilizar o servidor web Apache, você pode usar <em>virtual hosts</em> (similares aos blocos do servidor no Nginx) para encapsular detalhes de configuração e hospedar mais de um domínio a partir de um único servidor. Neste passo você irá  configurar um domínio chamado <code>example.com</code>, mas você deve substituí-lo por seu próprio nome de domínio. Para aprender mais sobre a configuração de um nome de domínio com a DigitalOcean, veja nossa <a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-digitalocean-dns">Introdução ao DNS da DigitalOcean</a>.</p>

<p>O Apache no CentOS 7 tem um bloco de servidor ativado por padrão que é configurado para servir documentos a partir do diretório <code>/var/www/html</code>. Apesar disso funcionar bem para um único site, pode ficar difícil se você estiver hospedando vários sites. Em vez de modificar <code>/var/www/html</code>, você irá criar uma estrutura de diretórios dentro de <code>/var/www</code> para o site <code>example.com</code>, deixando <code>/var/www/html</code> no lugar como o diretório padrão a ser servido se uma requisição de cliente não corresponder a nenhum outro site.</p>

<p>Crie o diretório <code>html</code> para <code>example.com</code> como segue, usando a flag <code>-p</code> para criar qualquer diretório pai que for necessário:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo mkdir -p /var/www/<span class="highlight">example.com</span>/html
</li></ul></code></pre>
<p>Crie um diretório adicional para armazenar arquivos de log para o site:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo mkdir -p /var/www/<span class="highlight">example.com</span>/log
</li></ul></code></pre>
<p>Em seguida, atribua a propriedade do diretório <code>html</code> com a variável de ambiente <code>$USER</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo chown -R $USER:$USER /var/www/<span class="highlight">example.com</span>/html
</li></ul></code></pre>
<p>Certifique-se de que seu web root ou pasta raiz para web tenha o conjunto de permissões padrão:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo chmod -R 755 /var/www
</li></ul></code></pre>
<p>Em seguida, crie uma página de exemplo <code>index.html</code> usando o <code>vi</code> ou seu editor favorito:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo vi /var/www/<span class="highlight">example.com</span>/html/index.html
</li></ul></code></pre>
<p>Pressione <code>i</code> para alternar para o modo <code>INSERT</code> e adicione o seguinte exemplo de HTML ao arquivo:</p>
<div class="code-label " title="/var/www/example.com/html/index.html">/var/www/example.com/html/index.html</div><pre class="code-pre "><code class="code-highlight language-html">&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Welcome to <span class="highlight">Example.com</span>!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Success! The <span class="highlight">example.com</span> virtual host is working!&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Salve e feche o arquivo pressionando <code>ESC</code>, digitando <code>:wq</code> e pressionando <code>ENTER</code>.</p>

<p>Com o diretório do seu site e o arquivo de index de exemplo no lugar, você está quase pronto para criar os arquivos do virtual host. Os arquivos do virtual host especificam a configuração de seus sites independentes e informam ao servidor Apache como responder a várias solicitações de domínio.</p>

<p>Antes de criar seus virtual hosts, você precisará criar um diretório <code>sites-available</code> para armazená-los. Você também criará o diretório <code>sites-enabled</code> que informa ao Apache que um virtual host está pronto para servir aos visitantes. O diretório <code>sites-enabled</code> conterá links simbólicos para os virtual hosts que queremos publicar. Crie ambos os diretórios com o seguinte comando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo mkdir /etc/httpd/sites-available /etc/httpd/sites-enabled
</li></ul></code></pre>
<p>Em seguida, você dirá ao Apache para procurar por virtual hosts no diretório <code>sites-enabled</code>. Para fazer isso, edite o arquivo de configuração principal do Apache e adicione uma linha declarando um diretório opcional para arquivos de configuração adicionais:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo vi /etc/httpd/conf/httpd.conf
</li></ul></code></pre>
<p>Adicione esta linha ao final do arquivo:</p>
<pre class="code-pre "><code langs="">IncludeOptional sites-enabled/*.conf
</code></pre>
<p>Salve e feche o arquivo quando terminar de adicionar essa linha. Agora que você tem seus diretórios de virtual host no lugar, você criará seu arquivo de virtual host.</p>

<p>Comece criando um novo arquivo no diretório <code>sites-available</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo vi /etc/httpd/sites-available/<span class="highlight">example.com</span>.conf
</li></ul></code></pre>
<p>Adicione o seguinte bloco de configuração e altere o domínio <code>example.com</code> para o seu nome de domínio:</p>
<div class="code-label " title="/etc/httpd/sites-available/example.com.conf">/etc/httpd/sites-available/example.com.conf</div><pre class="code-pre "><code langs="">&lt;VirtualHost *:80&gt;
    ServerName www.<span class="highlight">example.com</span>
    ServerAlias <span class="highlight">example.com</span>
    DocumentRoot /var/www/<span class="highlight">example.com</span>/html
    ErrorLog /var/www/<span class="highlight">example.com</span>/log/error.log
    CustomLog /var/www/<span class="highlight">example.com</span>/log/requests.log combined
&lt;/VirtualHost&gt;
</code></pre>
<p>Isso dirá ao Apache onde encontrar diretamente a raiz que contém os documentos web publicamente acessíveis. Ele também informa ao Apache onde armazenar logs de erros e de solicitações para esse site específico.</p>

<p>Salve e feche o arquivo quando terminar.</p>

<p>Agora que você criou os arquivos do virtual host, você os habilitará para que o Apache saiba como servi-los aos visitantes. Para fazer isso, crie um link simbólico para cada virtual host no diretório <code>sites-enabled</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ln -s /etc/httpd/sites-available/<span class="highlight">example.com</span>.conf /etc/httpd/sites-enabled/<span class="highlight">example.com</span>.conf
</li></ul></code></pre>
<p>Seu virtual host agora está configurado e pronto para servir conteúdo. Antes de reiniciar o serviço Apache, vamos garantir que o SELinux tenha as políticas corretas em vigor para seus virtual hosts.</p>

<h2 id="passo-5-—-ajustando-permissões-do-selinux-para-virtual-hosts-recomendado">Passo 5 — Ajustando Permissões do SELinux para Virtual Hosts (Recomendado)</h2>

<p>O <a href="https://www.digitalocean.com/community/tutorial_series/an-introduction-to-selinux-on-centos-7">SELinux</a> está configurado para funcionar com a configuração padrão do Apache. Como você configurou um diretório de log personalizado no arquivo de configuração de virtual hosts, você receberá um erro se tentar iniciar o serviço Apache. Para resolver isso, você precisa atualizar as políticas do SELinux para permitir que o Apache grave nos arquivos necessários. O SELinux traz maior segurança ao seu ambiente CentOS 7, portanto, não é recomendado desativar completamente o módulo do kernel.</p>

<p>Existem diferentes maneiras de definir políticas com base nas necessidades do seu ambiente, pois o SELinux permite que você personalize seu nível de segurança. Esta etapa abordará dois métodos de ajuste das políticas do Apache: universalmente e em um diretório específico. Ajustar políticas em diretórios é mais seguro e, portanto, é a abordagem recomendada.</p>

<h3 id="ajustando-políticas-do-apache-universalmente">Ajustando Políticas do Apache Universalmente</h3>

<p>Definir a política do Apache universalmente dirá ao SELinux para tratar todos os processos do Apache de forma idêntica usando o booleano <code>httpd_unified</code>. Embora essa abordagem seja mais conveniente, ela não fornecerá o mesmo nível de controle que uma abordagem centrada em uma diretiva de arquivo ou diretório.</p>

<p>Execute o seguinte comando para definir uma política universal para o Apache:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo setsebool -P httpd_unified 1
</li></ul></code></pre>
<p>O comando <code>setsebool</code> altera os valores booleanos do SELinux. A flag <code>-P</code> atualizará o valor de tempo de inicialização, fazendo com que essa mudança persista durante as reinicializações. <code>httpd_unified</code> é o booleano que irá dizer ao SELinux para tratar todos os processos do Apache como do mesmo tipo, então você habilitou-o com um valor de <code>1</code>.</p>

<h3 id="ajustando-as-políticas-do-apache-em-um-diretório">Ajustando as Políticas do Apache em um Diretório</h3>

<p>Configurar individualmente as permissões do SELinux para o diretório <code>/var/www/<span class="highlight">example.com</span>/log</code> lhe dará mais controle sobre suas políticas do Apache, mas também pode exigir mais manutenção. Como essa opção não está definindo políticas universalmente, você precisará definir manualmente o tipo de contexto para todos os novos diretórios de log especificados em suas configurações de virtual host.</p>

<p>Primeiro, verifique o tipo de contexto que o SELinux deu ao diretório <code>/var/www/<span class="highlight">example.com</span>/log</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ls -dZ /var/www/<span class="highlight">example.com</span>/log/
</li></ul></code></pre>
<p>Este comando lista e imprime o contexto do SELinux do diretório. Você verá uma saída semelhante à seguinte:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>drwxr-xr-x. root root unconfined_u:object_r:<span class="highlight">httpd_sys_content_t</span>:s0 /var/www/<span class="highlight">example.com</span>/log/
</code></pre>
<p>O contexto atual é <code>httpd_sys_content_t</code>, que informa ao SELinux que o processo do Apache só pode ler arquivos criados neste diretório. Neste tutorial, você irá alterar o tipo de contexto do diretório <code>/var/www/<span class="highlight">example.com</span>/log</code> para <code>httpd_log_t</code>. Esse tipo permitirá ao Apache gerar e agregar arquivos de log da aplicação web:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo semanage fcontext -a -t <span class="highlight">httpd_log_t</span> "/var/www/<span class="highlight">example.com</span>/log(/.*)?"
</li></ul></code></pre>
<p>Em seguida, use o comando <code>restorecon</code> para aplicar essas mudanças e fazer com que elas persistam durante as reinicializações:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo restorecon -R -v /var/www/<span class="highlight">example.com</span>/log
</li></ul></code></pre>
<p>A flag <code>-R</code> executa este comando recursivamente, o que significa que ele atualizará quaisquer arquivos existentes para usar o novo contexto. A flag <code>-v</code> imprimirá as mudanças de contexto feitas pelo comando. Você verá a seguinte saída confirmando as alterações:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>restorecon reset /var/www/example.com/log context unconfined_u:object_r:<span class="highlight">httpd_sys_content_t</span>:s0-&gt;unconfined_u:object_r:<span class="highlight">httpd_log_t</span>:s0
</code></pre>
<p>Você pode listar os contextos mais uma vez para ver as alterações:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ls -dZ /var/www/<span class="highlight">example.com</span>/log/
</li></ul></code></pre>
<p>A saída reflete o tipo de contexto atualizado:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>drwxr-xr-x. root root unconfined_u:object_r:<span class="highlight">httpd_log_t</span>:s0 /var/www/<span class="highlight">example.com</span>/log
</code></pre>
<p>Agora que o diretório <code>/var/www/<span class="highlight">example.com</span>/log</code> está usando o tipo <code>httpd_log_t</code>, você está pronto para testar sua configuração de virtual host.</p>

<h2 id="passo-6-—-testando-o-virtual-host-recomendado">Passo 6 — Testando o Virtual Host (Recomendado)</h2>

<p>Uma vez que o contexto do SELinux tenha sido atualizado com quaisquer dos métodos, o Apache poderá gravar no diretório <code>/var/www/<span class="highlight">example.com</span>/log</code>. Agora você pode reiniciar o serviço Apache com sucesso:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl restart httpd
</li></ul></code></pre>
<p>Liste o conteúdo do diretório <code>/var/www/<span class="highlight">example.com</span>/log</code> para ver se o Apache criou os arquivos de log:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ls -lZ /var/www/<span class="highlight">example.com</span>/log
</li></ul></code></pre>
<p>Você verá que o Apache foi capaz de criar os arquivos <code>error.log</code> e <code>requests.log</code> especificados na configuração do virtual host:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>-rw-r--r--. 1 root root 0 Feb 26 22:54 error.log
-rw-r--r--. 1 root root 0 Feb 26 22:54 requests.log
</code></pre>
<p>Agora que você tem seu virtual host configurado e as permissões do SELinux atualizadas, o Apache agora servirá seu nome de domínio. Você pode testar isso navegando até <code>http://<span class="highlight">example.com</span></code>, onde você deve ver algo assim:</p>

<p><img src="https://assets.digitalocean.com/articles/CART-65406/virtual_host_success.png" alt="Success! The example.com virtual host is working!"></p>

<p>Isso confirma que seu virtual host foi configurado e está servindo o conteúdo com êxito. Repita os Passos 4 e 5 para criar novos virtual hosts com permissões do SELinux para domínios adicionais.</p>

<h2 id="conclusão">Conclusão</h2>

<p>Neste tutorial, você instalou e gerenciou o servidor web Apache. Agora que você tem seu servidor web instalado, você tem muitas opções para o tipo de conteúdo que você pode servir e as tecnologias que você pode usar para criar uma experiência mais rica.</p>

<p>Se você quiser criar uma pilha ou stack de aplicação mais completa, consulte este artigo sobre como configurar uma <a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-apache-mysql-php-lamp-stack-on-centos-7#step-four-%E2%80%94-test-php-processing-on-your-web-server">pilha LAMP no CentOS 7</a>.</p>
