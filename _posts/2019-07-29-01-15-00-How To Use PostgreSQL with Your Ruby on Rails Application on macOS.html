---
layout: post
title: How To Use PostgreSQL with Your Ruby on Rails Application on macOS
network: digitalocean
date: July 29, 2019 at 01:15AM
url: https://www.digitalocean.com/community/tutorials/how-to-use-postgresql-with-your-ruby-on-rails-application-on-macos
image: https://assets.digitalocean.com/articles/cart_66733/Rails_Welcome.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="introduction">Introduction</h3>

<p>When using the <a href="https://rubyonrails.org/">Ruby on Rails</a> web framework, your application is set up by default to use <a href="https://www.sqlite.org/index.html">SQLite</a> as a database. SQLite is a lightweight, portable, and user-friendly relational database that performs especially well in low-memory environments, and will work well in many cases. However, for highly complex applications that need more reliable data integrity and programmatic extensibility, a <a href="https://www.postgresql.org/">PostgreSQL</a> database will be a more robust and flexible choice. In order to configure your Ruby on Rails setup to use PostgreSQL, you will need to perform a few additional steps to get it up and running. </p>

<p>In this tutorial, you will set up a Ruby on Rails development environment connected to a PostgreSQL database on a local macOS machine. You will install and configure PostgreSQL, and then test your setup by creating a Rails application that uses PostgreSQL as its database server.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>This tutorial requires the following:</p>

<ul>
<li><p>One computer or virtual machine with macOS installed, with administrative access to that machine and an internet connection. This tutorial has been tested on <a href="https://www.apple.com/macos/mojave/">macOS 10.14 Mojave</a>.</p></li>
<li><p>A Ruby on Rails development environment installed on your macOS machine. To set this up, follow our guide on <a href="https://www.digitalocean.com/community/tutorials/how-to-install-ruby-on-rails-with-rbenv-on-macos">How To Install Ruby on Rails with rbenv on macOS</a>. This tutorial will use version 2.6.3 of Ruby and 5.2.3 of Rails; for information on the latest versions, check out the official sites for <a href="https://www.ruby-lang.org/en/downloads/releases/">Ruby</a> and <a href="https://guides.rubyonrails.org/">Rails</a>. </p></li>
</ul>

<h2 id="step-1-—-installing-postgresql">Step 1 — Installing PostgreSQL</h2>

<p>In order to configure Ruby on Rails to create your web application with PostgreSQL as a database, you will first install the database onto your machine. Although there are <a href="https://www.postgresql.org/download/macosx/">many ways to install PostgreSQL on macOS</a>, this tutorial will use the package manager <a href="https://brew.sh/">Homebrew</a>.</p>

<p>There are multiple Homebrew packages to install different versions of PostgreSQL. To install the latest version, run the following command:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">brew install postgresql
</li></ul></code></pre>
<p>If you would like to download a specific version of PostgreSQL, replace <code>postgresql</code> in the previous command with your desired package. You can find the available packages at the <a href="https://formulae.brew.sh/formula/postgresql">Homebrew website</a>.</p>

<p>Next, include the PostgreSQL binary in your <code>PATH</code> variable in order to access the PostgreSQL command line tools, making sure to replace the <code><span class="highlight">10</span></code> with the version number you are using:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">echo 'export PATH="/usr/local/opt/postgresql@<span class="highlight">10</span>/bin:$PATH"' &gt;&gt; ~/.bash_profile
</li></ul></code></pre>
<p>Then, apply the changes you made to your <code>~/.bash_profile</code> file to your current shell session:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">source ~/.bash_profile
</li></ul></code></pre>
<p>To start the service and enable it to start at login, run the following:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">brew services start postgresql@<span class="highlight">10</span>
</li></ul></code></pre>
<p>Check to make sure the installation was successful:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">postgres -V
</li></ul></code></pre>
<p>You will get the following output:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>postgres (PostgreSQL) <span class="highlight">10.9</span>
</code></pre>
<p>Once PostgreSQL is installed, the next step is to create a role that your Rails application will use later to create your database.</p>

<h2 id="step-2-—-creating-a-database-role-for-your-application">Step 2 — Creating a Database Role for Your Application</h2>

<p>In PostgreSQL, <em>roles</em> can be used to organize permissions and authorization. When starting PostgreSQL with Homebrew, you will automatically have a superuser role created with your macOS username. In order to keep these superuser privileges separate from the database instance you use for your Rails application, in this step you will create a new role with less access.</p>

<p>To create a new role, run the following command, replacing <code><span class="highlight">appname</span></code> with whatever name you'd like to give the role:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">createuser -P -d <span class="highlight">appname</span>
</li></ul></code></pre>
<p>In this command, you used <code>createuser</code> to create a role named <code><span class="highlight">appname</span></code>. The <code>-d</code> flag gave the role the permission to create new databases.</p>

<p>You also specified the <code>-P</code> flag, which means you will be prompted to enter a password for your new role. Enter your desired password, making sure to record it so that you can use it in a configuration file in a future step. </p>

<p>If you did not use the <code>-P</code> flag and want to set a password for the role after you create it, enter the PostgreSQL console with the following command:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">psql postgres
</li></ul></code></pre>
<p>You will receive the following output, along with the prompt for the PostgreSQL console:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>psql (<span class="highlight">10.9</span>)
Type "help" for help.

postgres=#
</code></pre>
<p>The PostgreSQL console is indicated by the <code>postgres=#</code> prompt. At the PostgreSQL prompt, enter this command to set the password for the new database role, replacing the highlighted name with the one you created:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="postgres=#">\password <span class="highlight">appname</span>
</li></ul></code></pre>
<p>PostgreSQL will prompt you for a password. Enter your desired password at the prompt, then confirm it.</p>

<p>Now, exit the PostgreSQL console by entering this command:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="postgres=#">\q
</li></ul></code></pre>
<p>Your usual prompt will now reappear.</p>

<p>In this step, you created a new PostgreSQL role without superuser privileges for your application. Now you are ready to create a new Rails app that uses this role to create a database.</p>

<h2 id="step-3-—-creating-a-new-rails-application">Step 3 — Creating a New Rails Application</h2>

<p>With your role configured for PostgreSQL, you can now create a new Rails application that is set up to use PostgreSQL as a database.</p>

<p>First, navigate to your home directory:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd ~
</li></ul></code></pre>
<p>Create a new Rails application in this directory, replacing <code><span class="highlight">appname</span></code> with whatever you would like to call your app:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">rails new <span class="highlight">appname</span> -d=postgresql
</li></ul></code></pre>
<p>The <code>-d=postgresql</code> option sets PostgreSQL as the database. </p>

<p>Once you've run this command, a new folder named <code><span class="highlight">appname</span></code> will appear in your home directory, containing all the elements of a basic Rails application.</p>

<p>Next, move into the application's directory:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd <span class="highlight">appname</span>
</li></ul></code></pre>
<p>Now that you have created a new Rails application and have moved into the root directory for your project, you can configure and create your PostgreSQL database from within your Rails app.</p>

<h2 id="step-4-—-configuring-and-creating-your-database">Step 4 — Configuring and Creating Your Database</h2>

<p>When creating the <code>development</code> and <code>test</code> databases for your application, Rails will use the PostgreSQL role that you created in Step 2. To make sure that Rails creates these databases, you will alter the database configuration file of your project. You will then create your databases.</p>

<p>One of the configuration changes to make in your Rails application is to add the password for the PostgreSQL role you created in the last step. To keep sensitive information like passwords safe, it is a good idea to store this in an environment variable rather than to write it directly in your configuration file.</p>

<p>To store your password in an environment variable at login, run the following command, replacing <code><span class="highlight">APPNAME</span></code> with the name of your app and <code><span class="highlight">PostgreSQL_Role_Password</span></code> with the password you created in the last step:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">echo 'export <span class="highlight">APPNAME</span>_DATABASE_PASSWORD="<span class="highlight">PostgreSQL_Role_Password</span>"' &gt;&gt; ~/.bash_profile
</li></ul></code></pre>
<p>This command writes the <code>export</code> command to your <code>~/.bash_profile</code> file so that the environment variable will be set at login. </p>

<p>To export the variable for your current session, use the <code>source</code> command:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">source ~/.bash_profile
</li></ul></code></pre>
<p>Now that you have stored your password in your environment, it's time to alter the configuration file. </p>

<p>Open your application's database configuration file in your preferred text editor. This tutorial will use <code>nano</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano config/database.yml
</li></ul></code></pre>
<p>Under the <code>default</code> section, find the line that says <code>pool: &lt;%= ENV.fetch("RAILS_MAX_THREADS") { 5 } %&gt;</code> and add the following highlighted lines, filling in your credentials and the environment variable you created. It should look something like this:</p>
<div class="code-label " title="config/database.yml">config/database.yml</div><pre class="code-pre "><code langs="">...
default: &amp;default
  adapter: postgresql
  encoding: unicode
  # For details on connection pooling, see Rails configuration guide
  # http://guides.rubyonrails.org/configuring.html#database-pooling
  pool: &lt;%= ENV.fetch("RAILS_MAX_THREADS") { 5 } %&gt;
  <span class="highlight">username: appname</span>
  <span class="highlight">password: &lt;%= ENV['APPNAME_DATABASE_PASSWORD'] %&gt;</span>

development:
  &lt;&lt;: *default
  database: appname_development
...
</code></pre>
<p>This will make the Rails application run the database with the correct role and password. Save and exit by pressing <code>CTRL+X</code>, <code>Y</code>, then <code>ENTER</code>.  </p>

<p>For more information on configuring databases in Rails, see the <a href="https://guides.rubyonrails.org/configuring.html#configuring-a-database">Rails documentation</a>.</p>

<p>Now that you have made changes to <code>config/database.yml</code>, create your application's databases by using the <code>rails</code> command:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">rails db:create
</li></ul></code></pre>
<p>Once Rails creates the database, you will receive the following output:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Created database '<span class="highlight">appname</span>_development'
Created database '<span class="highlight">appname</span>_test'
</code></pre>
<p>As the output suggests, this command created a <code>development</code> and <code>test</code> database in your PostgreSQL server.</p>

<p>You now have a PostgreSQL database connected to your Rails app. To ensure that your application is working, the next step is to test your configuration.</p>

<h2 id="step-5-—-testing-your-configuration">Step 5 — Testing Your Configuration</h2>

<p>To test that your application is able to use the PostgreSQL database, try to run your web application so that it will show up in a browser.</p>

<p>First, you'll use the built-in web server for Rails, <a href="https://github.com/puma/puma">Puma</a>, to serve your application. This web server comes with Rails automatically and requires no additional setup. To serve your application, run the following command:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">rails server --binding=127.0.0.1
</li></ul></code></pre>
<p><code>--binding</code> binds your application to a specified IP. By default, this flag will bind Rails to <code>0.0.0.0</code>, but since this means that Rails will listen to all interfaces, it is more secure to use <code>127.0.0.1</code> to specify the <code>localhost</code>. By default, the application listens on port <code>3000</code>.</p>

<p>Once your Rails app is running, your command prompt will disappear, replaced by this output:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>=&gt; Booting Puma
=&gt; Rails <span class="highlight">5.2.3</span> application starting in development
=&gt; Run `rails server -h` for more startup options
Puma starting in single mode...
* Version <span class="highlight">3.12.1</span> (ruby <span class="highlight">2.6.3</span>-p62), codename: Llamas in Pajamas
* Min threads: 5, max threads: 5
* Environment: development
* Listening on tcp://127.0.0.1:3000
Use Ctrl-C to stop
</code></pre>
<p>To test if your application is running, open up a new terminal window on your server and use the <code>curl</code> command to send a request to <code>127.0.0.1:3000</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">curl http://127.0.0.1:3000
</li></ul></code></pre>
<p>You will receive a lot of output in HTML, ending in something like:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>...
        &lt;strong&gt;Rails version:&lt;/strong&gt;<span class="highlight"> 5.2.3</span>&lt;br /&gt;
        &lt;strong&gt;Ruby version:&lt;/strong&gt; <span class="highlight">2.6.3</span> (x86_64-darwin18)
      &lt;/p&gt;
    &lt;/section&gt;
  &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>You can also access your Rails application in a local web browser by visiting:</p>
<pre class="code-pre "><code langs="">http://127.0.0.1:3000
</code></pre>
<p>At this URL, you will find a Ruby on Rails welcome page:</p>

<p><img src="https://assets.digitalocean.com/articles/cart_66733/Rails_Welcome.png" alt="Ruby on Rails Welcome Page"></p>

<p>This means that your application is properly configured and connected to the PostgreSQL database.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In this tutorial, you created a Ruby on Rails web application that was configured to use PostgreSQL as a database on a local macOS machine. If you would like to learn more about the Ruby programming language, check out our <a href="https://www.digitalocean.com/community/tutorial_series/how-to-code-in-ruby">How To Code in Ruby series</a>. </p>

<p>For more information on choosing a database for your application, check out our tutorial on the differences between and use cases of <a href="https://www.digitalocean.com/community/tutorials/sqlite-vs-mysql-vs-postgresql-a-comparison-of-relational-database-management-systems">SQLite, PostgreSQL, and MySQL</a>. If you want to read more about how to use databases, see our <a href="https://www.digitalocean.com/community/tutorials/introduction-to-queries-postgresql">An Introduction to Queries in PostgreSQL</a> article, or explore DigitalOcean's <a href="https://www.digitalocean.com/products/managed-databases/">Managed Databases product</a>.</p>
