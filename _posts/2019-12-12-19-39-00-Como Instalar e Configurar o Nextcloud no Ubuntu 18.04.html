---
layout: post
title: Como Instalar e Configurar o Nextcloud no Ubuntu 18.04
network: digitalocean
date: December 12, 2019 at 07:39PM
url: https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-nextcloud-on-ubuntu-18-04-pt
image: https://assets.digitalocean.com/articles/nextcloud_1804/login_page.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="introdução">Introdução</h3>

<p><a href="https://nextcloud.com/">Nextcloud</a>, uma ramificação do ownCloud, é um servidor de compartilhamento de arquivos que permite que você armazene seu conteúdo pessoal, como documentos e fotos, em um local centralizado, bem parecido com o Dropbox. A diferença com o Nextcloud é que todos os seus recursos são em código aberto. Além disso, ele restitui a você o controle e a segurança de seus dados confidenciais, eliminando assim o uso de serviço de hospedagem em nuvem de terceiros.</p>

<p>Neste tutorial, iremos instalar e configurar uma instância de Nextcloud em um servidor Ubuntu 18.04.</p>

<h2 id="pré-requisitos">Pré-requisitos</h2>

<p>Para completar os passos neste guia, será necessário o seguinte:</p>

<ul>
<li><strong>Um usuário sudo e firewall configurados no seu servidor</strong>: você pode criar um usuário com privilégios <code>sudo</code> e configurar um firewall básico, de acordo <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-18-04">com o Guia de configuração inicial do servidor Ubuntu 18.04</a>.</li>
<li><strong>(Opcional) Um nome de domínio apontado para seu s</strong>ervidor: vamos garantir conexões com a instalação do Nextcloud com protocolos TLS/SSL. O Nextcloud pode configurar e gerenciar um certificado SSL gratuito e confiável do <a href="https://letsencrypt.org/">Let&rsquo;s Encrypt</a> se seu servidor tiver um nome de domínio. Se não tiver um nome de domínio, o Nextcloud pode definir um certificado SSL autoassinado que possa criptografar conexões; porém, ele não será confiável por padrão em navegadores Web. Se estiver usando o DigitalOcean, você pode seguir nosso guia <a href="https://www.digitalocean.com/docs/networking/dns/how-to/add-domains/">sobre como configurar um nome de domínio para seu se</a>rvidor, caso pretenda usar o certificado Let&rsquo;s Encrypt.</li>
</ul>

<p>Assim que concluir os passos acima, continue para aprender como configurar o Nextcloud no seu servidor.</p>

<h2 id="passo-1-como-instalar-o-nextcloud">Passo 1 - Como instalar o Nextcloud</h2>

<p>Vamos instalar o Nextcloud usando o sistema de empacotamento <a href="https://en.wikipedia.org/wiki/Snappy_(package_manager)">snappy</a>. Este sistema de empacotamento, disponível no Ubuntu 18.04 por padrão, permite que as organizações enviem software, junto com todas as dependências e configuração associadas, em uma unidade autocontida com atualizações automáticas. Isso significa que, em vez de instalar e configurar um servidor Web e de banco de dados e, depois, configurar o app Nextcloud para executá-lo, podemos instalar o pacote <code>snap</code> que lida com os sistemas subjacentes automaticamente.</p>

<p>Para baixar o pacote <code>snap</code> do Nextcloud e instalá-lo no sistema, digite:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo snap install nextcloud
</li></ul></code></pre>
<p>O pacote Nextcloud será baixado e instalado no seu servidor. Você pode confirmar que o processo de instalação foi bem sucedido listando as alterações associadas ao <code>snap</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">snap changes nextcloud
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>ID   Status  Spawn               Ready               Summary
2    <span class="highlight">Done</span>    today at 16:12 UTC  today at 16:12 UTC  <span class="highlight">Install "nextcloud" snap</span>
</code></pre>
<p>O status e o resumo indicam que a instalação foi concluída sem problemas.</p>

<h3 id="obtendo-informações-adicionais-sobre-o-nextcloud-snap">Obtendo informações adicionais sobre o Nextcloud Snap</h3>

<p>Se quiser mais informações sobre o <code>snap</code> do Nextcloud, há alguns comandos que podem ser úteis.</p>

<p>O comando <code>snap info</code> pode mostrar a descrição, os comandos de gerenciamento do Nextcloud disponíveis, assim como a versão instalada e o canal snap sendo rastreado:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">snap info nextcloud
</li></ul></code></pre>
<p>Os Snaps podem definir as interfaces que suportam, as quais consistem de um slot e um plug que - quando conectados juntos - permitem que o snap tenha acesso a certos recursos ou níveis de acesso. Por exemplo, os snaps que precisam atuar como um cliente de rede devem ter a interface de <code>network</code>. Para ver quais &ldquo;interfaces&rdquo; de snap este snap define, digite:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">snap interfaces nextcloud
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Slot           Plug
:network       nextcloud
:network-bind  nextcloud
-              nextcloud:removable-media
</code></pre>
<p>Para aprender sobre todos os serviços e apps específicos que este snap proporciona, consulte o  arquivo definição de snap, digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cat /snap/nextcloud/current/meta/snap.yaml
</li></ul></code></pre>
<p>Isso permitirá que veja os componentes individuais incluídos dentro do snap, caso precise de ajuda com a depuração (debugging).</p>

<h2 id="configurando-uma-conta-administrativa">Configurando uma conta administrativa</h2>

<p>Existem algumas maneiras diferentes de configurar o snap do Nextcloud. Neste guia, vamos criar uma linha de comando - e não um usuário administrativo através da interface Web - para evitar uma pequena janela onde a página de registro do administrador fica acessível a qualquer um que visite o endereço de IP ou nome de domínio do seu servidor.</p>

<p>Para configurar o Nextcloud com uma nova conta de administrador, utilize o comando <code>nextcloud.manual-install</code>. Você deve enviar um nome de usuário e senha na forma de argumentos:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nextcloud.manual-install <span class="highlight">sammy</span> <span class="highlight">password</span>
</li></ul></code></pre>
<p>A seguinte mensagem indica que o Nextcloud foi configurado corretamente:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Nextcloud is not installed - only a limited number of commands are available
<span class="highlight">Nextcloud was successfully installed</span>
</code></pre>
<p>Agora que o Nextcloud está instalado, precisamos ajustar os domínios confiáveis para que o Nextcloud responda às solicitações, utilizando o nome de domínio ou endereço IP do servidor.</p>

<h2 id="ajustando-os-domínios-confiáveis">Ajustando os domínios confiáveis</h2>

<p>Ao instalar a partir da linha de comando, o Nextcloud restringe os nomes de host aos quais a instância responderá. Por padrão, o serviço responde somente aos pedidos feitos ao nome do host &ldquo;localhost&rdquo;. Acessaremos o Nextcloud através do nome de domínio ou endereço IP do servidor. Assim, precisaremos ajustar essa configuração para aceitar esses tipos de pedidos.</p>

<p>Você pode visualizar as configurações atuais, consultando o valor da matriz <code>trusted_domains</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nextcloud.occ config:system:get trusted_domains
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div><span class="highlight">localhost</span>
</code></pre>
<p>Atualmente, apenas o <code>localhost</code> está presente como o primeiro valor na matriz. Podemos adicionar uma entrada para nosso nome de domínio ou endereço de IP do servidor digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nextcloud.occ config:system:set trusted_domains 1 --value=<span class="highlight">example.com</span>
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div><span class="highlight">System config value trusted_domains =&gt; 1 set to string example.com</span>
</code></pre>
<p>Se consultarmos os domínios confiáveis novamente, veremos que agora temos duas entradas:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nextcloud.occ config:system:get trusted_domains
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div><span class="highlight">localhost</span>
<span class="highlight">example.com</span>
</code></pre>
<p>Se precisar adicionar outra maneira de acessar a instância Nextcloud, poderá adicionar domínios ou endereços adicionais executando novamente o comando <code>config:system:set</code> com um número de índice incrementado (o &ldquo;1&rdquo; no primeiro comando) e ajustar o &ldquo;&ndash;value.</p>

<h2 id="protegendo-a-interface-web-da-nextcloud-com-ssl">Protegendo a interface Web da Nextcloud com SSL</h2>

<p>Antes de começar a utilizar o Nextcloud, precisamos proteger a interface Web.</p>

<p>Se tiver um nome de domínio associado ao seu servidor Nextcloud, o snap Nextcloud pode ajudá-lo a obter e configurar um certificado SSL confiável do <a href="https://letsencrypt.org/">Let&rsquo;s Encrypt</a>. Se seu servidor Nextcloud <em>não tiver</em> um nome de domínio, o Nextcloud pode configurar um certificado autoassinado que irá criptografar o seu tráfego Web, mas não poderá verificar a identidade do seu servidor.</p>

<p>Com isso em mente, siga a seção abaixo que corresponde ao seu cenário.</p>

<h3 id="opção-1-configurando-o-ssl-com-o-let-39-s-encrypt">Opção 1: configurando o SSL com o Let&rsquo;s Encrypt</h3>

<p>Se tiver um nome de domínio associado ao seu servidor Nextcloud, a melhor opção para proteger sua interface Web é obter um certificado SSL do Let&rsquo;s Encrypt.</p>

<p>Comece abrindo as portas do firewall que o Let&rsquo;s Encrypt usa para validar a propriedade de domínio. Isso irá tornar sua página de login do Nextcloud acessível ao público; mas, como já temos uma conta de administrador configurada, ninguém conseguirá de comprometer a instalação:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow 80,443/tcp
</li></ul></code></pre>
<p>Em seguida, peça um certificado do Let&rsquo;s Encrypt digitando:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nextcloud.enable-https lets-encrypt
</li></ul></code></pre>
<p>Primeiramente, será perguntado se seu servidor atende as condições necessárias para solicitar um certificado do serviço do Let&rsquo;s Encrypt:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>In order for Let's Encrypt to verify that you actually own the
domain(s) for which you're requesting a certificate, there are a
number of requirements of which you need to be aware:

1. In order to register with the Let's Encrypt ACME server, you must
   agree to the currently-in-effect Subscriber Agreement located
   here:

       https://letsencrypt.org/repository/

   By continuing to use this tool you agree to these terms. Please
   cancel now if otherwise.

2. You must have the domain name(s) for which you want certificates
   pointing at the external IP address of this machine.

3. Both ports 80 and 443 on the external IP address of this machine
   must point to this machine (e.g. port forwarding might need to be
   setup on your router).

Have you met these requirements? (y/n)
</code></pre>
<p>Digite <strong>y</strong> para continuar.</p>

<p>Em seguida, será solicitado que forneça um endereço de e-mail para usar em operações de recuperação:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Please enter an email address (for urgent notices or key recovery): <span class="highlight">your_email@domain.com</span>
</code></pre>
<p>Finalmente, digite o nome de domínio associado ao seu servidor Nextcloud:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Please enter your domain name(s) (space-separated): <span class="highlight">example.com</span>
</code></pre>
<p>Seu certificado Let&rsquo;s Encrypt será solicitado e, desde que tudo tenha corrido bem, a instância interna do Apache será reiniciada para implementar imediatamente o SSL:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Attempting to obtain certificates... done
Restarting apache... done
</code></pre>
<p>Agora, você pode avançar e <a href="#logging-in-to-the-nextcloud-web-interface">entrar no Nextcloud pela primeira vez​​​</a>​.</p>

<h3 id="opção-2-configurando-o-ssl-com-um-certificado-autoassinado">Opção 2: configurando o SSL com um certificado autoassinado</h3>

<p>Se seu servidor NextCloud *não *tiver um nome de domínio, ainda assim é possível proteger a interface Web, gerando um certificado SSL autoassinado. Este certificado permitirá o acesso à interface Web em uma conexão criptografada, mas será incapaz de verificar a identidade do seu servidor, então seu navegador provavelmente exibirá um aviso.</p>

<p>Para gerar um certificado autoassinado e configurar o Nextcloud para usá-lo, digite:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nextcloud.enable-https self-signed
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Generating key and self-signed certificate... done
Restarting apache... done
</code></pre>
<p>A saída de dados acima indica que o Nextcloud gerou e habilitou um certificado autoassinado.</p>

<p>Agora que a interface está segura, abra as portas Web no firewall para permitir o acesso à interface Web:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow 80,443/tcp
</li></ul></code></pre>
<p>Agora, você está pronto para fazer login no Nextcloud pela primeira vez.</p>

<h2 id="fazendo-login-na-interface-web-do-nextcloud">Fazendo login na Interface Web do Nextcloud</h2>

<p>Agora que o Nextcloud está configurado, visite seu nome de domínio ou endereço IP do seu servidor no seu navegador Web:</p>
<pre class="code-pre "><code langs="">https://<span class="highlight">example.com</span>
</code></pre>
<p><span class='note'><strong>Nota:</strong> se configurar um certificado SSL autoassinado, o seu navegador pode exibir um aviso de que a conexão não é segura porque o certificado do servidor não está assinado por uma autoridade de certificação reconhecida. Isso é de se esperar de certificados autoassinados; então, sinta-se à vontade para clicar no aviso para prosseguir até o site.<br></span></p>

<p>Como você já configurou uma conta de administrador a partir da linha de comando, você será levado até a página de login da Nextcloud. Digite as credenciais que você criou para o usuário administrativo:</p>

<p><img src="https://assets.digitalocean.com/articles/nextcloud_1804/login_page.png" alt="Nextcloud login page"></p>

<p>Clique no botão <strong>Log in​​​</strong> para fazer login na interface Web Nextcloud.</p>

<p>A primeira vez que você digitar, uma janela será exibida com links para vários clientes Nextcloud que podem ser usados para interagir e gerenciar sua instância Nextcloud:</p>

<p><img src="https://assets.digitalocean.com/articles/nextcloud_1804/modal.png" alt="Nextcloud client modal"></p>

<p>Clique para baixar os clientes que lhe interessem, ou saia da janela clicando no X, <strong>no</strong> canto superior direito. Você será levado para a interface principal do Nextcloud, onde você pode começar a fazer upload e gerenciar arquivos:</p>

<p><img src="https://assets.digitalocean.com/articles/nextcloud_1804/main_page.png" alt="Nextcloud main page"></p>

<p>Sua instalação agora está completa e segura. Sinta-se à vontade para explorar a interface para se familiarizar com as características e funcionalidades do seu novo sistema.</p>

<h2 id="conclusão">Conclusão</h2>

<p>O Nextcloud pode replicar as capacidades de serviços populares de armazenamento em nuvem de terceiros. O conteúdo pode ser compartilhado entre os usuários ou externamente com URLs públicas. A vantagem do Nextcloud é que as informações são armazenadas de maneira segura em um lugar que você controla.</p>

<p>Explore a interface e, para obter funcionalidades adicionais, instale plug-ins utilizando a <a href="https://apps.nextcloud.com/">Nextcloud&rsquo;s app store</a>.</p>
