---
layout: post
title: Установка Ruby on Rails с помощью rbenv в Ubuntu 18.04
network: digitalocean
date: January 07, 2020 at 07:48PM
url: https://www.digitalocean.com/community/tutorials/how-to-install-ruby-on-rails-with-rbenv-on-ubuntu-18-04-ru
image: http://ifttt.com/images/no_image_card.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<h3 id="Введение">Введение</h3>

<p><a href="https://rubyonrails.org">Ruby on Rails</a> — один из самых популярных среди разработчиков наборов приложений для создания сайтов и веб-приложений. Язык программирования Ruby в сочетании с системой разработки Rails делает разработку приложений очень простой.</p>

<p>Вы можете легко установить Ruby и Rails с помощью инструмента командной строки <a href="https://github.com/rbenv/rbenv">rbenv</a>. Использование rbenv обеспечит надежную среду для разработки приложений Ruby on Rails, позволяющую легко сменять версии Ruby, чтобы вся команда использовала одну и ту же версию.</p>

<p>rbenv обеспечивает поддержку версий Ruby для конкретных приложений, позволяет изменять глобальную версию Ruby для каждого пользователя и использовать переменную среды для принудительного определения версии Ruby.</p>

<p>В этом обучающем модуле вы научитесь выполнять установку Ruby и Rails с помощью rbenv.</p>

<h2 id="Предварительные-требования">Предварительные требования</h2>

<p>Для данного обучающего модуля вам потребуется следующее:</p>

<ul>
<li>Один сервер Ubuntu 18.04, настроенный в соответствии с <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-18-04">руководством по начальной настройке сервера Ubuntu 18.04</a>, включая пользователя sudo без прав root и брандмауэр.</li>
<li>Node.js, установленный через официальный PPA в соответствии с указаниями руководства <a href="https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-18-04">Установка Node.js в Ubuntu 18.04</a>. Некоторые функции Rails, в том числе Asset Pipeline, используют среду исполнения JavaScript. Node.js обеспечивает этот функционал.</li>
</ul>

<h2 id="Шаг-1-–-Установка-rbenv-и-зависимостей">Шаг 1 – Установка rbenv и зависимостей</h2>

<p>Ruby использует несколько пакетов, которые вы можете установить с помощью диспетчера пакетов. После их установки вы можете установить rbenv и использовать его для установки Ruby,</p>

<p>Вначале обновите список пакетов:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt update
</li></ul></code></pre>
<p>Затем установите зависимости, необходимые для установки Ruby:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt install autoconf bison build-essential libssl-dev libyaml-dev libreadline6-dev zlib1g-dev libncurses5-dev libffi-dev libgdbm5 libgdbm-dev
</li></ul></code></pre>
<p>После загрузки зависимостей вы можете установить саму утилиту rbenv. Клонируйте репозиторий rbenv из GitHub в каталог <code>~/.rbenv</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">git clone https://github.com/rbenv/rbenv.git ~/.rbenv
</li></ul></code></pre>
<p>Затем добавьте <code>~/.rbenv/bin</code> в <code>$PATH</code>, чтобы иметь возможность использовать утилиту командной строки <code>rbenv</code>. Для этого измените файл <code>~/.bashrc</code>, чтобы он влиял на будущие сеансы входа в систему:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">echo 'export PATH="$HOME/.rbenv/bin:$PATH"' &gt;&gt; ~/.bashrc
</li></ul></code></pre>
<p>Затем добавьте команду <code>eval "$(rbenv init -)"</code> в файл <code>~/.bashrc</code>, чтобы утилита rbenv загружалась автоматически:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">echo 'eval "$(rbenv init -)"' &gt;&gt; ~/.bashrc
</li></ul></code></pre>
<p>Затем примените изменения, внесенные в файл <code>~/.bashrc</code>, для текущего сеанса оболочки:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">source ~/.bashrc
</li></ul></code></pre>
<p>Проверьте правильность настройки rbenv с помощью команды <code>type</code>, которая выводит дополнительную информацию о команде <code>rbenv</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">type rbenv
</li></ul></code></pre>
<p>В окне терминала будет отображаться следующее:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>rbenv is a function
rbenv ()
{
    local command;
    command="${1:-}";
    if [ "$#" -gt 0 ]; then
        shift;
    fi;
    case "$command" in
        rehash | shell)
            eval "$(rbenv "sh-$command" "$@")"
        ;;
        *)
            command rbenv "$command" "$@"
        ;;
    esac
}
</code></pre>
<p>Затем установите плагин <a href="https://github.com/rbenv/ruby-build">ruby-build</a>. Этот плагин добавляет команду <code>rbenv install</code>, упрощающую процесс установки новых версий Ruby:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">git clone https://github.com/rbenv/ruby-build.git ~/.rbenv/plugins/ruby-build
</li></ul></code></pre>
<p>Итак, вы установили rbenv и ruby-build. Теперь выполним установку Ruby.</p>

<h2 id="Шаг-2-–-Установка-ruby-с-помощью-ruby-build">Шаг 2 – Установка Ruby с помощью ruby-build</h2>

<p>После установки плагина <code>ruby-build</code> вы можете устанавливать требуемые версии Ruby с помощью простой команды. Вначале выведем список всех доступных версий Ruby:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">rbenv install -l
</li></ul></code></pre>
<p>Эта команда должна вывести длинный список версий, которые вы можете установить.</p>

<p>Мы установим Ruby <span class="highlight">2.5.1</span>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">rbenv install <span class="highlight">2.5.1</span>
</li></ul></code></pre>
<p>Установка Ruby может быть длительным процессом, поэтому будьте готовы к тому, что установка займет некоторое время.</p>

<p>После завершения установки установите новую версию как версию Ruby по умолчанию с помощью субкоманды <code>global</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">rbenv global <span class="highlight">2.5.1</span>
</li></ul></code></pre>
<p>Проверьте правильность установки Ruby, проверив номер версии:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ruby -v
</li></ul></code></pre>
<p>Если вы установили версию Ruby 2.5.1, результат выполнения этой команды должен выглядеть примерно так:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>ruby 2.5.1p57 (2018-03-29 revision 63029) [x86_64-linux]
</code></pre>
<p>Чтобы установить и использовать другую версию Ruby, запустите команду <code>rbenv</code> с другим номером версии, например, <code>rbenv install <span class="highlight">2.3.0</span></code> или <code>rbenv global <span class="highlight">2.3.0</span></code>.</p>

<p>Теперь у вас имеется хотя бы одна установленная версия Ruby, и вы выбрали версию Ruby по умолчанию. Теперь мы настроим Gems и Rails.</p>

<h2 id="Шаг-3-—-Работа-с-gems">Шаг 3 — Работа с Gems</h2>

<p>Gems — это способ распределения библиотек Ruby. Вы можете использовать команду <code>gem</code> для управления этим распределением. Мы используем эту команду для установки Rails.</p>

<p>При установке gem процедура установки генерирует локальную документацию. Это может значительно увеличить время установки gem, так что отключите генерирование локальной документации, создав файл <code>~/.gemrc</code> с параметром конфигурации, отключающим эту функцию:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">echo "gem: --no-document" &gt; ~/.gemrc
</li></ul></code></pre>
<p><a href="https://bundler.io/">Bundler</a> — это инструмент, управляющий зависимостями gem в проектах. Далее установите компонент Bundler, поскольку Rails зависит от него.</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">gem install bundler
</li></ul></code></pre>
<p>Вывод будет выглядеть следующим образом:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Fetching: bundler-1.16.2.gem (100%)
Successfully installed bundler-1.16.2
1 gem installed
</code></pre>
<p>Вы можете использовать команду <code>gem env</code> (субкоманда <code>env</code> означает <code>среду</code>), чтобы узнать больше о среде и конфигурации gems. Вы можете увидеть место установки gems с помощью аргумента <code>home</code>, примерно так:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">gem env home
</li></ul></code></pre>
<p>Результат будет выглядеть примерно так:</p>
<pre class="code-pre "><code langs="">/home/<span class="highlight">sammy</span>/.rbenv/versions/<span class="highlight">2.5.1</span>/lib/ruby/gems/<span class="highlight">2.5.0</span>
</code></pre>
<p>После настройки gems вы можете установить Rails.</p>

<h2 id="Шаг-4-–-Установка-rails">Шаг 4 – Установка Rails</h2>

<p>Чтобы установить Rails, нужно использовать команду <code>gem install</code> с флагом <code>-v</code> для указания версии. Для данного обучающего модуля мы используем версию <code>5.2.0:</code></p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">gem install rails -v <span class="highlight">5.2.0</span>
</li></ul></code></pre>
<p>Команда <code>gem</code> устанавливает заданный элемент gem и все необходимые зависимости. Rails — это сложная веб-система разработки с множеством зависимостей, и для ее установки потребуется некоторое время. В конечном итоге вы увидите сообщение об установке Rails вместе со всеми зависимостями:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>...
Successfully installed rails-<span class="highlight">5.2.0</span>
38 gems installed
</code></pre>
<span class='note'><p>
<strong>Примечание.</strong> Если вы хотите установить другую версию Rails, вы можете вывести список допустимых версий Rails, выполнив поиск, в результате которого будет выведен длинный список возможных версий. Затем мы можем установить определенную версию, например <span class="highlight">4.2.7</span>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">gem search '^rails$' --all
</li><li class="line" prefix="$">gem install rails -v <span class="highlight">4.2.7</span>
</li></ul></code></pre>
<p>Если вы хотите установить последнюю версию Rails, запустите команду без указания версии:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">gem install rails
</li></ul></code></pre>
<p></p></span>

<p>rbenv создает каталог <strong>shims</strong>, указывающий на файлы, которые используются текущей активной версией Ruby. Используя субкоманду <code>rehash</code>, rbenv сохраняет shims в этом каталоге для соответствия всех команд Ruby во всех установленных версиях Ruby на вашем сервере. При установке новой версии Ruby или элемента gem, который предоставляет команды, наподобие Rails, нужно использовать следующую команду:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">rbenv rehash
</li></ul></code></pre>
<p>Проверьте правильность установки Rails, распечатав версию с помощью следующей команды:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">rails -v
</li></ul></code></pre>
<p>Если установка выполнена надлежащим образом, вы увидите установленную версию Rails:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Rails 5.2.0
</code></pre>
<p>Теперь вы можете начать тестирование установки Ruby on Rails и разработку веб-приложений. Давайте посмотрим, как обновлять rbenv.</p>

<h2 id="Шаг-5-–-Обновление-rbenv">Шаг 5 – Обновление rbenv</h2>

<p>Поскольку вы установили rbenv вручную с помощью Git, вы можете обновить установленную версию до последней в любое время, запустив команду <code>git pull</code> в каталоге <code>~/.rbenv</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">cd ~/.rbenv
</li><li class="line" prefix="$">git pull
</li></ul></code></pre>
<p>Это обеспечит использование последней актуальной версии rbenv.</p>

<h2 id="Шаг-6-–-Удаление-версий-ruby">Шаг 6 – Удаление версий Ruby</h2>

<p>После загрузки дополнительных версий Ruby в каталоге <code>~/.rbenv/versions</code> может оказаться слишком много версий. Используйте в плагине <code>ruby-build</code> субкоманду <code>uninstall</code> для удаления ненужных предыдущих версий.</p>

<p>Например, следующая команда удалит версию Ruby <span class="highlight">2.1.3</span>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">rbenv uninstall <span class="highlight">2.1.3</span>
</li></ul></code></pre>
<p>Команда <code>rbenv uninstall</code> позволяет удалять старые версии Ruby, чтобы в каталоге были установлены только используемые версии.</p>

<h2 id="Шаг-7-–-Удаление-rbenv">Шаг 7 – Удаление rbenv</h2>

<p>Если вы решите больше не использовать утилиту rbenv, вы можете удалить ее из своей системы.</p>

<p>Для этого вначале откройте в редакторе файл <code>~/.bashrc</code>:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">nano ~/.bashrc
</li></ul></code></pre>
<p>Найдите в файле следующие две строки и удалите их:</p>
<div class="code-label " title="~/.bashrc">~/.bashrc</div><pre class="code-pre "><code langs="">...
export PATH="$HOME/.rbenv/bin:$PATH"
eval "$(rbenv init -)"
</code></pre>
<p>Сохраните файл и выйдите из редактора.</p>

<p>Затем удалите rbenv и все установленные версии Ruby с помощью следующей команды:</p>
<pre class="code-pre "><code langs=""> rm -rf `rbenv root`
</code></pre>
<p>Выйдите из системы и снова войдите в нее, чтобы применить изменения в оболочке.</p>

<h2 id="Заключение">Заключение</h2>

<p>В этом обучающем модуле вы установили <code>rbenv</code> и Ruby on Rails. Теперь вы можете узнать больше о повышении безопасности этих сред.</p>

<p>Узнайте, как использовать Ruby on Rails с <a href="https://www.digitalocean.com/community/tutorials/how-to-use-postgresql-with-your-ruby-on-rails-application-on-ubuntu-14-04">PostgreSQL</a> или <a href="https://www.digitalocean.com/community/tutorials/how-to-use-mysql-with-your-ruby-on-rails-application-on-ubuntu-14-04">MySQL</a> вместо базы данных по умолчанию sqlite3, чтобы обеспечить дополнительную масштабируемость, централизацию и стабильность ваших приложений. По мере роста ваших потребностей вы также можете изучить <a href="https://www.digitalocean.com/community/tutorials/how-to-scale-ruby-on-rails-applications-across-multiple-droplets-part-1">масштабирование приложений Ruby on Rails на нескольких серверах</a>.</p>
