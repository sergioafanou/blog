---
layout: post
title: How To Configure a Galera Cluster with MySQL on Ubuntu 18.04 Servers
network: digitalocean
date: December 13, 2019 at 07:18PM
url: https://www.digitalocean.com/community/tutorials/how-to-configure-a-galera-cluster-with-mysql-on-ubuntu-18-04-servers
image: http://ifttt.com/images/no_image_card.png
tags: docker
feedtitle: DigitalOcean Community Tutorials
feedurl: https://www.digitalocean.com/community/tutorials
author: DigitalOcean
---
<p><em>The author selected the <a href="https://www.brightfunds.org/funds/foss-nonprofits">Free and Open Source Fund</a> to receive a donation as part of the <a href="https://do.co/w4do-cta">Write for DOnations</a> program.</em></p>

<h3 id="introduction">Introduction</h3>

<p>Clustering adds high availability to your database by distributing changes to different servers. In the event that one of the instances fails, others are quickly available to continue serving. </p>

<p>Clusters come in two general configurations, <em>active-passive</em> and <em>active-active</em>. In active-passive clusters, all writes are done on a single active server and then copied to one or more passive servers that are poised to take over only in the event of an active server failure. Some active-passive clusters also allow <code>SELECT</code> operations on passive nodes. In an active-active cluster, every node is read-write and a change made to one is replicated to all.</p>

<p><a href="https://www.mysql.com/">MySQL</a> is an open source relational database management system that is a popular choice for <a href="https://www.digitalocean.com/community/tutorials/how-to-manage-sql-database-cheat-sheet">SQL databases</a>. <a href="http://galeracluster.com/">Galera</a> is a database clustering solution that enables you to set up multi-master clusters using synchronous replication. Galera automatically handles keeping the data on different nodes in sync while allowing you to send read and write queries to any of the nodes in the cluster. You can learn more about Galera at the official <a href="http://galeracluster.com/library/documentation/">documentation page</a>.</p>

<p>In this guide, you will configure an active-active MySQL Galera cluster. For demonstration purposes, you will configure and test three Ubuntu 18.04 <a href="https://www.digitalocean.com/docs/droplets/">Droplets</a> that will act as nodes in the cluster. This amount of nodes is the smallest configurable cluster.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>To follow along, you will need a <a href="https://cloud.digitalocean.com/registrations/new">DigitalOcean account</a>, in addition to the following:</p>

<ul>
<li>Three Ubuntu 18.04 Droplets with private networking enabled, each with a non-root user with <code>sudo</code> privileges. 

<ul>
<li>For setting up private networking on the three Droplets, follow our <a href="https://www.digitalocean.com/docs/networking/private-networking/quickstart/">Private Networking Quickstart</a> guide.</li>
<li>For assistance setting up a non-root user with <code>sudo</code> privileges, follow our <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-18-04">Initial Server Setup with Ubuntu 18.04</a> tutorial.</li>
</ul></li>
</ul>

<p>While the steps in this tutorial have been written for and tested against DigitalOcean Droplets, much of them will also be applicable to non-DigitalOcean servers with private networking enabled.</p>

<h2 id="step-1-—-adding-the-mysql-repositories-to-all-servers">Step 1 — Adding the MySQL Repositories to All Servers</h2>

<p>In this step, you will add the relevant MySQL and Galera package repositories to each of your three servers so that you will be able to install the right version of MySQL and Galera used in this tutorial.</p>

<p><span class='note'><strong>Note:</strong> <a href="https://galeracluster.com/company/">Codership</a>, the company behind Galera Cluster, maintains the Galera repository, but be aware that not all external repositories are reliable. Be sure to install only from trusted sources.<br></span></p>

<p>In this tutorial, you will use <a href="https://dev.mysql.com/doc/relnotes/mysql/5.7/en/">MySQL version 5.7</a>. You&rsquo;ll start by adding the external Ubuntu repository maintained by the Galera project to all three of your servers.</p>

<p>Once the repositories are updated on all three servers, you will be ready to install MySQL along with Galera.</p>

<p>First, on all three of your servers, add the Galera repository key with the <code>apt-key</code> command, which the APT package manager will use to verify that the package is authentic:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt-key adv --keyserver keyserver.ubuntu.com --recv BC19DDBA
</li></ul></code></pre>
<p>After a few seconds, you will receive the following output:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Executing: /tmp/apt-key-gpghome.RG5cTZjQo0/gpg.1.sh --keyserver keyserver.ubuntu.com --recv BC19DDBA
gpg: key D669017EBC19DDBA: public key "Codership Oy &lt;info@galeracluster.com&gt;" imported
gpg: Total number processed: 1
gpg:               imported: 1
</code></pre>
<p>Once you have the trusted key in each server’s database, you can add the repositories. To do so, create a new file called <code>galera.list</code> within the <code>/etc/apt/sources.list.d/</code> directory on each server:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/apt/sources.list.d/galera.list
</li></ul></code></pre>
<p>In the text editor, add the following lines, which will make the appropriate repositories available to the APT package manager:</p>
<div class="code-label " title="/etc/apt/sources.list.d/galera.list">/etc/apt/sources.list.d/galera.list</div><pre class="code-pre "><code langs="">deb http://releases.galeracluster.com/mysql-wsrep-5.7/ubuntu bionic main
deb http://releases.galeracluster.com/galera-3/ubuntu bionic main
</code></pre>
<p>Save and close the files on each server (press <code>CTRL + X</code>, <code>Y</code>, then <code>ENTER</code>). </p>

<p>The Codership repositories are now available to all three of your servers. However, it’s important that you instruct <code>apt</code> to prefer Codership’s repositories over others to ensure that it installs the patched versions of the software needed to create a Galera cluster. To do this, create another new file called <code>galera.pref</code> within the <code>/etc/apt/preferences.d/</code> directory of each server:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/apt/preferences.d/galera.pref
</li></ul></code></pre>
<p>Add the following lines to the text editor:</p>
<div class="code-label " title="/etc/apt/preferences.d/galera.pref">/etc/apt/preferences.d/galera.pref</div><pre class="code-pre "><code langs=""># Prefer Codership repository
Package: *
Pin: origin releases.galeracluster.com
Pin-Priority: 1001
</code></pre>
<p>Save and close that file, then run the following command on each server in order to include package manifests from the new repositories:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt update
</li></ul></code></pre>
<p>Now that you have successfully added the package repository on all three of your servers, you&rsquo;re ready to install MySQL in the next section.</p>

<h2 id="step-2-—-installing-mysql-on-all-servers">Step 2 — Installing MySQL on All Servers</h2>

<p>In this step, you will install the MySQL package on your three servers.</p>

<p>Run the following command on all three servers to install a version of MySQL patched to work with Galera, as well as the Galera package.</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt install galera-3 mysql-wsrep-5.7
</li></ul></code></pre>
<p>You will be asked to confirm whether you would like to proceed with the installation. Enter <code>Y</code> to continue with the installation. During the installation, you will also be asked to set a password for the MySQL administrative user. Set a strong password and press <code>ENTER</code> to continue.</p>

<p>Once MySQL is installed, you will disable the default AppArmor profile to ensure that Galera functions properly, as per the <a href="https://galeracluster.com/library/training/tutorials/galera-installation.html#disabling-apparmor">official Galera documentation</a>. <a href="https://help.ubuntu.com/lts/serverguide/apparmor.html">AppArmor</a> is a kernel module for Linux that provides access control functionality for services through security profiles.</p>

<p>Disable AppArmor by executing the following on each server:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ln -s /etc/apparmor.d/usr.sbin.mysqld /etc/apparmor.d/disable/
</li></ul></code></pre>
<p>This command adds a symbolic link of the MySQL profile to the <code>disable</code> directory, which disables the profile on boot.</p>

<p>Then, run the following command to remove the MySQL definition that has already been loaded in the kernel.</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apparmor_parser -R /etc/apparmor.d/usr.sbin.mysqld
</li></ul></code></pre>
<p>Once you have installed MySQL and disabled the AppArmor profile on your first server, repeat these steps for your other two servers.</p>

<p>Now that you have installed MySQL successfully on each of the three servers, you can proceed to the configuration step in the next section.</p>

<h2 id="step-3-—-configuring-the-first-node">Step 3 — Configuring the First Node</h2>

<p>In this step you will configure your first node. Each node in the cluster needs to have a nearly identical configuration. Because of this, you will do all of the configuration on your first machine, and then copy it to the other nodes.</p>

<p>By default, MySQL is configured to check the <code>/etc/mysql/conf.d</code> directory to get additional configuration settings from files ending in <code>.cnf</code>. On your first server, create a file in this directory with all of your cluster-specific directives:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="galera-node01$">sudo nano /etc/mysql/conf.d/galera.cnf
</li></ul></code></pre>
<p>Add the following configuration into the file. The configuration specifies different cluster options, details about the current server and the other servers in the cluster, and replication-related settings. Note that the IP addresses in the configuration are the private addresses of your respective servers; replace the highlighted lines with the appropriate IP addresses.</p>
<div class="code-label " title="/etc/mysql/conf.d/galera.cnf">/etc/mysql/conf.d/galera.cnf</div><pre class="code-pre "><code langs="">[mysqld]
binlog_format=ROW
default-storage-engine=innodb
innodb_autoinc_lock_mode=2
bind-address=0.0.0.0

# Galera Provider Configuration
wsrep_on=ON
wsrep_provider=/usr/lib/galera/libgalera_smm.so

# Galera Cluster Configuration
wsrep_cluster_name="test_cluster"
wsrep_cluster_address="gcomm://<span class="highlight">First_Node_IP</span>,<span class="highlight">Second_Node_IP</span>,<span class="highlight">Third_Node_IP</span>"

# Galera Synchronization Configuration
wsrep_sst_method=rsync

# Galera Node Configuration
wsrep_node_address="<span class="highlight">This_Node_IP</span>"
wsrep_node_name="<span class="highlight">This_Node_Name</span>"
</code></pre>
<ul>
<li><strong>The first section</strong> modifies or re-asserts MySQL settings that will allow the cluster to function correctly. For example, Galera won’t work with MyISAM or similar non-transactional storage engines, and <code>mysqld</code> must not be bound to the IP address for <code>localhost</code>. You can learn about the settings in more detail on the Galera Cluster <a href="http://galeracluster.com/documentation-webpages/configuration.html">system configuration page</a>.</li>
<li><strong>The &ldquo;Galera Provider Configuration&rdquo; section</strong>  configures the MySQL components that provide a WriteSet replication API. This means Galera in your case, since Galera is a <em>wsrep</em> (WriteSet Replication) provider. You specify the general parameters to configure the initial replication environment. This doesn&rsquo;t require any customization, but you can learn more about <a href="http://www.codership.com/wiki/doku.php?id=galera_parameters">Galera configuration options in the documentation</a>. </li>
<li><strong>The &ldquo;Galera Cluster Configuration&rdquo; section</strong> defines the cluster, identifying the cluster members by IP address or resolvable domain name and creating a name for the cluster to ensure that members join the correct group. You can change the <code>wsrep_cluster_name</code> to something more meaningful than <code>test_cluster</code> or leave it as-is, but you must update <code>wsrep_cluster_address</code> with the private IP addresses of your three servers.</li>
<li><strong>The <code>Galera Synchronization Configuration</code> section</strong> defines how the cluster will communicate and synchronize data between members. This is used only for the state transfer that happens when a node comes online. For your initial setup, you are using <a href="https://www.digitalocean.com/community/tutorials/how-to-use-rsync-to-sync-local-and-remote-directories-on-a-vps"><code>rsync</code></a>, because it&rsquo;s commonly available and does what you&rsquo;ll need for now.</li>
<li><strong>The <code>Galera Node Configuration</code> section</strong> clarifies the IP address and the name of the current server. This is helpful when trying to diagnose problems in logs and for referencing each server in multiple ways. The <code>wsrep_node_address</code> must match the address of the machine you&rsquo;re on, but you can choose any name you want in order to help you identify the node in log files.</li>
</ul>

<p>When you are satisfied with your cluster configuration file, copy the contents into your clipboard, then save and close the file.</p>

<p>Now that you have configured your first node successfully, you can move on to configuring the remaining nodes in the next section.</p>

<h2 id="step-4-—-configuring-the-remaining-nodes">Step 4 — Configuring the Remaining Nodes</h2>

<p>In this step, you will configure the remaining two nodes. On your second node, open the configuration file:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="galera-node02$">sudo nano /etc/mysql/conf.d/galera.cnf
</li></ul></code></pre>
<p>Paste in the configuration you copied from the first node, then update the <code>Galera Node Configuration</code> to use the IP address or resolvable domain name for the specific node you&rsquo;re setting up. Finally, update its name, which you can set to whatever helps you identify the node in your log files:</p>
<div class="code-label " title="/etc/mysql/conf.d/galera.cnf">/etc/mysql/conf.d/galera.cnf</div><pre class="code-pre "><code langs="">. . .
# Galera Node Configuration
wsrep_node_address="<span class="highlight">This_Node_IP</span>"
wsrep_node_name="<span class="highlight">This_Node_Name</span>"
. . .

</code></pre>
<p>Save and exit the file.</p>

<p>Once you have completed these steps, repeat them on the third node. </p>

<p>You&rsquo;re almost ready to bring up the cluster, but before you do, make sure that the appropriate ports are open in your firewall.</p>

<h2 id="step-5-—-opening-the-firewall-on-every-server">Step 5 — Opening the Firewall on Every Server</h2>

<p>In this step, you will configure your firewall so that the ports required for inter-node communication are open. On every server, check the status of the firewall by running:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw status
</li></ul></code></pre>
<p>In this case, only SSH is allowed through:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Status: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere
OpenSSH (v6)               ALLOW       Anywhere (v6)
</code></pre>
<p>Since only SSH traffic is permitted in this case, you’ll need to add rules for MySQL and Galera traffic. If you tried to start the cluster, it would fail because of these firewall rules.</p>

<p>Galera can make use of four ports:</p>

<ul>
<li><code>3306</code> For MySQL client connections and State Snapshot Transfer that use the <code>mysqldump</code> method.</li>
<li><code>4567</code> For Galera Cluster replication traffic. Multicast replication uses both UDP transport and TCP on this port.</li>
<li><code>4568</code> For Incremental State Transfer.</li>
<li><code>4444</code> For all other State Snapshot Transfer.</li>
</ul>

<p>In this example, you’ll open all four ports while you do your setup. Once you&rsquo;ve confirmed that replication is working, you&rsquo;d want to close any ports you&rsquo;re not actually using and restrict traffic to just servers in the cluster.</p>

<p>Open the ports with the following commands:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo ufw allow 3306,4567,4568,4444/tcp
</li><li class="line" prefix="$">sudo ufw allow 4567/udp
</li></ul></code></pre>
<p><span class='note'><strong>Note:</strong> Depending on what else is running on your servers, you might want to restrict access right away. The <a href="https://www.digitalocean.com/community/tutorials/ufw-essentials-common-firewall-rules-and-commands">UFW Essentials: Common Firewall Rules and Commands</a> guide can help with this.<br></span></p>

<p>After you have configured your firewall on the first node, create the same firewall settings on the second and third node.</p>

<p>Now that you have configured the firewalls successfully, you&rsquo;re ready to start the cluster in the next step.</p>

<h2 id="step-6-—-starting-the-cluster">Step 6 — Starting the Cluster</h2>

<p>In this step, you will start your MySQL Galera cluster. But first, you will enable the MySQL <code>systemd</code> service, so that MySQL will start automatically whenever the server is rebooted.</p>

<h3 id="enable-mysql-to-start-on-boot-on-all-three-servers">Enable MySQL to Start on Boot on All Three Servers</h3>

<p>Use the following command on all three servers to enable the MySQL <code>systemd</code> service:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo systemctl enable mysql
</li></ul></code></pre>
<p>You will see the following output, which shows that the service has been linked successfully to the startup services list:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>Created symlink /etc/systemd/system/multi-user.target.wants/mysql.service → /lib/systemd/system/mysql.service.
</code></pre>
<p>Now that you&rsquo;ve enabled <code>mysql</code> to start on boot on all of the servers, you&rsquo;re ready to proceed to bring the cluster up.</p>

<h3 id="bring-up-the-first-node">Bring Up the First Node</h3>

<p>To bring up the first node, you&rsquo;ll need to use a special startup script. The way you&rsquo;ve configured your cluster, each node that comes online will try to connect to at least one other node specified in its <code>galera.cnf</code> file to get its initial state. Without using the <code>mysqld_bootstrap</code> script that allows <code>systemd</code> to pass the <code>--wsrep-new-cluster</code> parameter,  a normal <code>systemctl start mysql</code> would fail because there are no nodes running for the first node to connect with.</p>

<p>Run the following on your first server:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="galera-node-01$">sudo mysqld_bootstrap
</li></ul></code></pre>
<p>This command will not display any output on successful execution. When this script succeeds, the node is registered as part of the cluster, and you can see it with the following command:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="galera-node-01$">mysql -u root -p -e "SHOW STATUS LIKE 'wsrep_cluster_size'"
</li></ul></code></pre>
<p>After entering your password, you will see the following output, indicating that there is one node in the cluster:</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>+--------------------+-------+
| Variable_name      | Value |
+--------------------+-------+
| wsrep_cluster_size | 1     |
+--------------------+-------+

</code></pre>
<p>On the remaining nodes, you can start <code>mysql</code> normally. They will search for any member of the cluster list that is online, and when they find one, they will join the cluster.</p>

<h3 id="bring-up-the-second-node">Bring Up the Second Node</h3>

<p>Now you can bring up the second node. Start <code>mysql</code>:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="galera-node-02$">sudo systemctl start mysql
</li></ul></code></pre>
<p>No output will be displayed on successful execution. You will see your cluster size increase as each node comes online:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="galera-node-02$">mysql -u root -p -e "SHOW STATUS LIKE 'wsrep_cluster_size'"
</li></ul></code></pre>
<p>You will see the following output indicating that the second node has joined the cluster and that there are two nodes in total.</p>
<pre class="code-pre  second-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>+--------------------+-------+
| Variable_name      | Value |
+--------------------+-------+
| wsrep_cluster_size | 2     |
+--------------------+-------+

</code></pre>
<h3 id="bring-up-the-third-node">Bring Up the Third Node</h3>

<p>It&rsquo;s now time to bring up the third node. Start <code>mysql</code>:</p>
<pre class="code-pre custom_prefix third-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="galera-node-03$">sudo systemctl start mysql
</li></ul></code></pre>
<p>Run the following command to find the cluster size:</p>
<pre class="code-pre custom_prefix third-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="galera-node-03$">mysql -u root -p -e "SHOW STATUS LIKE 'wsrep_cluster_size'"
</li></ul></code></pre>
<p>You will see the following output, which indicates that the third node has joined the cluster and that the total number of nodes in the cluster is three.</p>
<pre class="code-pre  third-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>+--------------------+-------+
| Variable_name      | Value |
+--------------------+-------+
| wsrep_cluster_size | 3     |
+--------------------+-------+
</code></pre>
<p>At this point, the entire cluster is online and communicating successfully. Next, you can ensure the working setup by testing replication in the following section.</p>

<h2 id="step-7-—-testing-replication">Step 7 — Testing Replication</h2>

<p>You&rsquo;ve gone through the steps up to this point so that your cluster can perform replication from any node to any other node, known as active-active replication. In this step, you will test and see if the replication is working as expected.</p>

<h3 id="write-to-the-first-node">Write to the First Node</h3>

<p>You&rsquo;ll start by making database changes on your first node. The following commands will create a database called <code>playground</code> and a table inside of this database called <code>equipment</code>.</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="galera-node-01$">mysql -u root -p -e 'CREATE DATABASE playground;
</li><li class="line" prefix="galera-node-01$">CREATE TABLE playground.equipment ( id INT NOT NULL AUTO_INCREMENT, type VARCHAR(50), quant INT, color VARCHAR(25), PRIMARY KEY(id));
</li><li class="line" prefix="galera-node-01$">INSERT INTO playground.equipment (type, quant, color) VALUES ("slide", 2, "blue");'
</li></ul></code></pre>
<p>In the previous command, the <code>CREATE DATABASE</code> statement creates a database named <code>playground</code>. The <code>CREATE</code> statement creates a table named <code>equipment</code> inside the <code>playground</code> database having an auto-incrementing identifier column called <code>id</code> and other columns. The <code>type</code> column, <code>quant</code> column, and <code>color</code> column are defined to store the type, quantity, and color of the equipment respectively. The <code>INSERT</code> statement inserts an entry of type <code>slide</code>, quantity <code>2</code> and color <code>blue</code>.</p>

<p>You now have one value in your table.</p>

<h3 id="read-and-write-on-the-second-node">Read and Write on the Second Node</h3>

<p>Next, look at the second node to verify that replication is working:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="galera-node-02$">mysql -u root -p -e 'SELECT * FROM playground.equipment;'
</li></ul></code></pre>
<p>The data you entered on the first node will be visible here on the second, proving that replication is working:</p>
<pre class="code-pre  second-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>+----+-------+-------+-------+
| id | type  | quant | color |
+----+-------+-------+-------+
|  1 | slide |     2 | blue  |
+----+-------+-------+-------+
</code></pre>
<p>From this same node, write data to the cluster:</p>
<pre class="code-pre custom_prefix second-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="galera-node-02$">mysql -u root -p -e 'INSERT INTO playground.equipment (type, quant, color) VALUES ("swing", 10, "yellow");'
</li></ul></code></pre>
<h3 id="read-and-write-on-the-third-node">Read and Write on the Third Node</h3>

<p>From the third node, you can read all of this data by querying the table again:</p>
<pre class="code-pre custom_prefix third-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="galera-node-03$">mysql -u root -p -e 'SELECT * FROM playground.equipment;'
</li></ul></code></pre>
<p>You will see the following output showing the two rows:</p>
<pre class="code-pre  third-environment"><code langs=""><div class="secondary-code-label " title="Output">Output</div>   +----+-------+-------+--------+
   | id | type  | quant | color  |
   +----+-------+-------+--------+
   |  1 | slide |     2 | blue   |
   |  2 | swing |    10 | yellow |
   +----+-------+-------+--------+
</code></pre>
<p>Again, you can add another value from this node:</p>
<pre class="code-pre custom_prefix third-environment"><code langs=""><ul class="prefixed"><li class="line" prefix="galera-node-03$">mysql -u root -p -e 'INSERT INTO playground.equipment (type, quant, color) VALUES ("seesaw", 3, "green");'
</li></ul></code></pre>
<h3 id="read-on-the-first-node">Read on the First Node</h3>

<p>Back on the first node, you can verify that your data is available everywhere:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="galera-node-01$">mysql -u root -p -e 'SELECT * FROM playground.equipment;'
</li></ul></code></pre>
<p>You will see the following output, which indicates that the rows are available on the first node.</p>
<pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>   +----+--------+-------+--------+
   | id | type   | quant | color  |
   +----+--------+-------+--------+
   |  1 | slide  |     2 | blue   |
   |  2 | swing  |    10 | yellow |
   |  3 | seesaw |     3 | green  |
   +----+--------+-------+--------+
</code></pre>
<p>You&rsquo;ve now verified successfully that you can write to all of the nodes and that replication is being performed properly.</p>

<h2 id="conclusion">Conclusion</h2>

<p>At this point, you have a working three-node Galera test cluster configured. If you plan on using a Galera cluster in a production situation, it’s recommended that you begin with no fewer than five nodes.</p>

<p>Before production use, you may want to take a look at some of the <a href="http://galeracluster.com/documentation-webpages/sst.html">other state snapshot transfer (sst) agents</a> like <strong>xtrabackup</strong>, which allows you to set up new nodes quickly and without large interruptions to your active nodes. This does not affect the actual replication, but is a concern when nodes are being initialized.</p>

<p>You might also be interested in other clustering solutions for MySQL, in which case you can check out our <a href="https://www.digitalocean.com/community/tutorials/how-to-create-a-multi-node-mysql-cluster-on-ubuntu-18-04">How To Create a Multi-Node MySQL Cluster on Ubuntu 18.04</a> tutorial. If you are looking to try out a managed database solution, see our <a href="https://www.digitalocean.com/docs/databases/">DigitalOcean Managed Databases documentation</a>.</p>
